var Pl=Object.defineProperty,jl=Object.defineProperties;var Wl=Object.getOwnPropertyDescriptors;var ht=Object.getOwnPropertySymbols;var ls=Object.prototype.hasOwnProperty,os=Object.prototype.propertyIsEnumerable;var ss=(P,V,O)=>V in P?Pl(P,V,{enumerable:!0,configurable:!0,writable:!0,value:O}):P[V]=O,ee=(P,V)=>{for(var O in V||(V={}))ls.call(V,O)&&ss(P,O,V[O]);if(ht)for(var O of ht(V))os.call(V,O)&&ss(P,O,V[O]);return P},ye=(P,V)=>jl(P,Wl(V));var Tt=(P,V)=>{var O={};for(var E in P)ls.call(P,E)&&V.indexOf(E)<0&&(O[E]=P[E]);if(P!=null&&ht)for(var E of ht(P))V.indexOf(E)<0&&os.call(P,E)&&(O[E]=P[E]);return O};var we=(P,V,O)=>new Promise((E,ie)=>{var A=G=>{try{v(O.next(G))}catch(Q){ie(Q)}},ke=G=>{try{v(O.throw(G))}catch(Q){ie(Q)}},v=G=>G.done?E(G.value):Promise.resolve(G.value).then(A,ke);v((O=O.apply(P,V)).next())});import{_ as Mt,r as y,x as ce,o as a,c as n,d as t,i as D,j as R,F as B,h as z,t as g,f as ms,m as C,Z as Rt,Q as Ot,n as j,l as m,k as Be,N as fe,L as T,a6 as Hl,X as me,U as te,H as ue,z as W,y as J,u as Jl,M as Gl,e as pe,E as Yl,w as qe,a7 as as,K as ve,a8 as Zl,S as ns,b as oe,O as it,B as is,R as Oe,v as gt,a9 as rs,aa as ds,ab as Kl,ac as Lt,a2 as us,ad as cs,D as ps,ae as Ql}from"./index-B2Wfiq8l.js";const Xl="/assets/ezy_forms/ezyformsfrontend/assets/oui_app-users-roles-C_V_SNI2.svg",xl={class:"simple-field-library"},Il={class:"field-search"},eo={class:"field-types-grid"},to=["onDragstart","onClick"],so={__name:"SimpleFieldLibrary",props:{fields:{type:Array,required:!0}},emits:["field-add","field-dragstart","field-dragend"],setup(P,{emit:V}){const O=P,E=V,ie=y(""),A=y(!1),ke=ce(()=>{if(!ie.value)return O.fields;const N=ie.value.toLowerCase();return O.fields.filter(re=>re.label.toLowerCase().includes(N))}),v=(N,re)=>{A.value=!0,N.dataTransfer.effectAllowed="copy",N.dataTransfer.setData("text/plain",re.type),E("field-dragstart",re.type)},G=()=>{A.value=!1,E("field-dragend")},Q=N=>{E("field-add",N.type)};return(N,re)=>(a(),n("div",xl,[t("div",Il,[re[1]||(re[1]=t("i",{class:"bi bi-search"},null,-1)),D(t("input",{"onUpdate:modelValue":re[0]||(re[0]=Z=>ie.value=Z),type:"text",placeholder:"Search fields",class:"search-input"},null,512),[[R,ie.value]])]),t("div",eo,[(a(!0),n(B,null,z(ke.value,Z=>(a(),n("button",{key:Z.type,class:"field-type-btn",draggable:!0,onDragstart:X=>v(X,Z),onDragend:G,onClick:X=>Q(Z)},g(Z.label),41,to))),128))])]))}},lo=Mt(so,[["__scopeId","data-v-cb64d6f9"]]),oo={class:"frappe-form-builder"},ao={class:"builder-toolbar stepperbackground ps-2 pe-2 m-0 d-flex justify-content-between align-items-center"},no=["disabled"],io=["disabled"],ro={class:"fields-container mt-3"},uo=["onMouseenter"],co={class:"d-flex justify-content-between align-items-start"},po={class:"flex-grow-1"},mo={class:"d-flex align-items-center gap-2 mb-2"},fo={class:"flex-grow-1"},vo=["onUpdate:modelValue","onInput"],bo={key:1,class:"font-14"},_o={class:"badge bg-primary font-11"},ho={key:0,class:"field-preview-info"},go={class:"text-muted font-12"},yo={key:0,class:"text-danger ms-1"},wo={key:1,class:"badge bg-secondary ms-1 font-10"},ko={key:2,class:"badge bg-dark ms-1 font-10"},$o={key:3,class:"badge bg-info ms-1 font-10"},Fo={key:1,class:"mt-2"},Co=["onUpdate:modelValue","onChange"],Do=["value"],So=["onUpdate:modelValue"],qo={key:0,class:"text-danger font-10 d-block mb-2"},Ao=["onUpdate:modelValue"],Vo={key:1,class:"mb-2"},Eo={class:"font-12 fw-light"},Uo=["onUpdate:modelValue","placeholder"],To=["onUpdate:modelValue","placeholder"],Lo={key:2,class:"text-danger font-10"},Ro=["onUpdate:modelValue"],Oo={class:"d-flex flex-wrap gap-3 mb-2"},Mo={class:"form-check"},Bo=["onUpdate:modelValue","id"],No=["for"],zo={class:"form-check"},Po=["onUpdate:modelValue","id"],jo=["for"],Wo={class:"form-check"},Ho=["onUpdate:modelValue","id"],Jo=["for"],Go={class:"form-check"},Yo=["onUpdate:modelValue","id"],Zo=["for"],Ko={class:"form-check"},Qo=["onUpdate:modelValue","id"],Xo=["for"],xo={class:"mb-2"},Io={class:"mt-2"},ea=["onUpdate:modelValue"],ta=["onUpdate:modelValue"],sa={class:"d-flex gap-2 mt-2"},la=["onClick"],oa=["onClick"],aa={key:0,class:"FieldcopyRemove"},na=["onClick"],ia=["onClick"],ra=["onClick"],da={key:1,class:"empty-state text-center py-5"},ua={class:"modal-body-custom"},ca={class:"json-preview"},pa={__name:"FrappeFormBuilder",props:{formName:{type:String,default:""},existingFields:{type:Array,default:()=>[]}},emits:["save","preview","update"],setup(P,{expose:V,emit:O}){const E=P,ie=O,A=y([]),ke=y([{label:"Text",type:"Data"},{label:"Time",type:"Time"},{label:"Text Area",type:"Text"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Attach",type:"Attach"},{label:"Phone",type:"Data"},{label:"Check",type:"Check"},{label:"Number",type:"Int"},{label:"Select",type:"Select"},{label:"Multi Select",type:"Small Text"},{label:"Link",type:"Link"}]),v=y(!1),G=y(!1),Q=y(!1),N=y(null);ms(()=>we(this,null,function*(){E.existingFields&&E.existingFields.length>0&&(A.value=E.existingFields.map((w,f)=>ye(ee({},w),{idx:f+1,editing:!1})))}));const re=w=>({idx:w,fieldname:`field_${w}`,fieldtype:"Data",label:`Field ${w}`,description:"",options:"",reqd:0,read_only:0,hidden:0,default:"",depends_on:"",mandatory_depends_on:"",read_only_depends_on:"",permlevel:0,in_list_view:0,in_standard_filter:0,in_global_search:0,bold:0,allow_bulk_edit:0,allow_in_quick_entry:0,allow_on_submit:0,ignore_user_permissions:0,ignore_xss_filter:0,translatable:0,unique:0,fetch_from:"",fetch_if_empty:0,columns:0,length:0,precision:"",non_negative:0,report_hide:0,collapsible:0,collapsible_depends_on:"",print_hide:0,print_hide_if_no_value:0,sort_options:0,remember_last_selected_value:0,is_virtual:0,search_index:0,documentation_url:"",editing:!0}),Z=()=>{const w=A.value.length+1,f=re(w);A.value.forEach(h=>{h.editing=!1}),A.value.push(f)},X=w=>{A.value.forEach((f,h)=>{h!==w&&(f.editing=!1)}),A.value[w].editing=!0},Y=w=>{const f=A.value[w];if(!f.label||!f.fieldname||!f.fieldtype){te("Label, fieldname, and field type are required");return}if(!ae(f.fieldname)){te("Invalid fieldname format");return}if(Ze(f.fieldtype)&&(!f.options||!f.options.trim())){te("Options are required for this field type");return}A.value[w].editing=!1,A.value.forEach((h,U)=>{h.idx=U+1}),ie("update",be()),ue("Field saved successfully")},H=w=>{const f=A.value[w];if(f.fieldname.startsWith("field_")&&f.label.startsWith("Field ")){A.value.splice(w,1),A.value.forEach((h,U)=>{h.idx=U+1});return}A.value[w].editing=!1},Ae=w=>{const f=ee({},A.value[w]),h=A.value.length+1;f.idx=h,f.fieldname=`${f.fieldname}_copy`,f.label=`${f.label} (Copy)`,f.editing=!0,A.value.forEach(U=>{U.editing=!1}),A.value.push(f)},$e=w=>{const f=A.value[w].label||"this field";confirm(`Are you sure you want to delete "${f}"?`)&&(A.value.splice(w,1),A.value.forEach((h,U)=>{h.idx=U+1}),ie("update",be()))},Ne=w=>{const f=A.value[w];f.label&&(!f.fieldname||f.fieldname.startsWith("field_"))&&(f.fieldname=f.label.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""))},ze=w=>{const f=A.value[w];Ze(f.fieldtype)||(f.options="")},Ze=w=>["Select","Link","Table","Table MultiSelect","Small Text"].includes(w),yt=w=>w==="Select"||w==="Small Text"?"Enter Options:":w==="Link"?"Search Doctype:":w==="Table"?"Child DocType:":"Options:",L=w=>w==="Select"||w==="Small Text"?"Enter your Options":w==="Link"?"Type to search DocType...":w==="Table"?"Enter Child DocType name":"Enter options",ae=w=>/^[a-z_][a-z0-9_]*$/.test(w),be=()=>A.value.map((w,f)=>{const h=ee({},w);return delete h.editing,h.idx=f+1,h}),Ve=()=>we(this,null,function*(){try{if(A.value.some(U=>U.editing)){te("Please save all fields before saving the form schema");return}const f=be(),h={form_name:E.formName||"Untitled Form",fields:JSON.stringify(f)};if(W.saveFormDefinition){Q.value=!0;const U=yield J.post(W.saveFormDefinition,h);if(Q.value=!1,U&&U.data&&U.data.message&&U.data.message.success)ue("Form schema saved successfully!"),ie("save",f);else throw new Error("Failed to save form schema")}}catch(w){Q.value=!1,console.error("Error saving form schema:",w),te("Failed to save form schema. Please try again.")}}),Pe=()=>{G.value=!0,ie("preview",be())},Ke=()=>{G.value=!1},wt=()=>we(this,null,function*(){const w=prompt("Enter form name to load:");if(w)try{if(Q.value=!0,W.getFormDefinition){const f=yield J.post(W.getFormDefinition,{form_name:w});Q.value=!1;const h=f.data.message;if(h&&h.success&&h.fields){const U=typeof h.fields=="string"?JSON.parse(h.fields):h.fields;A.value=U.map((q,Fe)=>ye(ee({},q),{idx:Fe+1,editing:!1})),ue("Form loaded successfully!")}else throw new Error("Form not found")}}catch(f){Q.value=!1,console.error("Error loading form:",f),te("Failed to load form. Please check the form name and try again.")}});return V({formFields:A,saveFormSchema:Ve,addNewField:Z,getFields:()=>be()}),(w,f)=>(a(),n("div",oo,[t("div",ao,[f[9]||(f[9]=t("div",null,null,-1)),f[10]||(f[10]=t("h1",{class:"font-14 fw-bold m-0"},"Advanced Form Builder",-1)),t("div",null,[t("button",{onClick:Z,class:"btn btn-light font-13 mx-2"},f[5]||(f[5]=[t("i",{class:"bi bi-plus-circle"},null,-1),C(" Add Field ")])),t("button",{onClick:wt,class:"btn btn-light font-13 mx-2"},f[6]||(f[6]=[t("i",{class:"bi bi-folder-open"},null,-1),C(" Load ")])),t("button",{onClick:Pe,class:"btn btn-light font-13 mx-2",disabled:A.value.length===0},f[7]||(f[7]=[t("i",{class:"bi bi-eye"},null,-1),C(" Preview ")]),8,no),t("button",{onClick:Ve,class:"btn btn-dark bg-dark text-white fw-bold font-13",disabled:A.value.length===0},f[8]||(f[8]=[t("i",{class:"bi bi-save"},null,-1),C(" Save Schema ")]),8,io)])]),t("div",ro,[A.value.length>0?(a(),Rt(T(Hl),{key:0,modelValue:A.value,"onUpdate:modelValue":f[1]||(f[1]=h=>A.value=h),"item-key":h=>h.idx,handle:".drag-handle",onStart:f[2]||(f[2]=h=>v.value=!0),onEnd:f[3]||(f[3]=h=>v.value=!1),animation:200,"ghost-class":"ghost-field"},{item:Ot(({element:h,index:U})=>[t("div",{class:j(["field-item dynamicColumn px-3 py-2",{dragging:v.value}]),onMouseenter:q=>N.value=U,onMouseleave:f[0]||(f[0]=q=>N.value=null)},[t("div",co,[t("div",po,[t("div",mo,[f[11]||(f[11]=t("div",{class:"drag-handle",style:{cursor:"move"}},[t("i",{class:"bi bi-grip-vertical font-16"})],-1)),t("div",fo,[h.editing?D((a(),n("input",{key:0,"onUpdate:modelValue":q=>h.label=q,placeholder:"Name the field",class:j(["border-less-input","font-14","p-0","inputHeight",{"italic-style":!h.label},{"fw-medium":h.label}]),onInput:q=>Ne(U)},null,42,vo)),[[R,h.label]]):(a(),n("strong",bo,g(h.label||"Untitled Field"),1))]),t("span",_o,g(h.fieldtype),1)]),h.editing?m("",!0):(a(),n("div",ho,[t("small",go,g(h.fieldname),1),h.reqd?(a(),n("span",yo,"*")):m("",!0),h.read_only?(a(),n("span",wo,"Read Only")):m("",!0),h.hidden?(a(),n("span",ko,"Hidden")):m("",!0),h.unique?(a(),n("span",$o,"Unique")):m("",!0)])),h.editing?(a(),n("div",Fo,[D(t("select",{"onUpdate:modelValue":q=>h.fieldtype=q,class:"form-select mb-2 font-13 searchSelect",onChange:q=>ze(U)},[f[12]||(f[12]=t("option",{value:""},"Select Type",-1)),(a(!0),n(B,null,z(ke.value,q=>(a(),n("option",{key:q.type,value:q.type},g(q.label),9,Do))),128))],40,Co),[[Be,h.fieldtype]]),D(t("input",{"onUpdate:modelValue":q=>h.fieldname=q,type:"text",class:"form-control mb-2 font-12",placeholder:"fieldname (lowercase with underscores)"},null,8,So),[[R,h.fieldname]]),ae(h.fieldname)?m("",!0):(a(),n("small",qo," Invalid fieldname format ")),D(t("textarea",{"onUpdate:modelValue":q=>h.description=q,class:"form-control mb-2 font-12",rows:"2",placeholder:"Field description"},null,8,Ao),[[R,h.description]]),Ze(h.fieldtype)?(a(),n("div",Vo,[t("label",Eo,g(yt(h.fieldtype)),1),h.fieldtype==="Select"||h.fieldtype==="Small Text"?D((a(),n("textarea",{key:0,"onUpdate:modelValue":q=>h.options=q,class:"form-control shadow-none font-12",rows:"3",placeholder:L(h.fieldtype)},null,8,Uo)),[[R,h.options]]):D((a(),n("input",{key:1,"onUpdate:modelValue":q=>h.options=q,type:"text",class:"form-control font-12",placeholder:L(h.fieldtype)},null,8,To)),[[R,h.options]]),!h.options||!h.options.trim()?(a(),n("small",Lo," Options are required for this field type ")):m("",!0)])):m("",!0),D(t("input",{"onUpdate:modelValue":q=>h.default=q,type:"text",class:"form-control mb-2 font-12",placeholder:"Default value"},null,8,Ro),[[R,h.default]]),t("div",Oo,[t("div",Mo,[D(t("input",{"onUpdate:modelValue":q=>h.reqd=q,type:"checkbox",class:"form-check-input",id:`reqd-${U}`,"true-value":1,"false-value":0},null,8,Bo),[[fe,h.reqd]]),t("label",{class:"form-check-label font-12",for:`reqd-${U}`}," Mandatory ",8,No)]),t("div",zo,[D(t("input",{"onUpdate:modelValue":q=>h.read_only=q,type:"checkbox",class:"form-check-input",id:`readonly-${U}`,"true-value":1,"false-value":0},null,8,Po),[[fe,h.read_only]]),t("label",{class:"form-check-label font-12",for:`readonly-${U}`}," Read Only ",8,jo)]),t("div",Wo,[D(t("input",{"onUpdate:modelValue":q=>h.hidden=q,type:"checkbox",class:"form-check-input",id:`hidden-${U}`,"true-value":1,"false-value":0},null,8,Ho),[[fe,h.hidden]]),t("label",{class:"form-check-label font-12",for:`hidden-${U}`}," Hidden ",8,Jo)]),t("div",Go,[D(t("input",{"onUpdate:modelValue":q=>h.unique=q,type:"checkbox",class:"form-check-input",id:`unique-${U}`,"true-value":1,"false-value":0},null,8,Yo),[[fe,h.unique]]),t("label",{class:"form-check-label font-12",for:`unique-${U}`}," Unique ",8,Zo)]),t("div",Ko,[D(t("input",{"onUpdate:modelValue":q=>h.in_list_view=q,type:"checkbox",class:"form-check-input",id:`listview-${U}`,"true-value":1,"false-value":0},null,8,Qo),[[fe,h.in_list_view]]),t("label",{class:"form-check-label font-12",for:`listview-${U}`}," In List View ",8,Xo)])]),t("details",xo,[f[13]||(f[13]=t("summary",{class:"font-12 fw-medium cursor-pointer"},"Advanced Options",-1)),t("div",Io,[D(t("input",{"onUpdate:modelValue":q=>h.depends_on=q,type:"text",class:"form-control mb-2 font-12",placeholder:"Depends on (e.g., eval:doc.field=='value')"},null,8,ea),[[R,h.depends_on]]),D(t("input",{"onUpdate:modelValue":q=>h.fetch_from=q,type:"text",class:"form-control mb-2 font-12",placeholder:"Fetch from (e.g., link_field.source_field)"},null,8,ta),[[R,h.fetch_from]])])]),t("div",sa,[t("button",{onClick:q=>Y(U),class:"btn btn-dark btn-sm font-12"},f[14]||(f[14]=[t("i",{class:"bi bi-check"},null,-1),C(" Save ")]),8,la),t("button",{onClick:q=>H(U),class:"btn btn-secondary btn-sm font-12"}," Cancel ",8,oa)])])):m("",!0)]),N.value===U&&!h.editing?(a(),n("div",aa,[t("button",{class:"btn btn-light btn-sm bg-transparent py-0",onClick:q=>X(U),title:"Edit"},f[15]||(f[15]=[t("i",{class:"bi bi-pencil font-13"},null,-1)]),8,na),t("button",{class:"btn btn-light btn-sm bg-transparent py-0",onClick:q=>Ae(U),title:"Duplicate"},f[16]||(f[16]=[t("i",{class:"ri-file-copy-line font-13 copyIcon"},null,-1)]),8,ia),t("button",{class:"btn btn-light btn-sm bg-transparent trash-btn py-0",onClick:q=>$e(U),title:"Delete"},f[17]||(f[17]=[t("i",{class:"bi bi-x-lg font-13"},null,-1)]),8,ra)])):m("",!0)])],42,uo)]),_:1},8,["modelValue","item-key"])):m("",!0),A.value.length===0?(a(),n("div",da,f[18]||(f[18]=[t("i",{class:"bi bi-inbox",style:{"font-size":"48px",color:"#6c757d"}},null,-1),t("p",{class:"text-muted mt-3"},'No fields added yet. Click "Add Field" to get started.',-1)]))):m("",!0)]),G.value?(a(),n("div",{key:0,class:"modal-backdrop",onClick:Ke},[t("div",{class:"modal-content-custom",onClick:f[4]||(f[4]=me(()=>{},["stop"]))},[t("div",{class:"modal-header-custom"},[f[20]||(f[20]=t("h5",{class:"font-16 fw-bold m-0"},"Form Schema Preview",-1)),t("button",{onClick:Ke,class:"btn-close-custom"},f[19]||(f[19]=[t("i",{class:"bi bi-x-lg"},null,-1)]))]),t("div",ua,[t("pre",ca,g(JSON.stringify(be(),null,2)),1)])])])):m("",!0)]))}},ma=Mt(pa,[["__scopeId","data-v-52a46c1a"]]),fa={class:""},va={class:""},ba={class:"d-flex justify-content-between align-items-center CancelNdSave"},_a={class:"d-flex align-items-center"},ha={key:0,class:"font-16"},ga=["disabled"],ya={class:"form-container p-0 container-fluid mt-3"},wa={class:"row g-4"},ka={class:"col-lg-2 col-md-3 col-sm-12"},$a={class:"steps-sticky-div"},Fa={class:"steps d-sm-inline-flex d-md-block m-0 p-0"},Ca=["onClick"],Da={key:0,class:"ri-checkbox-circle-fill completedStepIcon"},Sa={class:"step-text"},qa={class:"font-11"},Aa={class:"font-14"},Va={class:"col-lg-10 col-md-9 col-sm-12 formbackground-color"},Ea={class:"px-2"},Ua={class:"form-content stepsDiv"},Ta={key:0},La={class:""},Ra={class:"stepperbackground ps-2 pe-2 m-0 d-flex justify-content-between align-items-center"},Oa={class:"container-fluid aboutFields p-0"},Ma={class:"row"},Ba={class:"col-sm-12 col-md-12 mt-lg-3 p-lg-4"},Na={class:"container-fluid"},za={class:"row g-3"},Pa={class:"col-md-6"},ja={class:"position-relative"},Wa={key:0,class:"font-12 position-absolute PredefinedLabel"},Ha={key:1,class:"text-danger ErrorMsg ms-2"},Ja={class:"col-md-6"},Ga={key:0,class:"text-danger ErrorMsg ms-2"},Ya={class:"col-md-6"},Za={class:"col-md-6"},Ka={key:0,class:"text-danger"},Qa={class:"col-md-6"},Xa={key:0,class:"text-danger"},xa={class:"col-md-6"},Ia={key:0,class:"text-danger"},en={class:"custom-option"},tn=["checked","onChange"],sn={class:"col-md-6"},ln={class:"col-md-6"},on={key:0,class:"col-md-6"},an={key:1,class:"col-md-6"},nn={key:2,class:"col-md-6"},rn={key:3,class:"col-md-6"},dn={class:"form-check d-flex align-items-center p-0 pe-3"},un=["disabled"],cn={key:4,class:"col-md-6"},pn=["disabled"],mn={key:0,class:"list-group position-absolute w-100 z-3 formslist"},fn=["onMousedown"],vn={key:1,class:"zoho-form-builder"},bn={class:"zoho-toolbar"},_n={class:"toolbar-left"},hn={class:"zoho-tabs"},gn=["onClick"],yn=["onClick"],wn={class:"toolbar-right"},kn={class:"zoho-builder-container"},$n={key:0,class:"advanced-builder-wrapper"},Fn={class:"d-flex align-items-center justify-content-between w-100"},Cn={class:"mb-0 font-14 fw-bold"},Dn={class:"btn btn-sm btn-link p-0 text-dark"},Sn={key:0,class:"library-content"},qn={class:"zoho-form-canvas"},An={class:"requestandAppHeader"},Vn={class:"d-flex justify-content-between align-items-center"},En={class:""},Un={class:"ps-2 mb-0 fw-bolder font-14 blockTitle"},Tn={class:"text-center ms-2 mt-1"},Ln={key:0,class:"font-12 d-flex align-items-center"},Rn={class:"font-12 approver_type_div"},On={class:"font-12 fw-bold"},Mn={class:"font-12 text-danger ms-1"},Bn={class:"d-flex align-items-center"},Nn={key:0,class:"role-container"},zn={key:0,class:"role-text d-flex align-items-center"},Pn={class:"role-label fw-bold"},jn={class:"role-names text-primary"},Wn=["onClick"],Hn=["onClick"],Jn=["onClick"],Gn=["onClick"],Yn={class:"pt-0 section_block"},Zn={class:"d-flex justify-content-between align-items-center"},Kn={class:"d-flex flex-column"},Qn=["onUpdate:modelValue","onChange","onInput"],Xn={key:0,class:"text-danger ps-3 font-10"},xn={class:"d-flex align-items-center"},In=["onClick"],ei={class:"container-fluid"},ti={class:"d-flex justify-content-between align-items-center"},si={class:"rownames m-0"},li=["onClick"],oi={class:"col"},ai={class:"row"},ni=["onMouseenter"],ii={class:"column_name d-flex align-items-center justify-content-between"},ri={class:"d-flex flex-column ps-2"},di=["onUpdate:modelValue","onChange","onInput"],ui={key:0,class:"text-danger ps-2 font-10"},ci={class:"position-absolute top-0 end-0"},pi=["onClick"],mi=["onDrop"],fi=["onMouseenter","onDragstart","onDrop"],vi=["onDrop"],bi=["onDragstart","onDrop"],_i={class:"d-flex justify-content-between"},hi={class:"flex-column d-flex"},gi=["onUpdate:modelValue","onChange","onInput"],yi={key:0,class:"text-danger font-10"},wi={class:"FieldcopyRemove"},ki=["onClick"],$i=["onClick"],Fi=["onUpdate:modelValue","onChange"],Ci=["value"],Di={key:0},Si=["onUpdate:modelValue"],qi={key:0,class:"text-danger font-10"},Ai={key:1},Vi=["for"],Ei=["id","onUpdate:modelValue","onInput","onFocus"],Ui={key:0,class:"list-group mt-1",style:{"max-height":"200px","overflow-y":"auto"}},Ti=["onClick"],Li={class:"d-flex align-items-center justify-content-between"},Ri={class:"d-flex align-items-center gap-2"},Oi={class:"d-flex align-items-center"},Mi=["onUpdate:modelValue","id"],Bi=["for"],Ni=["onClick"],zi=["onUpdate:modelValue"],Pi={key:3,class:"text-danger font-10"},ji=["onDrop"],Wi={class:"childtableShow"},Hi={class:"mt-2"},Ji={key:0,class:"childTableContainer"},Gi={key:0,class:"font-13"},Yi={key:1,class:"d-flex align-items-center gap-2"},Zi={class:"d-flex align-items-center"},Ki=["onUpdate:modelValue"],Qi=["onClick"],Xi={key:2,class:"table table-bordered rounded-table"},xi=["onDrop"],Ii=["draggable","onDragstart"],er={key:0},tr=["onUpdate:modelValue","onInput"],sr={key:0,class:"text-danger font-11"},lr={key:1},or={key:2},ar={class:"d-flex gap-1"},nr=["onUpdate:modelValue","onChange"],ir=["value"],rr={class:"d-flex"},dr={class:"d-flex align-items-center gap-2"},ur={class:"d-flex align-items-center"},cr=["onUpdate:modelValue"],pr=["onClick"],mr={key:0},fr=["onUpdate:modelValue","onInput"],vr={key:0,class:"text-danger font-10"},br={key:1,class:"font-11 text-danger"},_r={key:3},hr={key:3,class:"mb-2 mt-3"},gr=["onClick"],yr=["onClick"],wr=["onDrop"],kr=["onDrop"],$r={class:"d-flex justify-content-center align-items-center my-2"},Fr=["onClick"],Cr={class:"font-13"},Dr={key:0,class:"d-flex align-items-center gap-2"},Sr={class:"d-flex align-items-center"},qr=["onUpdate:modelValue"],Ar=["onClick"],Vr={class:"table table-bordered rounded-table"},Er={key:0},Ur=["onUpdate:modelValue","onBlur"],Tr={key:0,class:"text-danger font-11 mt-1"},Lr={key:1},Rr={key:2},Or={class:"d-flex gap-1 align-items-center"},Mr=["onUpdate:modelValue","onChange"],Br=["value"],Nr=["onClick"],zr={key:0,class:"mt-1"},Pr=["onUpdate:modelValue","onInput"],jr={key:1,class:"text-danger font-11 mt-1"},Wr={key:3},Hr={class:"mb-2"},Jr=["onClick"],Gr=["onClick"],Yr=["onClick"],Zr={key:0},Kr={class:"d-flex justify-content-between align-items-center mt-1 mb-2"},Qr=["onUpdate:modelValue","onBlur"],Xr={key:0,class:"text-danger font-12"},xr={key:1,class:"text-danger font-12"},Ir={class:"d-flex align-items-center gap-2"},ed={class:"d-flex align-items-center"},td=["onUpdate:modelValue"],sd=["onClick"],ld=["onClick"],od={class:"px-1 field-border"},ad={class:"d-flex justify-content-between"},nd=["onUpdate:modelValue","onBlur"],id={key:0,class:"text-danger font-12"},rd={class:"d-flex align-items-center"},dd={class:"d-flex my-1"},ud=["onUpdate:modelValue"],cd=["onClick"],pd=["onClick"],md=["onUpdate:modelValue"],fd=["value"],vd={key:0},bd=["onUpdate:modelValue"],_d={key:0,class:"text-danger font-10"},hd={key:1,class:"text-danger font-12"},gd=["onClick"],yd=["onClick"],wd={class:"d-flex justify-content-center align-items-center py-2 add-section-btn"},kd=["onClick"],$d={key:0,class:"m-2"},Fd={key:0,class:"zoho-properties-panel"},Cd={class:"properties-header"},Dd={key:2},Sd={class:"stepperbackground d-flex align-items-center justify-content-between p-3"},qd={class:"container-fluid mt-4 p-4"},Ad={class:"card mb-4"},Vd={class:"card-body"},Ed={class:"row g-3"},Ud={class:"col-md-6"},Td={class:"btn-group w-100",role:"group"},Ld={key:0,class:"col-md-6"},Rd={key:0,class:"card mb-4"},Od={class:"card-body"},Md={key:0,class:"table-responsive"},Bd={class:"table table-bordered"},Nd=["onUpdate:modelValue"],zd={class:"form-check form-switch"},Pd=["onUpdate:modelValue"],jd={class:"form-check-label font-12"},Wd=["onClick"],Hd=["onClick"],Jd={key:1,class:"card mb-4"},Gd={class:"card-body"},Yd={class:"alert alert-success"},Zd={class:"table-responsive"},Kd={class:"table table-bordered"},Qd={key:0,class:"badge bg-success"},Xd={key:1,class:"badge bg-secondary"},xd={class:"text-muted"},Id={key:2,class:"card mb-4"},eu={class:"card-body"},tu={class:"alert alert-success"},su={class:"table-responsive"},lu={class:"table table-bordered table-hover"},ou={class:"badge bg-dark"},au={key:0,class:"badge bg-danger"},nu={key:1,class:"badge bg-secondary"},iu={key:0,class:"badge bg-info"},ru={key:1,class:"badge bg-warning text-dark"},du={key:2,class:"badge bg-success"},uu={key:3,class:"badge bg-secondary"},cu={class:"text-muted"},pu={key:3},mu={class:"modal fade",id:"customFormatModal",tabindex:"-1","aria-labelledby":"customFormatModalLabel","aria-hidden":"true"},fu={class:"modal-dialog modal-dialog-centered"},vu={class:"modal-content"},bu={class:"modal-body"},_u=["placeholder"],hu={class:"d-flex align-items-center gap-2"},gu={class:"d-flex align-items-center py-2"},yu={class:"modal fade",id:"formViewModal",tabindex:"-1","aria-labelledby":"formViewModalLabel","aria-hidden":"true"},wu={class:"modal-dialog modal-xl modal-dialog-scrollable"},ku={class:"modal-content"},$u={class:"modal-body"},Fu={class:"offcanvas addOffCanvas offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},Cu={class:"offcanvas-header add_designationHeader"},Du={id:"offcanvasRightLabel",class:"font-14 fw-bold"},Su={class:"offcanvas-body add_desig_offCanvas_body p-0"},qu={class:""},Au={key:0,class:"p-3 approval-border-bottom"},Vu={class:"px-3 listofdesignations"},Eu={class:"my-1 d-flex justify-content-between"},Uu={class:"font-12 fw-bold"},Tu={class:"italic-style text-secondary font-12"},Lu={key:0,ref:"resizableDiv",class:"my-1 disgnationlist_div"},Ru={class:"d-flex align-items-center justify-content-between gap-1"},Ou={class:"form-check ps-1 d-flex align-items-center m-0"},Mu=["checked"],Bu={for:"selectAll",class:"form-check-label SelectallDesignation mt-2 fw-bold"},Nu={key:0,class:"form-check d-flex align-items-center m-0"},zu={key:1},Pu={key:1,class:"p-3"},ju=["value"],Wu={key:2},Hu={class:""},Ju={class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Gu={key:0,class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Yu={class:"offcanvas-footer"},Zu={class:"text-end p-3"},Me="Select All",Ku={__name:"FormStepper",setup(P){const V=Jl(),O=Gl(),E=y(1),ie=y([]);y([]);const A=y([]),ke=y([]);pe([]);let v=pe([]),G=pe([]);const Q=y([]),N=y([]),re=y([]),Z=y(""),X=y(""),Y=y("");let H=pe([]);const Ae=y("");y(!1),y(!1),y(!1);const $e=y(""),Ne=y(""),ze=y(""),Ze=y([]),yt=y([]),L=pe({}),ae=y([]),be=y(!1),Ve=y([]),Pe=y(!1);let Ke=null;const wt=y("");let w=y("");const f=y(null),h=y(null),U=y(null),q=y(0),Fe=y(!1),je=y(!0),Qe=y([]),Ce=y(null),ge=y("new"),rt=y([]),We=y([]);y([]);const Ee=y([]),He=ce(()=>Yl);y(!1);const dt=pe([]),de=y({routepath:V.query.routepath,business_unit:V.query.business_unit,formId:V.query.id}),ut=y(""),Je=y(!1),Ge=y(!1),Bt=[{label:"Public",value:1},{label:"Private",value:0}],Nt=ce({get(){return Bt.find(s=>s.value===_.value.as_web_view)},set(s){_.value.as_web_view=s?s.value:null}}),kt=ce({get(){return _.value.form_name||V.query.form_name||""},set(s){_.value.form_name=s}}),_=y({form_name:"",form_short_name:"",accessible_departments:[],business_unit:`${He.value.value||de.value.business_unit||V.query.business_unit}`,form_category:"",owner_of_the_form:"",series:"",has_workflow:"",workflow_check:"",is_linked:0,is_linked_form:"",is_predefined_doctype:V.query.id?1:0,as_web_view:0,mail_id:""});qe(()=>V.query.form_name,s=>{s&&(_.value.form_name=s,_.value.form_short_name=s)},{immediate:!0});const ct=["name","parent","creation","owner","modified","modified_by","parentfield","parenttype","file_list","flags","docstatus","idx","doctype","company_field","business_unit"].map(s=>s.toLowerCase().trim()),zt=["Approver","Approved on","Approved By"].map(s=>s.toLowerCase().trim());function fs(s){return s.toLowerCase().replace(/\s+/g,"_").replace(/[^\w_]/g,"")}ce(()=>_.value),y(""),y(!1),qe(He,s=>{s&&s.value&&(_.value.business_unit=s.value)},{immediate:!0});function vs(s){if(w==null||w==="new")return!1;const e=K(s).roles;if(s===0)return e.length===0;const l=K(s-1).roles;return l.length>0&&l[0]!==null&&l[0]!==""&&e.length===0}qe(()=>_.value.form_name,s=>{_.value.form_name=s.trim()}),qe(()=>_.value.form_short_name,s=>{_.value.form_short_name=s.trim()}),qe(()=>_.value.series,s=>{_.value.series=s.trim()}),qe(()=>ge.value,s=>{s==="existing"&&(v.splice(0,v.length),Ee.value=[],H.length=0)});const Xe=y(null),Pt=(s,e,l,o,i,r)=>{Xe.value={blockIndex:e,sectionIndex:l,rowIndex:o,columnIndex:i,fieldIndex:r}},Ue=(s,e,l,o,i,r)=>{if(s.preventDefault(),s.stopPropagation(),console.log("Field dropped at index:",{targetBlock:e,targetSection:l,targetRow:o,targetColumn:i,insertIndex:r,draggedField:Xe.value,draggedFieldType:f.value}),f.value){console.log("Dropping from field library:",f.value);const F=ts(f.value);if(!F){console.error("Failed to create field from type:",f.value);return}const S=v[e];if(!S){te("Target block not found");return}S.sections||(S.sections=[]),S.sections[l]||(S.sections[l]={label:"",rows:[]}),S.sections[l].rows||(S.sections[l].rows=[]),S.sections[l].rows[o]||(S.sections[l].rows[o]={label:"",columns:[]}),S.sections[l].rows[o].columns||(S.sections[l].rows[o].columns=[]),S.sections[l].rows[o].columns[i]||(S.sections[l].rows[o].columns[i]={label:"",fields:[]}),S.sections[l].rows[o].columns[i].fields.splice(r,0,F),console.log("Field added successfully:",F),ue(`${F.label} field added`),f.value=null;return}if(!Xe.value){console.log("No dragged field found");return}const{blockIndex:u,sectionIndex:c,rowIndex:b,columnIndex:d,fieldIndex:p}=Xe.value,$=v[u].sections[c].rows[b].columns[d].fields,M=v[e].sections[l].rows[o].columns[i].fields;if(u===e&&c===l&&b===o&&d===i&&p===r)return;const k=$.splice(p,1)[0];$===M&&p<r&&r--,M.splice(r,0,k),Xe.value=null},Ye=y(""),bs=s=>we(this,null,function*(){const e=[["module","in",["User Forms"]],["istable","=",1]];s!=null&&s.trim()&&e.push(["name","=",`${s}`]);const l={fields:JSON.stringify(["name"]),filters:JSON.stringify(e),limit_page_length:"None",doctype:ve.doctypesList};try{return(yield J.get(W.GetDoctypeData,{params:l})).message.data||[]}catch(o){return console.error("Error fetching doctype list:",o),[]}}),pt=y(null),jt=s=>we(this,null,function*(){if(Ye.value="",pt.value=null,s.tableName){let e=s.tableName.trim();if(e.length>64){Ye.value="Table name cannot exceed 64 characters";return}if(!/^[a-zA-Z]+( [a-zA-Z]+)*$/.test(e)){Ye.value="Table name can only contain letters and spaces (no leading/trailing spaces or special characters)";return}const o=yield bs(e);pt.value=o.find(i=>i.name.toLowerCase()===e.toLowerCase()),pt.value&&(Ye.value="Table already exists"),s.tableName=e}s.label&&(s.fieldname=fs(s.label))});function _s(){const s=_.value.is_linked_form;if(!s){Ve.value=[];return}clearTimeout(Ke),Ke=setTimeout(()=>{const e=[["business_unit","=",`${He.value.value}`],["name","like",`%${s}%`]],l={fields:JSON.stringify(["name"]),limit_page_length:10,limit_start:0,filters:JSON.stringify(e),doctype:ve.EzyFormDefinitions,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"};J.get(`${W.GetDoctypeData}`,{params:l}).then(o=>{Ve.value=o.message.data||[]}).catch(o=>{console.error("Error fetching form definitions:",o)})},300)}function hs(s){_.value.is_linked_form=s,Pe.value=!1}function gs(){setTimeout(()=>{Pe.value=!1},200)}pe({query:"",key:""});function De(s,e,l,o,i){return`${s}-${e}-${l}-${o}-${i}`}pe({});const xe=pe({}),$t=pe({});function ys(s){$t[s]=!0}function ws(s,e,l,o,i,r){const u=De(e,l,o,i,r),c=[["istable","=",0]];s!=null&&s.trim()&&c.push(["name","like",`%${s}%`]);const b={fields:JSON.stringify(["name"]),filters:JSON.stringify(c),limit_page_length:"none",doctype:ve.doctypesList};J.get(W.GetDoctypeData,{params:b}).then(d=>{xe[u]=d.message.data||[]}).catch(d=>{console.error("Error fetching doctype list:",d),xe[u]=[]})}function ks(s,e,l,o,i,r){v[s].sections[e].rows[l].columns[o].fields[i].options=r;const u=De(s,e,l,o,i);xe[u]=[],$t[u]=!1}const $s=ce(()=>v!=null&&v.length?Y.value===1?[0]:Array.from({length:Y.value},(s,e)=>e).filter(s=>s<Y.value):[]),Se=y(null),Te=y(null),Fs=(s,e,l,o,i)=>{Se.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o,fieldIndex:i}},Cs=()=>{Se.value=null},Ds=(s,e,l,o,i)=>Se.value&&Se.value.blockIndex===s&&Se.value.sectionIndex===e&&Se.value.rowIndex===l&&Se.value.columnIndex===o&&Se.value.fieldIndex===i,Ss=(s,e,l,o)=>{Te.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o}},qs=()=>{Te.value=null},As=(s,e,l,o)=>Te.value&&Te.value.blockIndex===s&&Te.value.sectionIndex===e&&Te.value.rowIndex===l&&Te.value.columnIndex===o,Wt=y([{form_json:""}]),Le=y("");ms(()=>{Yt(),Le.value=V.query.Clone,w.value=V.query.id||"new",Le.value==="1"&&(_.value.series=""),w.value!=null&&w.value!=null&&w.value!="new"&&(Gt(),Vt()),sessionStorage.getItem("allow_approver_to_edit_form")=="1"?be.value=!0:be.value=!1;let s=localStorage.getItem("Bu");if(_.value.business_unit=s,V.query.preId==="PreDefine"){const e=localStorage.getItem("form_json");if(e){Wt.value[0].form_json=e;const l=Wt.value[0],o=JSON.parse(l.form_json),i=as(o.fields);ae.value=o.child_table_fields,i.forEach(r=>{v.push(r)})}}});const Re=y(null),se=pe({}),Ht=y(null),Vs=s=>{Re.value=s},Es=()=>{Re.value=null},Us=s=>{s.preventDefault()},Ts=(s,e)=>{const l=s.target.closest("tr");if(!l)return;const o=Array.from(l.parentNode.children).indexOf(l);if(o!==Re.value){const i=e[Re.value];e.splice(Re.value,1),e.splice(o,0,i),Re.value=o}},Ls=y([]),Ft=s=>{if(["Select","Table MultiSelect","Check","Small Text"].includes(s.fieldtype)&&s.options){const e=s.options.split(`
`).map(i=>i.trim()).filter(i=>i),l=[],o=new Set;return e.forEach(i=>{const r=i.toLowerCase();o.has(r)||(o.add(r),l.push(i))}),`
`+l.join(`
`)}else if(["Link","Table"].includes(s.fieldtype)&&s.options)return s.options.trim();return s.options},Rs=(s,e)=>{const l=v[s].sections[e];l.childTables||(l.childTables=[]);const o=l.childTables.length;l.childTables.push({label:"",fieldname:"",fieldtype:"Table",idx:o,reqd:!1,as_a_block:"",description:"false",columns:[ee({label:"",fieldname:"",fieldtype:"",idx:0,description:"",reqd:!1},dt.fieldtype==="Select"&&dt.options?{options:dt.options?`
${dt.options}`:`
`}:{})],newTable:!0})},Os=(s,e,l)=>{const o=v[s].sections[e].childTables[l];o.columns||(o.columns=[]),o.columns.push(ee({label:"",fieldname:"",fieldtype:"",idx:o.columns.length,description:"",reqd:!1},o.columns.fieldtype==="Select"&&o.columns.options?{options:o.columns.options?`
${o.columns.options}`:`
`}:{}))},Ms=(s,e,l)=>{v[s].sections[e].childTables.splice(l,1)},Bs=(s,e,l,o)=>{v[s].sections[e].childTables[l].columns.splice(o,1)};function Ns(s,e,l,o,i,r){var d;const u=`${e}-${l}-${o}`;L[u]||(L[u]={columns:[]});const c={},b=((d=s.label)==null?void 0:d.trim())||"";if(!b)c.label="Field Label is required";else{const p=b.toLowerCase();if(ct.includes(p)&&!zt.includes(p))c.label=`"${b}" is a restricted field label`;else if(b.length>64)c.label="Field Label cannot exceed 64 characters";else if(!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(b))c.label="Field Label can only contain letters, numbers, and single spaces between words";else{const $=r.map((M,k)=>{var F;return{label:(F=M.label)==null?void 0:F.trim().toLowerCase(),index:k}}).filter(M=>M.label===p);if($.length>1){const M=$[0].index;i!==M&&(c.label=`"${b}" is already used in this table`)}}}L[u].columns[i]=c}function mt(s,e,l){var r;L[e]||(L[e]={});const o=[],i=((r=s.label)==null?void 0:r.trim())||"";i||o.push("Label is required"),i.length>64&&o.push("Label cannot exceed 64 characters"),i&&!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(i)&&o.push("No special characters allowed"),i&&ct.includes(i.toLowerCase().trim())&&o.push("This label is restricted"),i&&ae.value[e].map(b=>{var d;return(d=b.label)==null?void 0:d.trim().toLowerCase()}).filter(Boolean).filter(b=>b===i.toLowerCase()).length>1&&o.push("Duplicate label is not allowed"),s.fieldtype||o.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||s.options.trim()==="")&&o.push("Options are required"),L[e][l]=o}const zs=(s,e,l)=>{var u;const o=v[s].sections[e].childTables[l],i={tableName:!1,columns:[]};let r=!1;return(u=o.tableName)!=null&&u.trim()||(i.tableName="Table name is required.",r=!0),o.columns.forEach((c,b)=>{var p,$;const d={};(p=c.label)!=null&&p.trim()||(d.label="Field Label is required",r=!0),($=c.fieldtype)!=null&&$.trim()||(d.fieldtype="Please select field type",r=!0),i.columns[b]=d}),L[`${s}-${e}-${l}`]=i,r},Ps=(s,e,l)=>{var i,r;const o=(r=(i=v[s])==null?void 0:i.sections)==null?void 0:r[e];o&&!Array.isArray(o[l])&&(o[l]=[])},js=s=>s?s.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,""):"",Ws=(s,e,l)=>{if(zs(s,e,l)){te("Please fix validation errors before creating the table",{transition:"zoom"});return}if(pt.value){te("Table already exists",{transition:"zoom"});return}const i=v[s].sections[e].childTables[l],r=v[s].sections[e];i.columns=i.columns.map((c,b)=>ye(ee({},c),{idx:b,options:Ft(c)})),i.newTable=!1;const u={form_short_name:i.tableName,fields:i.columns,idx:i.idx,as_a_block:i.as_a_block?i.as_a_block:"false"};J.post(W.childtable,u).then(c=>{var b,d,p;if(c){Ps(s,e,"afterCreated"),r.afterCreated[l]=ee({},i),ue("Table created successfully!");const $=(p=(d=(b=c.message)==null?void 0:b[0])==null?void 0:d[0])==null?void 0:p.child_doc;$&&(v[s].sections[e].childTables[l]=ye(ee(ee({},v[s].sections[e].childTables[l]),$),{newTable:!1}))}}).catch(c=>{console.error("Error creating table:",c)})},Ie=(s,e,l,o=[])=>{var u;se[e]||(se[e]=[]),se[e]=se[e].filter(c=>c!==l),L[e]||(L[e]=[]),L[e][l]=[];const i=[],r=((u=s.label)==null?void 0:u.trim())||"";if(r?ct.includes(r.toLowerCase())?i.push("This label is restricted"):r.length>64?i.push("Label cannot exceed 64 characters"):/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(r)||i.push("Only letters, numbers, and single spaces allowed"):i.push("Label is required"),o.length){const c=r.toLowerCase(),b=o.map((d,p)=>{var $;return{label:($=d.label)==null?void 0:$.trim().toLowerCase(),idx:p}}).filter(d=>d.label===c);if(b.length>1){const d=b[0].idx;l!==d?(i.push("Duplicate label not allowed"),s._duplicate=!0):s._duplicate=!1}else s._duplicate=!1}return s.fieldtype||i.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||!s.options.trim())&&i.push("Options are required"),L[e][l]=i,i.length>0&&se[e].push(l),i.length===0},Hs=(s,e,l)=>{const i=v[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!i)return;const r=i.columns.length,u={fieldname:"",fieldtype:"",idx:r+1,label:"",value:"",isNew:!0,description:""};i.columns.push(u),Ie(u,l,r,i.columns)},Jt=y([]),Js=(s,e,l,o)=>{const r=v[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!r)return;r.columns.splice(o,1),r.columns.forEach((c,b)=>{c.idx=b+1});const u=se.value[l];u&&(se.value[l]=u.filter(c=>c!==o).map(c=>c>o?c-1:c))},Gs=(s,e,l)=>{const i=v[s].sections[e].afterCreated.find(r=>r.tableName===l);if(i){if(x[l]){se[l]=[];let r=!0;if(i.columns.forEach((b,d)=>{Ie(b,l,d,i.columns)||(r=!1)}),!r){te("Please fix the errors in the highlighted fields before saving!");return}const u=i.columns.map(($,p)=>{var M=$,{isNew:b}=M,d=Tt(M,["isNew"]);return ye(ee({},d),{idx:p+1,options:Ft(d)})}),c={form_short_name:js(l),fields:u,as_a_block:i.description};J.post(W.childtable,c).then(b=>{Jt.value=b.data,ue("Fields updated successfully!")}).catch(b=>{console.error("❌ Saving fields failed:",b)})}x[l]=!x[l]}},x=pe({}),Ys=s=>{ae.value[s]||(ae.value[s]=[]);const e=ae.value[s].length+1;ae.value[s].push({fieldname:"",fieldtype:"",idx:e,label:"",value:"",isNew:!0,description:"",options:ae.value[s].options?`
${ae.value[s].options}`:""})},Zs=(s,e)=>{ae.value[s]&&ae.value[s].splice(e,1)},Ks=(s,e)=>{if(!s)return;se.value||(se.value={}),se.value[s]||(se.value[s]=[]);const l=ae.value[s];if(l){if(x[s]){se.value[s]=[];let o=!0;if(l.forEach((u,c)=>{var d;mt(u,s,c);const b=(d=L[s])==null?void 0:d[c];b&&b.length>0&&(se.value[s].push(c),o=!1),u.label&&(u.label=u.label.trim())}),!o){te("Please fix the errors before saving");return}const i=l.map((d,b)=>{var p=d,{isNew:u}=p,c=Tt(p,["isNew"]);return ye(ee({},c),{idx:b+1,options:Ft(c)})}),r={form_short_name:s,fields:i,as_a_block:e};J.post(W.childtable,r).then(u=>{Jt.value=u.data,ue("Fields updated successfully!")}).catch(u=>{console.error("❌ Saving fields failed:",u)})}x[s]=!x[s],Ht.value=x[s]?s:null}},Qs=y([{id:1,label:"Form Info",stepno:"Step 1",icon:"bi bi-info-circle"},{id:2,label:"Form Fields",stepno:"Step 2",icon:"bi bi-grid-3x3-gap"},{id:3,label:"Workflow Setup",stepno:"Step 3",icon:"bi bi-diagram-3"},{id:4,label:"Print Format",stepno:"Step 4",icon:"ri-checkbox-circle-line"}]),Ct=[{label:"Text",type:"Data"},{label:"Select",type:"Select"},{label:"Attach",type:"Attach"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Number",type:"Int"},{label:"TextArea",type:"Text"}],ft=[{label:"Text",type:"Data"},{label:"Time",type:"Time"},{label:"Text Area",type:"Text"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Attach",type:"Attach"},{label:"Phone",type:"Data"},{label:"Check",type:"Check"},{label:"Number",type:"Int"},{label:"Select",type:"Select"},{label:"Multi Select",type:"Small Text"},{label:"Link",type:"Link"}],Xs=ce(()=>[Me,...A.value]),xs=ce(()=>{const s=_.value.accessible_departments;return s.includes(Me)?"All Selected":s.length>1?`${s[0]}.. +${s.length-1} more selected`:s.join(", ")}),Is=s=>s===Me?_.value.accessible_departments.length===A.value.length:_.value.accessible_departments.includes(s),el=(s,e)=>{s===Me?e.target.checked?_.value.accessible_departments=[...A.value]:_.value.accessible_departments=[]:(e.target.checked?_.value.accessible_departments.push(s):_.value.accessible_departments=_.value.accessible_departments.filter(l=>l!==s),_.value.accessible_departments.length===A.value.length?_.value.accessible_departments=[...A.value]:_.value.accessible_departments=_.value.accessible_departments.filter(l=>l!==Me))},tl=s=>{s===Me&&(_.value.accessible_departments=[...A.value])},sl=s=>{s===Me&&(_.value.accessible_departments=[])},Dt=y(!1),et=ce(()=>{var e;let s=[...Q.value];if(Ge.value&&(s=s.filter(l=>l.is_hod===1)),(e=Ae.value)!=null&&e.trim()){const l=Ae.value.toLowerCase();s=s.filter(o=>o.role.toLowerCase().includes(l))}return s.sort((l,o)=>l.role.localeCompare(o.role)),s.sort((l,o)=>{const i=N.value.includes(l.role),r=N.value.includes(o.role);return i===r?0:i?1:-1}),s.map(l=>l.role)}),ll=ce(()=>{const s=et.value;return s.length>0&&s.every(e=>N.value.includes(e))});qe([N,et],()=>{const s=et.value;Dt.value=s.length>0&&s.every(e=>N.value.includes(e))},{immediate:!0,deep:!0});function ol(s){const e=s.target.checked,l=Q.value.filter(o=>{var i;return!(Ge.value&&o.is_hod!==1||(i=Ae.value)!=null&&i.trim()&&!o.role.toLowerCase().includes(Ae.value.toLowerCase()))}).map(o=>o.role);e?N.value=Array.from(new Set([...N.value,...l])):N.value=N.value.filter(o=>!l.includes(o)),Dt.value=e}function al(){N.value=[],Dt.value=!1,Ge.value=!1}const _e=y("");function nl(){const s=v[Y.value];if(!s||!s.sections){console.error("Error: Invalid block or sections not found.");return}let e={type:Y.value==0?"requestor":"approver",roles:N.value,approval_required:Ne.value,approver_can_edit:ze.value,fields:s.sections.flatMap(Lt),idx:Y.value};Y.value!==0&&(e.view_only_reportee=_e.value==="ViewOnlyReportee"?1:0,e.all_approvals_required=_e.value==="all_approvals_required"?1:0,e.requester_as_a_approver=_e.value==="requester_as_a_approver"?1:0,e.on_rejection=$e.value?$e.value:0);const l=H.findIndex(o=>o.idx===e.idx);l!==-1?H[l]=e:H.push(e),dl()}function K(s){const e=H.filter(i=>i.idx===s);if(e.length===0)return{roles:[]};if(e.length===1)return e[0];const l=ee({},e[0]),o=[];return e.forEach(i=>{i.roles&&Array.isArray(i.roles)&&o.push(...i.roles)}),l.roles=o,console.log(`getWorkflowSetup(${s}): Found ${e.length} entries, merged roles:`,o),l}function il(s){const e=K(s),l=e.roles||[];N.value=[...l],$e.value=e.on_rejection,Ne.value=e.approval_required,ze.value=e.approver_can_edit,e.view_only_reportee===1?_e.value="ViewOnlyReportee":e.all_approvals_required===1?_e.value="all_approvals_required":e.requester_as_a_approver===1?_e.value="requester_as_a_approver":_e.value=""}const St=s=>{Ge.value=!1,Ae.value="",_e.value="",$e.value="",_.value.accessible_departments.length&&rl(s,_.value.accessible_departments),Y.value=s,il(s)};function rl(s,e){let l={index:s,departments:e,property:_.value.business_unit};J.post(W.addDesignationroles,l).then(o=>{o.message&&(Q.value=o.message)}).catch(o=>{console.error("Error fetching designations data:",o)})}function dl(){J.post(W.add_roles_WF,{workflow_setup:H,doctype:_.value.form_short_name,business_unit:_.value.business_unit}).then(s=>{console.log(s),Y.value==0?ue("Requestor Added"):ue(`Approver-${Y.value} Added`)})}function ul(){O.push({path:de.value.routepath||localStorage.getItem("routepath")}),localStorage.removeItem("form_json")}function cl(){_.value.form_name="",_.value.form_short_name="",_.value.owner_of_the_form="",_.value.business_unit="",_.value.form_category="",_.value.accessible_departments=[]}const pl=s=>{if(bt.value){te("Please check all required fields before proceeding.");return}s<E.value?At():s>E.value&&qt()},qt=()=>{if(bt.value){te("Please check all required fields before proceeding.");return}E.value<4&&(E.value+=1,E.value===4&&(_t.value=v))},At=()=>{E.value>1&&(E.value-=1)},ml=y([]);function Gt(){const s={fields:JSON.stringify(["*"]),limit_page_length:"none",doctype:ve.EzyFormDefinitions,doc_id:w.value};J.get(W.GetDoctypeData,{params:s}).then(e=>{var o;let l=e==null?void 0:e.message.data;if(l){l.accessible_departments&&(l.accessible_departments=l.accessible_departments.split(",")),_.value=ye(ee(ee({},_.value),l),{owner_of_the_form:l.owner_of_the_form||_.value.owner_of_the_form||""});const i=JSON.parse((o=e.message.data)==null?void 0:o.form_json);Ze.value=i.workflow,wt.value=i.fields.filter(u=>u.fieldtype==="Table"),ml.value=i.fields.filter(u=>u.fieldtype==="Table"),Je.value=e.message.data.is_landscape;let r=as(JSON.parse(l==null?void 0:l.form_json).fields);ae.value=JSON.parse(e.message.data.form_json).child_table_fields,Ls.value=[],yt.value=[],r.forEach((u,c)=>{v.push(u)}),JSON.parse(l==null?void 0:l.form_json).workflow.forEach((u,c)=>{H.push(u)})}}).catch(e=>{console.error("Error fetching  data:",e)})}function fl(){const s={};ut.value&&(s.print_format=ut.value),Je.value!==void 0&&Je.value!==null&&(s.is_landscape=Je.value),J.put(W.resource+ve.EzyFormDefinitions+`/${V.query.id}`,s).then(e=>{console.log(e),bootstrap.Modal.getInstance(document.getElementById("customFormatModal")).hide(),ue("Print Format Added Successfully")}).catch(e=>{console.error("Error fetching  data:",e)})}function Yt(){const s={fields:JSON.stringify(["name","department_name"]),limit_page_length:"none",business_unit:`${de.value.business_unit||V.query.business_unit}`,doctype:ve.departments};J.get(W.GetDoctypeData,{params:s}).then(e=>{var l;(l=e==null?void 0:e.message.data)!=null&&l.length&&(ke.value=e.message.data.map(o=>o.name),A.value=e.message.data.map(o=>o.name))}).catch(e=>{console.error("Error fetching department data:",e)})}y(""),qe(()=>_.value.owner_of_the_form,s=>{s&&Vt(s)});function Vt(s){s&&typeof s=="string"&&s.trim()!==""&&vl(s)}function vl(s){const e={fields:JSON.stringify(["ezy_departments_items"]),doctype:ve.departments,doc_id:s};J.get(W.GetDoctypeData,{params:e}).then(l=>{var o;(o=l==null?void 0:l.message.data)!=null&&o.ezy_departments_items&&(ie.value=l.message.data.ezy_departments_items.map(i=>i.category))}).catch(l=>{console.error("Error fetching categories data:",l)})}function Et(s){let e=Ql(v);const l=ye(ee({},_.value),{fields:e,doctype:ve.EzyFormDefinitions,workflow_setup:H,form_status:s==="save"?"Created":"Draft"});l.accessible_departments=l.accessible_departments.toString(),J.post(W.savedata,l).then(o=>{if(o&&o.message&&o.message.message){let i=localStorage.getItem("preName");if(i){let r={installed:"Yes"};J.put(`${W.resource}${ve.preDefinedForm}/${i}`,r).then(u=>{localStorage.removeItem("preName")}).catch(u=>{console.error("Error fetching ezyForms data:",u)})}if(O.push({params:{paramid:o.message.message},query:{id:o.message.message}}),w.value=o.message.message,w&&w!=="new"&&(v.splice(0,v.length),Gt()),H.length<v.length)ps("Add Workflow");else if(Kt.value===!0){ue("Form Created Successfully!",{autoClose:2e3,transition:"zoom"});let r=localStorage.getItem("routepath");s==="save"?O.push({path:r}):s==="Draft"&&O.push({path:r})}}else console.error("Invalid response structure:",o)}).catch(o=>{console.error("Error saving form data:",o)})}const vt=y(""),Zt=()=>{var l,o;const s=v.length,e={label:s===0?"requestor":`approver-${s}`,parent:`${(l=He.value)==null?void 0:l.value}-${(o=_.value)==null?void 0:o.form_short_name}`,sections:[{label:"",parent:`${He.value.value}-${_.value.form_short_name}`,childTables:[],afterCreated:{},rows:s===0?[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Requested By",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Requested On",fieldtype:"Datetime",options:"",reqd:!1}]}]},{label:`row_0_1_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1,description:""}]}]}]:[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Approver",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved On",fieldtype:"Datetime",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved By",fieldtype:"Attach",options:"",reqd:!1}]}]}]}]};v.push(e),us(()=>{vt.value&&vt.value.scrollTo({top:vt.value.scrollHeight,behavior:"smooth"})})},Kt=y(!1),Qt=s=>{let e=v[s];e.parent&&G.push(e);let l=[];H.length>s&&H[s].roles&&(l=[...H[s].roles]),v.splice(s,1),H.length>s&&H.splice(s,1),v.forEach((o,i)=>{o.sections.forEach((r,u)=>{r.rows.forEach((c,b)=>{c.columns.forEach((d,p)=>{he(i,u,b,p)})})})}),l.length&&bl(l,s)};function bl(s,e){const l={role:s,level:e,document_type:_.value.form_name,short_name:_.value.form_short_name,property:_.value.business_unit};J.post(W.deleteAssigneRoles,l).then(o=>{o&&Et()})}const _l=(s,e)=>{const l={label:"",parent:`${He.value.value}-${_.value.form_short_name}`,rows:[{label:`row_0_${e}_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]}]}]};v[s].sections.splice(e+1,0,l)},hl=(s,e)=>{let l=v[s].sections[e];l.parent&&G.push(l),v[s].sections.splice(e,1),v[s].sections.forEach((o,i)=>{o.rows.forEach((r,u)=>{r.columns.forEach((c,b)=>{he(s,i,u,b)})})})},gl=(s,e,l)=>{v[s].sections[e].rows[l].columns.push({label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]})},yl=(s,e,l,o)=>{const r=v[s].sections[e].rows[l].columns,u=r[o];u.parent&&G.push(u),r.length===1?v[s].sections[e].rows.splice(l,1):r.splice(o,1),v[s].sections.forEach((c,b)=>{c.rows.forEach((d,p)=>{d.columns.forEach(($,M)=>{he(s,b,p,M)})})})},wl=(s,e,l,o)=>{v[s].sections[e].rows[l].columns[o].fields.push({label:"",fieldtype:"",options:"",reqd:!1})},kl=(s,e,l,o,i)=>{let r=v[s].sections[e].rows[l].columns[o].fields[i];r.parent&&G.push(r),v[s].sections[e].rows[l].columns[o].fields.splice(i,1)},$l=(s,e,l,o,i)=>{const r=v[s].sections[e].rows[l].columns[o].fields[i],u=ee({},r);u.name=`${r.name} Name the field`,v[s].sections[e].rows[l].columns[o].fields.splice(i+1,0,u)},Fl=(s,e,l,o,i)=>{const r=cs(v);v.splice(0,v.length,...r);let u=v[s].sections[e].rows[l].columns[o].fields[i].fieldtype;(u!=="Select"||u!=="radio"||u!=="multiselect")&&(v[s].sections[e].rows[l].columns[o].fields[i].options="")};function Cl(s){return ct.includes(s==null?void 0:s.trim().toLowerCase())}function Dl(s){return/[^a-zA-Z0-9 _\/!@#$%^&*()?.:;|/\\[\]{}]/.test(s)||s.includes('"')||s.includes("'")}function Sl(s){return s.flatMap(e=>{var l;return[(l=e.label)==null?void 0:l.trim().toLowerCase(),...e.sections.flatMap(o=>{var i;return[(i=o.label)==null?void 0:i.trim().toLowerCase(),...o.rows.flatMap(r=>r.columns.flatMap(u=>{var c;return[(c=u.label)==null?void 0:c.trim().toLowerCase(),...u.fields.map(b=>{var d;return(d=b.label)==null?void 0:d.trim().toLowerCase()})]}))]})]}).filter(e=>e!==""&&!zt.includes(e))}function he(s,e,l,o,i){const u=Sl(v).filter((d,p,$)=>$.indexOf(d)!==p),c=cs(v);v.splice(0,v.length,...c);function b(d,p){if(!d){p.errorMsg="";return}Cl(d)?p.errorMsg="Entered label is restricted":Dl(d)?p.errorMsg=`Label should not contain special characters, double quotes (") or single quotes (')`:d.length>64?p.errorMsg="Label should not exceed 64 characters":p.errorMsg=u.includes(d.trim().toLowerCase())?"Duplicate Label Name":""}i!==void 0&&b(v[s].sections[e].rows[l].columns[o].fields[i].label,v[s].sections[e].rows[l].columns[o].fields[i]),i===void 0&&o!==void 0&&b(v[s].sections[e].rows[l].columns[o].label,v[s].sections[e].rows[l].columns[o]),o===void 0&&i===void 0&&b(v[s].sections[e].label,v[s].sections[e]),v.forEach(d=>{d.sections.forEach(p=>{b(p.label,p),p.rows.forEach($=>{$.columns.forEach(M=>{b(M.label,M),M.fields.forEach(k=>{b(k.label,k)})})})})})}const Ut=ce(()=>{function s(e){return!e||typeof e!="object"?!1:"fieldtype"in e&&e.fieldtype===""||"error"in e&&e.error||"errorMsg"in e&&e.errorMsg||["Select","Table MultiSelect"].includes(e.fieldtype)&&(!e.options||e.options.trim()==="")?!0:Array.isArray(e)?e.some(s):Object.values(e).some(s)}return s(v)}),bt=ce(()=>Z.value.length>0||X.value.length>0||!_.value.form_category||!_.value.owner_of_the_form||_.value.accessible_departments.length===0),ql=ce(()=>v.some(s=>s.sections.some(e=>e.rows.some(l=>l.columns.some(o=>o.fields.some(i=>i.label&&i.fieldtype))))));function Xt(s,e){let l=s.target.value.trim();if(!l){e==="form_name"?Z.value="Input cannot be empty or only spaces":e==="form_short_name"&&(X.value="Input cannot be empty or only spaces");return}if(l.length>63){e==="form_name"?Z.value="Name cannot exceed 63 characters":e==="form_short_name"&&(X.value="Short name cannot exceed 63 characters");return}if(/^\d/.test(l)){e==="form_short_name"&&(X.value="First character must be a letter");return}else X.value="";if(e==="form_short_name"&&l.length<2){X.value="Short name must have at least 2 letters";return}if(e==="form_short_name"&&/[^a-zA-Z ]/.test(l)){X.value="Only alphabets and spaces are allowed";return}if(/[^a-zA-Z0-9& ]/.test(l)){e==="form_name"?Z.value="Special characters are not allowed":e==="form_short_name"&&(X.value="Special characters are not allowed");return}else e==="form_name"?Z.value="":e==="form_short_name"&&(X.value="");const o=[[e,"=",`${l}`],["business_unit","=",`${_.value.business_unit}`]],i={fields:JSON.stringify(["form_name","form_short_name"]),filters:JSON.stringify(o),doctype:ve.EzyFormDefinitions};J.get(`${W.GetDoctypeData}`,{params:i}).then(r=>{re.value=r.message.data,e==="form_name"?Z.value=l&&re.value.some(u=>u.form_name&&u.form_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Name already exists":"":e==="form_short_name"&&(X.value=l&&re.value.some(u=>u.form_short_name&&u.form_short_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Short name already exists":"")}).catch(r=>{console.error("Error fetching ezyForms data:",r),e==="form_name"?Z.value="":e==="form_short_name"&&(X.value="")})}const Al=s=>s===0?"1st row":s===1?"2nd row":s===2?"3rd row":`${s+1}th row`,_t=y([]),Vl=()=>{v.length&&(_t.value=v,new bootstrap.Modal(document.getElementById("formViewModal")).show())};function El(){J.post(W.delete_form_items,{deleted_fields:G.flatMap(Lt),doctype:w}).then(s=>{var e;(e=s==null?void 0:s.message)!=null&&e.success&&Et()})}function xt(s){return we(this,null,function*(){if(Ut.value){te("Please fix the errors before proceeding.");return}Kt.value=!0;let e=G.flatMap(Lt);w!=null&&w!=null&&w!="new"&&e.length?El():Et(s)})}const Ul=()=>{rt.value.push({role:"",autoApproval:!1,permissions:{}})},Tl=s=>{rt.value.splice(s,1)},Ll=s=>{ps("Permission configuration modal will be implemented here")},It=()=>we(this,null,function*(){var s;if(!(Qe.value.length>0))try{const e={doctype:"WF Roadmap",fields:JSON.stringify(["name","roadmap_title","document_type","workflow_levels","property","cluster_name"]),filters:JSON.stringify([])},l=yield J.get(W.GetDoctypeData,{params:e});(s=l==null?void 0:l.message)!=null&&s.data&&(Qe.value=l.message.data.map(o=>({roadmap_title:o.name,display_name:`${o.roadmap_title} (${o.document_type})`,document_type:o.document_type,workflow_levels:o.workflow_levels,property:o.property,cluster_name:o.cluster_name})),console.log("Fetched WF Road Maps:",Qe.value))}catch(e){console.error("Error fetching WF Road Maps:",e),te("Failed to fetch workflow road maps")}}),es=s=>we(this,null,function*(){var e;try{console.log("Selected WF Road Map:",s);const l=yield J.get(`${W.resource}${ve.wfRoadmap}/${s.roadmap_title}`),o=((e=l==null?void 0:l.data)==null?void 0:e.data)||(l==null?void 0:l.data)||{};console.log("WF Road Map Data:",o);const i=(o.wf_requestors&&o.wf_requestors.length>0,1),r={};o.wf_level_setup&&o.wf_level_setup.length>0&&o.wf_level_setup.forEach(d=>{r[d.level]||(r[d.level]=[]),r[d.level].push(d)});const u=Object.keys(r).length,c=i+u;for(console.log(`Required blocks: ${c} (1 requestor + ${u} approver levels)`),H=[],We.value=[],Ee.value=[];v.length>c;)v.pop();for(;v.length<c;)Zt();console.log(`Block adjustment complete: ${v.length} blocks`);let b=0;o.wf_requestors&&o.wf_requestors.length>0?(We.value=o.wf_requestors,console.log(`Loaded ${o.wf_requestors.length} requestor role(s)`),o.wf_requestors.forEach(d=>{H.push({type:"requestor",roles:[d.requestor],auto_approval:d.auto_approval||0,columns_allowed:d.columns_allowed||"",fields:[],idx:0})})):console.warn("No Requestors found in roadmap, creating default requestor setup"),b=1,o.wf_level_setup&&o.wf_level_setup.length>0?(Ee.value=o.wf_level_setup.sort((p,$)=>p.level-$.level),console.log(`Loaded ${o.wf_level_setup.length} approver level(s)`),Object.keys(r).sort((p,$)=>parseInt(p)-parseInt($)).forEach(p=>{const $=r[p],M=b;console.log(`Level ${p} → Block Index ${M}, Roles: ${$.length}`),$.forEach(k=>{H.push({type:"approver",level:parseInt(p),roles:[k.role],approval_required:k.mandatory?1:0,approver_can_edit:0,view_only_reportee:k.view_only_reportee||0,all_approvals_required:k.all_approvals_required||0,requester_as_a_approver:k.requester_as_a_approver||0,on_rejection:k.on_rejection||0,columns_allowed:k.columns_allowed||"",fields:[],idx:M})}),b++})):console.warn("No approver levels found in roadmap"),console.log("Final blockArr length:",v.length),console.log("Final workflowSetup:",H),ue(`Workflow configured! ${We.value.length} requestor role(s), ${Ee.value.length} approver level(s) across ${v.length} blocks.`),us(()=>{q.value=0})}catch(l){console.error("Error in handleWFRoadMapSelect:",l),te("Failed to load workflow. Please try again.")}}),Rl=s=>{console.log("Field added from library:",s);const e=q.value,l=v[e];if(!l){te("Please create a block first before adding fields");return}const o=ts(s);if(!o)return;l.sections||(l.sections=[]),l.sections.length===0&&l.sections.push({label:"",rows:[[{label:"",fields:[]}]]});const u=l.sections[0].rows[0][0];u.fields||(u.fields=[]),u.fields.push(o),console.log("Field added successfully:",o),ue(`${o.label} field added successfully`)},Ol=s=>{console.log("Drag started:",s),f.value=s},Ml=()=>{console.log("Drag ended")},Bl=s=>{console.log("Advanced builder fields saved:",s),ue(`${s.length} field(s) saved successfully!`)},Nl=s=>{console.log("Advanced builder fields updated:",s)},ts=s=>{console.log("Creating field from Frappe type:",s);const e=ft.find(r=>r.type===s);if(!e)return console.error("Field type not found:",s),console.error("Available types:",ft.map(r=>r.type)),te(`Field type "${s}" not found. Please try again.`),null;const l=Date.now(),o=Math.random().toString(36).substring(2,6),i=`field_${l}_${o}`;return{id:`field_${l}_${o}`,fieldname:i,label:e.label,fieldtype:e.type,options:"",reqd:0,read_only:0,hidden:0,description:"",default:"",placeholder:""}};return(s,e)=>(a(),n("div",null,[t("div",fa,[t("div",va,[t("div",ba,[t("div",_a,[t("div",{class:"ps-1 my-2 d-flex align-items-center",onClick:e[0]||(e[0]=l=>ul())},e[43]||(e[43]=[t("button",{class:"btn font-13 ms-3"},[t("i",{class:"bi bi-arrow-left"}),t("span",{class:"ms-2"},"Back")],-1)])),s.$route.query.id||s.$route.query.preId?(a(),n("span",ha,"("+g(de.value.formId||T(V).query.form_name)+")",1)):m("",!0)]),t("div",null,[E.value===2&&T(v).length&&!s.$route.query.id?(a(),n("button",{key:0,disabled:Ut.value||bt.value,style:Zl({cursor:Ut.value?"not-allowed":"pointer"}),type:"butoon",class:"btn font-13 btn-light",onClick:e[1]||(e[1]=l=>xt("Draft"))},e[44]||(e[44]=[t("i",{class:"bi bi-bookmark-check-fill"},null,-1),C(" Save As Draft ")]),12,ga)):m("",!0)])]),t("div",ya,[t("div",wa,[t("div",ka,[t("div",$a,[t("ul",Fa,[(a(!0),n(B,null,z(Qs.value,l=>(a(),n("li",{key:l.id,class:j({active:E.value===l.id,completed:E.value>l.id})},[t("div",{class:j(["d-flex gap-3 align-items-center",{"not-allowed":bt.value&&E.value+1===l.id}]),onClick:o=>pl(l.id)},[E.value>l.id?(a(),n("i",Da)):(a(),n("i",{key:1,class:j(l.icon)},null,2)),t("div",Sa,[t("span",qa,g(l.stepno),1),e[45]||(e[45]=t("br",null,null,-1)),t("span",Aa,g(l.label),1)])],10,Ca)],2))),128))])])]),t("div",Va,[t("div",Ea,[t("div",Ua,[E.value===1?(a(),n("div",Ta,[t("div",La,[t("div",Ra,[e[46]||(e[46]=t("div",null,null,-1)),e[47]||(e[47]=t("h1",{class:"font-14 fw-bold m-0"},"Form Info",-1)),t("div",null,[!s.$route.query.id&&!s.$route.query.preId?(a(),n("button",{key:0,class:"btn btn-light font-12 mx-2",type:"button",onClick:cl},"Clear Form")):m("",!0),E.value<5?(a(),Rt(ns,{key:1,class:"btn btn-dark bg-dark text-white fw-bold font-13",name:"Next",onClick:qt})):m("",!0)])])]),t("div",Oa,[t("div",Ma,[e[63]||(e[63]=t("div",{class:"col-sm-none col-md-4"},null,-1)),t("div",Ba,[t("div",Na,[t("div",za,[t("div",Pa,[t("div",ja,[T(V).query.preId?(a(),n("span",Wa,e[48]||(e[48]=[C("Predefined "),t("i",{class:"bi bi-check2-circle"},null,-1)]))):m("",!0),oe(it,{disabled:(de.value.formId&&de.value.formId.length>0||T(V).query.form_name)&&Le.value!=="1",labeltext:"Form Name",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formName",validationStar:"true",placeholder:"Untitled Form",onChange:e[2]||(e[2]=l=>Xt(l,"form_name")),modelValue:kt.value,"onUpdate:modelValue":e[3]||(e[3]=l=>kt.value=l)},null,8,["disabled","modelValue"]),Z.value?(a(),n("span",Ha,g(Z.value),1)):m("",!0)])]),t("div",Ja,[oe(it,{disabled:(de.value.formId&&de.value.formId.length>0||T(V).query.form_name)&&Le.value!=="1",labeltext:"Form Short Code",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formShortCode",validationStar:"true",placeholder:"Untitled Form",onChange:e[4]||(e[4]=l=>Xt(l,"form_short_name")),modelValue:_.value.form_short_name,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value.form_short_name=l)},null,8,["disabled","modelValue"]),X.value?(a(),n("span",Ga,g(X.value),1)):m("",!0)]),t("div",Ya,[oe(it,{disabled:de.value.formId&&de.value.formId.length>0&&Le.value!=="1",labeltext:"Form Naming series",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Naming series",modelValue:_.value.series,"onUpdate:modelValue":e[6]||(e[6]=l=>_.value.series=l)},null,8,["disabled","modelValue"]),e[49]||(e[49]=is('<small class="text-muted" style="font-size:12px;" data-v-7583d2b0> Note : Enter <code data-v-7583d2b0>YY-YY</code>, <code data-v-7583d2b0>YYYY</code>, or <code data-v-7583d2b0>ABC</code>. The system will default to the format <code data-v-7583d2b0> 24-25-0001</code>, <code data-v-7583d2b0> 2025-0001</code>, or <code data-v-7583d2b0> ABC-0001</code> respectively. </small>',1))]),t("div",Za,[t("label",null,[e[50]||(e[50]=C("Owner Of The Form ")),_.value.owner_of_the_form?m("",!0):(a(),n("span",Ka,"*"))]),oe(T(Oe),{disabled:de.value.formId&&de.value.formId.length>0&&Le.value!=="1",onOpen:Yt,options:ke.value,onChange:Vt,modelValue:_.value.owner_of_the_form,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value.owner_of_the_form=l),placeholder:"Select Department",multiple:!1,class:"font-11 multiselect",searchable:!0,openDirection:"bottom"},null,8,["disabled","options","modelValue"])]),t("div",Qa,[t("label",null,[e[51]||(e[51]=C("Form Category ")),_.value.form_category?m("",!0):(a(),n("span",Xa,"*"))]),oe(T(Oe),{disabled:de.value.formId&&de.value.formId.length>0&&Le.value!=="1",options:ie.value,modelValue:_.value.form_category,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value.form_category=l),placeholder:"Select Category",multiple:!1,searchable:!0,class:"font-11 multiselect"},null,8,["disabled","options","modelValue"])]),t("div",xa,[t("label",null,[e[52]||(e[52]=C("Accessible to Department ")),_.value.accessible_departments.length?m("",!0):(a(),n("span",Ia,"*"))]),oe(T(Oe),{modelValue:_.value.accessible_departments,"onUpdate:modelValue":e[10]||(e[10]=l=>_.value.accessible_departments=l),options:Xs.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Select Department",class:"font-11",onSelect:tl,onRemove:sl,openDirection:"bottom"},{option:Ot(({option:l})=>[t("div",en,[t("input",{type:"checkbox",checked:Is(l),class:"custom-checkbox",onChange:o=>el(l,o),onClick:e[9]||(e[9]=me(()=>{},["stop"]))},null,40,tn),t("span",null,g(l),1)])]),selection:Ot(({values:l,isOpen:o})=>[l.length?D((a(),n("span",{key:0,class:"multiselect__single font-10"},g(xs.value),513)),[[gt,!o]]):m("",!0)]),_:1},8,["modelValue","options"])]),t("div",sn,[e[53]||(e[53]=t("label",null,"Form Type",-1)),oe(T(Oe),{options:Bt,modelValue:Nt.value,"onUpdate:modelValue":e[11]||(e[11]=l=>Nt.value=l),placeholder:"Select Form Type",multiple:!1,searchable:!0,label:"label","track-by":"value",reduce:l=>l.value,class:"font-11 multiselect",openDirection:"top"},null,8,["modelValue","reduce"]),e[54]||(e[54]=t("small",{class:"text-muted font-12 ms-2"},"Note: Public form is accessible by anyone through QR code.",-1))]),t("div",ln,[e[55]||(e[55]=t("label",null,[C("Has Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),oe(T(Oe),{options:["Yes","No"],modelValue:_.value.has_workflow,"onUpdate:modelValue":e[12]||(e[12]=l=>_.value.has_workflow=l),placeholder:"Select",multiple:!1,class:"font-11 multiselect",searchable:!0},null,8,["modelValue"])]),_.value.has_workflow==="Yes"?(a(),n("div",on,[e[56]||(e[56]=t("label",null,[C("Use Existing Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),oe(T(Oe),{onOpen:It,options:Qe.value,modelValue:Ce.value,"onUpdate:modelValue":e[13]||(e[13]=l=>Ce.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:es,openDirection:"bottom"},null,8,["options","modelValue"]),e[57]||(e[57]=t("small",{class:"text-muted font-12 ms-2"},[t("i",{class:"bi bi-info-circle me-1"}),C(" Select to auto-populate requestor and approver configurations ")],-1))])):m("",!0),_.value.as_web_view===1?(a(),n("div",an,[e[58]||(e[58]=t("label",null,[C("Form Submit Response "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),oe(it,{class:"formHeight mt-2",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Submit Response",modelValue:_.value.public_form_response,"onUpdate:modelValue":e[14]||(e[14]=l=>_.value.public_form_response=l)},null,8,["modelValue"])])):m("",!0),_.value.as_web_view===1?(a(),n("div",nn,[e[59]||(e[59]=t("label",null,[C("Submit Notification Email "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),oe(it,{class:"formHeight mt-2",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Submit mail",modelValue:_.value.mail_id,"onUpdate:modelValue":e[15]||(e[15]=l=>_.value.mail_id=l)},null,8,["modelValue"]),e[60]||(e[60]=t("small",{class:"text-muted font-12 ms-2"},"Note : If multiple Emails, separate with commas (,).",-1))])):m("",!0),T(V).query.preId?(a(),n("div",rn,[t("div",dn,[D(t("input",{class:"form-check-input linketoCheck p-1",disabled:_.value.is_predefined_doctype==1,type:"checkbox",id:"is_linked","onUpdate:modelValue":e[16]||(e[16]=l=>_.value.is_linked=l),"true-value":1,"false-value":0},null,8,un),[[fe,_.value.is_linked]]),e[61]||(e[61]=t("label",{class:"form-check-label font-12 mx-2 mb-0 ps-1",for:"is_linked"}," Link ",-1))])])):m("",!0),_.value.is_linked?(a(),n("div",cn,[e[62]||(e[62]=t("label",{for:"standardFormInput"},"Form",-1)),D(t("input",{type:"text",class:"form-control standardFormInput",id:"standardFormInput",disabled:_.value.is_predefined_doctype==1,"onUpdate:modelValue":e[17]||(e[17]=l=>_.value.is_linked_form=l),placeholder:"Type to search Form Name...",onInput:_s,onFocus:e[18]||(e[18]=l=>Pe.value=!0),onBlur:gs},null,40,pn),[[R,_.value.is_linked_form]]),Pe.value&&Ve.value.length?(a(),n("ul",mn,[(a(!0),n(B,null,z(Ve.value,(l,o)=>(a(),n("li",{class:"list-group-item formlistitem",key:o,onMousedown:me(i=>hs(l.name),["prevent"])},g(l.name),41,fn))),128))])):m("",!0)])):m("",!0)])])]),e[64]||(e[64]=t("div",{class:"col-sm-none col-md-4"},null,-1))])])])):m("",!0),E.value===2?(a(),n("div",vn,[t("div",bn,[t("div",_n,[t("button",{onClick:e[19]||(e[19]=l=>At()),class:"btn btn-sm btn-light"},e[65]||(e[65]=[t("i",{class:"bi bi-chevron-left"},null,-1),C(" Back ")]))]),t("div",hn,[(a(!0),n(B,null,z(T(v),(l,o)=>(a(),n("button",{key:o,class:j(["zoho-tab",{active:q.value===o}]),onClick:i=>q.value=o},[e[66]||(e[66]=t("i",{class:"bi bi-file-earmark-text me-1"},null,-1)),C(" "+g(o===0?"Requestor Block":`Approver Block ${o}`)+" ",1),T(v).length>1?(a(),n("i",{key:0,class:"bi bi-x-lg ms-2",onClick:me(i=>Qt(o),["stop"])},null,8,yn)):m("",!0)],10,gn))),128))]),t("div",wn,[t("button",{class:j(["btn btn-sm me-2",Fe.value?"btn-dark":"btn-outline-dark"]),onClick:e[20]||(e[20]=l=>Fe.value=!Fe.value),title:"Toggle Advanced Field Builder"},[t("i",{class:j(Fe.value?"bi bi-tools":"bi bi-grid-3x3-gap")},null,2),C(" "+g(Fe.value?"Advanced":"Simple"),1)],2),t("button",{class:"btn btn-sm btn-primary me-2",onClick:Zt},e[67]||(e[67]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),C("Add Block ")])),ql.value?(a(),n("button",{key:0,class:"btn btn-sm btn-light me-2",onClick:Vl},e[68]||(e[68]=[t("i",{class:"bi bi-eye me-1"},null,-1),C("Preview ")]))):m("",!0),T(v).length?(a(),n("button",{key:1,class:"btn btn-sm btn-dark",onClick:e[21]||(e[21]=l=>xt("save"))},g(T(w)!=="new"?"Update Form":"Create Form"),1)):m("",!0)])]),t("div",kn,[Fe.value?(a(),n("div",$n,[e[69]||(e[69]=t("div",{class:"alert alert-info mb-3"},[t("i",{class:"bi bi-info-circle me-2"}),t("strong",null,"Advanced Mode:"),C(" Use this mode to access all Frappe field types and advanced field properties. Fields created here will be added to the current block. ")],-1)),oe(ma,{ref_key:"frappeBuilderRef",ref:U,formName:kt.value,onSave:Bl,onUpdate:Nl},null,8,["formName"])])):(a(),n(B,{key:1},[t("aside",{class:j(["zoho-field-library",{collapsed:!je.value}])},[t("div",{class:"library-header",onClick:e[22]||(e[22]=l=>je.value=!je.value)},[t("div",Fn,[t("h6",Cn,[e[70]||(e[70]=t("i",{class:"bi bi-grid-3x3-gap me-2"},null,-1)),C(" "+g(je.value?"Field Types":"Fields"),1)]),t("button",Dn,[t("i",{class:j(je.value?"bi bi-chevron-left":"bi bi-chevron-right")},null,2)])])]),je.value?(a(),n("div",Sn,[oe(lo,{fields:ft,onFieldAdd:Rl,onFieldDragstart:Ol,onFieldDragend:Ml})])):m("",!0)],2),t("div",qn,[t("div",{class:"canvas-inner",ref_key:"mainBlockRef",ref:vt},[(a(!0),n(B,null,z(T(v),(l,o)=>D((a(),n("div",{class:"block-level",key:o},[t("div",An,[t("div",Vn,[t("div",En,[t("h6",Un,g(o===0?"Requestor Block":`Approver
                                  Block ${o}
                                  `),1),t("div",Tn,[o!==0&&K(o).view_only_reportee||K(o).all_approvals_required||K(o).requester_as_a_approver?(a(),n("div",Ln,[t("span",Rn,g(K(o).view_only_reportee===1?"Reporting Manager only":"")+" "+g(K(o).all_approvals_required===1?"All of the selected approvers":"")+" "+g(K(o).requester_as_a_approver===1?"Approval by Requestor":""),1),t("span",null,[e[71]||(e[71]=t("span",{class:"ms-1"}," on rejection escalating to ",-1)),t("span",On,g(K(o).on_rejection?`Level ${K(o).on_rejection}`:"Requestor"),1)]),t("span",Mn,g(K(o).all_approvals_required===1?"":"(Skipping multi approval)"),1)])):m("",!0)])]),t("div",Bn,[T(w)&&T(H).length?(a(),n("div",Nn,[K(o)?(a(),n("label",zn,[t("span",Pn,g(K(o).roles.length>0?o===0?"Requestor Roles: ":"Approver Roles: ":""),1),t("span",jn,g(K(o).roles.slice(0,2).join(", ")),1),K(o).roles.length>2?(a(),n("span",{key:0,"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:i=>St(o),class:"more-count badge bg-primary ms-2",style:{cursor:"pointer"}}," +"+g(K(o).roles.length-2)+" more ",9,Wn)):m("",!0)])):m("",!0)])):m("",!0),vs(o)&&T(w)!=null&&T(w)!=null&&T(w)!="new"&&K(o).roles.length===0?(a(),n("button",{key:1,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:i=>St(o)},[e[72]||(e[72]=t("img",{src:Xl,alt:"Add",class:"me-1"},null,-1)),C(" "+g(o===0?"Add Requestors":"Add Approvers"),1)],8,Hn)):m("",!0),T(w)!=null&&T(w)!=null&&T(w)!="new"&&K(o).roles.length>0?(a(),n("button",{key:2,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:i=>St(o)},e[73]||(e[73]=[t("i",{class:"bi bi-pencil font-14"},null,-1)]),8,Jn)):m("",!0),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteBlock",onClick:i=>Qt(o)},e[74]||(e[74]=[t("i",{class:"bi bi-trash me-1"},null,-1),C(" Delete Block ")]),8,Gn)])])]),t("div",Yn,[(a(!0),n(B,null,z(l.sections,(i,r)=>(a(),n("div",{key:"section-"+r,class:"dynamicSection mt-0 section"},[t("section",Zn,[t("div",Kn,[D(t("input",{"onUpdate:modelValue":u=>i.label=u,type:"text",class:j(["border-less-input","font-14",{"italic-style":!i.label},{"fw-medium":i.label}]),onChange:u=>he(o,r),onInput:u=>he(o,r),placeholder:"Untitled section"},null,42,Qn),[[R,i.label]]),i.errorMsg?(a(),n("small",Xn,g(i.errorMsg),1)):m("",!0)]),t("div",xn,[t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:u=>hl(o,r)},e[75]||(e[75]=[t("i",{class:"bi bi-trash me-1"},null,-1),C(" Delete Section ")]),8,In)])]),t("div",ei,[(a(!0),n(B,null,z(i.rows,(u,c)=>(a(),n("section",{class:"row dynamicRow row-container",key:"row-"+c},[t("div",ti,[t("label",si,g(Al(c)),1),t("div",null,[u.columns.length<3?(a(),n("button",{key:0,class:"btn btn-light bg-transparent border-0 p-1 font-12",onClick:b=>gl(o,r,c)},e[76]||(e[76]=[t("i",{class:"bi bi-plus font-14"},null,-1),C(" Add Column ")]),8,li)):m("",!0)])]),t("div",oi,[t("div",ai,[(a(!0),n(B,null,z(u.columns,(b,d)=>(a(),n("div",{key:"column-"+d,onMouseenter:p=>Ss(o,r,c,d),onMouseleave:qs,class:"col p-0 dynamicColumn position-relative column-container"},[t("div",ii,[t("div",ri,[D(t("input",{"onUpdate:modelValue":p=>b.label=p,type:"text",class:j(["border-less-input","ps-1","font-14","inputHeight",{"italic-style":!b.label},{"fw-medium":b.label}]),onChange:p=>he(o,r,c,d),onInput:p=>he(o,r,c,d),placeholder:"Column Name"},null,42,di),[[R,b.label]]),b.errorMsg?(a(),n("small",ui,g(b.errorMsg),1)):m("",!0)]),D(t("div",ci,[t("button",{class:"btn btn-light bg-transparent me-1 btn-sm",onClick:p=>yl(o,r,c,d)},e[77]||(e[77]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,pi)],512),[[gt,As(o,r,c,d)]])]),b.fields.length===0?(a(),n("div",{key:0,class:"empty-drop-zone",onDragover:e[23]||(e[23]=me(()=>{},["prevent"])),onDrop:p=>Ue(p,o,r,c,d,s.fieldIndex)},null,40,mi)):m("",!0),(a(!0),n(B,null,z(b.fields,(p,$)=>{var M;return a(),n("div",{key:"field-"+$,onMouseenter:k=>Fs(o,r,c,d,$),onMouseleave:Cs,class:"dynamicField m-1 draggable-item",draggable:"true",onDragstart:k=>Pt(k,o,r,c,d,$),onDragover:e[27]||(e[27]=me(()=>{},["prevent"])),onDrop:k=>Ue(k,o,r,c,d,$)},[t("div",{class:"drop-zone",onDragover:e[24]||(e[24]=me(()=>{},["prevent"])),onDrop:k=>Ue(k,o,r,c,d,$)},null,40,vi),p.fieldtype!=="Table"?(a(),n("div",{key:0,class:"px-1 dynamic_fied field-border",draggable:"true",onDragstart:k=>Pt(k,o,r,c,d,$),onDragover:e[25]||(e[25]=me(()=>{},["prevent"])),onDrop:k=>Ue(k,o,r,c,d,$)},[t("div",_i,[t("div",hi,[D(t("input",{"onUpdate:modelValue":k=>p.label=k,placeholder:"Name the field",class:j(["border-less-input","font-14","p-0","inputHeight",{"italic-style":!p.label},{"fw-medium":p.label}]),onChange:k=>he(o,r,c,d,$),onInput:k=>he(o,r,c,d,$)},null,42,gi),[[R,p.label]]),p.errorMsg?(a(),n("small",yi,g(p.errorMsg),1)):m("",!0)]),D(t("div",wi,[t("button",{class:"btn btn-light btn-sm bg-transparent py-0",onClick:k=>$l(o,r,c,d,$)},e[78]||(e[78]=[t("i",{class:"ri-file-copy-line font-13 copyIcon"},null,-1)]),8,ki),t("button",{class:"btn btn-light btn-sm bg-transparent trash-btn py-0",onClick:k=>{kl(o,r,c,d,$),he(o,r,c,d)}},e[79]||(e[79]=[t("i",{class:"bi bi-x-lg font-13"},null,-1)]),8,$i)],512),[[gt,Ds(o,r,c,d,$)]])]),D(t("select",{"onUpdate:modelValue":k=>p.fieldtype=k,class:"form-select mb-2 mt-1 font-13 searchSelect",onChange:k=>Fl(o,r,c,d,$)},[e[80]||(e[80]=t("option",{value:""},"Select Type",-1)),(a(),n(B,null,z(ft,k=>t("option",{key:k,value:k.type},g(k.label),9,Ci)),64))],40,Fi),[[Be,p.fieldtype]]),["Select","Table MultiSelect","Small Text"].includes(p.fieldtype)?(a(),n("div",Di,[e[81]||(e[81]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":k=>p.options=k,class:"form-control shadow-none mb-1 font-12"},null,8,Si),[[R,p.options]]),!p.options||p.options.trim()===""?(a(),n("small",qi," Options are required for this field type. ")):m("",!0)])):m("",!0),p.fieldtype==="Link"?(a(),n("div",Ai,[t("label",{class:"font-11 fw-light",for:"link-search-"+De(o,r,c,d,$)}," Search Doctype: ",8,Vi),D(t("input",{id:"link-search-"+De(o,r,c,d,$),type:"text","onUpdate:modelValue":k=>T(v)[o].sections[r].rows[c].columns[d].fields[$].options=k,onInput:k=>ws(T(v)[o].sections[r].rows[c].columns[d].fields[$].options,o,r,c,d,$),onFocus:k=>ys(De(o,r,c,d,$)),class:"form-control font-12 mb-1",placeholder:"Type to search..."},null,40,Ei),[[R,T(v)[o].sections[r].rows[c].columns[d].fields[$].options]]),(M=xe[De(o,r,c,d,$)])!=null&&M.length&&$t[De(o,r,c,d,$)]?(a(),n("ul",Ui,[(a(!0),n(B,null,z(xe[De(o,r,c,d,$)],(k,F)=>(a(),n("li",{key:F,onClick:S=>ks(o,r,c,d,$,k.name),class:"list-group-item list-group-item-action"},g(k.name),9,Ti))),128))])):m("",!0)])):m("",!0),t("div",Li,[t("div",Ri,[t("div",Oi,[D(t("input",{class:"font-12","onUpdate:modelValue":k=>p.reqd=k,"true-value":1,id:"mandatory-"+o+"-"+r+"-"+c+"-"+d+"-"+$,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,8,Mi),[[fe,p.reqd]])]),t("div",null,[t("label",{class:"font-12 m-0 fw-light",for:"mandatory-"+o+"-"+r+"-"+c+"-"+d+"-"+$},"Mandatory",8,Bi)])]),t("div",null,[t("button",{class:"btn btn-sm font-12",onClick:k=>p.showDescription=!p.showDescription},g(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Ni)])]),p.showDescription?D((a(),n("textarea",{key:2,"onUpdate:modelValue":k=>p.description=k,class:"form-control font-12 mt-2",placeholder:"Enter field description"},null,8,zi)),[[R,p.description]]):m("",!0),p.error?(a(),n("small",Pi,g(p.error),1)):m("",!0)],40,bi)):m("",!0),t("div",{class:"drop-zone",onDragover:e[26]||(e[26]=me(()=>{},["prevent"])),onDrop:k=>Ue(k,o,r,c,d,$)},null,40,ji),t("div",Wi,[t("div",null,[t("div",null,[t("div",Hi,[p.fieldtype==="Table"?(a(),n("div",Ji,[(a(!0),n(B,null,z(ae.value,(k,F)=>(a(),n("div",{key:F,class:"childTable"},[F===p.fieldname||F===p.options?(a(),n("h5",Gi,g(F.replace(/_/g," ")),1)):m("",!0),x[F]&&F===Ht.value?(a(),n("div",Yi,[t("div",Zi,[p.showDescription?D((a(),n("input",{key:0,"onUpdate:modelValue":S=>p.description=S,class:"form-control font-12",placeholder:"Enter field description"},null,8,Ki)),[[R,p.description]]):m("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:S=>p.showDescription=!p.showDescription},g(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Qi)])])):m("",!0),F===p.options||F===p.fieldname?(a(),n("table",Xi,[e[85]||(e[85]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",{onDragover:me(Us,["prevent"]),onDrop:S=>Ts(S,k)},[(a(!0),n(B,null,z(k,(S,le)=>{var tt,st,lt,ot,at,nt,ne;return a(),n("tr",{key:le,draggable:x[F],onDragstart:I=>Vs(le),onDragend:Es,class:j({dragging:Re.value===le})},[t("td",null,g(le+1),1),x[F]?(a(),n("td",er,[D(t("input",{"onUpdate:modelValue":I=>S.label=I,onInput:I=>mt(S,F,le),placeholder:"Field Label",class:j(["form-control",{"border-1 border-danger":(st=(tt=L[F])==null?void 0:tt[le])==null?void 0:st.length}])},null,42,tr),[[R,S.label]]),(ot=(lt=L[F])==null?void 0:lt[le])!=null&&ot.length?(a(),n("div",sr,[(a(!0),n(B,null,z(L[F][le],(I,zl)=>(a(),n("div",{key:zl},g(I),1))),128))])):m("",!0)])):(a(),n("td",lr,g(S.label),1)),x[F]?(a(),n("td",or,[t("div",ar,[D(t("select",{"onUpdate:modelValue":I=>S.fieldtype=I,onChange:I=>mt(S,F,le),class:j(["form-select form-select-sm",{"border-1 border-danger":(nt=(at=L[F])==null?void 0:at[le])==null?void 0:nt.length}])},[e[82]||(e[82]=t("option",{value:""},"Select Type",-1)),(a(),n(B,null,z(Ct,I=>t("option",{key:I.type,value:I.type},g(I.label),9,ir)),64))],42,nr),[[Be,S.fieldtype]]),t("div",rr,[t("div",dr,[t("div",ur,[D(t("input",{class:"font-12 form-control-sm","onUpdate:modelValue":I=>S.description=I,placeholder:"description",type:"text"},null,8,cr),[[R,S.description]])])]),t("button",{class:"btn btn-light btn-sm",onClick:I=>Zs(F,le)},e[83]||(e[83]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,pr)])]),["Select"].includes(S.fieldtype)?(a(),n("div",mr,[e[84]||(e[84]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":I=>S.options=I,onInput:I=>mt(S,F,le),class:"form-control shadow-none mb-1 font-12"},null,40,fr),[[R,S.options]]),!S.options||S.options.trim()===""?(a(),n("small",vr," Options are required for this field type. ")):m("",!0)])):m("",!0),(ne=se[F])!=null&&ne.includes(le)?(a(),n("span",br,"Type required**")):m("",!0)])):(a(),n("td",_r,g(S.fieldtype),1))],42,Ii)}),128))],40,xi)])):m("",!0),p.fieldtype==="Table"&&(p.label===F||p.fieldname===F)?(a(),n("div",hr,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:S=>Ks(F,p.description)},g(x[F]?"Save":"Edit"),9,gr),x[F]?(a(),n("button",{key:0,class:"btn btn-light btn-sm",onClick:S=>Ys(F)}," Add More Field ",8,yr)):m("",!0)])):m("",!0)]))),128))])):m("",!0)])])])])],40,fi)}),128)),t("div",{class:"drop-zone-bottom",onDragover:e[28]||(e[28]=me(()=>{},["prevent"])),onDrop:p=>Ue(p,o,r,c,d,b.fields.length),style:{"background-color":"#f0f0f0",border:"1px dashed #ccc",margin:"4px"}},null,40,wr),t("div",{class:"drop-zone",onDragover:e[29]||(e[29]=me(()=>{},["prevent"])),onDrop:p=>Ue(p,o,r,c,d,s.fields.length),style:{height:"10px","background-color":"transparent"}},null,40,kr),t("div",$r,[t("button",{class:"btn btn-light btn-sm d-flex align-items-center addField m-2",onClick:p=>wl(o,r,c,d)},e[86]||(e[86]=[t("i",{class:"bi bi-plus fs-5"},null,-1),t("span",null,"Add Field",-1)]),8,Fr)])],40,ni))),128))])])]))),128)),t("div",null,[(a(!0),n(B,null,z(i.afterCreated,(u,c)=>(a(),n("div",{key:c,class:"childTable dynamicColumn m-0 p-2"},[t("h5",Cr,g(u.tableName),1),x[u.tableName]?(a(),n("div",Dr,[t("div",Sr,[u.showDescription?D((a(),n("input",{key:0,"onUpdate:modelValue":b=>u.description=b,class:"form-control font-12",placeholder:"Enter field description"},null,8,qr)),[[R,u.description]]):m("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:b=>u.showDescription=!u.showDescription},g(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,Ar)])])):m("",!0),t("table",Vr,[e[92]||(e[92]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",null,[(a(!0),n(B,null,z(u.columns,(b,d)=>{var p,$,M,k;return a(),n("tr",{key:d},[t("td",null,g(d+1),1),x[u.tableName]?(a(),n("td",Er,[D(t("input",{"onUpdate:modelValue":F=>b.label=F,placeholder:"Field Label",class:j(["form-control",{"border-1 border-danger":(p=se[u.tableName])==null?void 0:p.includes(d)}]),onBlur:F=>{var S;b.label=(S=b.label)==null?void 0:S.trim(),Ie(b,u.tableName,d,u.columns)}},null,42,Ur),[[R,b.label]]),($=L[u.tableName])!=null&&$[d]?(a(),n("div",Tr,[(a(!0),n(B,null,z(L[u.tableName][d],(F,S)=>(a(),n("span",{key:S},[C(g(F)+" ",1),e[87]||(e[87]=t("br",null,null,-1))]))),128))])):m("",!0)])):(a(),n("td",Lr,g(b.label),1)),x[u.tableName]?(a(),n("td",Rr,[t("div",Or,[D(t("select",{"onUpdate:modelValue":F=>b.fieldtype=F,class:j(["form-select form-select-sm",{"border-1 border-danger":(M=se[u.tableName])==null?void 0:M.includes(d)}]),onChange:F=>Ie(b,u.tableName,d,u.columns)},[e[88]||(e[88]=t("option",{value:""},"Select Type",-1)),(a(),n(B,null,z(Ct,F=>t("option",{key:F.type,value:F.type},g(F.label),9,Br)),64))],42,Mr),[[Be,b.fieldtype]]),t("button",{class:"btn btn-light btn-sm",onClick:F=>Js(o,r,u.tableName,d)},e[89]||(e[89]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Nr)]),b.fieldtype==="Select"?(a(),n("div",zr,[e[90]||(e[90]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":F=>b.options=F,class:"form-control shadow-none mb-1 font-12",onInput:F=>Ie(b,u.tableName,d,u.columns)},null,40,Pr),[[R,b.options]])])):m("",!0),(k=L[u.tableName])!=null&&k[d]?(a(),n("div",jr,[(a(!0),n(B,null,z(L[u.tableName][d],(F,S)=>(a(),n("span",{key:S},[C(g(F),1),e[91]||(e[91]=t("br",null,null,-1))]))),128))])):m("",!0)])):(a(),n("td",Wr,g(b.fieldtype),1))])}),128))])]),t("div",Hr,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:b=>Gs(o,r,u.tableName)},g(x[u.tableName]?"Save":"Edit"),9,Jr),x[u.tableName]?(a(),n("button",{key:0,class:"btn btn-light btn-sm",onClick:b=>Hs(o,r,u.tableName)}," Add More Field ",8,Gr)):m("",!0)])]))),128))])]),t("div",null,[t("div",null,[o==0?(a(),n("button",{key:0,class:"btn btn-light addRow mb-3 mt-4",onClick:u=>Rs(o,r)}," Add New Table ",8,Yr)):m("",!0),(a(!0),n(B,null,z(i.childTables,(u,c)=>{var b;return a(),n("div",{key:`table-${o}-${r}-${c}`,class:"child-table"},[u.newTable?(a(),n("div",Zr,[t("div",Kr,[t("div",null,[t("span",{class:j(u.tableName?"d-none":"text-danger")},"*",2),D(t("input",{"onUpdate:modelValue":d=>u.tableName=d,placeholder:"Table Name",onBlur:d=>jt(u),class:j(["border-less-input font-14 p-0 inputHeight",{"italic-style":!u.tableName,"fw-medium":u.tableName}])},null,42,Qr),[[R,u.tableName]]),(b=L[`${o}-${r}-${c}`])!=null&&b.tableName?(a(),n("div",Xr,g(L[`${o}-${r}-${c}`].tableName),1)):m("",!0),Ye.value?(a(),n("div",xr,g(Ye.value),1)):m("",!0),t("div",Ir,[t("div",ed,[u.showDescription?D((a(),n("input",{key:0,"onUpdate:modelValue":d=>u.as_a_block=d,class:"form-control font-12",placeholder:"Enter field description"},null,8,td)),[[R,u.as_a_block]]):m("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:d=>u.showDescription=!u.showDescription},g(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,sd)])])]),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:d=>Ms(o,r,c)},e[93]||(e[93]=[t("i",{class:"bi bi-trash"},null,-1),C(" Remove Table ")]),8,ld)]),(a(!0),n(B,null,z(u.columns,(d,p)=>{var $,M,k,F,S,le,tt,st,lt,ot,at,nt;return a(),n("div",{key:p,class:"dynamicField"},[t("div",od,[t("div",ad,[t("div",null,[t("span",{class:j(d.label?"d-none":"text-danger")},"*",2),D(t("input",{"onUpdate:modelValue":ne=>d.label=ne,placeholder:"Name the field",onBlur:()=>{jt(d),Ns(d,o,r,c,p,u.columns)},class:j(["border-less-input font-14 p-0 inputHeight",{"italic-style":!d.label,"fw-medium":d.label,"is-invalid":(k=(M=($=L[`${o}-${r}-${c}`])==null?void 0:$.columns)==null?void 0:M[p])==null?void 0:k.label}])},null,42,nd),[[R,d.label]]),(le=(S=(F=L[`${o}-${r}-${c}`])==null?void 0:F.columns)==null?void 0:S[p])!=null&&le.label?(a(),n("div",id,g(L[`${o}-${r}-${c}`].columns[p].label),1)):m("",!0)]),t("div",rd,[t("div",dd,[d.showDescription?D((a(),n("input",{key:0,"onUpdate:modelValue":ne=>d.description=ne,class:"form-control font-12",placeholder:"Enter field description"},null,8,ud)),[[R,d.description]]):m("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:ne=>d.showDescription=!d.showDescription},g(d.showDescription?"Hide Description":d.description?"Edit Description":"Add Description"),9,cd)]),t("button",{class:"btn btn-sm trash-btn py-0",onClick:ne=>Bs(o,r,c,p)},e[94]||(e[94]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,pd)])]),D(t("select",{"onUpdate:modelValue":ne=>d.fieldtype=ne,class:j(["form-select font-13 mb-1",{"is-invalid":(lt=(st=(tt=L[`${o}-${r}-${c}`])==null?void 0:tt.columns)==null?void 0:st[p])==null?void 0:lt.fieldtype}])},[e[95]||(e[95]=t("option",{value:""},"Select Type",-1)),(a(),n(B,null,z(Ct,ne=>t("option",{key:ne.type,value:ne.type},g(ne.label),9,fd)),64))],10,md),[[Be,d.fieldtype]]),["Select"].includes(d.fieldtype)?(a(),n("div",vd,[e[96]||(e[96]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":ne=>d.options=ne,class:"form-control shadow-none mb-1 font-12"},null,8,bd),[[R,d.options]]),!d.options||d.options.trim()===""?(a(),n("small",_d," Options are required for this field type. ")):m("",!0)])):m("",!0),(nt=(at=(ot=L[`${o}-${r}-${c}`])==null?void 0:ot.columns)==null?void 0:at[p])!=null&&nt.fieldtype?(a(),n("div",hd,g(L[`${o}-${r}-${c}`].columns[p].fieldtype),1)):m("",!0)])])}),128)),t("button",{class:"btn btn-light btn-sm addField mx-1",onClick:d=>Os(o,r,c)},e[97]||(e[97]=[t("i",{class:"bi bi-plus"},null,-1),C(" Add Field ")]),8,gd),t("button",{class:"btn btn-dark btn-sm font-12 mx-1",onClick:d=>Ws(o,r,c)}," Create Table ",8,yd),e[98]||(e[98]=t("hr",null,null,-1))])):m("",!0)])}),128))])]),t("div",wd,[t("button",{class:"btn btn-light border font-12",onClick:u=>_l(o,r)},e[99]||(e[99]=[t("i",{class:"bi bi-plus-circle me-1 fs-6"},null,-1),C(" Add Section ")]),8,kd)])]))),128)),o===0?(a(),n("div",$d)):m("",!0)])])),[[gt,o===q.value]])),128))],512)]),h.value?(a(),n("aside",Fd,[t("div",Cd,[e[101]||(e[101]=t("h6",{class:"mb-0"},"Field Properties",-1)),t("button",{class:"btn btn-sm btn-link p-0",onClick:e[30]||(e[30]=l=>h.value=null)},e[100]||(e[100]=[t("i",{class:"bi bi-x-lg"},null,-1)]))]),e[102]||(e[102]=t("div",{class:"properties-content"},[t("p",{class:"text-muted small"},"Select a field to edit its properties")],-1))])):m("",!0)],64))])])):m("",!0),E.value===3?(a(),n("div",Dd,[t("div",Sd,[t("button",{onClick:e[31]||(e[31]=l=>At()),class:"btn btn-sm btn-light"},e[103]||(e[103]=[t("i",{class:"bi bi-chevron-left"},null,-1),C(" Back ")])),e[105]||(e[105]=t("h1",{class:"font-14 fw-bold m-0"},"Workflow Setup",-1)),t("button",{class:"btn btn-sm btn-dark",onClick:qt},e[104]||(e[104]=[C(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]))]),t("div",qd,[t("div",Ad,[e[111]||(e[111]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),C("Workflow Configuration")])],-1)),t("div",Vd,[t("div",Ed,[t("div",Ud,[e[108]||(e[108]=t("label",{class:"form-label fw-bold"},"Workflow Type",-1)),t("div",Td,[D(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"existingWorkflow",value:"existing","onUpdate:modelValue":e[32]||(e[32]=l=>ge.value=l)},null,512),[[rs,ge.value]]),e[106]||(e[106]=t("label",{class:"btn btn-outline-primary",for:"existingWorkflow"},[t("i",{class:"bi bi-folder me-1"}),C("Use Existing ")],-1)),D(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"newWorkflow",value:"new","onUpdate:modelValue":e[33]||(e[33]=l=>ge.value=l),checked:""},null,512),[[rs,ge.value]]),e[107]||(e[107]=t("label",{class:"btn btn-outline-primary",for:"newWorkflow"},[t("i",{class:"bi bi-plus-circle me-1"}),C("Create New ")],-1))])]),ge.value==="existing"?(a(),n("div",Ld,[e[109]||(e[109]=t("label",{class:"form-label fw-bold"},"Select Workflow",-1)),oe(T(Oe),{onOpen:It,options:Qe.value,modelValue:Ce.value,"onUpdate:modelValue":e[34]||(e[34]=l=>Ce.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:es,openDirection:"bottom"},null,8,["options","modelValue"]),e[110]||(e[110]=t("small",{class:"text-muted font-12 mt-1 d-block"},[t("i",{class:"bi bi-info-circle me-1"}),C("Auto-populates requestors and approvers ")],-1))])):m("",!0)])])]),ge.value==="new"?(a(),n("div",Rd,[e[117]||(e[117]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-person-plus me-2"}),C("Requestor Configuration")])],-1)),t("div",Od,[e[116]||(e[116]=t("p",{class:"text-muted font-12 mb-3"},[t("i",{class:"bi bi-info-circle me-1"}),C(" Define who can submit requests for this form based on WF Requestors ")],-1)),t("button",{class:"btn btn-primary btn-sm mb-3",onClick:Ul},e[112]||(e[112]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),C("Add Requestor Role ")])),rt.value.length>0?(a(),n("div",Md,[t("table",Bd,[e[115]||(e[115]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"40%"},"Role"),t("th",{width:"30%"},"Auto Approval"),t("th",{width:"20%"},"Permissions"),t("th",{width:"10%"},"Action")])],-1)),t("tbody",null,[(a(!0),n(B,null,z(rt.value,(l,o)=>(a(),n("tr",{key:o},[t("td",null,[D(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":i=>l.role=i,placeholder:"Enter role name"},null,8,Nd),[[R,l.role]])]),t("td",null,[t("div",zd,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>l.autoApproval=i},null,8,Pd),[[fe,l.autoApproval]]),t("label",jd,g(l.autoApproval?"Yes":"No"),1)])]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:i=>Ll()},e[113]||(e[113]=[t("i",{class:"bi bi-gear"},null,-1),C(" Configure ")]),8,Wd)]),t("td",null,[t("button",{class:"btn btn-sm btn-danger",onClick:i=>Tl(o)},e[114]||(e[114]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Hd)])]))),128))])])])):m("",!0)])])):m("",!0),ge.value==="existing"&&Ce.value&&We.value.length>0?(a(),n("div",Jd,[e[123]||(e[123]=t("div",{class:"card-header bg-success text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-check-circle me-2"}),C("Loaded Requestors")])],-1)),t("div",Gd,[t("div",Yd,[e[118]||(e[118]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),t("strong",null,g(We.value.length),1),e[119]||(e[119]=C(" requestor role(s) loaded from ")),t("strong",null,g(Ce.value.display_name),1)]),t("div",Zd,[t("table",Kd,[e[121]||(e[121]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Role"),t("th",null,"Auto Approval"),t("th",null,"Columns Allowed")])],-1)),t("tbody",null,[(a(!0),n(B,null,z(We.value,(l,o)=>(a(),n("tr",{key:o},[t("td",null,[t("strong",null,g(l.requestor),1)]),t("td",null,[l.auto_approval?(a(),n("span",Qd,e[120]||(e[120]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),C("Yes ")]))):(a(),n("span",Xd,"No"))]),t("td",null,[t("small",xd,g(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[122]||(e[122]=t("div",{class:"alert alert-info mt-3"},[t("i",{class:"bi bi-info-circle me-1"}),C(" Go to "),t("strong",null,"Step 2"),C(" and click "),t("strong",null,'"Add Requestors"'),C(" to select specific designations for these roles ")],-1))])])):m("",!0),ge.value==="existing"&&Ce.value&&Ee.value.length>0?(a(),n("div",Id,[e[132]||(e[132]=t("div",{class:"card-header bg-primary text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),C("Loaded Approval Workflow")])],-1)),t("div",eu,[t("div",tu,[e[124]||(e[124]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),t("strong",null,g(Ee.value.length),1),e[125]||(e[125]=C(" approval level(s) loaded from ")),t("strong",null,g(Ce.value.display_name),1)]),t("div",su,[t("table",lu,[e[130]||(e[130]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"10%"},"Level"),t("th",{width:"25%"},"Role"),t("th",{width:"15%"},"Mandatory"),t("th",{width:"20%"},"Approval Type"),t("th",{width:"30%"},"Columns Allowed")])],-1)),t("tbody",null,[(a(!0),n(B,null,z(Ee.value,(l,o)=>(a(),n("tr",{key:o},[t("td",null,[t("span",ou,"Level "+g(l.level),1)]),t("td",null,[t("strong",null,g(l.role),1)]),t("td",null,[l.mandatory?(a(),n("span",au,e[126]||(e[126]=[t("i",{class:"bi bi-exclamation-circle me-1"},null,-1),C("Required ")]))):(a(),n("span",nu,"Optional"))]),t("td",null,[l.view_only_reportee?(a(),n("span",iu,e[127]||(e[127]=[t("i",{class:"bi bi-person me-1"},null,-1),C("Reporting Manager ")]))):l.all_approvals_required?(a(),n("span",ru,e[128]||(e[128]=[t("i",{class:"bi bi-people me-1"},null,-1),C("All Users ")]))):l.requester_as_a_approver?(a(),n("span",du,e[129]||(e[129]=[t("i",{class:"bi bi-person-check me-1"},null,-1),C("Requestor ")]))):(a(),n("span",uu," Any One "))]),t("td",null,[t("small",cu,g(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[131]||(e[131]=t("div",{class:"alert alert-info mt-3"},[t("i",{class:"bi bi-info-circle me-1"}),C(" Go to "),t("strong",null,"Step 2"),C(" and click "),t("strong",null,'"Add Approvers"'),C(" for each level to select specific designations ")],-1))])])):m("",!0),e[133]||(e[133]=is('<div class="card mt-4" data-v-7583d2b0><div class="card-header bg-light" data-v-7583d2b0><h6 class="mb-0 fw-bold" data-v-7583d2b0><i class="bi bi-shield-check me-2" data-v-7583d2b0></i>System Generated Fields</h6></div><div class="card-body" data-v-7583d2b0><div class="alert alert-secondary mb-3" data-v-7583d2b0><i class="bi bi-info-circle me-2" data-v-7583d2b0></i> These fields are automatically included for all requestors. </div><div class="row g-3" data-v-7583d2b0><div class="col-md-6" data-v-7583d2b0><div class="field-preview-card" data-v-7583d2b0><label class="form-label fw-bold" data-v-7583d2b0>Requestor Name</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-7583d2b0></div></div><div class="col-md-6" data-v-7583d2b0><div class="field-preview-card" data-v-7583d2b0><label class="form-label fw-bold" data-v-7583d2b0>Requestor Email</label><input type="email" class="form-control" value="Auto-populated from user profile" disabled data-v-7583d2b0></div></div><div class="col-md-6" data-v-7583d2b0><div class="field-preview-card" data-v-7583d2b0><label class="form-label fw-bold" data-v-7583d2b0>Request Date</label><input type="text" class="form-control" value="Auto-populated on submission" disabled data-v-7583d2b0></div></div><div class="col-md-6" data-v-7583d2b0><div class="field-preview-card" data-v-7583d2b0><label class="form-label fw-bold" data-v-7583d2b0>Department</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-7583d2b0></div></div></div></div></div>',1))])])):m("",!0),E.value===4?(a(),n("div",pu,[e[134]||(e[134]=t("div",{class:"stepperbackground d-flex align-items-center justify-content-end gap-2"},[t("div",null,[t("button",{class:"btn btn btn-light previewBtn font-13","data-bs-toggle":"modal","data-bs-target":"#customFormatModal"},"Print Format ")]),t("div")],-1)),oe(ds,{blockArr:_t.value},null,8,["blockArr"])])):m("",!0)])])])])])])]),t("div",mu,[t("div",fu,[t("div",vu,[e[138]||(e[138]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"customFormatModalLabel"},"Print Format"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",bu,[e[136]||(e[136]=t("label",{for:""},"Form Name",-1)),D(t("input",{"onUpdate:modelValue":e[35]||(e[35]=l=>ut.value=l),multiple:!1,placeholder:T(V).query.id,class:"font-11 form-control",id:"Form_name_print",searchable:!0},null,8,_u),[[R,ut.value]]),t("div",hu,[t("div",gu,[D(t("input",{class:"font-12","onUpdate:modelValue":e[36]||(e[36]=l=>Je.value=l),"true-value":1,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,512),[[fe,Je.value]])]),e[135]||(e[135]=t("div",null,[t("label",{for:"mandatory",class:"font-12 fw-bold m-0 fw-light"},"Print Landscape Mode")],-1))])]),t("div",{class:"modal-footer"},[e[137]||(e[137]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),t("button",{type:"button",class:"btn btn-dark",onClick:fl},"Add Print Format")])])])]),t("div",yu,[t("div",wu,[t("div",ku,[e[139]||(e[139]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"formViewModalLabel"},"Form Preview"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",$u,[oe(ds,{blockArr:_t.value},null,8,["blockArr"])]),e[140]||(e[140]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),t("div",Fu,[t("div",Cu,[t("span",Du,g(Y.value==0?"Add Requestors":`Approval Settings - Level ${Y.value}`),1),e[141]||(e[141]=t("button",{type:"button",class:"btn-close bg-light text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),t("div",Su,[t("div",qu,[Y.value!==0?(a(),n("div",Au,[e[143]||(e[143]=t("label",{class:"fw-bold font-12 mb-2"},"Approver Type",-1)),D(t("select",{"onUpdate:modelValue":e[37]||(e[37]=l=>_e.value=l),class:"form-select shadow-none font-12"},e[142]||(e[142]=[t("option",{value:""},"Any one of the selected approvers",-1),t("option",{value:"ViewOnlyReportee"},"Reporting Manager only",-1),t("option",{value:"all_approvals_required"},"All of the selected approvers",-1),t("option",{value:"requester_as_a_approver"},"Approval by Requestor",-1)]),512),[[Be,_e.value]])])):m("",!0),t("div",Vu,[t("div",Eu,[t("span",Uu," Select "+g(Y.value===0?"Requestors":"Approvers"),1),t("span",Tu,g(N.value.length)+" Selected ",1)]),Q.value.length?(a(),n("div",Lu,[t("div",Ru,[t("div",Ou,[t("input",{type:"checkbox",id:"selectAll",checked:ll.value,onChange:ol,class:"form-check-input me-2 designationCheckBox"},null,40,Mu),t("label",Bu," Select all designation ("+g(et.value.length)+") ",1)]),Y.value!==0?(a(),n("div",Nu,[D(t("input",{type:"checkbox",id:"showHods","onUpdate:modelValue":e[38]||(e[38]=l=>Ge.value=l),class:"form-check-input me-2 designationCheckBox"},null,512),[[fe,Ge.value]]),e[144]||(e[144]=t("label",{for:"showHods",class:"form-check-label mt-2 fw-bold"}," Show HODs Only ",-1))])):m("",!0),t("div",null,[N.value.length?(a(),n("button",{key:0,type:"button",class:"btn btn-sm font-12 text-danger",onClick:al},e[145]||(e[145]=[t("i",{class:"bi bi-x"},null,-1),C(" Clear all ")]))):m("",!0)])]),Q.value.length?(a(),Rt(T(Kl),{key:0,multiple:!0,modelValue:N.value,"onUpdate:modelValue":e[39]||(e[39]=l=>N.value=l),options:et.value,"close-on-select":!1,"clear-search-on-select":!0,placeholder:"Search & Select Designations"},null,8,["modelValue","options"])):m("",!0)],512)):(a(),n("div",zu,e[146]||(e[146]=[t("div",{class:"d-flex justify-content-center"},[t("span",null,"No Designations Found")],-1)])))]),Y.value!==0?(a(),n("div",Pu,[e[147]||(e[147]=t("div",null,[t("label",{for:"",class:"fw-bold font-12"},"On Rejection")],-1)),D(t("select",{"onUpdate:modelValue":e[40]||(e[40]=l=>$e.value=l),class:"form-select shadow-none font-12 mt-1 me-2"},[(a(!0),n(B,null,z($s.value,l=>(a(),n("option",{key:l,value:l},g(l===0?"Requestor":"Approver Level "+l),9,ju))),128))],512),[[Be,$e.value,void 0,{number:!0}]])])):m("",!0),Y.value!==0?(a(),n("div",Wu,[t("div",Hu,[t("div",Ju,[D(t("input",{"onUpdate:modelValue":e[41]||(e[41]=l=>Ne.value=l),type:"checkbox","true-value":1,"false-value":0,id:"Approver",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[fe,Ne.value]]),e[148]||(e[148]=t("label",{for:"Approver",class:"m-0"},"Approval Mandatory",-1))]),be.value===!0?(a(),n("div",Gu,[D(t("input",{"onUpdate:modelValue":e[42]||(e[42]=l=>ze.value=l),type:"checkbox","true-value":1,"false-value":0,id:"approver_can_edit",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[fe,ze.value]]),e[149]||(e[149]=t("label",{for:"approver_can_edit",class:"m-0"}," Allow this approver to edit the form ",-1))])):m("",!0)])])):m("",!0)]),t("div",Yu,[t("div",Zu,[oe(ns,{class:"btn btn-dark addingDesignations","data-bs-dismiss":"offcanvas",onClick:nl,name:Y.value===0?"Add Requestor":"Add Approvers"},null,8,["name"])])])])])]))}},xu=Mt(Ku,[["__scopeId","data-v-7583d2b0"]]);export{xu as default};
