var be=Object.defineProperty;var z=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var U=(q,d,v)=>d in q?be(q,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):q[d]=v,H=(q,d)=>{for(var v in d||(d={}))qe.call(d,v)&&U(q,v,d[v]);if(z)for(var v of z(d))Re.call(d,v)&&U(q,v,d[v]);return q};import{q as we,I as ke,u as $e,e as I,d as o,w as Ce,o as m,c as f,b as s,t as w,a as G,_ as Se,P as Ae,z as Ee,A as Fe,y as Q,j as E,h as b,x as Ne,G as Oe,H as X,E as Pe,J as Le,l as _,m as g,p as M,k as P}from"./index-DXneRfP_.js";const Ie={class:"d-flex justify-content-between align-items-center py-2"},Me={class:"m-0 font-11 pt-1"},je={class:"mt-2"},xe={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},Te={class:"modal-dialog modal-dialog-centered modal-lg"},Be={class:"modal-content"},Ve={class:"modal-header"},Je={class:"modal-title font-13",id:"viewRequestLabel"},De={class:"p-2"},We={class:"activity-log-container"},ze={class:"activity-log-content"},Ue={class:"font-12 mb-1"},He={class:"strong-content"},Ge={class:"strong-content"},Qe={class:"strong-content"},Xe={key:0},Ye={key:1,class:"strong-content"},Ze={key:0,class:"form-floating p-1"},Ke={key:0,class:"font-11 text-danger ps-1"},et={class:"modal-footer"},tt={key:0,class:"d-flex justify-content-between align-items-center mt-3 gap-2"},at=["disabled"],st={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ot={key:1},nt=["disabled"],lt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},rt={key:1},it={__name:"ReceivedForMe",setup(q){const d=ke(),v=$e(),Y=I(()=>Pe.value),j=o({business_unit:""}),u=o({limitPageLength:20,limit_start:0,filters:[]}),L=o(0),Z=o([]),K=o([]),ee=o([]),k=o([]),te=o(""),F=o([]),x=o([]);o(!1);const T=o([{th:"Request ID",td_key:"name"},{th:"Requested By",td_key:"requested_by"},{th:"Requested department",td_key:"role"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"}]),ae=o([{name:"View Request",icon:"fa-solid fa-eye"}]),$=o([]),l=o({}),B=o(null),N=o([]),y=o("");o([]);const se=o([]),C=o(!1),S=o(!1),V=o([]);function oe(){_.post(g.view_only_reportee).then(a=>{V.value=a.message,h()}).catch(a=>{console.log(a)})}function ne(a,e){var n,t,r;if(e.name==="View Request")if(a){l.value=H({},a),te.value=l.value.current_level,B.value=Le((t=JSON.parse((n=l.value)==null?void 0:n.json_columns))==null?void 0:t.fields),se.value=JSON.parse((r=l.value)==null?void 0:r.json_columns).child_table_fields;const i=[["wf_generated_request_id","like",`%${l.value.name}%`]],c={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(i),order_by:`\`tab${l.value.doctype_name}\`.\`creation\` desc`};_.get(`${g.resource}${l.value.doctype_name}`,{params:c}).then(p=>{p.data&&(N.value=p.data[0],fe(N.value,B.value),_.get(`${g.resource}${l.value.doctype_name}/${p.data[0].name}`).then(A=>{const W=Object.keys(A.data).filter(O=>Array.isArray(A.data[O]));W.length&&(x.value={},W.forEach(O=>{x.value[O]=A.data[O]||[]}))}).catch(A=>{console.error("Error fetching data for :",A)}))}).catch(p=>{console.error("Error fetching categories data:",p)}),_.get(`${g.resource}${M.WFActivityLog}/${l.value.name}`).then(p=>{p.data&&(F.value=p.data.reason||[])}).catch(p=>{console.error("Error fetching activity data:",p)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ")}function le(a){d.push({name:"ApproveRequest",query:{routepath:v.path,name:a.name,doctype_name:a.doctype_name,type:"mytasks"}})}const J=I(()=>F.value.some(a=>a.action==="Request Cancelled")),re=a=>a?new Date(a).toLocaleDateString("en-GB"):"N/A",ie=a=>a?{"Request Cancelled":"cancelled","Request Raised":"raised"}[a]||a.toLowerCase():"performed an action on",R=o(!0),ue=()=>{y.value.trim()!==""&&(R.value=!0)};function ce(a,e){if(y.value.trim()===""){R.value=!1;return}R.value=!0,C.value=!0;let n={};k.value.length&&k.value.map(t=>{n[t.fieldname]=t.value}),_.put(`${g.resource}${l.value.doctype_name}/${N.value.name}`,n).then(t=>{t!=null&&t.data&&de(a,e)}).catch(t=>{console.error("Error submitting form:",t)})}function de(a,e){let n={property:l.value.property,doctype:l.value.doctype_name,request_ids:[l.value.name],reason:y.value,action:e,files:null,cluster_name:null,url_for_approval_id:"",current_level:l.value.current_level};_.post(g.requestApproval,{request_details:[n]}).then(t=>{var r;((r=t==null?void 0:t.message)==null?void 0:r.success)===!0?(P.success(`Request ${e}ed`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),y.value="",h()):P.error(`Failed to ${e} request`,{autoClose:1e3,transition:"zoom"})}).catch(t=>{console.error("Error processing request:",t)}).finally(()=>{C.value=!1})}function ve(a,e){if(y.value.trim()===""){R.value=!1;return}R.value=!0,S.value=!0;let n={};k.value.length&&k.value.map(t=>{n[t.fieldname]=t.value}),_.put(`${g.resource}${l.value.doctype_name}/${N.value.name}`,n).then(t=>{t!=null&&t.data&&(bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),me(a,e))})}function me(a,e){let n={property:l.value.property,doctype:l.value.doctype_name,request_id:l.value.name,reason:y.value,action:e,files:[],url_for_cancelling_id:"",current_level:l.value.current_level};_.post(g.wf_cancelling_request,n).then(t=>{t!=null&&t.message&&(y.value="",P.success(`${e}`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),h())}).catch(t=>{console.error("Error processing cancellation:",t),P.error("An error occurred while processing your request.",{autoClose:1e3,transition:"zoom"})}).finally(()=>{S.value=!1})}function fe(a,e){e.forEach(n=>{n.sections.forEach(t=>{t.rows.forEach(r=>{r.columns.forEach(i=>{i.fields.forEach(c=>{a!=null&&a.hasOwnProperty(c==null?void 0:c.fieldname)&&(c.value=a[c==null?void 0:c.fieldname])})})})})})}function pe(){R.value=!0}const _e=a=>{u.value.limitPageLength=a,u.value.limit_start=0,u.value.filters.length?h(u.value.filters):h()},ge=([a,e])=>{u.value.limitPageLength=a,u.value.limit_start=e,u.value.filters.length?h(u.value.filters):h()};o([]);const D=o(null);function ye(a){clearTimeout(D.value),D.value=setTimeout(()=>{u.value.filters=[],T.value.forEach(e=>{const n=e.td_key;a[n]&&u.value.filters.push(n,"like",`%${a[n]}%`)}),u.value.filters.length?h(u.value.filters):h()},500)}function h(a){const e=JSON.parse(localStorage.getItem("employeeData")),n=[["assigned_to_users","like",`%${e==null?void 0:e.designation}%`],["property","like",`%${j.value.business_unit}%`],["status","!=","Request Cancelled"],["name","in",V.value]];a&&n.push(a);const t={fields:JSON.stringify(["*"]),limit_page_length:u.value.limitPageLength,limit_start:u.value.limit_start,filters:JSON.stringify(n),order_by:"`tabWF Workflow Requests`.`creation` desc"},r={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(n)};_.get(`${g.resource}${M.WFWorkflowRequests}`,{params:r}).then(i=>{L.value=i.data[0].total_count}).catch(i=>{console.error("Error fetching total count:",i)}),_.get(`${g.resource}${M.WFWorkflowRequests}`,{params:t}).then(i=>{u.value.limit_start===0?($.value=i.data,Z.value=[...new Set(i.data.map(c=>c.name))],K.value=[...new Set(i.data.map(c=>c.doctype_name))],ee.value=[...new Set(i.data.map(c=>c.status))]):$.value=$.value.concat(i.data)}).catch(i=>{console.error("Error fetching records:",i)})}const he=I(()=>({name:{type:"input"},requested_by:{type:"input"},role:{type:"input"},status:{type:"select",options:["Request Raised","In Progress"]}}));return Ce(Y,a=>{j.value.business_unit=a,a.length&&oe()},{immediate:!0}),(a,e)=>{var n;return m(),f("div",null,[s("div",Ie,[s("div",null,[e[3]||(e[3]=s("h1",{class:"m-0 font-13"},"Requests Assigned to me",-1)),s("p",Me,w(L.value)+" request",1)])]),s("div",je,[G(Se,{tHeaders:T.value,tData:$.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onUpdateFilters:ye,"field-mapping":he.value,onCellClick:le,isFiltersoption:"true",actions:ae.value,onActionClicked:ne},null,8,["tHeaders","tData","field-mapping","actions"]),G(Ae,{currentRecords:$.value.length,totalRecords:L.value,onUpdateValue:_e,onLimitStart:ge},null,8,["currentRecords","totalRecords"])]),s("div",xe,[s("div",Te,[s("div",Be,[s("div",Ve,[s("h5",Je," Request Id: "+w((n=l.value.name)==null?void 0:n.replace(/_/g," ")),1),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal",onClick:pe,"aria-label":"Close"})]),e[12]||(e[12]=s("div",{class:"modal-body approvermodalbody"},null,-1)),s("div",De,[s("div",We,[(m(!0),f(Ee,null,Fe(F.value,(t,r)=>(m(),f("div",{key:r,class:Q(["activity-log-item",{"last-item":r===F.value.length-1}])},[e[7]||(e[7]=s("div",{class:"activity-log-dot"},null,-1)),e[8]||(e[8]=E("def add_roles_to_wf_requestors ")),s("div",ze,[s("p",Ue,[e[4]||(e[4]=E(" On ")),s("strong",He,w(re(t.creation)),1),e[5]||(e[5]=E(", ")),s("strong",Ge,w(t.user_name),1),E(" ("+w(t.role)+") has ",1),s("strong",Qe,w(ie(t.action)),1),e[6]||(e[6]=E(" the request")),r!==0&&t.reason?(m(),f("span",Xe,"with the comments:")):b("",!0),r!==0&&t.reason?(m(),f("strong",Ye,w(t.reason||"N/A"),1)):b("",!0)])])],2))),128))]),J.value?b("",!0):(m(),f("div",Ze,[Ne(s("textarea",{class:Q(["form-control font-12",{"is-invalid":!R.value}]),placeholder:"Leave a comment here",id:"floatingTextarea",onInput:ue,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t)},null,34),[[Oe,y.value]]),e[9]||(e[9]=s("label",{class:"font-11",for:"floatingTextarea"},"Comments..",-1)),R.value?b("",!0):(m(),f("span",Ke,"Please enter comments**"))]))]),s("div",et,[J.value?b("",!0):(m(),f("div",tt,[s("div",null,[s("button",{type:"submit",class:"btn btn-outline-danger font-12 py-0 rejectbtn",disabled:S.value,onClick:e[1]||(e[1]=X(t=>ve(a.formData,"Request Cancelled"),["prevent"]))},[S.value?(m(),f("span",st)):b("",!0),S.value?b("",!0):(m(),f("span",ot,e[10]||(e[10]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),s("span",{class:"font-12"},"Reject",-1)])))],8,at)]),s("div",null,[s("button",{type:"submit",class:"btn btn-success approvebtn",disabled:C.value,onClick:e[2]||(e[2]=X(t=>ce(k.value,"Approve"),["prevent"]))},[C.value?(m(),f("span",lt)):b("",!0),C.value?b("",!0):(m(),f("span",rt,e[11]||(e[11]=[s("i",{class:"bi bi-check-lg font-15 me-2"},null,-1),s("span",{class:"font-12"},"Approve",-1)])))],8,nt)])]))])])])])])}}},vt=we(it,[["__scopeId","data-v-03df2959"]]);export{vt as default};
