import{d as n,u as X,e as I,w as Z,f as ee,g as p,o as L,c as q,b as s,t as te,a as S,I as se,x as ae,G as oe,P as ne,h as O,i as V,E as ie,j as b,k as y,l as w,m as le,n as x}from"./index-LfV3iEDw.js";const re={class:""},de={class:"d-flex align-items-center justify-content-between py-3"},ue={class:"m-0 font-11 pt-1"},me={key:0,class:"d-flex align-items-center gap-2"},ce={class:"d-flex align-items-center"},fe={class:"mt-1"},pe={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},be={class:"modal-dialog modal-xl"},ve={class:"modal-content"},he={class:"d-block modal-header bg-dark text-white py-2"},_e={class:"d-flex align-items-center justify-content-between"},ge={class:""},ye={class:"modal-body"},we=["innerHTML"],Ce={__name:"CreateForm",props:["id"],setup($){const C=n(0),E=n([{th:"Form Name",td_key:"form_name"},{th:"Form Short Code",td_key:"form_short_name"},{th:"Accessible Departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"},{th:"Form Status",td_key:"enable"}]),_=$,R=n({});n(null);const v=n([]),B=n([]),d=X(),D=n("");n([]);const k=n(""),A=n(""),m=I(()=>ie.value),N=n({business_unit:""}),l=n({limitPageLength:20,limit_start:0,filters:[]}),M=I(()=>{const e=[{name:"View form",icon:"fa-solid fa-eye"},{name:"Raise Request",icon:"fa fa-file-text"}];return k.value.includes("IT")&&e.push({name:"Edit Form",icon:"fa-solid fa-edit"}),e}),J=n({form_short_name:{type:"input"},form_category:{type:"input"},form_status:{type:"select",options:["Active","Retired"]},form_name:{type:"input"},enable:{type:"select",options:["Enabled","Disabled"]}});function P(e=null){e==null?p.push({name:"FormStepper",query:{routepath:d.path,business_unit:m.value}}):p.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:d.path,business_unit:m.value,id:e.name}}),localStorage.setItem("routepath",d.path)}function j(e,t,a){if(a==="view"&&e&&p.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:m.value}}),a==="raiseRequest"){const o=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const i=JSON.parse(r).designation;o.workflow.length||b.info("No Roles Added",{autoClose:500});const c=o.workflow[0].roles;let g=!1;for(let f=0;f<c.length;f++)if(c[f]===i){g=!0;break}g?p.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):b.info("You do not have permission to access this Form.")}}}function z(e,t){var a;if(t.name==="View form"?e?p.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:m.value}}):b.warn(" There is no form fields "):t.name==="Edit Form"&&P(e),t.name==="Raise Request"){const o=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const i=JSON.parse(r).designation;(a=o.workflow)!=null&&a.length||b.info("No Roles Added",{autoClose:500});const c=o.workflow[0].roles;let g=!1;for(let f=0;f<c.length;f++)if(c[f]===i){g=!0;break}g&&e.enable===1?p.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit,has_workflow:e.has_workflow}}):e.enable===0?b.info("This form is currently disabled.",{autoClose:500}):b.info("You do not have permission to access this Form.",{autoClose:500})}}if(t.name==="Download Print format"){R.value=e;const o={form_short_name:e.form_short_name,business_unit:m.value};y.post(w.preview_dynamic_form,o).then(i=>{D.value=i.message}).catch(i=>{console.error("Error fetching data:",i)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function U(){const e={form_short_name:R.value.form_short_name,name:null,business_unit:m.value};y.post(w.download_pdf_form,e).then(t=>{let a=le+t.message;a=a.replace("/api","");const o=document.createElement("a");o.href=a,o.download=t.message.split("/").pop(),o.click()}).catch(t=>{console.error("Error fetching data:",t)})}const H=n([]),u=n(null),F=n("");function Y(e,t,a){u.value=e;const o=e.enable=="1"||e.enable===1;F.value=o?"Disable":"Restore",document.getElementById("actionTextSpan").innerText=F.value,document.getElementById("rowNameSpan").innerText=e.name;const r=new bootstrap.Modal(document.getElementById("EnableDisable"));r.show(),window.currentModal=r}function G(){if(!u.value)return;const e=u.value.enable=="1"||u.value.enable===1;u.value.enable=e?0:1,u.value.form_status=e?"Draft":"Created",y.put(`${w.resource}${x.EzyFormDefinitions}/${u.value.name}`,u.value).then(t=>{H.value=t.data,b.success(`Form ${F.value}d successfully`,{autoClose:700}),setTimeout(()=>{h()},1e3),window.currentModal&&window.currentModal.hide()}).catch(t=>{console.error("Error updating toggle:",t)})}Z([()=>m.value,()=>_.id],([e,t])=>{N.value.business_unit=e,h()},{immediate:!0});const K=e=>{l.value.limitPageLength=e,l.value.limit_start=0,h()},Q=([e,t])=>{l.value.limitPageLength=e,l.value.limit_start=t,h()},T=n(null);function W(e){clearTimeout(T.value),T.value=setTimeout(()=>{l.value.filters=[],e.form_status==="Active"&&l.value.filters.push(["form_status","like","Created"]),e.form_status==="Retired"&&l.value.filters.push(["form_status","like","Draft"]),console.log(e.enable),e.enable==="Enabled"?l.value.filters.push(["enable","=",1]):e.enable==="Disabled"&&l.value.filters.push(["enable","=",0]),E.value.forEach(t=>{const a=t.td_key,o=e[a];a==="form_status"||a==="enable"||o&&l.value.filters.push([a,"like",`%${o}%`])}),l.value.filters.length?h(null,l.value.filters):h()},500)}function h(e,t){const a=[["business_unit","like",`%${N.value.business_unit}%`]];_.id&&_.id!=="Allforms"&&_.id!=="allforms"&&a.push(["owner_of_the_form","=",_.id]),t&&a.push(...t);const o={fields:JSON.stringify(["*"]),limit_page_length:l.value.limitPageLength,limit_start:l.value.limit_start,filters:JSON.stringify(a),order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`modified` DESC"},r={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(a)};y.get(`${w.resource}${x.EzyFormDefinitions}`,{params:r}).then(i=>{C.value=i.data[0].total_count}).catch(i=>{console.error("Error fetching ezyForms data:",i)}),y.get(`${w.resource}${x.EzyFormDefinitions}`,{params:o}).then(i=>{l.value.limit_start===0?(v.value=i.data,B.value=[...new Set(v.value.map(c=>c.form_category))]):v.value=v.value.concat(i.data)}).catch(i=>{console.error("Error fetching department details:",i)})}return ee(()=>{localStorage.removeItem("routepath");const e=JSON.parse(localStorage.getItem("employeeData"));k.value=e.designation||"",k.value.includes("IT")&&(A.value="true"),(d.path==="/forms/department/allforms"||d.path==="/forms/department/Allforms")&&p.replace("/forms/department/allforms")}),(e,t)=>(L(),q("div",re,[s("div",null,[s("div",de,[s("div",null,[t[2]||(t[2]=s("h1",{class:"m-0 font-13"}," All Forms ",-1)),s("p",ue,te(C.value)+" Forms Available ",1)]),k.value.includes("IT")?(L(),q("div",me,[s("div",ce,[S(se,{class:"buttoncomp",onClick:t[0]||(t[0]=a=>P()),name:"Create Form"})])])):ae("",!0)]),s("div",fe,[S(oe,{tHeaders:E.value,tData:v.value,isCheckbox:"true",isAction:"true",actionType:"dropdown",raiseRequest:"true",enableDisable:A.value,onCellClick:j,onActionClicked:z,onToggleClick:Y,actions:M.value,onUpdateFilters:W,"field-mapping":J.value,isFiltersoption:"true"},null,8,["tHeaders","tData","enableDisable","actions","field-mapping"]),S(ne,{currentRecords:v.value.length,totalRecords:C.value,onUpdateValue:K,onLimitStart:Q},null,8,["currentRecords","totalRecords"])])]),t[9]||(t[9]=O('<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel"><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasRightLabel">Asset Request Form</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><div class="d-flex align-items-baseline position-relative gap-3"><div class="d-flex flex-column"><span><i class="dashedcircle ri-checkbox-blank-circle-fill"></i></span><div class="dashed_line mt-4"></div></div><div>data</div></div></div></div>',1)),s("div",pe,[s("div",be,[s("div",ve,[s("div",he,[s("div",_e,[t[5]||(t[5]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",ge,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:U},t[3]||(t[3]=[V("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[1]||(t[1]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[4]||(t[4]=[V("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",ye,[s("div",{innerHTML:D.value},null,8,we)]),t[6]||(t[6]=s("div",{class:"modal-footer"},null,-1))])])]),s("div",{class:"modal fade",id:"EnableDisable",tabindex:"-1","aria-labelledby":"EnableDisableLabel","aria-hidden":"true"},[s("div",{class:"modal-dialog modal-dialog-centered"},[s("div",{class:"modal-content"},[t[8]||(t[8]=O('<div class="modal-header"><h5 class="modal-title" id="EnableDisableLabel">Confirm Action</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> Are you sure you want to <span id="actionTextSpan"></span> <span class="fw-bold font-13" id="rowNameSpan"></span> Form? </div>',2)),s("div",{class:"modal-footer"},[t[7]||(t[7]=s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),s("button",{type:"button",class:"btn btn-dark",onClick:G},"Yes, Proceed")])])])])]))}};export{Ce as default};
