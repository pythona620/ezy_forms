import{d as i,u as Z,e as q,w as ee,f as te,g as b,o as I,c as O,b as s,t as V,a as x,B as se,h as ae,G as oe,P as ne,i as $,j as B,E as ie,k as v,l as y,m as w,n as le,p as E}from"./index-B4_9ZtV1.js";const re={class:""},de={class:"d-flex align-items-center justify-content-between py-3"},ue={class:"m-0 font-13"},ce={class:"m-0 font-11 pt-1"},me={key:0,class:"d-flex align-items-center gap-2"},fe={class:"d-flex align-items-center"},pe={class:"mt-1"},be={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},ve={class:"modal-dialog modal-xl"},he={class:"modal-content"},_e={class:"d-block modal-header bg-dark text-white py-2"},ge={class:"d-flex align-items-center justify-content-between"},ye={class:""},we={class:"modal-body"},ke=["innerHTML"],Fe={__name:"AllDepartment",props:["id"],setup(C){const F=i(0),R=i([{th:"Form Name",td_key:"form_name"},{th:"Form Short Code",td_key:"form_short_name"},{th:"Form Category",td_key:"form_category"},{th:"Accessible Departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"},{th:"Form Status",td_key:"enable"}]),u=C,D=i({});i(null);const h=i([]),M=i([]),d=Z(),A=i("");i([]);const k=i(""),N=i(""),c=q(()=>ie.value),P=i({business_unit:""}),n=i({limitPageLength:20,limit_start:0,filters:[]}),J=q(()=>{const e=[{name:"View form",icon:"fa-solid fa-eye"},{name:"Raise Request",icon:"fa fa-file-text"}];return k.value.includes("IT")&&e.push({name:"Edit Form",icon:"fa-solid fa-edit"}),e}),j=i({form_short_name:{type:"input"},form_category:{type:"input"},form_status:{type:"select",options:["Active","Retired"]},form_name:{type:"input"},enable:{type:"select",options:["Enabled","Disabled"]}});function T(e=null){e==null?b.push({name:"FormStepper",query:{routepath:d.path,business_unit:c.value}}):b.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:d.path,business_unit:c.value,id:e.name}}),localStorage.setItem("routepath",d.path)}function z(e,t,a){if(a==="view"&&e&&b.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:c.value}}),a==="raiseRequest"){const o=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const l=JSON.parse(r).designation;o.workflow.length||v.info("No Roles Added",{autoClose:500});const f=o.workflow[0].roles;let g=!1;for(let p=0;p<f.length;p++)if(f[p]===l){g=!0;break}g?b.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):v.info("You do not have permission to access this Form.")}}}function U(e,t){var a;if(t.name==="View form"?e?b.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:c.value}}):v.warn(" There is no form fields "):t.name==="Edit Form"&&T(e),t.name==="Raise Request"){const o=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const l=JSON.parse(r).designation;(a=o.workflow)!=null&&a.length||v.info("No Roles Added",{autoClose:500});const f=o.workflow[0].roles;let g=!1;for(let p=0;p<f.length;p++)if(f[p]===l){g=!0;break}g&&e.enable===1?b.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit,has_workflow:e.has_workflow}}):e.enable===0?v.info("This form is currently disabled.",{autoClose:500}):v.info("You do not have permission to access this Form.",{autoClose:500})}}if(t.name==="Download Print format"){D.value=e;const o={form_short_name:e.form_short_name,business_unit:c.value};y.post(w.preview_dynamic_form,o).then(l=>{A.value=l.message}).catch(l=>{console.error("Error fetching data:",l)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function H(){const e={form_short_name:D.value.form_short_name,name:null,business_unit:c.value};y.post(w.download_pdf_form,e).then(t=>{let a=le+t.message;a=a.replace("/api","");const o=document.createElement("a");o.href=a,o.download=t.message.split("/").pop(),o.click()}).catch(t=>{console.error("Error fetching data:",t)})}const Y=i([]),m=i(null),S=i("");function G(e,t,a){m.value=e;const o=e.enable=="1"||e.enable===1;S.value=o?"Disable":"Restore",document.getElementById("actionTextSpan").innerText=S.value,document.getElementById("rowNameSpan").innerText=e.name;const r=new bootstrap.Modal(document.getElementById("EnableDisable"));r.show(),window.currentModal=r}function K(){if(!m.value)return;const e=m.value.enable=="1"||m.value.enable===1;m.value.enable=e?0:1,y.put(`${w.resource}${E.EzyFormDefinitions}/${m.value.name}`,m.value).then(t=>{Y.value=t.data,v.success(`Form ${S.value}d successfully`,{autoClose:700}),setTimeout(()=>{_()},1e3),window.currentModal&&window.currentModal.hide()}).catch(t=>{console.error("Error updating toggle:",t)})}ee([()=>c.value,()=>u.id],([e,t])=>{P.value.business_unit=e,e.length&&t&&u.id!==":id"&&(n.value.limit_start=0,n.value.filters=[],_(t||u.id,null))},{immediate:!0});const Q=e=>{n.value.limitPageLength=e,n.value.limit_start=0,_()},W=([e,t])=>{n.value.limitPageLength=e,n.value.limit_start=t,_()},L=i(null);function X(e){clearTimeout(L.value),L.value=setTimeout(()=>{n.value.filters=[],e.form_status==="Active"&&n.value.filters.push(["form_status","like","Created"]),e.form_status==="Retired"&&n.value.filters.push(["form_status","like","Draft"]),console.log(e.enable),e.enable==="Enabled"?n.value.filters.push(["enable","=",1]):e.enable==="Disabled"&&n.value.filters.push(["enable","=",0]),R.value.forEach(t=>{const a=t.td_key,o=e[a];a==="form_status"||a==="enable"||o&&n.value.filters.push([a,"like",`%${o}%`])}),n.value.filters.length?_(null,n.value.filters):_()},500)}function _(e,t){const a=[["business_unit","like",`%${P.value.business_unit}%`]];u.id&&u.id!=="Allforms"&&u.id!=="allforms"&&a.push(["owner_of_the_form","=",u.id]),t&&a.push(...t);const o={fields:JSON.stringify(["*"]),limit_page_length:n.value.limitPageLength,limit_start:n.value.limit_start,filters:JSON.stringify(a),order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`modified` DESC"},r={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(a)};y.get(`${w.resource}${E.EzyFormDefinitions}`,{params:r}).then(l=>{F.value=l.data[0].total_count}).catch(l=>{console.error("Error fetching ezyForms data:",l)}),y.get(`${w.resource}${E.EzyFormDefinitions}`,{params:o}).then(l=>{n.value.limit_start===0?(h.value=l.data,M.value=[...new Set(h.value.map(f=>f.form_category))]):h.value=h.value.concat(l.data)}).catch(l=>{console.error("Error fetching department details:",l)})}return te(()=>{localStorage.removeItem("routepath");const e=JSON.parse(localStorage.getItem("employeeData"));k.value=e.designation||"",k.value.includes("IT")&&(N.value="true"),(d.path==="/forms/department/allforms"||d.path==="/forms/department/Allforms")&&b.replace("/forms/department/allforms")}),(e,t)=>(I(),O("div",re,[s("div",null,[s("div",de,[s("div",null,[s("h1",ue,V(C.id==="allforms"?"All Forms":C.id),1),s("p",ce,V(F.value)+" Forms Available ",1)]),k.value.includes("IT")?(I(),O("div",me,[s("div",fe,[x(se,{class:"buttoncomp",onClick:t[0]||(t[0]=a=>T()),name:"Create Form"})])])):ae("",!0)]),s("div",pe,[x(oe,{tHeaders:R.value,tData:h.value,isCheckbox:"true",isAction:"true",actionType:"dropdown",raiseRequest:"true",enableDisable:N.value,onCellClick:z,onActionClicked:U,onToggleClick:G,actions:J.value,onUpdateFilters:X,"field-mapping":j.value,isFiltersoption:"true"},null,8,["tHeaders","tData","enableDisable","actions","field-mapping"]),x(ne,{currentRecords:h.value.length,totalRecords:F.value,onUpdateValue:Q,onLimitStart:W},null,8,["currentRecords","totalRecords"])])]),t[8]||(t[8]=$('<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel"><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasRightLabel">Asset Request Form</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><div class="d-flex align-items-baseline position-relative gap-3"><div class="d-flex flex-column"><span><i class="dashedcircle ri-checkbox-blank-circle-fill"></i></span><div class="dashed_line mt-4"></div></div><div>data</div></div></div></div>',1)),s("div",be,[s("div",ve,[s("div",he,[s("div",_e,[s("div",ge,[t[4]||(t[4]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",ye,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:H},t[2]||(t[2]=[B("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[1]||(t[1]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[3]||(t[3]=[B("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",we,[s("div",{innerHTML:A.value},null,8,ke)]),t[5]||(t[5]=s("div",{class:"modal-footer"},null,-1))])])]),s("div",{class:"modal fade",id:"EnableDisable",tabindex:"-1","aria-labelledby":"EnableDisableLabel","aria-hidden":"true"},[s("div",{class:"modal-dialog modal-dialog-centered"},[s("div",{class:"modal-content"},[t[7]||(t[7]=$('<div class="modal-header"><h5 class="modal-title" id="EnableDisableLabel">Confirm Action</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> Are you sure you want to <span id="actionTextSpan"></span> <span class="fw-bold font-13" id="rowNameSpan"></span> Form? </div>',2)),s("div",{class:"modal-footer"},[t[6]||(t[6]=s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),s("button",{type:"button",class:"btn btn-dark",onClick:K},"Yes, Proceed")])])])])]))}};export{Fe as default};
