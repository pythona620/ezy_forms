import{_ as $,r as a,i as L,S as P,o as i,c,C as x,d as t,b,G as D,l as U,H as j,s as h,f as v,g as u,h as H,m as A}from"./index-DxID15hf.js";const F={class:"d-flex justify-content-between align-content-center py-3"},T={class:"btn-group dropdown"},V={class:"dropdown-menu font-12",style:{transform:"translate(-124px, 42px) !important"}},K={class:"modal fade",id:"SendMailModal",tabindex:"-1","aria-hidden":"true"},q={class:"modal-dialog modal-dialog-centered"},G={class:"modal-content"},J={class:"modal-footer"},O=["disabled"],z={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Y={key:1},Q={__name:"ReportsComp",setup(W){const r=a(!1),m=a(!1),y=a([]);a([]);function E(){const o=[["module","=","ezy_custom_forms"]],e={fields:JSON.stringify(["*"]),filters:JSON.stringify(o)};v.get(u.resource+H.reportsApi,{params:e}).then(n=>{n.data&&(y.value=n.data)}).catch(n=>{console.error("Error:",n)})}const w=a([]),g=a([]);a([]);const s=a("");function M(o){s.value=o.name,m.value=!0,v.get(u.repostListData,{params:{report_name:s.value}}).then(e=>{var n,d,p;e&&(n=e==null?void 0:e.message)!=null&&n.columns&&(w.value=(d=e==null?void 0:e.message)==null?void 0:d.result,g.value=(p=e==null?void 0:e.message)==null?void 0:p.columns.map(l=>{let f={};return f.th=l==null?void 0:l.label,f.td_key=l==null?void 0:l.fieldname,f}))}).catch(e=>{console.error("Error",e)})}function R(){const o=document.getElementById("datatable");if(o){o.focus();const e=new KeyboardEvent("keydown",{key:"f",keyCode:70,ctrlKey:!0,bubbles:!0});o.dispatchEvent(e)}}function k(o){o.ctrlKey&&o.key==="f"&&(o.preventDefault(),R())}function I(){m.value=!1}const B=a([{th:"Name",td_key:"name"}]);function C(o){const e=s.value,n=o,d=u.ExportReport+`?report_name=${encodeURIComponent(e)}&file_format_type=${encodeURIComponent(n)}`;window.open(d,"_blank")}const _=a("");function N(o,e,n){if(_.value=o,n==="download"){if(!(o!=null&&o.name)||!(s!=null&&s.value)){console.error("Missing required data for PDF download");return}const d=s.value,p=o.name||o.Name||o.id||o.report_name,l=u.getReportData+`?doctype=${encodeURIComponent(d)}&name=${encodeURIComponent(p)}`;window.open(l,"_blank")}n==="mail"&&new bootstrap.Modal(document.getElementById("SendMailModal")).show()}function S(){r.value=!0;const o={docname:_.value.name,doctype:s.value};v.post(u.reportMailSend,o).then(e=>{e&&(A.success("Mail send successfully"),bootstrap.Modal.getInstance(document.getElementById("SendMailModal")).hide(),r.value=!1)}).catch(e=>{console.error("Upload error:",e)}).finally(()=>{r.value=!1})}return L(()=>{E(),document.addEventListener("keydown",k)}),P(()=>{document.removeEventListener("keydown",k)}),(o,e)=>(i(),c("section",null,[m.value?(i(),c(x,{key:1},[e[9]||(e[9]=t("div",{class:"d-flex justify-content-between align-items-center py-2"},null,-1)),t("section",null,[t("div",F,[t("button",{type:"button",class:"font-12 btn btn-light backtoListbtn",onClick:I},e[4]||(e[4]=[t("i",{class:"bi bi-chevron-left"},null,-1),U(" Back to Report List ")])),t("div",T,[b(j,{class:"btn-outline-primary m-0 dropdown-toggle d-flex justify-content-center align-items-center bg-white",name:"Export",type:"button",id:"exportDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"}),t("ul",V,[t("li",null,[t("a",{class:"dropdown-item",onClick:e[0]||(e[0]=n=>C("Csv"))},"Download Csv")]),t("li",null,[t("a",{class:"dropdown-item",onClick:e[1]||(e[1]=n=>C("Excel"))},"Download Excel")])])])])]),t("section",null,[b(D,{class:"newtable",tHeaders:g.value,tData:w.value,onCellClick:N,isAction:"true",download:"true"},null,8,["tHeaders","tData"]),t("div",K,[t("div",q,[t("div",G,[e[7]||(e[7]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Send Mail"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e[8]||(e[8]=t("div",{class:"modal-body"}," Are you sure you want to send the mail? ",-1)),t("div",J,[e[6]||(e[6]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-dark",disabled:r.value,onClick:e[2]||(e[2]=n=>S())},[r.value?(i(),c("span",z)):h("",!0),r.value?h("",!0):(i(),c("span",Y,e[5]||(e[5]=[t("span",{class:"font-12 fw-bold"},"Yes, Proceed",-1)])))],8,O)])])])])])],64)):(i(),c(x,{key:0},[e[3]||(e[3]=t("div",{class:"d-flex justify-content-between align-items-center py-2"},[t("div")],-1)),t("div",null,[b(D,{tHeaders:B.value,tData:y.value,onCellClick:M,isAction:"true",viewType:"viewPdf",isCheckbox:"true"},null,8,["tHeaders","tData"])])],64))]))}},Z=$(Q,[["__scopeId","data-v-6e93f39b"]]);export{Z as default};
