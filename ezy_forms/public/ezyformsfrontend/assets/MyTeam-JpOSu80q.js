var ie=Object.defineProperty;var V=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var j=(y,c,u)=>c in y?ie(y,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):y[c]=u,B=(y,c)=>{for(var u in c||(c={}))re.call(c,u)&&j(y,u,c[u]);if(V)for(var u of V(c))de.call(c,u)&&j(y,u,c[u]);return y};import{_ as ce,e as ue,d as o,u as me,O as fe,w as ve,f as pe,o as R,c as P,b as t,t as b,a as I,G as _e,P as ye,i as v,q as W,A as ge,B as he,C as be,E as we,R as ke,k as p,l as _,n as O,m as qe}from"./index-BHd6CXej.js";const Re={class:"d-flex justify-content-between align-items-center py-2"},Pe={class:"m-0 font-11 pt-1"},Ce={class:"mt-2"},Ne={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},$e={class:"modal-dialog modal-dialog-centered modal-lg"},xe={class:"modal-content"},Ee={class:"modal-header py-2 d-block"},Oe={class:"d-flex justify-content-between align-items-center"},Se={class:"m-0 font-13",id:"viewRequest"},Fe={class:""},Le={class:"activity-log-container"},Te={class:"activity-log-content"},Ae={class:"font-12 mb-1"},Me={class:"strong-content"},De={class:"strong-content"},Je={class:"strong-content"},Ve={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},je={class:"modal-dialog modal-xl"},Be={class:"modal-content"},Ie={class:"modal-header py-2 d-block bg-dark text-white"},We={class:"d-flex justify-content-between align-items-center"},Ue={class:""},He={class:"modal-body pdf-body"},Ge=["innerHTML"],ze={__name:"MyTeam",setup(y){const c=ue(()=>we.value),u=o({business_unit:""}),S=me(),F=fe(),h=o({limitPageLength:20,limit_start:0}),$=o(0),l=o({}),L=o(null),w=o([]),U=o([]),H=o([]),G=o([]);o([]);const k=o([]),z=o(""),T=o(""),x=o([]);o([]);const Q=o([]),X=o(""),E=o([]),A=o([{th:"Request ID",td_key:"name"},{th:"Form Name",td_key:"doctype_name"},{th:"Owner of form",td_key:"role"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"},{th:"Linked ID",td_key:"linked_form_id"}]),Y=o({name:{type:"input"},status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},role:{type:"input"},doctype_name:{type:"input"}}),Z=o([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(a,e){var n,i,f;if(e.name==="View Request")if(a){l.value=B({},a),z.value=(n=l.value)==null?void 0:n.total_levels,Q.value=JSON.parse((i=l.value)==null?void 0:i.json_columns).child_table_fields,L.value=ke(JSON.parse((f=l.value)==null?void 0:f.json_columns).fields);const g=[["wf_generated_request_id","like",`%${l.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(g),order_by:`\`tab${l.value.doctype_name}\`.\`creation\` desc`};p.get(`${_.resource}${l.value.doctype_name}`,{params:r}).then(s=>{s.data&&(w.value=s.data,se(w.value[0],L.value),p.get(`${_.resource}${l.value.doctype_name}`).then(d=>{console.log("Data for :",d.data[0])}).catch(d=>{console.error("Error fetching data for :",d)}),p.get(`${_.resource}${l.value.doctype_name}/${s.data[0].name}`).then(d=>{const m=Object.keys(d.data).filter(N=>Array.isArray(d.data[N]));m.length&&(E.value={},m.forEach(N=>{E.value[N]=d.data[N]||[]}))}).catch(d=>{console.error("Error fetching data for :",d)}))}).catch(s=>{console.error("Error fetching categories data:",s)}),p.get(`${_.resource}${O.WFActivityLog}/${l.value.name}`).then(s=>{s.data&&(x.value=s.data.reason||[])}).catch(s=>{console.error("Error fetching activity data:",s)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(e.name==="PDF Format"){l.value=a;const g=[["wf_generated_request_id","like",`%${l.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(g),order_by:`\`tab${l.value.doctype_name}\`.\`creation\` desc`};p.get(`${_.resource}${l.value.doctype_name}`,{params:r}).then(s=>{if(s.data){w.value=s.data;const d={form_short_name:a.doctype_name,name:w.value[0].name,business_unit:c.value};p.post(_.preview_dynamic_form,d).then(m=>{T.value=m.message}).catch(m=>{console.error("Error fetching data:",m)})}}).catch(s=>{console.error("Error fetching categories data:",s)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function ee(a,e,n){n==="view"&&F.push({name:"ApproveRequest",query:{routepath:S.path,name:a.name,doctype_name:a.doctype_name,type:"myteam",readOnly:"true"}}),n==="td_key"&&a.linked_form_id&&F.push({name:"ApproveRequest",query:{routepath:S.path,name:a.linked_form_id,business_unit:a.property,type:"linkedForm",readOnly:"true"}})}function M(){E.value=[],X.value=""}const te=a=>a?new Date(a).toLocaleDateString("en-GB"):"N/A",ae=a=>a?{"Request Cancelled":"cancelled","Request Raised":"raised"}[a]||a.toLowerCase():"performed an action on";function D(){var e;const a={form_short_name:l.value.doctype_name,name:(e=w.value[0])==null?void 0:e.name};p.post(_.download_pdf_form,a).then(n=>{let i=qe+n.message;i=i.replace("/api","");const f=document.createElement("a");f.href=i,f.download=n.message.split("/").pop(),f.click()}).catch(n=>{console.error("Error fetching data:",n)})}function se(a,e){e.forEach(n=>{n.sections.forEach(i=>{i.rows.forEach(f=>{f.columns.forEach(g=>{g.fields.forEach(r=>{a!=null&&a.hasOwnProperty(r==null?void 0:r.fieldname)&&(r.value=a[r==null?void 0:r.fieldname])})})})})})}const oe=a=>{h.value.limitPageLength=a,h.value.limit_start=0,q()},ne=([a,e])=>{h.value.limitPageLength=a,h.value.limit_start=e,q()},J=o(null);function le(a){clearTimeout(J.value),J.value=setTimeout(()=>{const e=[];A.value.forEach(n=>{const i=n.td_key;a[i]&&e.push([i,"like",`%${a[i]}%`])}),e.length?q(e):q()},500)}function q(a){var f,g,r,C;const e=[["property","like",`%${u.value.business_unit}%`]];a&&e.push(...a);const n={fields:JSON.stringify(["*"]),limit_page_length:(f=h.value)==null?void 0:f.limitPageLength,limit_start:(g=h.value)==null?void 0:g.limit_start,filters:JSON.stringify(e),order_by:"`tabWF Workflow Requests`.`creation` desc"},i={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(e)};p.get(`${(r=_)==null?void 0:r.resource}${(C=O)==null?void 0:C.WFWorkflowRequests}`,{params:i}).then(s=>{$.value=s.data[0].total_count}).catch(s=>{console.error("Error fetching total count:",s)}),p.get(`${_.resource}${O.WFWorkflowRequests}`,{params:n}).then(s=>{const d=s.data;h.value.limit_start===0?(k.value=d,U.value=[...new Set(s.data.map(m=>m.name))],H.value=[...new Set(s.data.map(m=>m.doctype_name))],G.value=[...new Set(s.data.map(m=>m.status))]):k.value=k.value.concat(d)}).catch(s=>{console.error("Error fetching records:",s)})}return ve(c,a=>{u.value.business_unit=a,a.length&&q()},{immediate:!0}),pe(()=>{}),(a,e)=>(R(),P("div",null,[t("div",Re,[t("div",null,[e[0]||(e[0]=t("h1",{class:"m-0 font-13"},"My Team",-1)),t("p",Pe,b($.value)+" request",1)])]),t("div",Ce,[I(_e,{tHeaders:A.value,tData:k.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",actions:Z.value,onActionClicked:K,isFiltersoption:"true","field-mapping":Y.value,onCellClick:ee,onUpdateFilters:le},null,8,["tHeaders","tData","actions","field-mapping"]),I(ye,{currentRecords:k.value.length,totalRecords:$.value,onUpdateValue:oe,onLimitStart:ne},null,8,["currentRecords","totalRecords"])]),t("div",Ne,[t("div",$e,[t("div",xe,[t("div",Ee,[t("div",Oe,[t("div",null,[t("h5",Se,"Request Id: "+b(l.value.name),1)]),t("div",Fe,[l.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-white text-dark font-13",onClick:D},e[1]||(e[1]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):W("",!0),t("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:M,"data-bs-dismiss":"modal"},e[2]||(e[2]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),e[9]||(e[9]=t("div",{class:"modal-body approvermodalbody"},null,-1)),t("div",Le,[(R(!0),P(ge,null,he(x.value,(n,i)=>(R(),P("div",{key:i,class:be(["activity-log-item",{"last-item":i===x.value.length-1}])},[e[8]||(e[8]=t("div",{class:"activity-log-dot"},null,-1)),t("div",Te,[t("p",Ae,[e[3]||(e[3]=v(" On ")),t("strong",Me,b(te(n.creation)),1),e[4]||(e[4]=v(", ")),e[5]||(e[5]=t("strong",{class:"strong-content"}," you ",-1)),v(" ("+b(n.role)+") ",1),t("strong",De,b(ae(n.action)),1),e[6]||(e[6]=v(" the request with the comments: ")),t("strong",Je,b(n.reason||"N/A"),1),e[7]||(e[7]=v(". "))])])],2))),128))]),e[10]||(e[10]=t("div",{class:"modal-footer"},null,-1))])])]),t("div",Ve,[t("div",je,[t("div",Be,[t("div",Ie,[t("div",We,[e[13]||(e[13]=t("div",null,[t("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),t("div",Ue,[l.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-dark text-white font-13",onClick:D},e[11]||(e[11]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):W("",!0),t("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:M,"data-bs-dismiss":"modal"},e[12]||(e[12]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),t("div",He,[t("div",{innerHTML:T.value},null,8,Ge)]),e[14]||(e[14]=t("div",{class:"modal-footer"},null,-1))])])])]))}},Ye=ce(ze,[["__scopeId","data-v-5ff1e2da"]]);export{Ye as default};
