var Re=Object.defineProperty,Ee=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var se=(p,d,c)=>d in p?Re(p,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):p[d]=c,z=(p,d)=>{for(var c in d||(d={}))Te.call(d,c)&&se(p,c,d[c]);if(ae)for(var c of ae(d))Pe.call(d,c)&&se(p,c,d[c]);return p},G=(p,d)=>Ee(p,Ie(d));var oe=(p,d,c)=>new Promise((N,k)=>{var j=m=>{try{S(c.next(m))}catch(R){k(R)}},b=m=>{try{S(c.throw(m))}catch(R){k(R)}},S=m=>m.done?N(m.value):Promise.resolve(m.value).then(j,b);S((c=c.apply(p,d)).next())});import{_ as De,r as n,u as Le,x as le,E as Ae,w as ne,K as B,y as T,z as P,f as Ne,A as C,o as g,c as y,d as a,t as x,b as H,S as $e,l as qe,G as Be,P as Me,B as ie,m as M,i as W,N as Y,F as O,h as V,n as re,D as A,I as Oe,H as de,U as Ve,J as je}from"./index-Dfr1Ik7C.js";const Ue={class:""},Je={class:"d-flex align-items-center justify-content-between py-3"},ze={class:"m-0 font-11 pt-1"},Ge={key:0,class:"d-flex align-items-center gap-2"},He={class:"d-flex align-items-center gap-2"},We={class:"mt-1"},Ye={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},Ke={class:"modal-dialog modal-xl"},Qe={class:"modal-content"},Xe={class:"d-block modal-header bg-dark text-white py-2"},Ze={class:"d-flex align-items-center justify-content-between"},et={class:""},tt={class:"modal-body"},at=["innerHTML"],st={class:"modal fade",id:"reportmodal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"reportmodalLabel","aria-hidden":"true"},ot={class:"modal-dialog modal-dialog-centered modal-lg"},lt={class:"modal-content"},nt={class:"modal-body"},it={class:"d-flex justify-content-between align-items-center mb-2"},rt={class:"form-check m-0"},dt={class:"report-fields row mb-2 pb-2"},ct={class:"d-flex align-items-center"},ut=["id","onUpdate:modelValue"],mt=["for"],ft={class:"font-13 mb-2"},pt={class:"row"},bt={class:"d-flex align-items-center"},vt=["id","onUpdate:modelValue"],ht=["for"],_t={class:"modal fade",id:"formview","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"formviewLabel","aria-hidden":"true"},gt={class:"modal-dialog modal-dialog-centered modal-lg"},yt={class:"modal-content border-0 shadow-lg rounded-4 overflow-hidden"},kt={class:"modal-header bg-light border-0 py-3 shadow-sm"},wt={class:"w-100"},Ct={class:"d-flex justify-content-between align-items-center"},xt={class:"modal-title fw-bold text-dark mb-0",id:"formviewLabel"},Ft={class:"badge bg-primary p-2 d-flex align-items-center rounded-pill"},St={class:"text-secondary"},Rt={class:"modal-body bg-light p-4"},Et={class:"row g-4 justify-content-center"},It={class:"status-card text-center p-4 rounded-4 shadow-sm"},Tt={class:"fw-semibold text-nowrap mb-1"},Pt={class:"fw-bold"},Dt={__name:"CreateForm",props:["id"],setup(p){const d=n(0),c=n([{th:"Form Name",td_key:"form_name"},{th:"Form Short Code",td_key:"form_short_name"},{th:"Accessible Departments",td_key:"accessible_departments"},{th:"Form Type",td_key:"as_web_view"},{th:"Status",td_key:"form_status"}]),N=n({});n(null);const k=n([]),j=n([]),b=Le(),S=n("");n([]);const m=n(""),R=n(""),E=n([]),ce=n([]),D=n(!1),F=n(null),U=n(""),w=le(()=>Ae.value),ue=n(""),i=n({limitPageLength:20,limit_start:0,filters:[]}),me=n({form_short_name:{type:"input"},form_category:{type:"input"},form_status:{type:"select",options:["Active","Retired"]},form_name:{type:"input"},enable:{type:"select",options:["Enabled","Disabled"]}});function K(t=null){t==null?C.push({name:"FormStepper",query:{routepath:b.path,business_unit:w.value}}):C.push({name:"FormStepper",params:{paramid:t.name},query:{routepath:b.path,business_unit:w.value,id:t.name}}),localStorage.setItem("routepath",b.path)}const Q=n(""),$=n({}),I=n([]),fe=le(()=>{var r,f,h,v;const t=I.value.reduce((_,u)=>_+u.count,0);Q.value=t;const e=((r=I.value.find(_=>_.status==="Completed"))==null?void 0:r.count)||0,s=((f=I.value.find(_=>_.status==="In Progress"))==null?void 0:f.count)||0,o=((h=I.value.find(_=>_.status==="Canceled"))==null?void 0:h.count)||0,l=((v=I.value.find(_=>_.status==="Request Raised"))==null?void 0:v.count)||0;return[{label:"Request Raised",value:l,icon:"bi bi-file-earmark-text",bg:"bg-primary"},{label:"Completed",value:e,icon:"bi bi-check-circle",bg:"bg-completed"},{label:"In Progress",value:s||l,icon:"bi bi-arrow-repeat",bg:"bg-progress"},{label:"Canceled",value:o,icon:"bi bi-x-circle",bg:"bg-canceled"}]});function pe(t){return new Date(t).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}function be(t,e,s){if(s==="view"&&t&&C.push({name:"FormPreviewComp",query:{routepath:b.path,form_short_name:t.form_short_name,business_unit:w.value}}),s==="raiseRequest"){const o=JSON.parse(t.form_json),l=localStorage.getItem("employeeData");if(l){const r=JSON.parse(l).designation;o.workflow.length||A("No Roles Added");const f=o.workflow[0].roles;let h=!1;for(let v=0;v<f.length;v++)if(f[v]===r){h=!0;break}h?C.push({name:"RaiseRequest",query:{routepath:b.path,selectedForm:t.form_short_name,business_unit:t.business_unit}}):A("You do not have permission to access this Form.")}}}const X=n([]);function ve(t){const e=[{name:"View form",icon:"fa-solid fa-eye"}];t.form_status==="Created"&&(e.push({name:"Raise Request",icon:"fa fa-file-text"}),e.push({name:"In-active this form",icon:"fa-solid fa-ban"})),t.form_status==="Draft"&&e.push({name:"Actived this form",icon:"fa-solid fa-check"}),m.value==1&&e.push({name:"Edit Form",icon:"fa-solid fa-edit"}),m.value==1&&e.push({name:"Create Report",icon:"fa fa-file-text"}),m.value==1&&e.push({name:"Form Info",icon:"fa fa-info-circle"}),m.value==1&&e.push({name:"Form Duplicate",icon:"fa fa-copy"}),X.value=e}function he(){E.value.forEach(t=>{t.selected=D.value})}ne(()=>E.value.map(t=>t.selected),t=>{t.every(e=>e)?D.value=!0:D.value=!1},{deep:!0});function Z(t){const e=t.fieldname.match(/_(\d+)$/),s=e?parseInt(e[1])+1:null,o=["approver","approved_on","approved_by"],l=t.fieldname.replace(/_\d+$/,"");return o.includes(l)?s?`${t.label} ${s}`:`${t.label} 1`:t.label}const _e=t=>{const e={};return t.forEach(s=>{s.isChild&&(e[s.parentTable]||(e[s.parentTable]=[]),e[s.parentTable].push(s))}),e},ee=n("");function ge(t,e){var s;if(e.name==="View form"?t?C.push({name:"FormPreviewComp",query:{routepath:b.path,form_short_name:t.form_short_name,business_unit:w.value}}):Oe(" There is no form fields "):e.name==="Edit Form"&&K(t),e.name==="Raise Request"){const o=JSON.parse(t.form_json),l=localStorage.getItem("employeeData");if(l){const r=JSON.parse(l).designation;(s=o.workflow)!=null&&s.length||A("No Roles Added");const f=o.workflow[0].roles;let h=!1;for(let v=0;v<f.length;v++)if(f[v]===r){h=!0;break}h&&t.enable===1?t.form_name==="VENDOR COMPARISON"?C.push({name:"vendorcomparison"}):C.push({name:"RaiseRequest",query:{routepath:b.path,selectedForm:t.form_short_name,business_unit:t.business_unit,has_workflow:t.has_workflow}}):t.enable===0?A("This form is currently disabled."):A("You do not have permission to access this Form.")}}if(e.name==="Download Print format"){N.value=t;const o={form_short_name:t.form_short_name,business_unit:w.value};T.post(P.preview_dynamic_form,o).then(r=>{S.value=r.message}).catch(r=>{console.error("Error fetching data:",r)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}if(e.name==="Actived this form"&&J(t),e.name==="In-active this form"&&J(t),e.name==="Create Report"){ee.value=t.name;const o=JSON.parse((t==null?void 0:t.form_json)||"{}"),l=o.fields||[],r=o.child_table_fields||{};let f=[];t.report_fields&&(f=t.report_fields.split(",").map(u=>u.trim().split(" as ")[0]));const h=l.filter(u=>u.label&&u.fieldtype!=="Column Break"&&u.fieldtype!=="Section Break").map(u=>G(z({},u),{isChild:!1,parentTable:null,fullName:u.fieldname,displayLabel:u.label,selected:f.includes(u.fieldname)})),v=Object.entries(r).flatMap(([u,Se])=>Se.map(q=>G(z({},q),{isChild:!0,parentTable:u,fullName:`${u}.${q.fieldname}`,displayLabel:q.label,selected:f.includes(`${u}.${q.fieldname}`)})));E.value=[...h,...v],new bootstrap.Modal(document.getElementById("reportmodal"),{}).show()}if(e.name==="Form Info"){$.value=t,new bootstrap.Modal(document.getElementById("formview"),{}).show();const l={fields:JSON.stringify(["doctype_name","name","status","creation"]),limit_page_length:"None",doctype:B.WFWorkflowRequests,doctype_name:$.value.name,group_by:"status"};T.get(P.GetDoctypeData,{params:l}).then(r=>{r.message&&(I.value=r.message)}).catch(r=>{console.error("Error fetching designations data:",r)})}e.name==="Form Duplicate"&&C.push({name:"FormStepper",query:{business_unit:w.value,id:t.name,Clone:"1"}}),localStorage.setItem("routepath",b.path)}function ye(){return oe(this,null,function*(){const t=E.value.filter(o=>o.selected).map(o=>`${o.isChild?`${o.parentTable}.${o.fieldname}`:o.fieldname} as '${o.label}'`);t.unshift("name as Name");const e=t.join(","),s={};e&&(s.report_fields=e);try{const o=yield T.put(P.resource+B.EzyFormDefinitions+`/${ee.value}`,s);console.log("Report fields updated:",o.data);const l=bootstrap.Modal.getInstance(document.getElementById("reportmodal"));l&&l.hide(),de("Report Created Successfully")}catch(o){console.error("Error updating report fields:",o),Ve("Failed to update report fields")}})}function ke(){const t={form_short_name:N.value.form_short_name,name:null,business_unit:w.value};T.post(P.download_pdf_form,t).then(e=>{let s=je+e.message;s=s.replace("/api","");const o=document.createElement("a");o.href=s,o.download=e.message.split("/").pop(),o.click()}).catch(e=>{console.error("Error fetching data:",e)})}function J(t,e,s){F.value=t;const o=t.enable=="1"||t.enable===1;U.value=o?"Disable":"Restore",document.getElementById("actionTextSpan").innerText=U.value,document.getElementById("rowNameSpan").innerText=t.name;const l=new bootstrap.Modal(document.getElementById("EnableDisable"));l.show(),window.currentModal=l}function we(){if(!F.value)return;const t=F.value.enable=="1"||F.value.enable===1;F.value.enable=t?0:1,F.value.form_status=t?"Draft":"Created",T.put(`${P.resource}${B.EzyFormDefinitions}/${F.value.name}`,F.value).then(e=>{ce.value=e.data,de(`Form ${U.value}d successfully`),setTimeout(()=>{L()},1e3),window.currentModal&&window.currentModal.hide()}).catch(e=>{console.error("Error updating toggle:",e)})}ne(w,t=>{t&&t.length&&(ue.value=t,L())},{immediate:!0});const Ce=t=>{i.value.limitPageLength=t,i.value.limit_start=0,L(i.value.filters)},xe=([t,e])=>{i.value.limitPageLength=t,i.value.limit_start=e,L(i.value.filters)},te=n(null);function Fe(t){clearTimeout(te.value),te.value=setTimeout(()=>{i.value.filters=[],t.form_status==="Active"&&i.value.filters.push(["form_status","like","Created"]),t.form_status==="Retired"&&i.value.filters.push(["form_status","like","Draft"]),t.enable==="Enabled"?i.value.filters.push(["enable","=",1]):t.enable==="Disabled"&&i.value.filters.push(["enable","=",0]),c.value.forEach(e=>{const s=e.td_key,o=t[s];s==="form_status"||s==="enable"||o&&i.value.filters.push([s,"like",`%${o}%`])}),i.value.limit_start=0,i.value.limitPageLength=20,L(i.value.filters)},500)}function L(t){i.value.filters=[["business_unit","=",`${w.value}`]],t&&i.value.filters.push(...t);const e={fields:JSON.stringify(["name","business_unit","form_category","owner_of_the_form","active","count","accessible_departments","form_short_name","form_json","form_name","form_status","enable","print_format","is_landscape","has_workflow","workflow_check","is_linked","is_linked_form","form_department","series","report_fields","creation","as_web_view"]),limit_page_length:i.value.limitPageLength,limit_start:i.value.limit_start,filters:JSON.stringify(i.value.filters),doctype:B.EzyFormDefinitions,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"};T.get(P.GetDoctypeData,{params:e}).then(s=>{d.value=s.message.total_count,i.value.limit_start===0?(k.value=s.message.data,j.value=[...new Set(k.value.map(o=>o.form_category))]):k.value=k.value.concat(s.message.data)}).catch(s=>{console.error("Error fetching department details:",s)})}return Ne(()=>{localStorage.removeItem("routepath");const t=JSON.parse(localStorage.getItem("employeeData"));m.value=t.is_admin||"",m.value==1&&(R.value="true"),(b.path==="/forms/department/allforms"||b.path==="/forms/department/allforms")&&C.replace("/forms/department/allforms")}),(t,e)=>(g(),y("div",Ue,[a("div",null,[a("div",Je,[a("div",null,[e[3]||(e[3]=a("h1",{class:"m-0 font-13"}," All Forms ",-1)),a("p",ze,x(d.value)+" Forms Available ",1)]),m.value==1?(g(),y("div",Ge,[a("div",He,[H($e,{class:"buttoncomp",onClick:e[0]||(e[0]=s=>K()),name:"Create Form"})])])):qe("",!0)]),a("div",We,[H(Be,{tHeaders:c.value,tData:k.value,isCheckbox:"true",isAction:"true",actionType:"dropdown",onActionClickedDropDown:ve,raiseRequest:"true",enableDisable:R.value,onCellClick:be,onActionClicked:ge,onToggleClick:J,actions:X.value,onUpdateFilters:Fe,"field-mapping":me.value,isFiltersoption:"true"},null,8,["tHeaders","tData","enableDisable","actions","field-mapping"]),H(Me,{currentRecords:k.value.length,totalRecords:d.value,"items-per-page":i.value.limitPageLength,onUpdateValue:Ce,onLimitStart:xe},null,8,["currentRecords","totalRecords","items-per-page"])])]),e[18]||(e[18]=ie('<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel" data-v-fa6ff3a7><div class="offcanvas-header" data-v-fa6ff3a7><h5 class="offcanvas-title" id="offcanvasRightLabel" data-v-fa6ff3a7>Asset Request Form</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-v-fa6ff3a7></button></div><div class="offcanvas-body" data-v-fa6ff3a7><div class="d-flex align-items-baseline position-relative gap-3" data-v-fa6ff3a7><div class="d-flex flex-column" data-v-fa6ff3a7><span data-v-fa6ff3a7><i class="dashedcircle ri-checkbox-blank-circle-fill" data-v-fa6ff3a7></i></span><div class="dashed_line mt-4" data-v-fa6ff3a7></div></div><div data-v-fa6ff3a7>data</div></div></div></div>',1)),a("div",Ye,[a("div",Ke,[a("div",Qe,[a("div",Xe,[a("div",Ze,[e[6]||(e[6]=a("div",null,[a("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),a("div",et,[a("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:ke},e[4]||(e[4]=[M("Download Pdf"),a("span",{class:"ms-2"},[a("i",{class:"bi bi-download"})],-1)])),a("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:e[1]||(e[1]=(...s)=>t.closemodal&&t.closemodal(...s)),"data-bs-dismiss":"modal"},e[5]||(e[5]=[M("Close "),a("i",{class:"bi bi-x"},null,-1)]))])])]),a("div",tt,[a("div",{innerHTML:S.value},null,8,at)]),e[7]||(e[7]=a("div",{class:"modal-footer"},null,-1))])])]),a("div",{class:"modal fade",id:"EnableDisable",tabindex:"-1","aria-labelledby":"EnableDisableLabel","aria-hidden":"true"},[a("div",{class:"modal-dialog modal-dialog-centered"},[a("div",{class:"modal-content"},[e[9]||(e[9]=ie('<div class="modal-header" data-v-fa6ff3a7><h5 class="modal-title" id="EnableDisableLabel" data-v-fa6ff3a7>Confirm Action</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-v-fa6ff3a7></button></div><div class="modal-body" data-v-fa6ff3a7> Are you sure you want to <span id="actionTextSpan" data-v-fa6ff3a7></span> <span class="fw-bold font-13" id="rowNameSpan" data-v-fa6ff3a7></span> Form? </div>',2)),a("div",{class:"modal-footer"},[e[8]||(e[8]=a("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),a("button",{type:"button",class:"btn btn-dark",onClick:we},"Yes, Proceed")])])])]),a("div",st,[a("div",ot,[a("div",lt,[e[13]||(e[13]=a("div",{class:"modal-header"},[a("h5",{class:"modal-title font-16",id:"reportmodalLabel"},"Report Creation"),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),a("div",nt,[a("div",it,[e[11]||(e[11]=a("p",{class:"font-13 mb-0"},"Select the fields you want to include in the report:",-1)),a("div",rt,[W(a("input",{id:"select-all-fields",type:"checkbox",class:"form-check-input me-1","onUpdate:modelValue":e[2]||(e[2]=s=>D.value=s),onChange:he},null,544),[[Y,D.value]]),e[10]||(e[10]=a("label",{for:"select-all-fields",class:"form-check-label font-12"},"Select All Fields",-1))])]),a("div",dt,[(g(!0),y(O,null,V(E.value.filter(s=>!s.isChild),(s,o)=>(g(),y("div",{key:o,class:"col-md-4 mb-2"},[a("div",ct,[W(a("input",{id:"field-"+o,type:"checkbox",class:"form-check-input me-2","onUpdate:modelValue":l=>s.selected=l},null,8,ut),[[Y,s.selected]]),a("label",{for:"field-"+o,class:"form-label font-12 mb-0"},x(Z(s)),9,mt)])]))),128))]),(g(!0),y(O,null,V(_e(E.value),(s,o)=>(g(),y("div",{key:o,class:"mb-3"},[a("h6",ft,x(o)+" (Child Table)",1),a("div",pt,[(g(!0),y(O,null,V(s,(l,r)=>(g(),y("div",{key:r,class:"col-md-4 mb-2"},[a("div",bt,[W(a("input",{id:"child-"+o+"-"+r,type:"checkbox",class:"form-check-input me-2","onUpdate:modelValue":f=>l.selected=f},null,8,vt),[[Y,l.selected]]),a("label",{for:"child-"+o+"-"+r,class:"form-label font-12 mb-0"},x(Z(l)),9,ht)])]))),128))])]))),128))]),a("div",{class:"modal-footer"},[e[12]||(e[12]=a("button",{type:"button",class:"btn btn-light font-13","data-bs-dismiss":"modal"},"Close",-1)),a("button",{type:"button",class:"btn btn-dark font-13 text-white",onClick:ye},"Generate Report")])])])]),a("div",_t,[a("div",gt,[a("div",yt,[a("div",kt,[a("div",wt,[a("div",Ct,[a("h5",xt,x($.value.name),1),a("span",Ft,[e[14]||(e[14]=a("i",{class:"bi bi-list-task me-1 font-16"},null,-1)),M(" "+x(Q.value)+" Total Forms ",1)])]),a("div",null,[a("small",St,[e[15]||(e[15]=a("i",{class:"bi bi-calendar3 me-1"},null,-1)),e[16]||(e[16]=M(" Created on: ")),a("b",null,x(pe($.value.creation)),1)])])])]),a("div",Rt,[a("div",Et,[(g(!0),y(O,null,V(fe.value,s=>(g(),y("div",{class:"col-6 col-md-4 col-lg-3",key:s.label},[a("div",It,[a("div",{class:re(["icon-wrapper mb-2",s.bg])},[a("i",{class:re(s.icon)},null,2)],2),a("h6",Tt,x(s.label),1),a("h4",Pt,x(s.value),1)])]))),128))])]),e[17]||(e[17]=a("div",{class:"modal-footer border-0 bg-light"},[a("button",{type:"button",class:"btn btn-outline-dark rounded-pill px-4","data-bs-dismiss":"modal"},"Close")],-1))])])])]))}},Nt=De(Dt,[["__scopeId","data-v-fa6ff3a7"]]);export{Nt as default};
