var ie=Object.defineProperty;var D=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var J=(g,c,u)=>c in g?ie(g,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):g[c]=u,V=(g,c)=>{for(var u in c||(c={}))re.call(c,u)&&J(g,u,c[u]);if(D)for(var u of D(c))de.call(c,u)&&J(g,u,c[u]);return g};import{_ as ce,e as ue,d as o,u as me,q as fe,w as ve,f as pe,o as R,c as P,b as t,t as h,a as j,G as _e,P as ge,i as v,x as B,C as ye,D as be,H as he,E as we,L as ke,k as p,l as _,n as S,m as qe}from"./index-LfV3iEDw.js";const Re={class:"d-flex justify-content-between align-items-center py-2"},Pe={class:"m-0 font-11 pt-1"},Ce={class:"mt-2"},Ne={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},$e={class:"modal-dialog modal-dialog-centered modal-lg"},xe={class:"modal-content"},Ee={class:"modal-header py-2 d-block"},Se={class:"d-flex justify-content-between align-items-center"},Le={class:"m-0 font-13",id:"viewRequest"},Oe={class:""},Fe={class:"activity-log-container"},Te={class:"activity-log-content"},Me={class:"font-12 mb-1"},Ae={class:"strong-content"},De={class:"strong-content"},Je={class:"strong-content"},Ve={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},je={class:"modal-dialog modal-xl"},Be={class:"modal-content"},We={class:"modal-header py-2 d-block bg-dark text-white"},Ie={class:"d-flex justify-content-between align-items-center"},Ue={class:""},He={class:"modal-body pdf-body"},Ge=["innerHTML"],ze={__name:"MyTeam",setup(g){const c=ue(()=>we.value),u=o({business_unit:""}),W=me(),I=fe(),b=o({limitPageLength:20,limit_start:0}),$=o(0),n=o({}),L=o(null),w=o([]),U=o([]),H=o([]),G=o([]);o([]);const k=o([]),z=o(""),O=o(""),x=o([]);o([]);const Q=o([]),X=o(""),E=o([]),F=o([{th:"Request ID",td_key:"name"},{th:"Form Name",td_key:"doctype_name"},{th:"Owner of form",td_key:"role"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"}]),Y=o({name:{type:"input"},status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},role:{type:"input"},doctype_name:{type:"input"}}),Z=o([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(a,e){var l,i,f;if(e.name==="View Request")if(a){n.value=V({},a),z.value=(l=n.value)==null?void 0:l.total_levels,Q.value=JSON.parse((i=n.value)==null?void 0:i.json_columns).child_table_fields,L.value=ke(JSON.parse((f=n.value)==null?void 0:f.json_columns).fields);const y=[["wf_generated_request_id","like",`%${n.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(y),order_by:`\`tab${n.value.doctype_name}\`.\`creation\` desc`};p.get(`${_.resource}${n.value.doctype_name}`,{params:r}).then(s=>{s.data&&(w.value=s.data,se(w.value[0],L.value),p.get(`${_.resource}${n.value.doctype_name}`).then(d=>{console.log("Data for :",d.data[0])}).catch(d=>{console.error("Error fetching data for :",d)}),p.get(`${_.resource}${n.value.doctype_name}/${s.data[0].name}`).then(d=>{const m=Object.keys(d.data).filter(N=>Array.isArray(d.data[N]));m.length&&(E.value={},m.forEach(N=>{E.value[N]=d.data[N]||[]}))}).catch(d=>{console.error("Error fetching data for :",d)}))}).catch(s=>{console.error("Error fetching categories data:",s)}),p.get(`${_.resource}${S.WFActivityLog}/${n.value.name}`).then(s=>{s.data&&(x.value=s.data.reason||[])}).catch(s=>{console.error("Error fetching activity data:",s)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(e.name==="PDF Format"){n.value=a;const y=[["wf_generated_request_id","like",`%${n.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(y),order_by:`\`tab${n.value.doctype_name}\`.\`creation\` desc`};p.get(`${_.resource}${n.value.doctype_name}`,{params:r}).then(s=>{if(s.data){w.value=s.data;const d={form_short_name:a.doctype_name,name:w.value[0].name,business_unit:c.value};p.post(_.preview_dynamic_form,d).then(m=>{O.value=m.message}).catch(m=>{console.error("Error fetching data:",m)})}}).catch(s=>{console.error("Error fetching categories data:",s)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function ee(a){I.push({name:"ApproveRequest",query:{routepath:W.path,name:a.name,doctype_name:a.doctype_name,type:"myteam",readOnly:"true"}})}function T(){E.value=[],X.value=""}const te=a=>a?new Date(a).toLocaleDateString("en-GB"):"N/A",ae=a=>a?{"Request Cancelled":"cancelled","Request Raised":"raised"}[a]||a.toLowerCase():"performed an action on";function M(){var e;const a={form_short_name:n.value.doctype_name,name:(e=w.value[0])==null?void 0:e.name};p.post(_.download_pdf_form,a).then(l=>{let i=qe+l.message;i=i.replace("/api","");const f=document.createElement("a");f.href=i,f.download=l.message.split("/").pop(),f.click()}).catch(l=>{console.error("Error fetching data:",l)})}function se(a,e){e.forEach(l=>{l.sections.forEach(i=>{i.rows.forEach(f=>{f.columns.forEach(y=>{y.fields.forEach(r=>{a!=null&&a.hasOwnProperty(r==null?void 0:r.fieldname)&&(r.value=a[r==null?void 0:r.fieldname])})})})})})}const oe=a=>{b.value.limitPageLength=a,b.value.limit_start=0,q()},ne=([a,e])=>{b.value.limitPageLength=a,b.value.limit_start=e,q()},A=o(null);function le(a){clearTimeout(A.value),A.value=setTimeout(()=>{const e=[];F.value.forEach(l=>{const i=l.td_key;a[i]&&e.push([i,"like",`%${a[i]}%`])}),e.length?q(e):q()},500)}function q(a){var f,y,r,C;const e=[["property","like",`%${u.value.business_unit}%`]];a&&e.push(...a);const l={fields:JSON.stringify(["*"]),limit_page_length:(f=b.value)==null?void 0:f.limitPageLength,limit_start:(y=b.value)==null?void 0:y.limit_start,filters:JSON.stringify(e),order_by:"`tabWF Workflow Requests`.`creation` desc"},i={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(e)};p.get(`${(r=_)==null?void 0:r.resource}${(C=S)==null?void 0:C.WFWorkflowRequests}`,{params:i}).then(s=>{$.value=s.data[0].total_count}).catch(s=>{console.error("Error fetching total count:",s)}),p.get(`${_.resource}${S.WFWorkflowRequests}`,{params:l}).then(s=>{const d=s.data;b.value.limit_start===0?(k.value=d,U.value=[...new Set(s.data.map(m=>m.name))],H.value=[...new Set(s.data.map(m=>m.doctype_name))],G.value=[...new Set(s.data.map(m=>m.status))]):k.value=k.value.concat(d)}).catch(s=>{console.error("Error fetching records:",s)})}return ve(c,a=>{u.value.business_unit=a,a.length&&q()},{immediate:!0}),pe(()=>{}),(a,e)=>(R(),P("div",null,[t("div",Re,[t("div",null,[e[0]||(e[0]=t("h1",{class:"m-0 font-13"},"My Team",-1)),t("p",Pe,h($.value)+" request",1)])]),t("div",Ce,[j(_e,{tHeaders:F.value,tData:k.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",actions:Z.value,onActionClicked:K,isFiltersoption:"true","field-mapping":Y.value,onCellClick:ee,onUpdateFilters:le},null,8,["tHeaders","tData","actions","field-mapping"]),j(ge,{currentRecords:k.value.length,totalRecords:$.value,onUpdateValue:oe,onLimitStart:ne},null,8,["currentRecords","totalRecords"])]),t("div",Ne,[t("div",$e,[t("div",xe,[t("div",Ee,[t("div",Se,[t("div",null,[t("h5",Le,"Request Id: "+h(n.value.name),1)]),t("div",Oe,[n.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-white text-dark font-13",onClick:M},e[1]||(e[1]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):B("",!0),t("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:T,"data-bs-dismiss":"modal"},e[2]||(e[2]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),e[9]||(e[9]=t("div",{class:"modal-body approvermodalbody"},null,-1)),t("div",Fe,[(R(!0),P(ye,null,be(x.value,(l,i)=>(R(),P("div",{key:i,class:he(["activity-log-item",{"last-item":i===x.value.length-1}])},[e[8]||(e[8]=t("div",{class:"activity-log-dot"},null,-1)),t("div",Te,[t("p",Me,[e[3]||(e[3]=v(" On ")),t("strong",Ae,h(te(l.creation)),1),e[4]||(e[4]=v(", ")),e[5]||(e[5]=t("strong",{class:"strong-content"}," you ",-1)),v(" ("+h(l.role)+") ",1),t("strong",De,h(ae(l.action)),1),e[6]||(e[6]=v(" the request with the comments: ")),t("strong",Je,h(l.reason||"N/A"),1),e[7]||(e[7]=v(". "))])])],2))),128))]),e[10]||(e[10]=t("div",{class:"modal-footer"},null,-1))])])]),t("div",Ve,[t("div",je,[t("div",Be,[t("div",We,[t("div",Ie,[e[13]||(e[13]=t("div",null,[t("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),t("div",Ue,[n.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-dark text-white font-13",onClick:M},e[11]||(e[11]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):B("",!0),t("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:T,"data-bs-dismiss":"modal"},e[12]||(e[12]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),t("div",He,[t("div",{innerHTML:O.value},null,8,Ge)]),e[14]||(e[14]=t("div",{class:"modal-footer"},null,-1))])])])]))}},Ye=ce(ze,[["__scopeId","data-v-fbba2371"]]);export{Ye as default};
