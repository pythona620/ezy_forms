import{d as i,u as X,e as Z,w as ee,f as te,g as p,o as q,c as O,b as s,t as se,a as S,I as ae,x as oe,G as ne,P as ie,h as V,i as $,E as le,j as b,k as y,l as w,m as re,n as E}from"./index-OTUT9Deo.js";const de={class:""},ue={class:"d-flex align-items-center justify-content-between py-3"},ce={class:"m-0 font-11 pt-1"},me={key:0,class:"d-flex align-items-center gap-2"},fe={class:"d-flex align-items-center"},pe={class:"mt-1"},be={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},ve={class:"modal-dialog modal-xl"},he={class:"modal-content"},_e={class:"d-block modal-header bg-dark text-white py-2"},ge={class:"d-flex align-items-center justify-content-between"},ye={class:""},we={class:"modal-body"},ke=["innerHTML"],xe={__name:"CreateForm",props:["id"],setup(B){const C=i(0),D=i([{th:"Form Name",td_key:"form_name"},{th:"Form Short Code",td_key:"form_short_name"},{th:"Accessible Departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"}]),_=B,R=i({});i(null);const v=i([]),M=i([]),d=X(),A=i("");i([]);const k=i(""),N=i(""),c=Z(()=>le.value),P=i({business_unit:""}),o=i({limitPageLength:20,limit_start:0,filters:[]}),J=i({form_short_name:{type:"input"},form_category:{type:"input"},form_status:{type:"select",options:["Active","Retired"]},form_name:{type:"input"},enable:{type:"select",options:["Enabled","Disabled"]}});function T(e=null){e==null?p.push({name:"FormStepper",query:{routepath:d.path,business_unit:c.value}}):p.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:d.path,business_unit:c.value,id:e.name}}),localStorage.setItem("routepath",d.path)}function j(e,t,a){if(a==="view"&&e&&p.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:c.value}}),a==="raiseRequest"){const n=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const l=JSON.parse(r).designation;n.workflow.length||b.info("No Roles Added",{autoClose:500});const m=n.workflow[0].roles;let g=!1;for(let f=0;f<m.length;f++)if(m[f]===l){g=!0;break}g?p.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):b.info("You do not have permission to access this Form.")}}}const I=i([]);function z(e){const t=[{name:"View form",icon:"fa-solid fa-eye"}];e.form_status==="Created"&&(t.push({name:"Raise Request",icon:"fa fa-file-text"}),t.push({name:"In-active this form",icon:"fa-solid fa-ban"})),e.form_status==="Draft"&&t.push({name:"Active this form",icon:"fa-solid fa-check"}),k.value.includes("IT")&&t.push({name:"Edit Form",icon:"fa-solid fa-edit"}),I.value=t}function U(e,t){var a;if(t.name==="View form"?e?p.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:c.value}}):b.warn(" There is no form fields "):t.name==="Edit Form"&&T(e),t.name==="Raise Request"){const n=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const l=JSON.parse(r).designation;(a=n.workflow)!=null&&a.length||b.info("No Roles Added",{autoClose:500});const m=n.workflow[0].roles;let g=!1;for(let f=0;f<m.length;f++)if(m[f]===l){g=!0;break}g&&e.enable===1?p.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit,has_workflow:e.has_workflow}}):e.enable===0?b.info("This form is currently disabled.",{autoClose:500}):b.info("You do not have permission to access this Form.",{autoClose:500})}}if(t.name==="Download Print format"){R.value=e;const n={form_short_name:e.form_short_name,business_unit:c.value};y.post(w.preview_dynamic_form,n).then(l=>{A.value=l.message}).catch(l=>{console.error("Error fetching data:",l)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}t.name==="Active this form"&&F(e),t.name==="In-active this form"&&F(e)}function H(){const e={form_short_name:R.value.form_short_name,name:null,business_unit:c.value};y.post(w.download_pdf_form,e).then(t=>{let a=re+t.message;a=a.replace("/api","");const n=document.createElement("a");n.href=a,n.download=t.message.split("/").pop(),n.click()}).catch(t=>{console.error("Error fetching data:",t)})}const Y=i([]),u=i(null),x=i("");function F(e,t,a){u.value=e;const n=e.enable=="1"||e.enable===1;x.value=n?"Disable":"Restore",document.getElementById("actionTextSpan").innerText=x.value,document.getElementById("rowNameSpan").innerText=e.name;const r=new bootstrap.Modal(document.getElementById("EnableDisable"));r.show(),window.currentModal=r}function G(){if(!u.value)return;const e=u.value.enable=="1"||u.value.enable===1;u.value.enable=e?0:1,u.value.form_status=e?"Draft":"Created",y.put(`${w.resource}${E.EzyFormDefinitions}/${u.value.name}`,u.value).then(t=>{Y.value=t.data,b.success(`Form ${x.value}d successfully`,{autoClose:700}),setTimeout(()=>{h()},1e3),window.currentModal&&window.currentModal.hide()}).catch(t=>{console.error("Error updating toggle:",t)})}ee([()=>c.value,()=>_.id],([e,t])=>{P.value.business_unit=e,h()},{immediate:!0});const K=e=>{o.value.limitPageLength=e,o.value.limit_start=0,h()},Q=([e,t])=>{o.value.limitPageLength=e,o.value.limit_start=t,h()},L=i(null);function W(e){clearTimeout(L.value),L.value=setTimeout(()=>{o.value.filters=[],e.form_status==="Active"&&o.value.filters.push(["form_status","like","Created"]),e.form_status==="Retired"&&o.value.filters.push(["form_status","like","Draft"]),e.enable==="Enabled"?o.value.filters.push(["enable","=",1]):e.enable==="Disabled"&&o.value.filters.push(["enable","=",0]),D.value.forEach(t=>{const a=t.td_key,n=e[a];a==="form_status"||a==="enable"||n&&o.value.filters.push([a,"like",`%${n}%`])}),o.value.filters.length?h(null,o.value.filters):h()},500)}function h(e,t){const a=[["business_unit","like",`%${P.value.business_unit}%`]];o.value.filters.push(...a),_.id&&_.id!=="Allforms"&&_.id!=="allforms"&&a.push(["owner_of_the_form","=",_.id]),t&&a.push(...t);const n={fields:JSON.stringify(["*"]),limit_page_length:o.value.limitPageLength,limit_start:o.value.limit_start,filters:JSON.stringify(o.value.filters),order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`modified` DESC"},r={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(o.value.filters)};y.get(`${w.resource}${E.EzyFormDefinitions}`,{params:r}).then(l=>{C.value=l.data[0].total_count}).catch(l=>{console.error("Error fetching ezyForms data:",l)}),y.get(`${w.resource}${E.EzyFormDefinitions}`,{params:n}).then(l=>{o.value.limit_start===0?(v.value=l.data,M.value=[...new Set(v.value.map(m=>m.form_category))]):v.value=v.value.concat(l.data)}).catch(l=>{console.error("Error fetching department details:",l)})}return te(()=>{localStorage.removeItem("routepath");const e=JSON.parse(localStorage.getItem("employeeData"));k.value=e.designation||"",k.value.includes("IT")&&(N.value="true"),(d.path==="/forms/department/allforms"||d.path==="/forms/department/Allforms")&&p.replace("/forms/department/allforms")}),(e,t)=>(q(),O("div",de,[s("div",null,[s("div",ue,[s("div",null,[t[2]||(t[2]=s("h1",{class:"m-0 font-13"}," All Forms ",-1)),s("p",ce,se(C.value)+" Forms Available ",1)]),k.value.includes("IT")?(q(),O("div",me,[s("div",fe,[S(ae,{class:"buttoncomp",onClick:t[0]||(t[0]=a=>T()),name:"Create Form"})])])):oe("",!0)]),s("div",pe,[S(ne,{tHeaders:D.value,tData:v.value,isCheckbox:"true",isAction:"true",actionType:"dropdown",onActionClickedDropDown:z,raiseRequest:"true",enableDisable:N.value,onCellClick:j,onActionClicked:U,onToggleClick:F,actions:I.value,onUpdateFilters:W,"field-mapping":J.value,isFiltersoption:"true"},null,8,["tHeaders","tData","enableDisable","actions","field-mapping"]),S(ie,{currentRecords:v.value.length,totalRecords:C.value,onUpdateValue:K,onLimitStart:Q},null,8,["currentRecords","totalRecords"])])]),t[9]||(t[9]=V('<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel"><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasRightLabel">Asset Request Form</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><div class="d-flex align-items-baseline position-relative gap-3"><div class="d-flex flex-column"><span><i class="dashedcircle ri-checkbox-blank-circle-fill"></i></span><div class="dashed_line mt-4"></div></div><div>data</div></div></div></div>',1)),s("div",be,[s("div",ve,[s("div",he,[s("div",_e,[s("div",ge,[t[5]||(t[5]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",ye,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:H},t[3]||(t[3]=[$("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[1]||(t[1]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[4]||(t[4]=[$("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",we,[s("div",{innerHTML:A.value},null,8,ke)]),t[6]||(t[6]=s("div",{class:"modal-footer"},null,-1))])])]),s("div",{class:"modal fade",id:"EnableDisable",tabindex:"-1","aria-labelledby":"EnableDisableLabel","aria-hidden":"true"},[s("div",{class:"modal-dialog modal-dialog-centered"},[s("div",{class:"modal-content"},[t[8]||(t[8]=V('<div class="modal-header"><h5 class="modal-title" id="EnableDisableLabel">Confirm Action</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> Are you sure you want to <span id="actionTextSpan"></span> <span class="fw-bold font-13" id="rowNameSpan"></span> Form? </div>',2)),s("div",{class:"modal-footer"},[t[7]||(t[7]=s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),s("button",{type:"button",class:"btn btn-dark",onClick:G},"Yes, Proceed")])])])])]))}};export{xe as default};
