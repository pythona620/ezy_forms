import{d as i,u as W,e as T,w as X,f as Z,g as b,o as ee,c as te,b as s,t as L,a as q,G as se,P as ae,h as O,i as I,E as oe,j as v,k as y,l as w,m as ne,n as E}from"./index-LfV3iEDw.js";const ie={class:""},le={class:"d-flex align-items-center justify-content-between py-3"},re={class:"m-0 font-13"},de={class:"m-0 font-11 pt-1"},ue={class:"mt-1"},ce={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},me={class:"modal-dialog modal-xl"},fe={class:"modal-content"},pe={class:"d-block modal-header bg-dark text-white py-2"},be={class:"d-flex align-items-center justify-content-between"},ve={class:""},he={class:"modal-body"},_e=["innerHTML"],ye={__name:"AllDepartment",props:["id"],setup(k){const C=i(0),x=i([{th:"Form Name",td_key:"form_name"},{th:"Form Short Code",td_key:"form_short_name"},{th:"Accessible Departments",td_key:"accessible_departments"}]),u=k,F=i({});i(null);const h=i([]),M=i([]),d=W(),R=i("");i([]);const A=i(""),D=i(""),c=T(()=>oe.value),P=i({business_unit:""}),n=i({limitPageLength:20,limit_start:0,filters:[]}),V=T(()=>[{name:"View form",icon:"fa-solid fa-eye"},{name:"Raise Request",icon:"fa fa-file-text"}]),$=i({form_short_name:{type:"input"},form_category:{type:"input"},form_status:{type:"select",options:["Active","Retired"]},form_name:{type:"input"},enable:{type:"select",options:["Enabled","Disabled"]}});function J(e=null){e==null?b.push({name:"FormStepper",query:{routepath:d.path,business_unit:c.value}}):b.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:d.path,business_unit:c.value,id:e.name}}),localStorage.setItem("routepath",d.path)}function j(e,t,a){if(a==="view"&&e&&b.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:c.value}}),a==="raiseRequest"){const o=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const l=JSON.parse(r).designation;o.workflow.length||v.info("No Roles Added",{autoClose:500});const f=o.workflow[0].roles;let g=!1;for(let p=0;p<f.length;p++)if(f[p]===l){g=!0;break}g?b.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):v.info("You do not have permission to access this Form.")}}}function B(e,t){var a;if(t.name==="View form"?e?b.push({name:"FormPreviewComp",query:{routepath:d.path,form_short_name:e.form_short_name,business_unit:c.value}}):v.warn(" There is no form fields "):t.name==="Edit Form"&&J(e),t.name==="Raise Request"){const o=JSON.parse(e.form_json),r=localStorage.getItem("employeeData");if(r){const l=JSON.parse(r).designation;(a=o.workflow)!=null&&a.length||v.info("No Roles Added",{autoClose:500});const f=o.workflow[0].roles;let g=!1;for(let p=0;p<f.length;p++)if(f[p]===l){g=!0;break}g&&e.enable===1?b.push({name:"RaiseRequest",query:{routepath:d.path,selectedForm:e.form_short_name,business_unit:e.business_unit,has_workflow:e.has_workflow}}):e.enable===0?v.info("This form is currently disabled.",{autoClose:500}):v.info("You do not have permission to access this Form.",{autoClose:500})}}if(t.name==="Download Print format"){F.value=e;const o={form_short_name:e.form_short_name,business_unit:c.value};y.post(w.preview_dynamic_form,o).then(l=>{R.value=l.message}).catch(l=>{console.error("Error fetching data:",l)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function z(){const e={form_short_name:F.value.form_short_name,name:null,business_unit:c.value};y.post(w.download_pdf_form,e).then(t=>{let a=ne+t.message;a=a.replace("/api","");const o=document.createElement("a");o.href=a,o.download=t.message.split("/").pop(),o.click()}).catch(t=>{console.error("Error fetching data:",t)})}const U=i([]),m=i(null),S=i("");function H(e,t,a){m.value=e;const o=e.enable=="1"||e.enable===1;S.value=o?"Disable":"Restore",document.getElementById("actionTextSpan").innerText=S.value,document.getElementById("rowNameSpan").innerText=e.name;const r=new bootstrap.Modal(document.getElementById("EnableDisable"));r.show(),window.currentModal=r}function Y(){if(!m.value)return;const e=m.value.enable=="1"||m.value.enable===1;m.value.enable=e?0:1,y.put(`${w.resource}${E.EzyFormDefinitions}/${m.value.name}`,m.value).then(t=>{U.value=t.data,v.success(`Form ${S.value}d successfully`,{autoClose:700}),setTimeout(()=>{_()},1e3),window.currentModal&&window.currentModal.hide()}).catch(t=>{console.error("Error updating toggle:",t)})}X([()=>c.value,()=>u.id],([e,t])=>{P.value.business_unit=e,e.length&&t&&u.id!==":id"&&(n.value.limit_start=0,n.value.filters=[],_(t||u.id,null))},{immediate:!0});const G=e=>{n.value.limitPageLength=e,n.value.limit_start=0,_()},K=([e,t])=>{n.value.limitPageLength=e,n.value.limit_start=t,_()},N=i(null);function Q(e){clearTimeout(N.value),N.value=setTimeout(()=>{n.value.filters=[],e.form_status==="Active"&&n.value.filters.push(["form_status","like","Created"]),e.form_status==="Retired"&&n.value.filters.push(["form_status","like","Draft"]),console.log(e.enable),e.enable==="Enabled"?n.value.filters.push(["enable","=",1]):e.enable==="Disabled"&&n.value.filters.push(["enable","=",0]),x.value.forEach(t=>{const a=t.td_key,o=e[a];a==="form_status"||a==="enable"||o&&n.value.filters.push([a,"like",`%${o}%`])}),n.value.filters.length?_(null,n.value.filters):_()},500)}function _(e,t){const a=[["business_unit","like",`%${P.value.business_unit}%`],["form_status","like","created"]];u.id&&u.id!=="Allforms"&&u.id!=="allforms"&&a.push(["owner_of_the_form","=",u.id]),t&&a.push(...t);const o={fields:JSON.stringify(["*"]),limit_page_length:n.value.limitPageLength,limit_start:n.value.limit_start,filters:JSON.stringify(a),order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`modified` DESC"},r={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(a)};y.get(`${w.resource}${E.EzyFormDefinitions}`,{params:r}).then(l=>{C.value=l.data[0].total_count}).catch(l=>{console.error("Error fetching ezyForms data:",l)}),y.get(`${w.resource}${E.EzyFormDefinitions}`,{params:o}).then(l=>{n.value.limit_start===0?(h.value=l.data,M.value=[...new Set(h.value.map(f=>f.form_category))]):h.value=h.value.concat(l.data)}).catch(l=>{console.error("Error fetching department details:",l)})}return Z(()=>{localStorage.removeItem("routepath");const e=JSON.parse(localStorage.getItem("employeeData"));A.value=e.designation||"",A.value.includes("IT")&&(D.value="true"),(d.path==="/forms/department/allforms"||d.path==="/forms/department/Allforms")&&b.replace("/forms/department/allforms")}),(e,t)=>(ee(),te("div",ie,[s("div",null,[s("div",le,[s("div",null,[s("h1",re,L(k.id==="allforms"?"All Active Forms":k.id.toUpperCase()),1),s("p",de,L(C.value)+" Forms Available ",1)])]),s("div",ue,[q(se,{tHeaders:x.value,tData:h.value,isCheckbox:"true",isAction:"true",actionType:"dropdown",raiseRequest:"true",enableDisable:D.value,onCellClick:j,onActionClicked:B,onToggleClick:H,actions:V.value,onUpdateFilters:Q,"field-mapping":$.value,isFiltersoption:"true"},null,8,["tHeaders","tData","enableDisable","actions","field-mapping"]),q(ae,{currentRecords:h.value.length,totalRecords:C.value,onUpdateValue:G,onLimitStart:K},null,8,["currentRecords","totalRecords"])])]),t[7]||(t[7]=O('<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel"><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasRightLabel">Asset Request Form</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><div class="d-flex align-items-baseline position-relative gap-3"><div class="d-flex flex-column"><span><i class="dashedcircle ri-checkbox-blank-circle-fill"></i></span><div class="dashed_line mt-4"></div></div><div>data</div></div></div></div>',1)),s("div",ce,[s("div",me,[s("div",fe,[s("div",pe,[s("div",be,[t[3]||(t[3]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",ve,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:z},t[1]||(t[1]=[I("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[0]||(t[0]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[2]||(t[2]=[I("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",he,[s("div",{innerHTML:R.value},null,8,_e)]),t[4]||(t[4]=s("div",{class:"modal-footer"},null,-1))])])]),s("div",{class:"modal fade",id:"EnableDisable",tabindex:"-1","aria-labelledby":"EnableDisableLabel","aria-hidden":"true"},[s("div",{class:"modal-dialog modal-dialog-centered"},[s("div",{class:"modal-content"},[t[6]||(t[6]=O('<div class="modal-header"><h5 class="modal-title" id="EnableDisableLabel">Confirm Action</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> Are you sure you want to <span id="actionTextSpan"></span> <span class="fw-bold font-13" id="rowNameSpan"></span> Form? </div>',2)),s("div",{class:"modal-footer"},[t[5]||(t[5]=s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),s("button",{type:"button",class:"btn btn-dark",onClick:Y},"Yes, Proceed")])])])])]))}};export{ye as default};
