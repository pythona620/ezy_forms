import{_ as M,x as f,E as $,r as n,w as D,e as q,K as B,y as V,z as S,o as l,c as i,d as a,b as A,G as H,P as K,t as r,F as v,h as _,l as b,m as C}from"./index-Dfr1Ik7C.js";const Q={class:"mt-2"},W={class:"offcanvas offcanvas-end","data-bs-backdrop":"static",tabindex:"-1",id:"staticBackdrop","aria-labelledby":"staticBackdropLabel"},X={class:"offcanvas-header"},Y=["title"],Z={class:"offcanvas-body p-3"},ee={key:0,class:"mb-2"},te={class:"ps-0 list-unstyled"},ae={class:"m-0 mb-1",style:{"font-weight":"500",color:"#4b5563"}},se={key:0,class:"ps-2"},oe={class:"text-muted"},ne={style:{"background-color":"#e0e7ff",padding:"2px 6px","border-radius":"4px",color:"#4338ca","margin-left":"5px","word-wrap":"break-word"}},le={key:1,style:{"font-size":"13px",color:"#6b7280"}},ie={style:{"background-color":"#dbeafe",padding:"2px 6px","border-radius":"4px",color:"#1e3a8a","margin-left":"5px","word-wrap":"break-word"}},de={key:1},re={class:"list-unstyled ps-0"},ce={class:"m-0 mb-1",style:{"font-weight":"500","font-size":"12px",color:"#4b5563"}},ue={class:"m-0",style:{"font-size":"11px",color:"#6b7280","line-height":"20px"}},pe={style:{"background-color":"#e0e7ff",padding:"2px 6px","border-radius":"4px",color:"#4338ca","word-wrap":"break-word"}},me={style:{"background-color":"#d1fae5",padding:"2px 6px","border-radius":"4px",color:"#065f46"}},fe={key:2},ve={class:"list-unstyled ps-0"},_e={class:"m-0 mb-1",style:{"font-weight":"500","font-size":"12px",color:"#4b5563"}},ge={key:0,class:"ps-2"},ye={class:"text-muted"},be={style:{"background-color":"#fee2e2",padding:"2px 6px","border-radius":"4px",color:"#b91c1c","margin-left":"5px","word-wrap":"break-word"}},he={key:1,style:{"font-size":"13px",color:"#6b7280"}},xe={style:{"background-color":"#fee2e2",padding:"2px 6px","border-radius":"4px",color:"#b91c1c","margin-left":"5px","word-wrap":"break-word"}},ke={key:3,class:"text-center text-muted mt-4"},we={__name:"AuditLog",setup(Le){const O=f(()=>$.value),N=n(0),u=n([]);n(["yes","no"]),n([]),n(""),n(null),n(""),n([]),n({ezy_departments_items:[]});const R=n([]),P=n(null),p=n([]),d=n({limitPageLength:20,limit_start:0,filters:[]}),g=n({department_code:"",department_name:""}),U=n([]),z=n([{th:"Document Name",td_key:"docname"},{th:"Doctype Name",td_key:"ref_doctype"},{th:"Modified By",td_key:"modified_by"},{th:"Modified Date",td_key:"modified"}]),F=n({docname:{type:"input"},ref_doctype:{type:"input"},modified_by:{type:"input"}}),h=n({department_code:"",department_name:"",business_unit:"",ezy_departments_items:[]});D(()=>h.value.department_code,s=>{const t=s.trim().toLowerCase();U.value.filter(o=>o!==null).map(o=>o.trim().toLowerCase()).includes(t)?g.value.department_code="Department code already exists.":g.value.department_code=""}),D(()=>h.value.department_name,s=>{const t=s.trim().toLowerCase();R.value.filter(o=>o!==null).map(o=>o.trim().toLowerCase()).includes(t)?g.value.department_name="Department name already exists.":g.value.department_name=""}),q({applieddepartment_name:!1,applieddepartment_code:!1,department_name:"",department_code:""}),D(O,s=>{h.value.business_unit=s,s.length&&T()},{immediate:!0});function J(s){clearTimeout(P.value),P.value=setTimeout(()=>{d.value.filters=[],z.value.forEach(t=>{const e=t.td_key;s[e]&&d.value.filters.push([e,"like",`%${s[e]}%`])}),d.value.limit_start=0,d.value.limitPageLength=20,y(d.value.filters)},500)}const E=n([]);function T(){const s="Ezy Dynamic Activate Log",t={fields:JSON.stringify(["activate_log"]),limit_page_length:"none",doctype:B.EzyActivityLog};V.get(`${S.GetDoctypeData}/${encodeURIComponent(s)}`,{params:t}).then(e=>{var o,c;e&&(E.value=(c=(o=e==null?void 0:e.message)==null?void 0:o.data[0])==null?void 0:c.activate_log,y())}).catch(e=>{console.error("Error fetching department data:",e)})}const j=s=>{d.value.limitPageLength=s,d.value.limit_start=0,y(d.value.filters)},G=([s,t])=>{d.value.limitPageLength=s,d.value.limit_start=t,y(d.value.filters)};function y(s){s&&(d.value.filters=s),d.value.filters.push(["ref_doctype","in",E.value]);const t={fields:JSON.stringify(["docname","ref_doctype","modified_by","modified","data"]),filters:JSON.stringify(d.value.filters),limit_page_length:d.value.limitPageLength,limit_start:d.value.limit_start,doctype:B.version,order_by:"`tabVersion`.`creation` desc"};V.get(S.GetDoctypeData,{params:t}).then(e=>{if(e){const o=e.message.data;N.value=e.message.total_count,d.value.limit_start===0?u.value=o:u.value=u.value.concat(o)}}).catch(e=>{console.error("Error fetching department data:",e)})}function I(s){p.value=s,JSON.parse(s.data).changed.forEach(c=>{});const e=document.getElementById("staticBackdrop");new bootstrap.Offcanvas(e).show()}const x=f(()=>{var s;try{return(s=p.value)!=null&&s.data?JSON.parse(p.value.data):{}}catch(t){return{}}}),k=f(()=>x.value.added||[]),w=f(()=>x.value.changed||[]),L=f(()=>x.value.removed||[]);return(s,t)=>(l(),i("div",null,[t[9]||(t[9]=a("div",{class:"d-flex justify-content-between align-items-center py-2"},[a("div",null,[a("h1",{class:"mt-3 font-13"}," Audit Log ")])],-1)),a("div",Q,[A(H,{tHeaders:z.value,tData:u.value,isAction:"true",viewType:"viewPdf",onCellClick:I,isCheckbox:"true",isFiltersoption:"true","field-mapping":F.value,onUpdateFilters:J},null,8,["tHeaders","tData","field-mapping"]),A(K,{currentRecords:u.value.length,totalRecords:N.value,"items-per-page":d.value.limitPageLength,onUpdateValue:j,onLimitStart:G},null,8,["currentRecords","totalRecords","items-per-page"])]),a("div",W,[a("div",X,[a("h5",{class:"offcanvas-title",id:"staticBackdropLabel",title:p.value.docname},r(p.value.docname),9,Y),t[0]||(t[0]=a("button",{type:"button",class:"btn-close shadow-none","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),a("div",Z,[k.value.length?(l(),i("div",ee,[t[2]||(t[2]=a("h6",{class:"text-muted fw-bold mb-3"},"âž• Added",-1)),a("ul",te,[(l(!0),i(v,null,_(k.value,(e,o)=>(l(),i("li",{key:"added-"+o,class:"px-3 rounded",style:{"background-color":"#f9fafb",color:"#333"}},[a("p",ae,r(e[0])+" added with: ",1),typeof e[1]=="object"&&e[1]!==null?(l(),i("div",se,[(l(!0),i(v,null,_(e[1],(c,m)=>(l(),i("div",{key:m,class:"mb-1",style:{"font-size":"13px",color:"#6b7280"}},[a("span",oe,r(m)+":",1),a("span",ne,r(c),1)]))),128))])):(l(),i("div",le,[t[1]||(t[1]=a("span",null,"Value:",-1)),a("span",ie,r(e[1]),1)]))]))),128))])])):b("",!0),w.value.length?(l(),i("div",de,[t[5]||(t[5]=a("h6",{class:"text-muted fw-bold mb-3"},"ðŸ”„ Changes",-1)),a("ul",re,[(l(!0),i(v,null,_(w.value,(e,o)=>(l(),i("li",{key:"changed-"+o,class:"mb-2 px-3 py-2 rounded",style:{"background-color":"#f9fafb",color:"#333"}},[a("p",ce,r(e[0].replace(/_/g," ")),1),a("p",ue,[t[3]||(t[3]=C(" Changed from ")),a("span",pe,r(e[1]),1),t[4]||(t[4]=C(" to ")),a("span",me,r(e[2]),1)])]))),128))])])):b("",!0),L.value.length?(l(),i("div",fe,[t[7]||(t[7]=a("h6",{class:"text-muted fw-bold mb-3"},"âž– Removed",-1)),a("ul",ve,[(l(!0),i(v,null,_(L.value,(e,o)=>(l(),i("li",{key:"removed-"+o,class:"mb-2 px-3 py-2 rounded",style:{"background-color":"#f9fafb",color:"#333"}},[a("p",_e,r(e[0].replace(/_/g," ")),1),typeof e[1]=="object"&&e[1]!==null?(l(),i("div",ge,[(l(!0),i(v,null,_(e[1],(c,m)=>(l(),i("div",{key:m,class:"mb-1",style:{"font-size":"13px",color:"#6b7280"}},[a("span",ye,r(m)+":",1),a("span",be,r(c),1)]))),128))])):(l(),i("div",he,[t[6]||(t[6]=a("span",null,"Value:",-1)),a("span",xe,r(e[1]),1)]))]))),128))])])):b("",!0),!k.value.length&&!w.value.length&&!L.value.length?(l(),i("div",ke,t[8]||(t[8]=[a("i",{class:"bi bi-info-circle me-2"},null,-1),C("No added or changed data. ")]))):b("",!0)])])]))}},Ce=M(we,[["__scopeId","data-v-e1806f96"]]);export{Ce as default};
