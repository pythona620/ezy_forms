var qe=Object.defineProperty;var U=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var H=(q,d,v)=>d in q?qe(q,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):q[d]=v,G=(q,d)=>{for(var v in d||(d={}))Re.call(d,v)&&H(q,v,d[v]);if(U)for(var v of U(d))we.call(d,v)&&H(q,v,d[v]);return q};import{_ as ke,s as Ce,u as $e,e as I,d as o,w as Se,o as m,c as f,b as s,t as w,a as K,G as Ee,P as Ae,D as Fe,H as Ne,I as Q,j as A,h as b,z as Le,C as Oe,K as X,E as Pe,L as Ie,l as _,m as g,p as M,k as O}from"./index-DU0Ahx_I.js";const Me={class:"d-flex justify-content-between align-items-center py-2"},Te={class:"m-0 font-11 pt-1"},je={class:"mt-2"},De={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},xe={class:"modal-dialog modal-dialog-centered modal-lg"},Be={class:"modal-content"},Ve={class:"modal-header"},Je={class:"modal-title font-13",id:"viewRequestLabel"},We={class:"p-2"},ze={class:"activity-log-container"},Ue={class:"activity-log-content"},He={class:"font-12 mb-1"},Ge={class:"strong-content"},Ke={class:"strong-content"},Qe={class:"strong-content"},Xe={key:0},Ye={key:1,class:"strong-content"},Ze={key:0,class:"form-floating p-1"},et={key:0,class:"font-11 text-danger ps-1"},tt={class:"modal-footer"},at={key:0,class:"d-flex justify-content-between align-items-center mt-3 gap-2"},st=["disabled"],ot={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},nt={key:1},lt=["disabled"],rt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},it={key:1},ut={__name:"ReceivedForMe",setup(q){const d=Ce(),v=$e(),Y=I(()=>Pe.value),T=o({business_unit:""}),r=o({limitPageLength:20,limit_start:0,filters:[]}),P=o(0),Z=o([]),ee=o([]),te=o([]),k=o([]),ae=o(""),F=o([]),j=o([]);o(!1);const D=o([{th:"Request ID",td_key:"name"},{th:"Requested By",td_key:"requested_by"},{th:"Requested Department",td_key:"role"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"}]),se=o([{name:"View Request",icon:"fa-solid fa-eye"}]),C=o([]),l=o({}),x=o(null),N=o([]),y=o(""),B=o([]),oe=o([]),$=o(!1),S=o(!1),V=o([]);function ne(){_.post(g.view_only_reportee).then(a=>{V.value=a.message,h(r.value.filters)}).catch(a=>{console.log(a)})}function le(a,e){var n,t,i;if(e.name==="View Request")if(a){l.value=G({},a),ae.value=l.value.current_level,x.value=Ie((t=JSON.parse((n=l.value)==null?void 0:n.json_columns))==null?void 0:t.fields),oe.value=JSON.parse((i=l.value)==null?void 0:i.json_columns).child_table_fields;const u=[["wf_generated_request_id","like",`%${l.value.name}%`]],c={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(u),order_by:`\`tab${l.value.doctype_name}\`.\`creation\` desc`};_.get(`${g.resource}${l.value.doctype_name}`,{params:c}).then(p=>{p.data&&(N.value=p.data[0],pe(N.value,x.value),_.get(`${g.resource}${l.value.doctype_name}/${p.data[0].name}`).then(E=>{const z=Object.keys(E.data).filter(L=>Array.isArray(E.data[L]));z.length&&(j.value={},z.forEach(L=>{j.value[L]=E.data[L]||[]}))}).catch(E=>{console.error("Error fetching data for :",E)}))}).catch(p=>{console.error("Error fetching categories data:",p)}),_.get(`${g.resource}${M.WFActivityLog}/${l.value.name}`).then(p=>{p.data&&(F.value=p.data.reason||[])}).catch(p=>{console.error("Error fetching activity data:",p)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ")}function re(a){d.push({name:"ApproveRequest",query:{routepath:v.path,name:a.name,doctype_name:a.doctype_name,type:"mytasks",designation:B.value}})}const J=I(()=>F.value.some(a=>a.action==="Request Cancelled")),ie=a=>a?new Date(a).toLocaleDateString("en-GB"):"N/A",ue=a=>a?{"Request Cancelled":"cancelled","Request Raised":"raised"}[a]||a.toLowerCase():"performed an action on",R=o(!0),ce=()=>{y.value.trim()!==""&&(R.value=!0)};function de(a,e){if(y.value.trim()===""){R.value=!1;return}R.value=!0,$.value=!0;let n={};k.value.length&&k.value.map(t=>{n[t.fieldname]=t.value}),_.put(`${g.resource}${l.value.doctype_name}/${N.value.name}`,n).then(t=>{t!=null&&t.data&&ve(a,e)}).catch(t=>{console.error("Error submitting form:",t)})}function ve(a,e){let n={property:l.value.property,doctype:l.value.doctype_name,request_ids:[l.value.name],reason:y.value,action:e,files:null,cluster_name:null,url_for_approval_id:"",current_level:l.value.current_level};_.post(g.requestApproval,{request_details:[n]}).then(t=>{var i;((i=t==null?void 0:t.message)==null?void 0:i.success)===!0?(O.success(`Request ${e}ed`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),y.value="",h()):O.error(`Failed to ${e} request`,{autoClose:1e3,transition:"zoom"})}).catch(t=>{console.error("Error processing request:",t)}).finally(()=>{$.value=!1})}function me(a,e){if(y.value.trim()===""){R.value=!1;return}R.value=!0,S.value=!0;let n={};k.value.length&&k.value.map(t=>{n[t.fieldname]=t.value}),_.put(`${g.resource}${l.value.doctype_name}/${N.value.name}`,n).then(t=>{t!=null&&t.data&&(bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),fe(a,e))})}function fe(a,e){let n={property:l.value.property,doctype:l.value.doctype_name,request_id:l.value.name,reason:y.value,action:e,files:[],url_for_cancelling_id:"",current_level:l.value.current_level};_.post(g.wf_cancelling_request,n).then(t=>{t!=null&&t.message&&(y.value="",O.success(`${e}`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),h())}).catch(t=>{console.error("Error processing cancellation:",t),O.error("An error occurred while processing your request.",{autoClose:1e3,transition:"zoom"})}).finally(()=>{S.value=!1})}function pe(a,e){e.forEach(n=>{n.sections.forEach(t=>{t.rows.forEach(i=>{i.columns.forEach(u=>{u.fields.forEach(c=>{a!=null&&a.hasOwnProperty(c==null?void 0:c.fieldname)&&(c.value=a[c==null?void 0:c.fieldname])})})})})})}function _e(){R.value=!0}const ge=a=>{r.value.limitPageLength=a,r.value.limit_start=0,r.value.filters.length?h(r.value.filters):h()},ye=([a,e])=>{r.value.limitPageLength=a,r.value.limit_start=e,r.value.filters.length?h(r.value.filters):h()};o([]);const W=o(null);function he(a){clearTimeout(W.value),W.value=setTimeout(()=>{r.value.filters=[],D.value.forEach(e=>{const n=e.td_key;a[n]&&r.value.filters.push([n,"like",`%${a[n]}%`])}),r.value.filters.length?(r.value.limit_start=0,h(r.value.filters)):h()},500)}function h(a){const e=JSON.parse(localStorage.getItem("employeeData"));B.value=e.designation;const n=[["assigned_to_users","like",`%${e==null?void 0:e.designation}%`],["property","like",`%${T.value.business_unit}%`],["status","!=","Request Cancelled"],["name","in",V.value],["status","!=","Completed"]];a&&(n.push(...a),console.log(a));const t={fields:JSON.stringify(["*"]),limit_page_length:r.value.limitPageLength,limit_start:r.value.limit_start,filters:JSON.stringify(n),order_by:"`tabWF Workflow Requests`.`creation` desc"},i={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(n)};_.get(`${g.resource}${M.WFWorkflowRequests}`,{params:i}).then(u=>{P.value=u.data[0].total_count}).catch(u=>{console.error("Error fetching total count:",u)}),_.get(`${g.resource}${M.WFWorkflowRequests}`,{params:t}).then(u=>{r.value.limit_start===0?(C.value=u.data,Z.value=[...new Set(u.data.map(c=>c.name))],ee.value=[...new Set(u.data.map(c=>c.doctype_name))],te.value=[...new Set(u.data.map(c=>c.status))]):C.value=C.value.concat(u.data)}).catch(u=>{console.error("Error fetching records:",u)})}const be=I(()=>({name:{type:"input"},requested_by:{type:"input"},role:{type:"input"},status:{type:"select",options:["Request Raised","In Progress"]}}));return Se(Y,a=>{T.value.business_unit=a,a.length&&ne()},{immediate:!0}),(a,e)=>{var n;return m(),f("div",null,[s("div",Me,[s("div",null,[e[3]||(e[3]=s("h1",{class:"m-0 font-13"},"Requests Assigned to me",-1)),s("p",Te,w(P.value)+" request",1)])]),s("div",je,[K(Ee,{tHeaders:D.value,tData:C.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onUpdateFilters:he,"field-mapping":be.value,onCellClick:re,isFiltersoption:"true",actions:se.value,onActionClicked:le},null,8,["tHeaders","tData","field-mapping","actions"]),K(Ae,{currentRecords:C.value.length,totalRecords:P.value,onUpdateValue:ge,onLimitStart:ye},null,8,["currentRecords","totalRecords"])]),s("div",De,[s("div",xe,[s("div",Be,[s("div",Ve,[s("h5",Je," Request Id: "+w((n=l.value.name)==null?void 0:n.replace(/_/g," ")),1),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal",onClick:_e,"aria-label":"Close"})]),e[12]||(e[12]=s("div",{class:"modal-body approvermodalbody"},null,-1)),s("div",We,[s("div",ze,[(m(!0),f(Fe,null,Ne(F.value,(t,i)=>(m(),f("div",{key:i,class:Q(["activity-log-item",{"last-item":i===F.value.length-1}])},[e[7]||(e[7]=s("div",{class:"activity-log-dot"},null,-1)),e[8]||(e[8]=A("def add_roles_to_wf_requestors ")),s("div",Ue,[s("p",He,[e[4]||(e[4]=A(" On ")),s("strong",Ge,w(ie(t.creation)),1),e[5]||(e[5]=A(", ")),s("strong",Ke,w(t.user_name),1),A(" ("+w(t.role)+") has ",1),s("strong",Qe,w(ue(t.action)),1),e[6]||(e[6]=A(" the request")),i!==0&&t.reason?(m(),f("span",Xe,"with the comments:")):b("",!0),i!==0&&t.reason?(m(),f("strong",Ye,w(t.reason||"N/A"),1)):b("",!0)])])],2))),128))]),J.value?b("",!0):(m(),f("div",Ze,[Le(s("textarea",{class:Q(["form-control font-12",{"is-invalid":!R.value}]),placeholder:"Leave a comment here",id:"floatingTextarea",onInput:ce,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t)},null,34),[[Oe,y.value]]),e[9]||(e[9]=s("label",{class:"font-11",for:"floatingTextarea"},"Comments..",-1)),R.value?b("",!0):(m(),f("span",et,"Please enter comments**"))]))]),s("div",tt,[J.value?b("",!0):(m(),f("div",at,[s("div",null,[s("button",{type:"submit",class:"btn btn-outline-danger font-12 py-0 rejectbtn",disabled:S.value,onClick:e[1]||(e[1]=X(t=>me(a.formData,"Request Cancelled"),["prevent"]))},[S.value?(m(),f("span",ot)):b("",!0),S.value?b("",!0):(m(),f("span",nt,e[10]||(e[10]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),s("span",{class:"font-12"},"Reject",-1)])))],8,st)]),s("div",null,[s("button",{type:"submit",class:"btn btn-success approvebtn",disabled:$.value,onClick:e[2]||(e[2]=X(t=>de(k.value,"Approve"),["prevent"]))},[$.value?(m(),f("span",rt)):b("",!0),$.value?b("",!0):(m(),f("span",it,e[11]||(e[11]=[s("i",{class:"bi bi-check-lg font-15 me-2"},null,-1),s("span",{class:"font-12"},"Approve",-1)])))],8,lt)])]))])])])])])}}},mt=ke(ut,[["__scopeId","data-v-831b4146"]]);export{mt as default};
