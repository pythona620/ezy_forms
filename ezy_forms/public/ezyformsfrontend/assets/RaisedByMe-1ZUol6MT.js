var de=Object.defineProperty;var V=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var W=(h,u,c)=>u in h?de(h,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[u]=c,U=(h,u)=>{for(var c in u||(u={}))ue.call(u,c)&&W(h,c,u[c]);if(V)for(var c of V(u))ce.call(u,c)&&W(h,c,u[c]);return h};import{_ as me,e as $,E as fe,L as pe,r as o,u as ve,w as _e,i as ye,o as q,c as R,d as s,t as k,b as L,G as ge,P as he,l as _,C as be,D as we,n as ke,H as qe,s as Re,W as Ee,f as y,g,h as O,p as Pe}from"./index-DxID15hf.js";const Ce={class:"d-flex justify-content-between align-items-center py-2"},Se={class:"m-0 font-11 pt-1"},Fe={class:"mt-2"},Ne={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},xe={class:"modal-dialog modal-dialog-centered modal-lg"},$e={class:"modal-content"},Le={class:"modal-header py-2 d-block"},Oe={class:"d-flex justify-content-between align-items-center"},Me={class:"m-0 font-13",id:"viewRequest"},Ae={class:"activity-log-container"},Ie={class:"activity-log-content"},Be={class:"font-12 mb-1"},Te={class:"strong-content"},De={class:"strong-content"},Je={key:0},je={key:1},Ve={class:"strong-content"},We={class:"strong-content"},Ue={class:"modal-footer"},He={key:0},Ge={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},ze={class:"modal-dialog modal-xl"},Qe={class:"modal-content"},Xe={class:"modal-body pdf-body"},Ye=["innerHTML"],Ze={__name:"RaisedByMe",setup(h){const u=$(()=>fe.value),c=pe(),M=o({business_unit:""}),r=o({limitPageLength:20,limit_start:0,filters:[]}),F=o(0),n=o({}),A=o(null),E=o([]),H=o([]),G=o([]),z=o([]);o([]);const P=o([]),Q=o(""),I=o(""),C=o([]),B=o("");o([]);const X=o([]),Y=o(""),N=o([]),x=ve();o(!1);const T=o([{th:"Request ID",td_key:"name"},{th:"Form Name",td_key:"doctype_name"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Pending With",td_key:"assigned_to_users"},{th:"Last Action On",td_key:"modified"},{th:"Linked ID",td_key:"linked_form_id"}]),Z=o([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(e,t,a){a==="view"&&c.push({name:"ApproveRequest",query:{routepath:x.path,name:e.name,doctype_name:e.doctype_name,business_unit:e.property,status:e.status,type:"myforms",readOnly:"true"}}),a==="td_key"&&e.linked_form_id&&c.push({name:"ApproveRequest",query:{routepath:x.path,name:e.linked_form_id,business_unit:e.property,type:"linkedForm",readOnly:"true"}})}function ee(){const e=document.getElementById("viewRequest");if(e){const t=bootstrap.Modal.getInstance(e);t&&t.hide()}c.push({name:"RaiseRequest",query:{routepath:x.path,business_unit:n.value.property,selectedForm:n.value.doctype_name,selectedFormId:n.value.name,selectedFormStatus:n.value.status}})}$(()=>C.value.some(e=>e.action==="Request Cancelled"));function te(e,t){var a,d,m;if(t.name==="View Request")if(e){n.value=U({},e),B.value=e.status,Q.value=(a=n.value)==null?void 0:a.total_levels,X.value=JSON.parse((d=n.value)==null?void 0:d.json_columns).child_table_fields,A.value=Ee(JSON.parse((m=n.value)==null?void 0:m.json_columns).fields);const b=[["wf_generated_request_id","like",`%${n.value.name}%`]],f={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(b),order_by:`\`tab${n.value.doctype_name}\`.\`creation\` desc`};y.get(`${g.resource}${n.value.doctype_name}`,{params:f}).then(i=>{i.data&&(E.value=i.data,oe(E.value[0],A.value),y.get(`${g.resource}${n.value.doctype_name}`).then(l=>{console.log("Data for :",l.data[0])}).catch(l=>{console.error("Error fetching data for :",l)}),y.get(`${g.resource}${n.value.doctype_name}/${i.data[0].name}`).then(l=>{const p=Object.keys(l.data).filter(v=>Array.isArray(l.data[v]));p.length&&(N.value={},p.forEach(v=>{N.value[v]=l.data[v]||[]}))}).catch(l=>{console.error("Error fetching data for :",l)}))}).catch(i=>{console.error("Error fetching categories data:",i)}),y.get(`${g.resource}${O.WFActivityLog}/${n.value.name}`).then(i=>{i.data&&(C.value=i.data.reason||[])}).catch(i=>{console.error("Error fetching activity data:",i)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(t.name==="PDF Format"){n.value=e;const b=[["wf_generated_request_id","like",`%${n.value.name}%`]],f={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(b),order_by:`\`tab${n.value.doctype_name}\`.\`creation\` desc`};y.get(`${g.resource}${n.value.doctype_name}`,{params:f}).then(i=>{if(i.data){E.value=i.data;const l={form_short_name:e.doctype_name,name:E.value[0].name,business_unit:u.value};y.post(g.preview_dynamic_form,l).then(p=>{I.value=p.message}).catch(p=>{console.error("Error fetching data:",p)})}}).catch(i=>{console.error("Error fetching categories data:",i)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function D(){N.value=[],Y.value=""}const se=e=>e?new Date(e).toLocaleDateString("en-GB"):"N/A",ae=e=>e?{"Request Cancelled":"cancelled","Request Raised":"raised"}[e]||e.toLowerCase():"performed an action on";function J(){var t;const e={form_short_name:n.value.doctype_name,name:(t=E.value[0])==null?void 0:t.name,business_unit:u.value};y.post(g.download_pdf_form,e).then(a=>{let d=Pe+a.message;d=d.replace("/api","");const m=document.createElement("a");m.href=d,m.download=a.message.split("/").pop(),m.click()}).catch(a=>{console.error("Error fetching data:",a)})}function oe(e,t){t.forEach(a=>{a.sections.forEach(d=>{d.rows.forEach(m=>{m.columns.forEach(b=>{b.fields.forEach(f=>{e!=null&&e.hasOwnProperty(f==null?void 0:f.fieldname)&&(f.value=e[f==null?void 0:f.fieldname])})})})})})}const ne=e=>{r.value.limitPageLength=e,r.value.limit_start=0,r.value.filters.length?w(r.value.filters):w()},le=([e,t])=>{r.value.limitPageLength=e,r.value.limit_start=t,r.value.filters.length?w(r.value.filters):w()},j=o(null);function ie(e){console.log(e),clearTimeout(j.value),j.value=setTimeout(()=>{r.value.filters=[],T.value.forEach(t=>{const a=t.td_key;e[a]&&r.value.filters.push([a,"like",`%${e[a]}%`])}),r.value.filters.length?(r.value.limit_start=0,w(r.value.filters)):w()},500)}function w(e){var b,f,S,i;const a=[["requested_by","like",JSON.parse(localStorage.getItem("employeeData")).emp_mail_id],["property","like",`%${M.value.business_unit}%`]];e&&a.push(...e);const d={fields:JSON.stringify(["*"]),limit_page_length:(b=r.value)==null?void 0:b.limitPageLength,limit_start:(f=r.value)==null?void 0:f.limit_start,filters:JSON.stringify(a),order_by:"`tabWF Workflow Requests`.`creation` desc"},m={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(a)};y.get(`${(S=g)==null?void 0:S.resource}${(i=O)==null?void 0:i.WFWorkflowRequests}`,{params:m}).then(l=>{F.value=l.data[0].total_count}).catch(l=>{console.error("Error fetching total count:",l)}),y.get(`${g.resource}${O.WFWorkflowRequests}`,{params:d}).then(l=>{const p=l.data;r.value.limit_start===0?(P.value=p,H.value=[...new Set(p.map(v=>v.name))],G.value=[...new Set(p.map(v=>v.doctype_name))],z.value=[...new Set(p.map(v=>v.status))]):P.value=P.value.concat(p)}).catch(l=>{console.error("Error fetching records:",l)})}const re=$(()=>({status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},name:{type:"input"},doctype_name:{type:"input"},requested_on:{type:"date"},role:{type:"input"},modified:{type:"date"}}));return _e(u,e=>{M.value.business_unit=e,e.length&&w()},{immediate:!0}),ye(()=>{}),(e,t)=>{var a;return q(),R("div",null,[s("div",Ce,[s("div",null,[t[0]||(t[0]=s("h1",{class:"m-0 font-13"},"Requests Submitted",-1)),s("p",Se,k(F.value)+" request",1)])]),s("div",Fe,[L(ge,{tHeaders:T.value,tData:P.value,isAction:"true",isCheckbox:"true",viewType:"viewPdf",onCellClick:K,actions:Z.value,onActionClicked:te,isFiltersoption:"true","field-mapping":re.value,onUpdateFilters:ie},null,8,["tHeaders","tData","actions","field-mapping"]),L(he,{currentRecords:P.value.length,totalRecords:F.value,onUpdateValue:ne,onLimitStart:le},null,8,["currentRecords","totalRecords"])]),s("div",Ne,[s("div",xe,[s("div",$e,[s("div",Le,[s("div",Oe,[s("div",null,[s("h5",Me,"Request Id: "+k((a=n.value.name)==null?void 0:a.replace(/_/g," ")),1)]),s("div",{class:""},[s("button",{button:"button",class:"btn btn-white text-dark font-13",onClick:J},t[1]||(t[1]=[_(" Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:D,"data-bs-dismiss":"modal"},t[2]||(t[2]=[_(" Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),t[9]||(t[9]=s("div",{class:"modal-body approvermodalbody"},null,-1)),s("div",Ae,[(q(!0),R(be,null,we(C.value,(d,m)=>(q(),R("div",{key:m,class:ke(["activity-log-item",{"last-item":m===C.value.length-1}])},[t[7]||(t[7]=s("div",{class:"activity-log-dot"},null,-1)),s("div",Ie,[s("p",Be,[t[3]||(t[3]=_(" On ")),s("strong",Te,k(se(d.creation)),1),t[4]||(t[4]=_(", ")),s("strong",De,[m==0?(q(),R("span",Je,"you")):(q(),R("span",je,k(d.user_name),1))]),_(" ("+k(d.role)+") ",1),s("strong",Ve,k(ae(d.action)),1),t[5]||(t[5]=_(" the request with the comments: ")),s("strong",We,k(d.reason||"N/A"),1),t[6]||(t[6]=_(". "))])])],2))),128))]),s("div",Ue,[t[8]||(t[8]=s("div",{class:"d-flex justify-content-between align-items-center gap-2"},null,-1)),B.value=="Request Raised"?(q(),R("div",He,[L(qe,{type:"button",class:"border-1 edit-btn text-nowrap font-10",onClick:ee,name:"Edit Form"})])):Re("",!0)])])])]),s("div",Ge,[s("div",ze,[s("div",Qe,[s("div",{class:"modal-header py-2 d-block bg-dark text-white"},[s("div",{class:"d-flex justify-content-between align-items-center"},[t[12]||(t[12]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",{class:""},[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:J},t[10]||(t[10]=[_(" Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:D,"data-bs-dismiss":"modal"},t[11]||(t[11]=[_(" Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",Xe,[s("div",{innerHTML:I.value},null,8,Ye)]),t[13]||(t[13]=s("div",{class:"modal-footer"},null,-1))])])])])}}},tt=me(Ze,[["__scopeId","data-v-a48ef01b"]]);export{tt as default};
