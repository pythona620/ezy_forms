var ke=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var X=(p,v,i)=>v in p?ke(p,v,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[v]=i,Y=(p,v)=>{for(var i in v||(v={}))Ce.call(v,i)&&X(p,i,v[i]);if(Q)for(var i of Q(v))$e.call(v,i)&&X(p,i,v[i]);return p};var Z=(p,v,i)=>new Promise((T,C)=>{var r=h=>{try{S(i.next(h))}catch(E){C(E)}},$=h=>{try{S(i.throw(h))}catch(E){C(E)}},S=h=>h.done?T(h.value):Promise.resolve(h.value).then(r,$);S((i=i.apply(p,v)).next())});import{_ as Se,J as Ee,u as Ae,e as B,d as o,f as Fe,w as Ne,o as m,c as f,b as s,t as k,a as ee,G as Pe,P as Ie,z as Oe,A as Le,C as te,j as O,h as w,v as je,y as Me,I as ae,E as De,K as Te,l as g,m as y,p as J,k as D}from"./index-DUC1w12e.js";const xe={class:"d-flex justify-content-between align-items-center py-2"},Be={class:"m-0 font-11 pt-1"},Je={class:"mt-2"},Ve={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},We={class:"modal-dialog modal-dialog-centered modal-lg"},ze={class:"modal-content"},Ue={class:"modal-header"},Ge={class:"modal-title font-13",id:"viewRequestLabel"},He={class:"p-2"},Ke={class:"activity-log-container"},Qe={class:"activity-log-content"},Xe={class:"font-12 mb-1"},Ye={class:"strong-content"},Ze={class:"strong-content"},et={class:"strong-content"},tt={key:0},at={key:1,class:"strong-content"},st={key:0,class:"form-floating p-1"},ot={key:0,class:"font-11 text-danger ps-1"},nt={class:"modal-footer"},lt={key:0,class:"d-flex justify-content-between align-items-center mt-3 gap-2"},rt=["disabled"],it={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ut={key:1},ct=["disabled"],dt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},vt={key:1},mt={__name:"ReceivedForMe",setup(p){const v=Ee(),i=Ae(),T=B(()=>De.value),C=o({business_unit:""}),r=o({limitPageLength:20,limit_start:0,filters:[]}),$=o(0),S=o([]),h=o([]),E=o([]),A=o([]),se=o(""),L=o([]),V=o([]);o(!1);const W=o([{th:"Request ID",td_key:"name"},{th:"Requested By",td_key:"requested_by"},{th:"Requested Department",td_key:"role"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"}]),oe=o([{name:"View Request",icon:"fa-solid fa-eye"}]),F=o([]),l=o({}),z=o(null),j=o([]),b=o(""),x=o([]),ne=o([]),N=o(!1),P=o(!1);Fe(()=>{fe();const t=localStorage.getItem("employeeData");x.value=JSON.parse(t)});const U=o([]);function le(){g.post(y.view_only_reportee).then(t=>{U.value=t.message,q()}).catch(t=>{console.log(t)})}function re(t,e){var n,a,u;if(e.name==="View Request")if(t){l.value=Y({},t),se.value=l.value.current_level,z.value=Te((a=JSON.parse((n=l.value)==null?void 0:n.json_columns))==null?void 0:a.fields),ne.value=JSON.parse((u=l.value)==null?void 0:u.json_columns).child_table_fields;const c=[["wf_generated_request_id","like",`%${l.value.name}%`]],d={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(c),order_by:`\`tab${l.value.doctype_name}\`.\`creation\` desc`};g.get(`${y.resource}${l.value.doctype_name}`,{params:d}).then(_=>{_.data&&(j.value=_.data[0],ye(j.value,z.value),g.get(`${y.resource}${l.value.doctype_name}/${_.data[0].name}`).then(I=>{const K=Object.keys(I.data).filter(M=>Array.isArray(I.data[M]));K.length&&(V.value={},K.forEach(M=>{V.value[M]=I.data[M]||[]}))}).catch(I=>{console.error("Error fetching data for :",I)}))}).catch(_=>{console.error("Error fetching categories data:",_)}),g.get(`${y.resource}${J.WFActivityLog}/${l.value.name}`).then(_=>{_.data&&(L.value=_.data.reason||[])}).catch(_=>{console.error("Error fetching activity data:",_)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ")}function ie(t){v.push({name:"ApproveRequest",query:{routepath:i.path,name:t.name,doctype_name:t.doctype_name,type:"mytasks",designation:x.value}})}const G=B(()=>L.value.some(t=>t.action==="Request Cancelled")),ue=t=>t?new Date(t).toLocaleDateString("en-GB"):"N/A",ce=t=>t?{"Request Cancelled":"cancelled","Request Raised":"raised"}[t]||t.toLowerCase():"performed an action on",R=o(!0),de=()=>{b.value.trim()!==""&&(R.value=!0)};function ve(t,e){if(b.value.trim()===""){R.value=!1;return}R.value=!0,N.value=!0;let n={};A.value.length&&A.value.map(a=>{n[a.fieldname]=a.value}),g.put(`${y.resource}${l.value.doctype_name}/${j.value.name}`,n).then(a=>{a!=null&&a.data&&pe(t,e)}).catch(a=>{console.error("Error submitting form:",a)})}const me=o(null),fe=()=>Z(this,null,function*(){try{const e=yield(yield fetch("https://api.ipify.org?format=json")).json();me.value=e.ip}catch(t){console.error("Error fetching IP:",t)}});function pe(t,e){let n={property:l.value.property,doctype:l.value.doctype_name,request_ids:[l.value.name],reason:b.value,action:e,files:null,cluster_name:null,url_for_approval_id:"",current_level:l.value.current_level};g.post(y.requestApproval,{request_details:[n]}).then(a=>{var u;((u=a==null?void 0:a.message)==null?void 0:u.success)===!0?(D.success(`Request ${e}ed`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),b.value="",q()):D.error(`Failed to ${e} request`,{autoClose:1e3,transition:"zoom"})}).catch(a=>{console.error("Error processing request:",a)}).finally(()=>{N.value=!1})}function _e(t,e){if(b.value.trim()===""){R.value=!1;return}R.value=!0,P.value=!0;let n={};A.value.length&&A.value.map(a=>{n[a.fieldname]=a.value}),g.put(`${y.resource}${l.value.doctype_name}/${j.value.name}`,n).then(a=>{a!=null&&a.data&&(bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),ge(t,e))})}function ge(t,e){let n={property:l.value.property,doctype:l.value.doctype_name,request_id:l.value.name,reason:b.value,action:e,files:[],url_for_cancelling_id:"",current_level:l.value.current_level};g.post(y.wf_cancelling_request,n).then(a=>{a!=null&&a.message&&(b.value="",D.success(`${e}`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),q())}).catch(a=>{console.error("Error processing cancellation:",a),D.error("An error occurred while processing your request.",{autoClose:1e3,transition:"zoom"})}).finally(()=>{P.value=!1})}function ye(t,e){e.forEach(n=>{n.sections.forEach(a=>{a.rows.forEach(u=>{u.columns.forEach(c=>{c.fields.forEach(d=>{t!=null&&t.hasOwnProperty(d==null?void 0:d.fieldname)&&(d.value=t[d==null?void 0:d.fieldname])})})})})})}function he(){R.value=!0}const be=t=>{r.value.limitPageLength=t,r.value.limit_start=0,r.value.filters.length?q(r.value.filters):q()},qe=([t,e])=>{r.value.limitPageLength=t,r.value.limit_start=e,r.value.filters.length?q(r.value.filters):q()};o([]);const H=o(null);function we(t){clearTimeout(H.value),H.value=setTimeout(()=>{r.value.filters=[],W.value.forEach(e=>{const n=e.td_key;t[n]&&r.value.filters.push([n,"like",`%${t[n]}%`])}),r.value.filters.length?(r.value.limit_start=0,q(r.value.filters)):q()},500)}function q(t){const e=JSON.parse(localStorage.getItem("employeeData"));x.value=e.designation;const n=[["assigned_to_users","like",`%${e==null?void 0:e.designation}%`],["property","like",`%${C.value.business_unit}%`],["status","!=","Request Cancelled"],["name","in",U.value],["status","!=","Completed"]];t&&(n.push(...t),console.log(t));const a={fields:JSON.stringify(["*"]),limit_page_length:r.value.limitPageLength,limit_start:r.value.limit_start,filters:JSON.stringify(n),order_by:"`tabWF Workflow Requests`.`creation` desc"},u={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(n)};g.get(`${y.resource}${J.WFWorkflowRequests}`,{params:u}).then(c=>{$.value=c.data[0].total_count}).catch(c=>{console.error("Error fetching total count:",c)}),g.get(`${y.resource}${J.WFWorkflowRequests}`,{params:a}).then(c=>{r.value.limit_start===0?(F.value=c.data,S.value=[...new Set(c.data.map(d=>d.name))],h.value=[...new Set(c.data.map(d=>d.doctype_name))],E.value=[...new Set(c.data.map(d=>d.status))]):F.value=F.value.concat(c.data)}).catch(c=>{console.error("Error fetching records:",c)})}const Re=B(()=>({name:{type:"input"},requested_by:{type:"input"},role:{type:"input"},status:{type:"select",options:["Request Raised","In Progress"]}}));return Ne(T,t=>{C.value.business_unit=t,t.length&&le()},{immediate:!0}),(t,e)=>{var n;return m(),f("div",null,[s("div",xe,[s("div",null,[e[3]||(e[3]=s("h1",{class:"m-0 font-13"},"Requests Assigned to me",-1)),s("p",Be,k($.value)+" request",1)])]),s("div",Je,[ee(Pe,{tHeaders:W.value,tData:F.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onUpdateFilters:we,"field-mapping":Re.value,onCellClick:ie,isFiltersoption:"true",actions:oe.value,onActionClicked:re},null,8,["tHeaders","tData","field-mapping","actions"]),ee(Ie,{currentRecords:F.value.length,totalRecords:$.value,onUpdateValue:be,onLimitStart:qe},null,8,["currentRecords","totalRecords"])]),s("div",Ve,[s("div",We,[s("div",ze,[s("div",Ue,[s("h5",Ge," Request Id: "+k((n=l.value.name)==null?void 0:n.replace(/_/g," ")),1),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal",onClick:he,"aria-label":"Close"})]),e[12]||(e[12]=s("div",{class:"modal-body approvermodalbody"},null,-1)),s("div",He,[s("div",Ke,[(m(!0),f(Oe,null,Le(L.value,(a,u)=>(m(),f("div",{key:u,class:te(["activity-log-item",{"last-item":u===L.value.length-1}])},[e[7]||(e[7]=s("div",{class:"activity-log-dot"},null,-1)),e[8]||(e[8]=O("def add_roles_to_wf_requestors ")),s("div",Qe,[s("p",Xe,[e[4]||(e[4]=O(" On ")),s("strong",Ye,k(ue(a.creation)),1),e[5]||(e[5]=O(", ")),s("strong",Ze,k(a.user_name),1),O(" ("+k(a.role)+") has ",1),s("strong",et,k(ce(a.action)),1),e[6]||(e[6]=O(" the request")),u!==0&&a.reason?(m(),f("span",tt,"with the comments:")):w("",!0),u!==0&&a.reason?(m(),f("strong",at,k(a.reason||"N/A"),1)):w("",!0)])])],2))),128))]),G.value?w("",!0):(m(),f("div",st,[je(s("textarea",{class:te(["form-control font-12",{"is-invalid":!R.value}]),placeholder:"Leave a comment here",id:"floatingTextarea",onInput:de,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a)},null,34),[[Me,b.value]]),e[9]||(e[9]=s("label",{class:"font-11",for:"floatingTextarea"},"Comments..",-1)),R.value?w("",!0):(m(),f("span",ot,"Please enter comments**"))]))]),s("div",nt,[G.value?w("",!0):(m(),f("div",lt,[s("div",null,[s("button",{type:"submit",class:"btn btn-outline-danger font-12 py-0 rejectbtn",disabled:P.value,onClick:e[1]||(e[1]=ae(a=>_e(t.formData,"Request Cancelled"),["prevent"]))},[P.value?(m(),f("span",it)):w("",!0),P.value?w("",!0):(m(),f("span",ut,e[10]||(e[10]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),s("span",{class:"font-12"},"Reject",-1)])))],8,rt)]),s("div",null,[s("button",{type:"submit",class:"btn btn-success approvebtn",disabled:N.value,onClick:e[2]||(e[2]=ae(a=>ve(A.value,"Approve"),["prevent"]))},[N.value?(m(),f("span",dt)):w("",!0),N.value?w("",!0):(m(),f("span",vt,e[11]||(e[11]=[s("i",{class:"bi bi-check-lg font-15 me-2"},null,-1),s("span",{class:"font-12"},"Approve",-1)])))],8,ct)])]))])])])])])}}},gt=Se(mt,[["__scopeId","data-v-d5eb86cf"]]);export{gt as default};
