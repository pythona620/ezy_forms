var ne=Object.defineProperty,se=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var T=(_,i,m)=>i in _?ne(_,i,{enumerable:!0,configurable:!0,writable:!0,value:m}):_[i]=m,k=(_,i)=>{for(var m in i||(i={}))oe.call(i,m)&&T(_,m,i[m]);if(A)for(var m of A(i))ie.call(i,m)&&T(_,m,i[m]);return _},S=(_,i)=>se(_,le(i));import{_ as re,x as de,E as me,r as o,w as $,K as D,y as w,z,o as p,c,d as t,b,G as ue,P as pe,m as x,O as L,t as U,l as I,W as ce,S as _e,F as ve,h as ge,i as fe,j as ye,U as V,H as G}from"./index-CcBin9ca.js";const be={class:"mt-2"},he={class:"modal fade",id:"viewCategory","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewCategoryLabel","aria-hidden":"true"},Ce={class:"modal-dialog"},ke={class:"modal-content"},De={class:"modal-header"},we={class:"modal-body"},ze={class:"mb-3"},xe={key:0,class:"text-danger font-12"},Ve={class:"mb-3"},Ee={key:0,class:"text-danger font-12"},Le={class:"d-flex w-100 gap-3"},Ue={key:0,class:"table mt-3 global-table"},Ne={key:0},Pe={key:1},Se=["onChange"],$e={class:"text-center"},Ie=["onClick"],Me=["onClick"],Be=["onClick"],Fe={class:"modal-footer"},Oe=["disabled"],je=["disabled"],qe={__name:"DepartmentComp",setup(_){const i=de(()=>me.value),m=o(0),N=o([]),f=o(""),v=o(null),y=o(""),r=o({ezy_departments_items:[]}),M=o([]),H=o([{name:"View Categories",icon:"fa-solid fa-eye"}]),d=o({department_code:"",department_name:""}),B=o([]),h=o(!1),J=o(null),F=o(""),O=o(""),g=o({limitPageLength:20,limit_start:0}),K=a=>{g.value.limitPageLength=a,g.value.limit_start=0,fetchTable()},W=([a,e])=>{g.value.limitPageLength=a,g.value.limit_start=e,fetchTable()};function Q(){Object.assign(n.value,{department_code:"",department_name:"",ezy_departments_items:[]}),r.value.ezy_departments_items=[],f.value=""}const j=o([{th:"Name",td_key:"name"},{th:"Department Code",td_key:"department_code"},{th:"Department Name",td_key:"department_name"}]),X=o({name:{type:"input"},department_code:{type:"input"},department_name:{type:"input"},form_category:{type:"select",options:["Software","Hardware"]}}),n=o({department_code:"",department_name:"",business_unit:"",ezy_departments_items:[]});$(()=>n.value.department_code,a=>{const e=a.trim().toLowerCase(),s=B.value.filter(u=>u!==null).map(u=>u.trim().toLowerCase()),l=F.value.trim().toLowerCase();h.value&&e===l?d.value.department_code="":s.includes(e)?d.value.department_code="Department code already exists.":d.value.department_code=""}),$(()=>n.value.department_name,a=>{const e=a.trim().toLowerCase(),s=M.value.filter(u=>u!==null).map(u=>u.trim().toLowerCase()),l=O.value.trim().toLowerCase();h.value&&e===l?d.value.department_name="":s.includes(e)?d.value.department_name="Department name already exists.":d.value.department_name=""}),$(i,a=>{n.value.business_unit=a,a.length&&C()},{immediate:!0});function Y(a,e){R(),e.name==="View Categories"&&(h.value=!0,F.value=a.department_code,O.value=a.department_name,J.value=a.id,n.value=k({},a),a?(n.value=k({},a),w.get(`${z.resource}${D.departments}/${a.name}`).then(l=>{l.data&&(r.value=l.data)}).catch(l=>{console.error("Error fetching categories data:",l)}),new bootstrap.Modal(document.getElementById("viewCategory"),{}).show()):(console.warn("No form fields provided."),formCreation(a)))}function q(){f.value&&(r.value.ezy_departments_items.push({category:f.value,parentfield:"ezy_departments_items"}),f.value="")}function Z(a,e){v.value=a,y.value=e}function E(a){const e=y.value.trim();e?r.value.ezy_departments_items[a].category=e:r.value.ezy_departments_items.splice(a,1),v.value=null,y.value=""}function P(a){r.value.ezy_departments_items.splice(a,1)}function ee(a){const e=[];j.value.forEach(s=>{const l=s.td_key;a[l]&&e.push([l,"like",`%${a[l]}%`])}),g.value.limit_start=0,g.value.limitPageLength=20,e.length?C(e):C()}function R(){h.value=!1,r.value.ezy_departments_items=[],n.value.business_unit=localStorage.getItem("Bu");const a=[["business_unit","=",`${i.value}`]],e={fields:JSON.stringify(["name","department_name","department_code","business_unit"]),filters:JSON.stringify(a),limit_page_length:"none",limit_start:g.value.limit_start,doctype:D.departments,order_by:"`tabEzy Departments`.`creation` desc"};w.get(z.GetDoctypeData,{params:e}).then(s=>{s.message.data&&(M.value=[...new Set(s.message.data.map(l=>l.department_name))],B.value=[...new Set(s.message.data.map(l=>l.department_code))])}).catch(s=>{console.error("Error fetching department data:",s)})}function C(a){const e=[["business_unit","=",`${n.value.business_unit}`]];a&&e.push(...a);const s={fields:JSON.stringify(["name","department_code","department_name","business_unit"]),filters:JSON.stringify(e),limit_page_length:g.value.limitPageLength,limit_start:g.value.limit_start,doctype:D.departments,order_by:"`tabEzy Departments`.`creation` desc"};w.get(z.GetDoctypeData,{params:s}).then(l=>{l&&(m.value=l.message.total_count,N.value=l.message.data)}).catch(l=>{console.error("Error fetching department data:",l)})}function te(){if(v.value!==null&&(y.value.trim()?E(v.value):P(v.value)),!r.value.ezy_departments_items||r.value.ezy_departments_items.length===0){V("At least one category is required");return}if(!d.value.department_code&&!d.value.department_name){n.value.ezy_departments_items=r.value.ezy_departments_items;const a=S(k({},n.value),{department_code:`${n.value.department_code}`,doctype:D.departments});w.post(z.DataUpdate,a).then(e=>{e.message.data&&(G("Department Created successfully"),C(),n.value={department_code:"",department_name:"",ezy_departments_items:[]},n.value.business_unit=i.value,f.value="",bootstrap.Modal.getInstance(document.getElementById("viewCategory")).hide(),n.value.business_unit=i.value)})}else V("Please correct the required fields")}function ae(){if(v.value!==null&&(y.value.trim()?E(v.value):P(v.value)),!r.value.ezy_departments_items||r.value.ezy_departments_items.length===0){V("At least one category is required");return}if(!n.value.department_code||!n.value.department_name||!n.value.business_unit||d.value.department_code||d.value.department_name){V("Please correct the required fields");return}n.value.ezy_departments_items=r.value.ezy_departments_items;const a=S(k({},n.value),{doctype:D.departments});w.put(`${z.DataUpdate}/${n.value.name}`,a).then(e=>{e.message.success==!0&&(G("Department Updated successfully"),C(),n.value={department_code:"",department_name:"",ezy_departments_items:[]},f.value="",bootstrap.Modal.getInstance(document.getElementById("viewCategory")).hide()),e.message.success==!1&&V(e.message.message)}).catch(e=>{var s;console.error("Error updating department:",((s=e.response)==null?void 0:s.data)||e)})}return(a,e)=>(p(),c("div",null,[t("div",{class:"d-flex justify-content-between align-items-center py-2"},[e[6]||(e[6]=t("div",null,[t("h1",{class:"m-0 font-13"},"Departments")],-1)),t("div",{class:"d-flex gap-2 align-items-center"},[t("div",{class:"d-flex align-items-center"},[t("button",{type:"button",class:"btn btn-dark buttoncomp CreateDepartments d-flex align-items-center",onClick:R,"data-bs-toggle":"modal","data-bs-target":"#viewCategory"}," Create Department ")])])]),t("div",be,[b(ue,{tHeaders:j.value,tData:N.value,onActionClicked:Y,isAction:"true",actions:H.value,actionType:"dropdown",isCheckbox:"true",isFiltersoption:"true","field-mapping":X.value,onUpdateFilters:ee},null,8,["tHeaders","tData","actions","field-mapping"]),b(pe,{currentRecords:N.value.length,totalRecords:m.value,"items-per-page":g.value.limitPageLength,onUpdateValue:K,onLimitStart:W},null,8,["currentRecords","totalRecords","items-per-page"])]),t("div",he,[t("div",Ce,[t("div",ke,[t("div",De,[e[7]||(e[7]=t("h6",{class:"modal-title",id:"viewCategoryLabel"},"Department",-1)),t("button",{type:"button",class:"btn-close shadow-none",onClick:e[0]||(e[0]=s=>Q()),"data-bs-dismiss":"modal","aria-label":"Close"})]),t("div",we,[t("div",null,[t("div",ze,[e[8]||(e[8]=t("label",{class:"font-13 ps-1",for:"DepartmentCode"},[x("Department Code"),t("span",{class:"text-danger ps-1"},"*")],-1)),b(L,{tag:"input",type:"text",name:"DepartmentCode",id:"DepartmentCode",placeholder:"Enter department code",modelValue:n.value.department_code,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.department_code=s),modelModifiers:{trim:!0}},null,8,["modelValue"]),d.value.department_code?(p(),c("span",xe,U(d.value.department_code),1)):I("",!0)]),t("div",Ve,[e[9]||(e[9]=t("label",{class:"font-13 ps-1",for:"Requedepartment_namested"},[x("Department name"),t("span",{class:"text-danger ps-1"},"*")],-1)),b(L,{tag:"input",type:"text",name:"department_name",id:"department_name",placeholder:"Enter department name",modelValue:n.value.department_name,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.department_name=s),modelModifiers:{trim:!0}},null,8,["modelValue"]),d.value.department_name?(p(),c("span",Ee,U(d.value.department_name),1)):I("",!0)]),e[10]||(e[10]=t("label",{class:"font-13 ps-1",for:"business_unit"},"Business Unit",-1)),b(L,{tag:"input",type:"text",disabled:!!n.value.business_unit,placeholder:"",class:"mb-3",name:"business_unit",id:"business_unit",modelValue:n.value.business_unit,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.business_unit=s)},null,8,["disabled","modelValue"])]),e[12]||(e[12]=t("label",{class:"font-13 ps-1",for:"Requedepartment_namested"},[x("Category"),t("span",{class:"text-danger ps-1"},"*")],-1)),t("div",Le,[b(L,{class:"w-100",tag:"input",type:"text",name:"ezy_departments_items",id:"ezy_departments_items",onKeydown:ce(q,["enter"]),placeholder:"Enter category",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=s=>f.value=s),modelModifiers:{trim:!0}},null,8,["modelValue"]),b(_e,{class:"buttoncomp",name:"Add",onClick:q})]),r.value.ezy_departments_items?(p(),c("table",Ue,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Category Name"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(p(!0),c(ve,null,ge(r.value.ezy_departments_items,(s,l)=>(p(),c("tr",{key:l},[t("td",null,U(l+1),1),v.value!==l?(p(),c("td",Ne,U(s.category),1)):(p(),c("td",Pe,[fe(t("input",{type:"text",class:"shadow-none rounded-1","onUpdate:modelValue":e[5]||(e[5]=u=>y.value=u),onChange:u=>E(l),placeholder:"Enter Category"},null,40,Se),[[ye,y.value,void 0,{trim:!0}]])])),t("td",$e,[v.value!==l?(p(),c("i",{key:0,class:"bi bi-pencil",onClick:u=>Z(l,s.category)},null,8,Ie)):(p(),c("i",{key:1,class:"bi bi-check font-20",onClick:u=>E(l)},null,8,Me)),t("i",{class:"bi bi-trash ms-2",onClick:u=>P(l)},null,8,Be)])]))),128))])])):I("",!0)]),t("div",Fe,[h.value?(p(),c("button",{key:0,type:"button",class:"applyfilter btn btn-dark text-nowrap font-10 d-flex justify-content-center align-items-center",disabled:!n.value.department_code||!n.value.department_name||!n.value.business_unit,onClick:ae},e[13]||(e[13]=[t("span",{class:"font-16 me-1"},[t("i",{class:"bi bi-check2"})],-1),x(" Save Department ")]),8,Oe)):(p(),c("button",{key:1,type:"button",class:"applyfilter btn btn-dark text-nowrap font-10 d-flex justify-content-center align-items-center",disabled:!n.value.department_code||!n.value.department_name||!n.value.business_unit,onClick:te},e[14]||(e[14]=[t("span",{class:"font-16 me-1"},[t("i",{class:"bi bi-check2"})],-1),x(" Create Department ")]),8,je))])])])])]))}},Te=re(qe,[["__scopeId","data-v-3bcdbae0"]]);export{Te as default};
