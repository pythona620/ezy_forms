var Ml=Object.defineProperty,Ol=Object.defineProperties;var Bl=Object.getOwnPropertyDescriptors;var vt=Object.getOwnPropertySymbols;var Xt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var Qt=(R,F,E)=>F in R?Ml(R,F,{enumerable:!0,configurable:!0,writable:!0,value:E}):R[F]=E,te=(R,F)=>{for(var E in F||(F={}))Xt.call(F,E)&&Qt(R,E,F[E]);if(vt)for(var E of vt(F))xt.call(F,E)&&Qt(R,E,F[E]);return R},ke=(R,F)=>Ol(R,Bl(F));var St=(R,F)=>{var E={};for(var $ in R)Xt.call(R,$)&&F.indexOf($)<0&&(E[$]=R[$]);if(R!=null&&vt)for(var $ of vt(R))F.indexOf($)<0&&xt.call(R,$)&&(E[$]=R[$]);return E};var Ue=(R,F,E)=>new Promise(($,re)=>{var le=G=>{try{m(E.next(G))}catch(ne){re(ne)}},Se=G=>{try{m(E.throw(G))}catch(ne){re(ne)}},m=G=>G.done?$(G.value):Promise.resolve(G.value).then(le,Se);m((E=E.apply(R,F)).next())});import{_ as is,r as h,x as se,o as a,c as i,d as t,i as D,j as M,F as q,h as V,t as _,u as zl,M as Nl,e as oe,E as Pl,w as Ce,f as jl,a6 as It,K as ce,y as z,z as W,L as S,l as b,a7 as Wl,m as k,n as N,Z as es,S as ts,b as X,O as Ke,B as ss,R as De,Q as ls,X as ie,v as bt,N as Fe,k as Re,a8 as os,a9 as as,aa as Hl,U as ae,H as pe,ab as At,a2 as Jl,ac as ns,D as qt,ad as Zl}from"./index-BZ4yfvPS.js";const Gl="/assets/ezy_forms/ezyformsfrontend/assets/oui_app-users-roles-C_V_SNI2.svg",Yl={class:"simple-field-library"},Kl={class:"field-search"},Ql={class:"field-types-grid"},Xl=["onDragstart","onClick"],xl={__name:"SimpleFieldLibrary",props:{fields:{type:Array,required:!0}},emits:["field-add","field-dragstart","field-dragend"],setup(R,{emit:F}){const E=R,$=F,re=h(""),le=h(!1),Se=se(()=>{if(!re.value)return E.fields;const T=re.value.toLowerCase();return E.fields.filter(I=>I.label.toLowerCase().includes(T))}),m=(T,I)=>{le.value=!0,T.dataTransfer.effectAllowed="copy",T.dataTransfer.setData("text/plain",I.type),$("field-dragstart",I.type)},G=()=>{le.value=!1,$("field-dragend")},ne=T=>{$("field-add",T.type)};return(T,I)=>(a(),i("div",Yl,[t("div",Kl,[I[1]||(I[1]=t("i",{class:"bi bi-search"},null,-1)),D(t("input",{"onUpdate:modelValue":I[0]||(I[0]=Y=>re.value=Y),type:"text",placeholder:"Search fields",class:"search-input"},null,512),[[M,re.value]])]),t("div",Ql,[(a(!0),i(q,null,V(Se.value,Y=>(a(),i("button",{key:Y.type,class:"field-type-btn",draggable:!0,onDragstart:K=>m(K,Y),onDragend:G,onClick:K=>ne(Y)},_(Y.label),41,Xl))),128))])]))}},Il=is(xl,[["__scopeId","data-v-cb64d6f9"]]),eo={class:""},to={class:""},so={class:"d-flex justify-content-between align-items-center CancelNdSave"},lo={class:"d-flex align-items-center"},oo={key:0,class:"font-16"},ao=["disabled"],no={class:"form-container p-0 container-fluid mt-3"},io={class:"row g-4"},ro={class:"col-lg-2 col-md-3 col-sm-12"},uo={class:"steps-sticky-div"},co={class:"steps d-sm-inline-flex d-md-block m-0 p-0"},po=["onClick"],mo={key:0,class:"ri-checkbox-circle-fill completedStepIcon"},fo={class:"step-text"},vo={class:"font-11"},bo={class:"font-14"},_o={class:"col-lg-10 col-md-9 col-sm-12 formbackground-color"},ho={class:"px-2"},go={class:"form-content stepsDiv"},yo={key:0},wo={class:""},ko={class:"stepperbackground ps-2 pe-2 m-0 d-flex justify-content-between align-items-center"},Co={class:"container-fluid aboutFields p-0"},Do={class:"row"},Fo={class:"col-sm-12 col-md-12 mt-lg-3 p-lg-4"},$o={class:"container-fluid"},So={class:"row g-3"},Ao={class:"col-md-6"},qo={class:"position-relative"},Vo={key:0,class:"font-12 position-absolute PredefinedLabel"},Eo={key:1,class:"text-danger ErrorMsg ms-2"},Lo={class:"col-md-6"},To={key:0,class:"text-danger ErrorMsg ms-2"},Uo={class:"col-md-6"},Ro={class:"col-md-6"},Mo={key:0,class:"text-danger"},Oo={class:"col-md-6"},Bo={key:0,class:"text-danger"},zo={class:"col-md-6"},No={key:0,class:"text-danger"},Po={class:"custom-option"},jo=["checked","onChange"],Wo={class:"col-md-6"},Ho={class:"col-md-6"},Jo={key:0,class:"col-md-6"},Zo={key:1,class:"col-md-6"},Go={key:2,class:"col-md-6"},Yo={key:3,class:"col-md-6"},Ko={class:"form-check d-flex align-items-center p-0 pe-3"},Qo=["disabled"],Xo={key:4,class:"col-md-6"},xo=["disabled"],Io={key:0,class:"list-group position-absolute w-100 z-3 formslist"},ea=["onMousedown"],ta={key:1,class:"zoho-form-builder"},sa={class:"zoho-toolbar"},la={class:"toolbar-left"},oa={class:"zoho-tabs"},aa=["onClick"],na=["onClick"],ia={class:"toolbar-right"},ra={class:"zoho-builder-container"},da={class:"d-flex align-items-center justify-content-between w-100"},ua={class:"mb-0 font-14 fw-bold"},ca={class:"btn btn-sm btn-link p-0 text-dark"},pa={key:0,class:"library-content"},ma={class:"zoho-form-canvas"},fa={class:"requestandAppHeader"},va={class:"d-flex justify-content-between align-items-center"},ba={class:""},_a={class:"ps-2 mb-0 fw-bolder font-14 blockTitle"},ha={class:"text-center ms-2 mt-1"},ga={key:0,class:"font-12 d-flex align-items-center"},ya={class:"font-12 approver_type_div"},wa={class:"font-12 fw-bold"},ka={class:"font-12 text-danger ms-1"},Ca={class:"d-flex align-items-center"},Da={key:0,class:"role-container"},Fa={key:0,class:"role-text d-flex align-items-center"},$a={class:"role-label fw-bold"},Sa={class:"role-names"},Aa=["onClick"],qa=["onClick"],Va=["onClick"],Ea=["onClick"],La={class:"pt-0 section_block"},Ta={class:"d-flex justify-content-between align-items-center"},Ua={class:"d-flex flex-column"},Ra=["onUpdate:modelValue","onChange","onInput"],Ma={key:0,class:"text-danger ps-3 font-10"},Oa={class:"d-flex align-items-center"},Ba=["onClick"],za={class:"container-fluid"},Na={class:"d-flex justify-content-between align-items-center"},Pa={class:"rownames m-0"},ja=["onClick"],Wa={class:"col"},Ha={class:"row"},Ja=["onMouseenter"],Za={class:"column_name d-flex align-items-center justify-content-between"},Ga={class:"d-flex flex-column ps-2"},Ya=["onUpdate:modelValue","onChange","onInput"],Ka={key:0,class:"text-danger ps-2 font-10"},Qa={class:"position-absolute top-0 end-0"},Xa=["onClick"],xa=["onDrop"],Ia=["onMouseenter","onDragstart","onDrop"],en=["onDrop"],tn=["onDragstart","onDrop"],sn={class:"d-flex justify-content-between"},ln={class:"flex-column d-flex"},on=["onUpdate:modelValue","onChange","onInput"],an={key:0,class:"text-danger font-10"},nn={class:"FieldcopyRemove"},rn=["onClick"],dn=["onClick"],un=["onUpdate:modelValue","onChange"],cn=["value"],pn={key:0},mn=["onUpdate:modelValue"],fn={key:0,class:"text-danger font-10"},vn={key:1},bn=["for"],_n=["id","onUpdate:modelValue","onInput","onFocus"],hn={key:0,class:"list-group mt-1",style:{"max-height":"200px","overflow-y":"auto"}},gn=["onClick"],yn={class:"d-flex align-items-center justify-content-between"},wn={class:"d-flex align-items-center gap-2"},kn={class:"d-flex align-items-center"},Cn=["onUpdate:modelValue","id"],Dn=["for"],Fn=["onClick"],$n=["onUpdate:modelValue"],Sn={key:3,class:"text-danger font-10"},An=["onDrop"],qn={class:"childtableShow"},Vn={class:"mt-2"},En={key:0,class:"childTableContainer"},Ln={key:0,class:"font-13"},Tn={key:1,class:"d-flex align-items-center gap-2"},Un={class:"d-flex align-items-center"},Rn=["onUpdate:modelValue"],Mn=["onClick"],On={key:2,class:"table table-bordered rounded-table"},Bn=["onDrop"],zn=["draggable","onDragstart"],Nn={key:0},Pn=["onUpdate:modelValue","onInput"],jn={key:0,class:"text-danger font-11"},Wn={key:1},Hn={key:2},Jn={class:"d-flex gap-1"},Zn=["onUpdate:modelValue","onChange"],Gn=["value"],Yn={class:"d-flex"},Kn={class:"d-flex align-items-center gap-2"},Qn={class:"d-flex align-items-center"},Xn=["onUpdate:modelValue"],xn=["onClick"],In={key:0},ei=["onUpdate:modelValue","onInput"],ti={key:0,class:"text-danger font-10"},si={key:1,class:"font-11 text-danger"},li={key:3},oi={key:3,class:"mb-2 mt-3"},ai=["onClick"],ni=["onClick"],ii=["onDrop"],ri=["onDrop"],di={class:"d-flex justify-content-center align-items-center my-2"},ui=["onClick"],ci={class:"font-13"},pi={key:0,class:"d-flex align-items-center gap-2"},mi={class:"d-flex align-items-center"},fi=["onUpdate:modelValue"],vi=["onClick"],bi={class:"table table-bordered rounded-table"},_i={key:0},hi=["onUpdate:modelValue","onBlur"],gi={key:0,class:"text-danger font-11 mt-1"},yi={key:1},wi={key:2},ki={class:"d-flex gap-1 align-items-center"},Ci=["onUpdate:modelValue","onChange"],Di=["value"],Fi=["onClick"],$i={key:0,class:"mt-1"},Si=["onUpdate:modelValue","onInput"],Ai={key:1,class:"text-danger font-11 mt-1"},qi={key:3},Vi={class:"mb-2"},Ei=["onClick"],Li=["onClick"],Ti=["onClick"],Ui={key:0},Ri={class:"d-flex justify-content-between align-items-center mt-1 mb-2"},Mi=["onUpdate:modelValue","onBlur"],Oi={key:0,class:"text-danger font-12"},Bi={key:1,class:"text-danger font-12"},zi={class:"d-flex align-items-center gap-2"},Ni={class:"d-flex align-items-center"},Pi=["onUpdate:modelValue"],ji=["onClick"],Wi=["onClick"],Hi={class:"px-1 field-border"},Ji={class:"d-flex justify-content-between"},Zi=["onUpdate:modelValue","onBlur"],Gi={key:0,class:"text-danger font-12"},Yi={class:"d-flex align-items-center"},Ki={class:"d-flex my-1"},Qi=["onUpdate:modelValue"],Xi=["onClick"],xi=["onClick"],Ii=["onUpdate:modelValue"],er=["value"],tr={key:0},sr=["onUpdate:modelValue"],lr={key:0,class:"text-danger font-10"},or={key:1,class:"text-danger font-12"},ar=["onClick"],nr=["onClick"],ir={class:"d-flex justify-content-center align-items-center py-2 add-section-btn"},rr=["onClick"],dr={key:0,class:"m-2"},ur={key:0,class:"zoho-properties-panel"},cr={class:"properties-header"},pr={key:2},mr={class:"stepperbackground d-flex align-items-center justify-content-between p-3"},fr={class:"container-fluid mt-4 p-4"},vr={class:"card mb-4"},br={class:"card-body"},_r={class:"row g-3"},hr={class:"col-md-6"},gr={class:"btn-group w-100",role:"group"},yr={key:0,class:"col-md-6"},wr={key:0,class:"card"},kr={class:"card-body"},Cr={key:0,class:"mt-3"},Dr={class:"table-responsive"},Fr={class:"table table-bordered"},$r=["onUpdate:modelValue"],Sr={class:"form-check form-switch"},Ar=["onUpdate:modelValue"],qr=["onClick"],Vr=["onClick"],Er={key:1,class:"card mt-4"},Lr={class:"card-body"},Tr={class:"alert alert-success mb-3"},Ur={class:"table-responsive"},Rr={class:"table table-bordered"},Mr={key:0,class:"badge bg-success"},Or={key:1,class:"badge bg-secondary"},Br={class:"text-muted"},zr={class:"mt-3"},Nr={class:"row g-2"},Pr={class:"field-badge"},jr={key:3},Wr={class:"stepperbackground d-flex align-items-center justify-content-between p-3"},Hr={class:"container-fluid mt-4 p-4"},Jr={key:0,class:"card mb-4"},Zr={class:"card-body"},Gr={class:"alert alert-success mb-3"},Yr={class:"table-responsive"},Kr={class:"table table-bordered table-hover"},Qr={class:"badge bg-dark"},Xr={key:0,class:"badge bg-danger"},xr={key:1,class:"badge bg-secondary"},Ir={key:0,class:"badge bg-info"},ed={key:1,class:"badge bg-warning text-dark"},td={key:2,class:"badge bg-secondary"},sd={class:"text-muted"},ld={key:1,class:"card"},od={class:"card-body"},ad={key:0},nd={class:"alert alert-secondary"},id={key:1},rd={key:4},dd={class:"modal fade",id:"customFormatModal",tabindex:"-1","aria-labelledby":"customFormatModalLabel","aria-hidden":"true"},ud={class:"modal-dialog modal-dialog-centered"},cd={class:"modal-content"},pd={class:"modal-body"},md=["placeholder"],fd={class:"d-flex align-items-center gap-2"},vd={class:"d-flex align-items-center py-2"},bd={class:"modal fade",id:"formViewModal",tabindex:"-1","aria-labelledby":"formViewModalLabel","aria-hidden":"true"},_d={class:"modal-dialog modal-xl modal-dialog-scrollable"},hd={class:"modal-content"},gd={class:"modal-body"},yd={class:"offcanvas addOffCanvas offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},wd={class:"offcanvas-header add_designationHeader"},kd={id:"offcanvasRightLabel",class:"font-14 fw-bold"},Cd={class:"offcanvas-body add_desig_offCanvas_body p-0"},Dd={class:""},Fd={class:""},$d={key:0,class:"p-3 approval-border-bottom"},Sd={key:0,class:""},Ad={class:"px-3 listofdesignations"},qd={class:"my-1 d-flex justify-content-between"},Vd={class:"font-12 fw-bold"},Ed={class:"italic-style text-secondary font-12"},Ld={key:0,ref:"resizableDiv",class:"my-1 disgnationlist_div"},Td={class:"d-flex align-items-center justify-content-between gap-1"},Ud={class:"form-check ps-1 d-flex align-items-center m-0"},Rd=["checked"],Md={for:"selectAll",class:"form-check-label SelectallDesignation mt-2 fw-bold"},Od={key:0,class:"form-check d-flex align-items-center m-0"},Bd={key:1},zd={key:0,class:"p-3"},Nd=["value"],Pd={key:1},jd={class:""},Wd={class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Hd={key:0,class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Jd={class:"offcanvas-footer"},Zd={class:"text-end p-3"},$e="Select All",Gd={__name:"FormStepper",setup(R){const F=zl(),E=Nl(),$=h(1),re=h([]);h([]);const le=h([]),Se=h([]);oe([]);let m=oe([]),G=oe([]);const ne=h([]),T=h([]),I=h([]),Y=h(""),K=h(""),O=h("");let H=oe([]);const Me=h("");h(!1),h(!1),h(!1);const Ae=h(""),Qe=h(""),Xe=h(""),rs=h([]),ds=h([]),A=oe({}),ee=h([]),_t=h(!1),xe=h([]),Ie=h(!1);let Vt=null;const us=h("");let U=h("");const _e=h(null),Et=h(null),qe=h(!0),et=h(0),Oe=h([]),me=h(null),fe=h("new"),tt=h([]),st=h([]),ht=h([]),Be=h([]),Ve=se(()=>Pl);h(!1);const lt=oe([]),x=h({routepath:F.query.routepath,business_unit:F.query.business_unit,formId:F.query.id}),ot=h(""),Ee=h(!1),Le=h(!1),Lt=[{label:"Public",value:1},{label:"Private",value:0}],Tt=se({get(){return Lt.find(s=>s.value===v.value.as_web_view)},set(s){v.value.as_web_view=s?s.value:null}}),Ut=se({get(){return v.value.form_name||F.query.form_name||""},set(s){v.value.form_name=s}}),v=h({form_name:"",form_short_name:"",accessible_departments:[],business_unit:`${Ve.value.value||x.value.business_unit||F.query.business_unit}`,form_category:"",owner_of_the_form:"",series:"",has_workflow:"",workflow_check:"",is_linked:0,is_linked_form:"",is_predefined_doctype:F.query.id?1:0,as_web_view:0,mail_id:""});Ce(()=>F.query.form_name,s=>{s&&(v.value.form_name=s,v.value.form_short_name=s)},{immediate:!0});const at=["name","parent","creation","owner","modified","modified_by","parentfield","parenttype","file_list","flags","docstatus","idx","doctype","company_field","business_unit"].map(s=>s.toLowerCase().trim()),Rt=["Approver","Approved on","Approved By"].map(s=>s.toLowerCase().trim());function cs(s){return s.toLowerCase().replace(/\s+/g,"_").replace(/[^\w_]/g,"")}se(()=>v.value),h(""),h(!1),Ce(Ve,s=>{s&&s.value&&(v.value.business_unit=s.value)},{immediate:!0});function ps(s){if(U==null||U==="new")return!1;const e=B(s).roles;if(s===0)return e.length===0;const l=B(s-1).roles;return l.length>0&&l[0]!==null&&l[0]!==""&&e.length===0}Ce(()=>v.value.form_name,s=>{v.value.form_name=s.trim()}),Ce(()=>v.value.form_short_name,s=>{v.value.form_short_name=s.trim()}),Ce(()=>v.value.series,s=>{v.value.series=s.trim()});const ze=h(null),Mt=(s,e,l,o,n,r)=>{ze.value={blockIndex:e,sectionIndex:l,rowIndex:o,columnIndex:n,fieldIndex:r}},he=(s,e,l,o,n,r)=>{if(s.preventDefault(),s.stopPropagation(),console.log("Field dropped at index:",{targetBlock:e,targetSection:l,targetRow:o,targetColumn:n,insertIndex:r,draggedField:ze.value,draggedFieldType:_e.value}),_e.value){console.log("Dropping from field library:",_e.value);const g=Kt(_e.value);if(!g){console.error("Failed to create field from type:",_e.value);return}const C=m[e];if(!C){ae("Target block not found");return}C.sections||(C.sections=[]),C.sections[l]||(C.sections[l]={label:"",rows:[]}),C.sections[l].rows||(C.sections[l].rows=[]),C.sections[l].rows[o]||(C.sections[l].rows[o]={label:"",columns:[]}),C.sections[l].rows[o].columns||(C.sections[l].rows[o].columns=[]),C.sections[l].rows[o].columns[n]||(C.sections[l].rows[o].columns[n]={label:"",fields:[]}),C.sections[l].rows[o].columns[n].fields.splice(r,0,g),console.log("Field added successfully:",g),pe(`${g.label} field added`),_e.value=null;return}if(!ze.value){console.log("No dragged field found");return}const{blockIndex:d,sectionIndex:c,rowIndex:f,columnIndex:u,fieldIndex:p}=ze.value,w=m[d].sections[c].rows[f].columns[u].fields,L=m[e].sections[l].rows[o].columns[n].fields;if(d===e&&c===l&&f===o&&u===n&&p===r)return;const y=w.splice(p,1)[0];w===L&&p<r&&r--,L.splice(r,0,y),ze.value=null},Te=h(""),ms=s=>Ue(this,null,function*(){const e=[["module","in",["User Forms"]],["istable","=",1]];s!=null&&s.trim()&&e.push(["name","=",`${s}`]);const l={fields:JSON.stringify(["name"]),filters:JSON.stringify(e),limit_page_length:"None",doctype:ce.doctypesList};try{return(yield z.get(W.GetDoctypeData,{params:l})).message.data||[]}catch(o){return console.error("Error fetching doctype list:",o),[]}}),nt=h(null),Ot=s=>Ue(this,null,function*(){if(Te.value="",nt.value=null,s.tableName){let e=s.tableName.trim();if(e.length>64){Te.value="Table name cannot exceed 64 characters";return}if(!/^[a-zA-Z]+( [a-zA-Z]+)*$/.test(e)){Te.value="Table name can only contain letters and spaces (no leading/trailing spaces or special characters)";return}const o=yield ms(e);nt.value=o.find(n=>n.name.toLowerCase()===e.toLowerCase()),nt.value&&(Te.value="Table already exists"),s.tableName=e}s.label&&(s.fieldname=cs(s.label))});function fs(){const s=v.value.is_linked_form;if(!s){xe.value=[];return}clearTimeout(Vt),Vt=setTimeout(()=>{const e=[["business_unit","=",`${Ve.value.value}`],["name","like",`%${s}%`]],l={fields:JSON.stringify(["name"]),limit_page_length:10,limit_start:0,filters:JSON.stringify(e),doctype:ce.EzyFormDefinitions,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"};z.get(`${W.GetDoctypeData}`,{params:l}).then(o=>{xe.value=o.message.data||[]}).catch(o=>{console.error("Error fetching form definitions:",o)})},300)}function vs(s){v.value.is_linked_form=s,Ie.value=!1}function bs(){setTimeout(()=>{Ie.value=!1},200)}oe({query:"",key:""});function ve(s,e,l,o,n){return`${s}-${e}-${l}-${o}-${n}`}oe({});const Ne=oe({}),gt=oe({});function _s(s){gt[s]=!0}function hs(s,e,l,o,n,r){const d=ve(e,l,o,n,r),c=[["istable","=",0]];s!=null&&s.trim()&&c.push(["name","like",`%${s}%`]);const f={fields:JSON.stringify(["name"]),filters:JSON.stringify(c),limit_page_length:"none",doctype:ce.doctypesList};z.get(W.GetDoctypeData,{params:f}).then(u=>{Ne[d]=u.message.data||[]}).catch(u=>{console.error("Error fetching doctype list:",u),Ne[d]=[]})}function gs(s,e,l,o,n,r){m[s].sections[e].rows[l].columns[o].fields[n].options=r;const d=ve(s,e,l,o,n);Ne[d]=[],gt[d]=!1}const ys=se(()=>m!=null&&m.length?O.value===1?[0]:Array.from({length:O.value},(s,e)=>e).filter(s=>s<O.value):[]),be=h(null),ge=h(null),ws=(s,e,l,o,n)=>{be.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o,fieldIndex:n}},ks=()=>{be.value=null},Cs=(s,e,l,o,n)=>be.value&&be.value.blockIndex===s&&be.value.sectionIndex===e&&be.value.rowIndex===l&&be.value.columnIndex===o&&be.value.fieldIndex===n,Ds=(s,e,l,o)=>{ge.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o}},Fs=()=>{ge.value=null},$s=(s,e,l,o)=>ge.value&&ge.value.blockIndex===s&&ge.value.sectionIndex===e&&ge.value.rowIndex===l&&ge.value.columnIndex===o,Bt=h([{form_json:""}]),ye=h("");jl(()=>{jt(),ye.value=F.query.Clone,U.value=F.query.id||"new",ye.value==="1"&&(v.value.series=""),U.value!=null&&U.value!=null&&U.value!="new"&&(Pt(),Dt()),sessionStorage.getItem("allow_approver_to_edit_form")=="1"?_t.value=!0:_t.value=!1;let s=localStorage.getItem("Bu");if(v.value.business_unit=s,F.query.preId==="PreDefine"){const e=localStorage.getItem("form_json");if(e){Bt.value[0].form_json=e;const l=Bt.value[0],o=JSON.parse(l.form_json),n=It(o.fields);ee.value=o.child_table_fields,n.forEach(r=>{m.push(r)})}}});const we=h(null),J=oe({}),zt=h(null),Ss=s=>{we.value=s},As=()=>{we.value=null},qs=s=>{s.preventDefault()},Vs=(s,e)=>{const l=s.target.closest("tr");if(!l)return;const o=Array.from(l.parentNode.children).indexOf(l);if(o!==we.value){const n=e[we.value];e.splice(we.value,1),e.splice(o,0,n),we.value=o}},Es=h([]),yt=s=>{if(["Select","Table MultiSelect","Check","Small Text"].includes(s.fieldtype)&&s.options){const e=s.options.split(`
`).map(n=>n.trim()).filter(n=>n),l=[],o=new Set;return e.forEach(n=>{const r=n.toLowerCase();o.has(r)||(o.add(r),l.push(n))}),`
`+l.join(`
`)}else if(["Link","Table"].includes(s.fieldtype)&&s.options)return s.options.trim();return s.options},Ls=(s,e)=>{const l=m[s].sections[e];l.childTables||(l.childTables=[]);const o=l.childTables.length;l.childTables.push({label:"",fieldname:"",fieldtype:"Table",idx:o,reqd:!1,as_a_block:"",description:"false",columns:[te({label:"",fieldname:"",fieldtype:"",idx:0,description:"",reqd:!1},lt.fieldtype==="Select"&&lt.options?{options:lt.options?`
${lt.options}`:`
`}:{})],newTable:!0})},Ts=(s,e,l)=>{const o=m[s].sections[e].childTables[l];o.columns||(o.columns=[]),o.columns.push(te({label:"",fieldname:"",fieldtype:"",idx:o.columns.length,description:"",reqd:!1},o.columns.fieldtype==="Select"&&o.columns.options?{options:o.columns.options?`
${o.columns.options}`:`
`}:{}))},Us=(s,e,l)=>{m[s].sections[e].childTables.splice(l,1)},Rs=(s,e,l,o)=>{m[s].sections[e].childTables[l].columns.splice(o,1)};function Ms(s,e,l,o,n,r){var u;const d=`${e}-${l}-${o}`;A[d]||(A[d]={columns:[]});const c={},f=((u=s.label)==null?void 0:u.trim())||"";if(!f)c.label="Field Label is required";else{const p=f.toLowerCase();if(at.includes(p)&&!Rt.includes(p))c.label=`"${f}" is a restricted field label`;else if(f.length>64)c.label="Field Label cannot exceed 64 characters";else if(!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(f))c.label="Field Label can only contain letters, numbers, and single spaces between words";else{const w=r.map((L,y)=>{var g;return{label:(g=L.label)==null?void 0:g.trim().toLowerCase(),index:y}}).filter(L=>L.label===p);if(w.length>1){const L=w[0].index;n!==L&&(c.label=`"${f}" is already used in this table`)}}}A[d].columns[n]=c}function it(s,e,l){var r;A[e]||(A[e]={});const o=[],n=((r=s.label)==null?void 0:r.trim())||"";n||o.push("Label is required"),n.length>64&&o.push("Label cannot exceed 64 characters"),n&&!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(n)&&o.push("No special characters allowed"),n&&at.includes(n.toLowerCase().trim())&&o.push("This label is restricted"),n&&ee.value[e].map(f=>{var u;return(u=f.label)==null?void 0:u.trim().toLowerCase()}).filter(Boolean).filter(f=>f===n.toLowerCase()).length>1&&o.push("Duplicate label is not allowed"),s.fieldtype||o.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||s.options.trim()==="")&&o.push("Options are required"),A[e][l]=o}const Os=(s,e,l)=>{var d;const o=m[s].sections[e].childTables[l],n={tableName:!1,columns:[]};let r=!1;return(d=o.tableName)!=null&&d.trim()||(n.tableName="Table name is required.",r=!0),o.columns.forEach((c,f)=>{var p,w;const u={};(p=c.label)!=null&&p.trim()||(u.label="Field Label is required",r=!0),(w=c.fieldtype)!=null&&w.trim()||(u.fieldtype="Please select field type",r=!0),n.columns[f]=u}),A[`${s}-${e}-${l}`]=n,r},Bs=(s,e,l)=>{var n,r;const o=(r=(n=m[s])==null?void 0:n.sections)==null?void 0:r[e];o&&!Array.isArray(o[l])&&(o[l]=[])},zs=s=>s?s.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,""):"",Ns=(s,e,l)=>{if(Os(s,e,l)){ae("Please fix validation errors before creating the table",{transition:"zoom"});return}if(nt.value){ae("Table already exists",{transition:"zoom"});return}const n=m[s].sections[e].childTables[l],r=m[s].sections[e];n.columns=n.columns.map((c,f)=>ke(te({},c),{idx:f,options:yt(c)})),n.newTable=!1;const d={form_short_name:n.tableName,fields:n.columns,idx:n.idx,as_a_block:n.as_a_block?n.as_a_block:"false"};z.post(W.childtable,d).then(c=>{var f,u,p;if(c){Bs(s,e,"afterCreated"),r.afterCreated[l]=te({},n),pe("Table created successfully!");const w=(p=(u=(f=c.message)==null?void 0:f[0])==null?void 0:u[0])==null?void 0:p.child_doc;w&&(m[s].sections[e].childTables[l]=ke(te(te({},m[s].sections[e].childTables[l]),w),{newTable:!1}))}}).catch(c=>{console.error("Error creating table:",c)})},Pe=(s,e,l,o=[])=>{var d;J[e]||(J[e]=[]),J[e]=J[e].filter(c=>c!==l),A[e]||(A[e]=[]),A[e][l]=[];const n=[],r=((d=s.label)==null?void 0:d.trim())||"";if(r?at.includes(r.toLowerCase())?n.push("This label is restricted"):r.length>64?n.push("Label cannot exceed 64 characters"):/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(r)||n.push("Only letters, numbers, and single spaces allowed"):n.push("Label is required"),o.length){const c=r.toLowerCase(),f=o.map((u,p)=>{var w;return{label:(w=u.label)==null?void 0:w.trim().toLowerCase(),idx:p}}).filter(u=>u.label===c);if(f.length>1){const u=f[0].idx;l!==u?(n.push("Duplicate label not allowed"),s._duplicate=!0):s._duplicate=!1}else s._duplicate=!1}return s.fieldtype||n.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||!s.options.trim())&&n.push("Options are required"),A[e][l]=n,n.length>0&&J[e].push(l),n.length===0},Ps=(s,e,l)=>{const n=m[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!n)return;const r=n.columns.length,d={fieldname:"",fieldtype:"",idx:r+1,label:"",value:"",isNew:!0,description:""};n.columns.push(d),Pe(d,l,r,n.columns)},Nt=h([]),js=(s,e,l,o)=>{const r=m[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!r)return;r.columns.splice(o,1),r.columns.forEach((c,f)=>{c.idx=f+1});const d=J.value[l];d&&(J.value[l]=d.filter(c=>c!==o).map(c=>c>o?c-1:c))},Ws=(s,e,l)=>{const n=m[s].sections[e].afterCreated.find(r=>r.tableName===l);if(n){if(P[l]){J[l]=[];let r=!0;if(n.columns.forEach((f,u)=>{Pe(f,l,u,n.columns)||(r=!1)}),!r){ae("Please fix the errors in the highlighted fields before saving!");return}const d=n.columns.map((w,p)=>{var L=w,{isNew:f}=L,u=St(L,["isNew"]);return ke(te({},u),{idx:p+1,options:yt(u)})}),c={form_short_name:zs(l),fields:d,as_a_block:n.description};z.post(W.childtable,c).then(f=>{Nt.value=f.data,pe("Fields updated successfully!")}).catch(f=>{console.error("❌ Saving fields failed:",f)})}P[l]=!P[l]}},P=oe({}),Hs=s=>{ee.value[s]||(ee.value[s]=[]);const e=ee.value[s].length+1;ee.value[s].push({fieldname:"",fieldtype:"",idx:e,label:"",value:"",isNew:!0,description:"",options:ee.value[s].options?`
${ee.value[s].options}`:""})},Js=(s,e)=>{ee.value[s]&&ee.value[s].splice(e,1)},Zs=(s,e)=>{if(!s)return;J.value||(J.value={}),J.value[s]||(J.value[s]=[]);const l=ee.value[s];if(l){if(P[s]){J.value[s]=[];let o=!0;if(l.forEach((d,c)=>{var u;it(d,s,c);const f=(u=A[s])==null?void 0:u[c];f&&f.length>0&&(J.value[s].push(c),o=!1),d.label&&(d.label=d.label.trim())}),!o){ae("Please fix the errors before saving");return}const n=l.map((u,f)=>{var p=u,{isNew:d}=p,c=St(p,["isNew"]);return ke(te({},c),{idx:f+1,options:yt(c)})}),r={form_short_name:s,fields:n,as_a_block:e};z.post(W.childtable,r).then(d=>{Nt.value=d.data,pe("Fields updated successfully!")}).catch(d=>{console.error("❌ Saving fields failed:",d)})}P[s]=!P[s],zt.value=P[s]?s:null}},Gs=h([{id:1,label:"Form Info",stepno:"Step 1",icon:"bi bi-info-circle"},{id:2,label:"Form Fields",stepno:"Step 2",icon:"bi bi-grid-3x3-gap"},{id:3,label:"Workflow Setup",stepno:"Step 3",icon:"bi bi-diagram-3"},{id:4,label:"Approver Blocks",stepno:"Step 4",icon:"bi bi-people"},{id:5,label:"Print Format",stepno:"Step 5",icon:"ri-checkbox-circle-line"}]),wt=[{label:"Text",type:"Data"},{label:"Select",type:"Select"},{label:"Attach",type:"Attach"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Number",type:"Int"},{label:"TextArea",type:"Text"}],rt=[{label:"Text",type:"Data"},{label:"Time",type:"Time"},{label:"Text Area",type:"Text"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Attach",type:"Attach"},{label:"Phone",type:"Data"},{label:"Check",type:"Check"},{label:"Number",type:"Int"},{label:"Select",type:"Select"},{label:"Multi Select",type:"Small Text"},{label:"Link",type:"Link"}],Ys=se(()=>[$e,...le.value]),Ks=se(()=>{const s=v.value.accessible_departments;return s.includes($e)?"All Selected":s.length>1?`${s[0]}.. +${s.length-1} more selected`:s.join(", ")}),Qs=s=>s===$e?v.value.accessible_departments.length===le.value.length:v.value.accessible_departments.includes(s),Xs=(s,e)=>{s===$e?e.target.checked?v.value.accessible_departments=[...le.value]:v.value.accessible_departments=[]:(e.target.checked?v.value.accessible_departments.push(s):v.value.accessible_departments=v.value.accessible_departments.filter(l=>l!==s),v.value.accessible_departments.length===le.value.length?v.value.accessible_departments=[...le.value]:v.value.accessible_departments=v.value.accessible_departments.filter(l=>l!==$e))},xs=s=>{s===$e&&(v.value.accessible_departments=[...le.value])},Is=s=>{s===$e&&(v.value.accessible_departments=[])},kt=h(!1),je=se(()=>{var e;let s=[...ne.value];if(Le.value&&(s=s.filter(l=>l.is_hod===1)),(e=Me.value)!=null&&e.trim()){const l=Me.value.toLowerCase();s=s.filter(o=>o.role.toLowerCase().includes(l))}return s.sort((l,o)=>l.role.localeCompare(o.role)),s.sort((l,o)=>{const n=T.value.includes(l.role),r=T.value.includes(o.role);return n===r?0:n?1:-1}),s.map(l=>l.role)}),el=se(()=>{const s=je.value;return s.length>0&&s.every(e=>T.value.includes(e))});Ce([T,je],()=>{const s=je.value;kt.value=s.length>0&&s.every(e=>T.value.includes(e))},{immediate:!0,deep:!0});function tl(s){const e=s.target.checked,l=ne.value.filter(o=>{var n;return!(Le.value&&o.is_hod!==1||(n=Me.value)!=null&&n.trim()&&!o.role.toLowerCase().includes(Me.value.toLowerCase()))}).map(o=>o.role);e?T.value=Array.from(new Set([...T.value,...l])):T.value=T.value.filter(o=>!l.includes(o)),kt.value=e}function sl(){T.value=[],kt.value=!1,Le.value=!1}const de=h("");function ll(){const s=m[O.value];if(!s||!s.sections){console.error("Error: Invalid block or sections not found.");return}let e={type:O.value==0?"requestor":"approver",roles:T.value,approval_required:Qe.value,approver_can_edit:Xe.value,fields:s.sections.flatMap(At),idx:O.value};O.value!==0&&(e.view_only_reportee=de.value==="ViewOnlyReportee"?1:0,e.all_approvals_required=de.value==="all_approvals_required"?1:0,e.requester_as_a_approver=de.value==="requester_as_a_approver"?1:0,e.on_rejection=Ae.value?Ae.value:0);const l=H.findIndex(o=>o.idx===e.idx);l!==-1?H[l]=e:H.push(e),nl()}function B(s){return H.find(e=>e.idx===s)||{roles:[]}}function ol(s){const e=B(s),l=e.roles||[];T.value=[...l],Ae.value=e.on_rejection,Qe.value=e.approval_required,Xe.value=e.approver_can_edit,e.view_only_reportee===1?de.value="ViewOnlyReportee":e.all_approvals_required===1?de.value="all_approvals_required":e.requester_as_a_approver===1?de.value="requester_as_a_approver":de.value=""}const Ct=s=>{Le.value=!1,Me.value="",de.value="",Ae.value="",v.value.accessible_departments.length&&al(s,v.value.accessible_departments),O.value=s,ol(s)};function al(s,e){let l={index:s,departments:e,property:v.value.business_unit};z.post(W.addDesignationroles,l).then(o=>{o.message&&(ne.value=o.message)}).catch(o=>{console.error("Error fetching designations data:",o)})}function nl(){z.post(W.add_roles_WF,{workflow_setup:H,doctype:v.value.form_short_name,business_unit:v.value.business_unit}).then(s=>{console.log(s),O.value==0?pe("Requestor Added"):pe(`Approver-${O.value} Added`)})}function il(){E.push({path:x.value.routepath||localStorage.getItem("routepath")}),localStorage.removeItem("form_json")}function rl(){v.value.form_name="",v.value.form_short_name="",v.value.owner_of_the_form="",v.value.business_unit="",v.value.form_category="",v.value.accessible_departments=[]}const dl=s=>{if(mt.value){ae("Please check all required fields before proceeding.");return}s<$.value?ut():s>$.value&&dt()},dt=()=>{if(mt.value){ae("Please check all required fields before proceeding.");return}$.value<5&&($.value+=1,$.value===5&&(ft.value=m))},ut=()=>{$.value>1&&($.value-=1)},ul=h([]);function Pt(){const s={fields:JSON.stringify(["*"]),limit_page_length:"none",doctype:ce.EzyFormDefinitions,doc_id:U.value};z.get(W.GetDoctypeData,{params:s}).then(e=>{var o;let l=e==null?void 0:e.message.data;if(l){l.accessible_departments&&(l.accessible_departments=l.accessible_departments.split(",")),v.value=ke(te(te({},v.value),l),{owner_of_the_form:l.owner_of_the_form||v.value.owner_of_the_form||""});const n=JSON.parse((o=e.message.data)==null?void 0:o.form_json);rs.value=n.workflow,us.value=n.fields.filter(d=>d.fieldtype==="Table"),ul.value=n.fields.filter(d=>d.fieldtype==="Table"),Ee.value=e.message.data.is_landscape;let r=It(JSON.parse(l==null?void 0:l.form_json).fields);ee.value=JSON.parse(e.message.data.form_json).child_table_fields,Es.value=[],ds.value=[],r.forEach((d,c)=>{m.push(d)}),JSON.parse(l==null?void 0:l.form_json).workflow.forEach((d,c)=>{H.push(d)})}}).catch(e=>{console.error("Error fetching  data:",e)})}function cl(){const s={};ot.value&&(s.print_format=ot.value),Ee.value!==void 0&&Ee.value!==null&&(s.is_landscape=Ee.value),z.put(W.resource+ce.EzyFormDefinitions+`/${F.query.id}`,s).then(e=>{console.log(e),bootstrap.Modal.getInstance(document.getElementById("customFormatModal")).hide(),pe("Print Format Added Successfully")}).catch(e=>{console.error("Error fetching  data:",e)})}function jt(){const s={fields:JSON.stringify(["name","department_name"]),limit_page_length:"none",business_unit:`${x.value.business_unit||F.query.business_unit}`,doctype:ce.departments};z.get(W.GetDoctypeData,{params:s}).then(e=>{var l;(l=e==null?void 0:e.message.data)!=null&&l.length&&(Se.value=e.message.data.map(o=>o.name),le.value=e.message.data.map(o=>o.name))}).catch(e=>{console.error("Error fetching department data:",e)})}h(""),Ce(()=>v.value.owner_of_the_form,s=>{s&&Dt(s)});function Dt(s){s&&typeof s=="string"&&s.trim()!==""&&pl(s)}function pl(s){const e={fields:JSON.stringify(["ezy_departments_items"]),doctype:ce.departments,doc_id:s};z.get(W.GetDoctypeData,{params:e}).then(l=>{var o;(o=l==null?void 0:l.message.data)!=null&&o.ezy_departments_items&&(re.value=l.message.data.ezy_departments_items.map(n=>n.category))}).catch(l=>{console.error("Error fetching categories data:",l)})}function Ft(s){let e=Zl(m);const l=ke(te({},v.value),{fields:e,doctype:ce.EzyFormDefinitions,workflow_setup:H,form_status:s==="save"?"Created":"Draft"});l.accessible_departments=l.accessible_departments.toString(),z.post(W.savedata,l).then(o=>{if(o&&o.message&&o.message.message){let n=localStorage.getItem("preName");if(n){let r={installed:"Yes"};z.put(`${W.resource}${ce.preDefinedForm}/${n}`,r).then(d=>{localStorage.removeItem("preName")}).catch(d=>{console.error("Error fetching ezyForms data:",d)})}if(E.push({params:{paramid:o.message.message},query:{id:o.message.message}}),U.value=o.message.message,U&&U!=="new"&&(m.splice(0,m.length),Pt()),H.length<m.length)qt("Add Workflow");else if(Wt.value===!0){pe("Form Created Successfully!",{autoClose:2e3,transition:"zoom"});let r=localStorage.getItem("routepath");s==="save"?E.push({path:r}):s==="Draft"&&E.push({path:r})}}else console.error("Invalid response structure:",o)}).catch(o=>{console.error("Error saving form data:",o)})}const ct=h(""),pt=()=>{var l,o;const s=m.length,e={label:s===0?"requestor":`approver-${s}`,parent:`${(l=Ve.value)==null?void 0:l.value}-${(o=v.value)==null?void 0:o.form_short_name}`,sections:[{label:"",parent:`${Ve.value.value}-${v.value.form_short_name}`,childTables:[],afterCreated:{},rows:s===0?[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Requested By",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Requested On",fieldtype:"Datetime",options:"",reqd:!1}]}]},{label:`row_0_1_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1,description:""}]}]}]:[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Approver",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved On",fieldtype:"Datetime",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved By",fieldtype:"Attach",options:"",reqd:!1}]}]}]}]};m.push(e),Jl(()=>{ct.value&&ct.value.scrollTo({top:ct.value.scrollHeight,behavior:"smooth"})})},Wt=h(!1),Ht=s=>{let e=m[s];e.parent&&G.push(e);let l=[];H.length>s&&H[s].roles&&(l=[...H[s].roles]),m.splice(s,1),H.length>s&&H.splice(s,1),m.forEach((o,n)=>{o.sections.forEach((r,d)=>{r.rows.forEach((c,f)=>{c.columns.forEach((u,p)=>{ue(n,d,f,p)})})})}),l.length&&ml(l,s)};function ml(s,e){const l={role:s,level:e,document_type:v.value.form_name,short_name:v.value.form_short_name,property:v.value.business_unit};z.post(W.deleteAssigneRoles,l).then(o=>{o&&Ft()})}const fl=(s,e)=>{const l={label:"",parent:`${Ve.value.value}-${v.value.form_short_name}`,rows:[{label:`row_0_${e}_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]}]}]};m[s].sections.splice(e+1,0,l)},vl=(s,e)=>{let l=m[s].sections[e];l.parent&&G.push(l),m[s].sections.splice(e,1),m[s].sections.forEach((o,n)=>{o.rows.forEach((r,d)=>{r.columns.forEach((c,f)=>{ue(s,n,d,f)})})})},bl=(s,e,l)=>{m[s].sections[e].rows[l].columns.push({label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]})},_l=(s,e,l,o)=>{const r=m[s].sections[e].rows[l].columns,d=r[o];d.parent&&G.push(d),r.length===1?m[s].sections[e].rows.splice(l,1):r.splice(o,1),m[s].sections.forEach((c,f)=>{c.rows.forEach((u,p)=>{u.columns.forEach((w,L)=>{ue(s,f,p,L)})})})},hl=(s,e,l,o)=>{m[s].sections[e].rows[l].columns[o].fields.push({label:"",fieldtype:"",options:"",reqd:!1})},gl=(s,e,l,o,n)=>{let r=m[s].sections[e].rows[l].columns[o].fields[n];r.parent&&G.push(r),m[s].sections[e].rows[l].columns[o].fields.splice(n,1)},yl=(s,e,l,o,n)=>{const r=m[s].sections[e].rows[l].columns[o].fields[n],d=te({},r);d.name=`${r.name} Name the field`,m[s].sections[e].rows[l].columns[o].fields.splice(n+1,0,d)},wl=(s,e,l,o,n)=>{const r=ns(m);m.splice(0,m.length,...r);let d=m[s].sections[e].rows[l].columns[o].fields[n].fieldtype;(d!=="Select"||d!=="radio"||d!=="multiselect")&&(m[s].sections[e].rows[l].columns[o].fields[n].options="")};function kl(s){return at.includes(s==null?void 0:s.trim().toLowerCase())}function Cl(s){return/[^a-zA-Z0-9 _\/!@#$%^&*()?.:;|/\\[\]{}]/.test(s)||s.includes('"')||s.includes("'")}function Dl(s){return s.flatMap(e=>{var l;return[(l=e.label)==null?void 0:l.trim().toLowerCase(),...e.sections.flatMap(o=>{var n;return[(n=o.label)==null?void 0:n.trim().toLowerCase(),...o.rows.flatMap(r=>r.columns.flatMap(d=>{var c;return[(c=d.label)==null?void 0:c.trim().toLowerCase(),...d.fields.map(f=>{var u;return(u=f.label)==null?void 0:u.trim().toLowerCase()})]}))]})]}).filter(e=>e!==""&&!Rt.includes(e))}function ue(s,e,l,o,n){const d=Dl(m).filter((u,p,w)=>w.indexOf(u)!==p),c=ns(m);m.splice(0,m.length,...c);function f(u,p){if(!u){p.errorMsg="";return}kl(u)?p.errorMsg="Entered label is restricted":Cl(u)?p.errorMsg=`Label should not contain special characters, double quotes (") or single quotes (')`:u.length>64?p.errorMsg="Label should not exceed 64 characters":p.errorMsg=d.includes(u.trim().toLowerCase())?"Duplicate Label Name":""}n!==void 0&&f(m[s].sections[e].rows[l].columns[o].fields[n].label,m[s].sections[e].rows[l].columns[o].fields[n]),n===void 0&&o!==void 0&&f(m[s].sections[e].rows[l].columns[o].label,m[s].sections[e].rows[l].columns[o]),o===void 0&&n===void 0&&f(m[s].sections[e].label,m[s].sections[e]),m.forEach(u=>{u.sections.forEach(p=>{f(p.label,p),p.rows.forEach(w=>{w.columns.forEach(L=>{f(L.label,L),L.fields.forEach(y=>{f(y.label,y)})})})})})}const $t=se(()=>{function s(e){return!e||typeof e!="object"?!1:"fieldtype"in e&&e.fieldtype===""||"error"in e&&e.error||"errorMsg"in e&&e.errorMsg||["Select","Table MultiSelect"].includes(e.fieldtype)&&(!e.options||e.options.trim()==="")?!0:Array.isArray(e)?e.some(s):Object.values(e).some(s)}return s(m)}),mt=se(()=>Y.value.length>0||K.value.length>0||!v.value.form_category||!v.value.owner_of_the_form||v.value.accessible_departments.length===0),Fl=se(()=>m.some(s=>s.sections.some(e=>e.rows.some(l=>l.columns.some(o=>o.fields.some(n=>n.label&&n.fieldtype))))));function Jt(s,e){let l=s.target.value.trim();if(!l){e==="form_name"?Y.value="Input cannot be empty or only spaces":e==="form_short_name"&&(K.value="Input cannot be empty or only spaces");return}if(l.length>63){e==="form_name"?Y.value="Name cannot exceed 63 characters":e==="form_short_name"&&(K.value="Short name cannot exceed 63 characters");return}if(/^\d/.test(l)){e==="form_short_name"&&(K.value="First character must be a letter");return}else K.value="";if(e==="form_short_name"&&l.length<2){K.value="Short name must have at least 2 letters";return}if(e==="form_short_name"&&/[^a-zA-Z ]/.test(l)){K.value="Only alphabets and spaces are allowed";return}if(/[^a-zA-Z0-9& ]/.test(l)){e==="form_name"?Y.value="Special characters are not allowed":e==="form_short_name"&&(K.value="Special characters are not allowed");return}else e==="form_name"?Y.value="":e==="form_short_name"&&(K.value="");const o=[[e,"=",`${l}`],["business_unit","=",`${v.value.business_unit}`]],n={fields:JSON.stringify(["form_name","form_short_name"]),filters:JSON.stringify(o),doctype:ce.EzyFormDefinitions};z.get(`${W.GetDoctypeData}`,{params:n}).then(r=>{I.value=r.message.data,e==="form_name"?Y.value=l&&I.value.some(d=>d.form_name&&d.form_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Name already exists":"":e==="form_short_name"&&(K.value=l&&I.value.some(d=>d.form_short_name&&d.form_short_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Short name already exists":"")}).catch(r=>{console.error("Error fetching ezyForms data:",r),e==="form_name"?Y.value="":e==="form_short_name"&&(K.value="")})}const $l=s=>s===0?"1st row":s===1?"2nd row":s===2?"3rd row":`${s+1}th row`,ft=h([]),Sl=()=>{m.length&&(ft.value=m,new bootstrap.Modal(document.getElementById("formViewModal")).show())};function Al(){z.post(W.delete_form_items,{deleted_fields:G.flatMap(At),doctype:U}).then(s=>{var e;(e=s==null?void 0:s.message)!=null&&e.success&&Ft()})}function Zt(s){return Ue(this,null,function*(){if($t.value){ae("Please fix the errors before proceeding.");return}Wt.value=!0;let e=G.flatMap(At);U!=null&&U!=null&&U!="new"&&e.length?Al():Ft(s)})}const ql=()=>{tt.value.push({role:"",autoApproval:!1,permissions:{}})},Vl=s=>{tt.value.splice(s,1)},El=s=>{qt("Permission configuration modal will be implemented here")},Gt=()=>Ue(this,null,function*(){var s;if(!(Oe.value.length>0))try{const e={doctype:"WF Roadmap",fields:JSON.stringify(["name","roadmap_title","document_type","workflow_levels","property","cluster_name"]),filters:JSON.stringify([])},l=yield z.get(W.GetDoctypeData,{params:e});(s=l==null?void 0:l.message)!=null&&s.data&&(Oe.value=l.message.data.map(o=>({roadmap_title:o.name,display_name:`${o.roadmap_title} (${o.document_type})`,document_type:o.document_type,workflow_levels:o.workflow_levels,property:o.property,cluster_name:o.cluster_name})),console.log("Fetched WF Road Maps:",Oe.value))}catch(e){console.error("Error fetching WF Road Maps:",e),ae("Failed to fetch workflow road maps")}}),Yt=s=>Ue(this,null,function*(){var e;if(s){console.log("Selected WF Road Map:",s);try{const l=yield z.get(`/api/resource/WF Roadmap/${s.roadmap_title}`);if((e=l==null?void 0:l.data)!=null&&e.data){const o=l.data.data;if(console.log("Full Roadmap Data:",o),o.wf_requestors&&o.wf_requestors.length>0&&(st.value=o.wf_requestors,m.length>0&&m[0].sections&&m[0].sections.length>0&&(ht.value=[],m[0].sections.forEach(n=>{n.rows.forEach(r=>{r.forEach(d=>{d.fields&&d.fields.forEach(c=>{ht.value.push({label:c.label,fieldtype:c.fieldtype})})})})})),m.length===0&&pt(),qt(`Workflow loaded: ${o.wf_requestors.length} requestor(s), ${o.workflow_levels} approval level(s)`)),o.wf_level_setup&&o.wf_level_setup.length>0){const n=o.wf_level_setup;Be.value=n;const r=1+o.workflow_levels;for(;m.length<r;)pt();H.length=0,H.push({type:"requestor",roles:[]}),n.forEach((d,c)=>{H.push({type:"approver",level:d.level,roles:[d.role],approval_required:d.mandatory?"1":"0",approver_can_edit:"0",view_only_reportee:d.view_only_reportee||0,all_approvals_required:d.all_approvals_required||0,requester_as_a_approver:d.requester_as_a_approver||0,on_rejection:d.on_rejection||"",fields:[]})}),pe(`Loaded workflow: ${o.workflow_levels} approval level(s) configured`)}}}catch(l){console.error("Error loading WF Road Map details:",l),ae("Failed to load workflow configuration")}}}),Ll=s=>{console.log("Field added from library:",s);const e=et.value,l=m[e];if(!l){ae("Please create a block first before adding fields");return}const o=Kt(s);if(!o)return;l.sections||(l.sections=[]),l.sections.length===0&&l.sections.push({label:"",rows:[[{label:"",fields:[]}]]});const d=l.sections[0].rows[0][0];d.fields||(d.fields=[]),d.fields.push(o),console.log("Field added successfully:",o),pe(`${o.label} field added successfully`)},Tl=s=>{console.log("Drag started:",s),_e.value=s},Ul=()=>{console.log("Drag ended")},Kt=s=>{console.log("Creating field from Frappe type:",s);const e=rt.find(r=>r.type===s);if(!e)return console.error("Field type not found:",s),console.error("Available types:",rt.map(r=>r.type)),ae(`Field type "${s}" not found. Please try again.`),null;const l=Date.now(),o=Math.random().toString(36).substring(2,6),n=`field_${l}_${o}`;return{id:`field_${l}_${o}`,fieldname:n,label:e.label,fieldtype:e.type,options:"",reqd:0,read_only:0,hidden:0,description:"",default:"",placeholder:""}};return(s,e)=>(a(),i("div",null,[t("div",eo,[t("div",to,[t("div",so,[t("div",lo,[t("div",{class:"ps-1 my-2 d-flex align-items-center",onClick:e[0]||(e[0]=l=>il())},e[43]||(e[43]=[t("button",{class:"btn font-13 ms-3"},[t("i",{class:"bi bi-arrow-left"}),t("span",{class:"ms-2"},"Back")],-1)])),s.$route.query.id||s.$route.query.preId?(a(),i("span",oo,"("+_(x.value.formId||S(F).query.form_name)+")",1)):b("",!0)]),t("div",null,[$.value===2&&S(m).length&&!s.$route.query.id?(a(),i("button",{key:0,disabled:$t.value||mt.value,style:Wl({cursor:$t.value?"not-allowed":"pointer"}),type:"butoon",class:"btn font-13 btn-light",onClick:e[1]||(e[1]=l=>Zt("Draft"))},e[44]||(e[44]=[t("i",{class:"bi bi-bookmark-check-fill"},null,-1),k(" Save As Draft ")]),12,ao)):b("",!0)])]),t("div",no,[t("div",io,[t("div",ro,[t("div",uo,[t("ul",co,[(a(!0),i(q,null,V(Gs.value,l=>(a(),i("li",{key:l.id,class:N({active:$.value===l.id,completed:$.value>l.id})},[t("div",{class:N(["d-flex gap-3 align-items-center",{"not-allowed":mt.value&&$.value+1===l.id}]),onClick:o=>dl(l.id)},[$.value>l.id?(a(),i("i",mo)):(a(),i("i",{key:1,class:N(l.icon)},null,2)),t("div",fo,[t("span",vo,_(l.stepno),1),e[45]||(e[45]=t("br",null,null,-1)),t("span",bo,_(l.label),1)])],10,po)],2))),128))])])]),t("div",_o,[t("div",ho,[t("div",go,[$.value===1?(a(),i("div",yo,[t("div",wo,[t("div",ko,[e[46]||(e[46]=t("div",null,null,-1)),e[47]||(e[47]=t("h1",{class:"font-14 fw-bold m-0"},"Form Info",-1)),t("div",null,[!s.$route.query.id&&!s.$route.query.preId?(a(),i("button",{key:0,class:"btn btn-light font-12 mx-2",type:"button",onClick:rl},"Clear Form")):b("",!0),$.value<5?(a(),es(ts,{key:1,class:"btn btn-dark bg-dark text-white fw-bold font-13",name:"Next",onClick:dt})):b("",!0)])])]),t("div",Co,[t("div",Do,[e[63]||(e[63]=t("div",{class:"col-sm-none col-md-4"},null,-1)),t("div",Fo,[t("div",$o,[t("div",So,[t("div",Ao,[t("div",qo,[S(F).query.preId?(a(),i("span",Vo,e[48]||(e[48]=[k("Predefined "),t("i",{class:"bi bi-check2-circle"},null,-1)]))):b("",!0),X(Ke,{disabled:(x.value.formId&&x.value.formId.length>0||S(F).query.form_name)&&ye.value!=="1",labeltext:"Form Name",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formName",validationStar:"true",placeholder:"Untitled Form",onChange:e[2]||(e[2]=l=>Jt(l,"form_name")),modelValue:Ut.value,"onUpdate:modelValue":e[3]||(e[3]=l=>Ut.value=l)},null,8,["disabled","modelValue"]),Y.value?(a(),i("span",Eo,_(Y.value),1)):b("",!0)])]),t("div",Lo,[X(Ke,{disabled:(x.value.formId&&x.value.formId.length>0||S(F).query.form_name)&&ye.value!=="1",labeltext:"Form Short Code",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formShortCode",validationStar:"true",placeholder:"Untitled Form",onChange:e[4]||(e[4]=l=>Jt(l,"form_short_name")),modelValue:v.value.form_short_name,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value.form_short_name=l)},null,8,["disabled","modelValue"]),K.value?(a(),i("span",To,_(K.value),1)):b("",!0)]),t("div",Uo,[X(Ke,{disabled:x.value.formId&&x.value.formId.length>0&&ye.value!=="1",labeltext:"Form Naming series",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Naming series",modelValue:v.value.series,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value.series=l)},null,8,["disabled","modelValue"]),e[49]||(e[49]=ss('<small class="text-muted" style="font-size:12px;" data-v-20cd2ab0> Note : Enter <code data-v-20cd2ab0>YY-YY</code>, <code data-v-20cd2ab0>YYYY</code>, or <code data-v-20cd2ab0>ABC</code>. The system will default to the format <code data-v-20cd2ab0> 24-25-0001</code>, <code data-v-20cd2ab0> 2025-0001</code>, or <code data-v-20cd2ab0> ABC-0001</code> respectively. </small>',1))]),t("div",Ro,[t("label",null,[e[50]||(e[50]=k("Owner Of The Form ")),v.value.owner_of_the_form?b("",!0):(a(),i("span",Mo,"*"))]),X(S(De),{disabled:x.value.formId&&x.value.formId.length>0&&ye.value!=="1",onOpen:jt,options:Se.value,onChange:Dt,modelValue:v.value.owner_of_the_form,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value.owner_of_the_form=l),placeholder:"Select Department",multiple:!1,class:"font-11 multiselect",searchable:!0,openDirection:"bottom"},null,8,["disabled","options","modelValue"])]),t("div",Oo,[t("label",null,[e[51]||(e[51]=k("Form Category ")),v.value.form_category?b("",!0):(a(),i("span",Bo,"*"))]),X(S(De),{disabled:x.value.formId&&x.value.formId.length>0&&ye.value!=="1",options:re.value,modelValue:v.value.form_category,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value.form_category=l),placeholder:"Select Category",multiple:!1,searchable:!0,class:"font-11 multiselect"},null,8,["disabled","options","modelValue"])]),t("div",zo,[t("label",null,[e[52]||(e[52]=k("Accessible to Department ")),v.value.accessible_departments.length?b("",!0):(a(),i("span",No,"*"))]),X(S(De),{modelValue:v.value.accessible_departments,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value.accessible_departments=l),options:Ys.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Select Department",class:"font-11",onSelect:xs,onRemove:Is,openDirection:"bottom"},{option:ls(({option:l})=>[t("div",Po,[t("input",{type:"checkbox",checked:Qs(l),class:"custom-checkbox",onChange:o=>Xs(l,o),onClick:e[9]||(e[9]=ie(()=>{},["stop"]))},null,40,jo),t("span",null,_(l),1)])]),selection:ls(({values:l,isOpen:o})=>[l.length?D((a(),i("span",{key:0,class:"multiselect__single font-10"},_(Ks.value),513)),[[bt,!o]]):b("",!0)]),_:1},8,["modelValue","options"])]),t("div",Wo,[e[53]||(e[53]=t("label",null,"Form Type",-1)),X(S(De),{options:Lt,modelValue:Tt.value,"onUpdate:modelValue":e[11]||(e[11]=l=>Tt.value=l),placeholder:"Select Form Type",multiple:!1,searchable:!0,label:"label","track-by":"value",reduce:l=>l.value,class:"font-11 multiselect",openDirection:"top"},null,8,["modelValue","reduce"]),e[54]||(e[54]=t("small",{class:"text-muted font-12 ms-2"},"Note: Public form is accessible by anyone through QR code.",-1))]),t("div",Ho,[e[55]||(e[55]=t("label",null,[k("Has Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(S(De),{options:["Yes","No"],modelValue:v.value.has_workflow,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.has_workflow=l),placeholder:"Select",multiple:!1,class:"font-11 multiselect",searchable:!0},null,8,["modelValue"])]),v.value.has_workflow==="Yes"?(a(),i("div",Jo,[e[56]||(e[56]=t("label",null,[k("Use Existing Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(S(De),{onOpen:Gt,options:Oe.value,modelValue:me.value,"onUpdate:modelValue":e[13]||(e[13]=l=>me.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:Yt,openDirection:"bottom"},null,8,["options","modelValue"]),e[57]||(e[57]=t("small",{class:"text-muted font-12 ms-2"},[t("i",{class:"bi bi-info-circle me-1"}),k(" Select to auto-populate requestor and approver configurations ")],-1))])):b("",!0),v.value.as_web_view===1?(a(),i("div",Zo,[e[58]||(e[58]=t("label",null,[k("Form Submit Response "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(Ke,{class:"formHeight mt-2",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Submit Response",modelValue:v.value.public_form_response,"onUpdate:modelValue":e[14]||(e[14]=l=>v.value.public_form_response=l)},null,8,["modelValue"])])):b("",!0),v.value.as_web_view===1?(a(),i("div",Go,[e[59]||(e[59]=t("label",null,[k("Submit Notification Email "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(Ke,{class:"formHeight mt-2",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Submit mail",modelValue:v.value.mail_id,"onUpdate:modelValue":e[15]||(e[15]=l=>v.value.mail_id=l)},null,8,["modelValue"]),e[60]||(e[60]=t("small",{class:"text-muted font-12 ms-2"},"Note : If multiple Emails, separate with commas (,).",-1))])):b("",!0),S(F).query.preId?(a(),i("div",Yo,[t("div",Ko,[D(t("input",{class:"form-check-input linketoCheck p-1",disabled:v.value.is_predefined_doctype==1,type:"checkbox",id:"is_linked","onUpdate:modelValue":e[16]||(e[16]=l=>v.value.is_linked=l),"true-value":1,"false-value":0},null,8,Qo),[[Fe,v.value.is_linked]]),e[61]||(e[61]=t("label",{class:"form-check-label font-12 mx-2 mb-0 ps-1",for:"is_linked"}," Link ",-1))])])):b("",!0),v.value.is_linked?(a(),i("div",Xo,[e[62]||(e[62]=t("label",{for:"standardFormInput"},"Form",-1)),D(t("input",{type:"text",class:"form-control standardFormInput",id:"standardFormInput",disabled:v.value.is_predefined_doctype==1,"onUpdate:modelValue":e[17]||(e[17]=l=>v.value.is_linked_form=l),placeholder:"Type to search Form Name...",onInput:fs,onFocus:e[18]||(e[18]=l=>Ie.value=!0),onBlur:bs},null,40,xo),[[M,v.value.is_linked_form]]),Ie.value&&xe.value.length?(a(),i("ul",Io,[(a(!0),i(q,null,V(xe.value,(l,o)=>(a(),i("li",{class:"list-group-item formlistitem",key:o,onMousedown:ie(n=>vs(l.name),["prevent"])},_(l.name),41,ea))),128))])):b("",!0)])):b("",!0)])])]),e[64]||(e[64]=t("div",{class:"col-sm-none col-md-4"},null,-1))])])])):b("",!0),$.value===2?(a(),i("div",ta,[t("div",sa,[t("div",la,[t("button",{onClick:e[19]||(e[19]=l=>ut()),class:"btn btn-sm btn-light"},e[65]||(e[65]=[t("i",{class:"bi bi-chevron-left"},null,-1),k(" Back ")]))]),t("div",oa,[(a(!0),i(q,null,V(S(m),(l,o)=>(a(),i("button",{key:o,class:N(["zoho-tab",{active:et.value===o}]),onClick:n=>et.value=o},[e[66]||(e[66]=t("i",{class:"bi bi-file-earmark-text me-1"},null,-1)),k(" "+_(o===0?"Requestor Block":`Approver Block ${o}`)+" ",1),S(m).length>1?(a(),i("i",{key:0,class:"bi bi-x-lg ms-2",onClick:ie(n=>Ht(o),["stop"])},null,8,na)):b("",!0)],10,aa))),128))]),t("div",ia,[t("button",{class:"btn btn-sm btn-primary me-2",onClick:pt},e[67]||(e[67]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),k("Add Block ")])),Fl.value?(a(),i("button",{key:0,class:"btn btn-sm btn-light me-2",onClick:Sl},e[68]||(e[68]=[t("i",{class:"bi bi-eye me-1"},null,-1),k("Preview ")]))):b("",!0),S(m).length?(a(),i("button",{key:1,class:"btn btn-sm btn-dark",onClick:e[20]||(e[20]=l=>Zt("save"))},_(S(U)!=="new"?"Update Form":"Create Form"),1)):b("",!0)])]),t("div",ra,[t("aside",{class:N(["zoho-field-library",{collapsed:!qe.value}])},[t("div",{class:"library-header",onClick:e[21]||(e[21]=l=>qe.value=!qe.value)},[t("div",da,[t("h6",ua,[e[69]||(e[69]=t("i",{class:"bi bi-grid-3x3-gap me-2"},null,-1)),k(" "+_(qe.value?"Field Types":"Fields"),1)]),t("button",ca,[t("i",{class:N(qe.value?"bi bi-chevron-left":"bi bi-chevron-right")},null,2)])])]),qe.value?(a(),i("div",pa,[X(Il,{fields:rt,onFieldAdd:Ll,onFieldDragstart:Tl,onFieldDragend:Ul})])):b("",!0)],2),t("div",ma,[t("div",{class:"canvas-inner",ref_key:"mainBlockRef",ref:ct},[(a(!0),i(q,null,V(S(m),(l,o)=>D((a(),i("div",{class:"block-level",key:o},[t("div",fa,[t("div",va,[t("div",ba,[t("h6",_a,_(o===0?"Requestor Block":`Approver
                                  Block ${o}
                                  `),1),t("div",ha,[o!==0&&B(o).view_only_reportee||B(o).all_approvals_required||B(o).requester_as_a_approver?(a(),i("div",ga,[t("span",ya,_(B(o).view_only_reportee===1?"Reporting Manager only":"")+" "+_(B(o).all_approvals_required===1?"All of the selected approvers":"")+" "+_(B(o).requester_as_a_approver===1?"Approval by Requestor":""),1),t("span",null,[e[70]||(e[70]=t("span",{class:"ms-1"}," on rejection escalating to ",-1)),t("span",wa,_(B(o).on_rejection?`Level ${B(o).on_rejection}`:"Requestor"),1)]),t("span",ka,_(B(o).all_approvals_required===1?"":"(Skipping multi approval)"),1)])):b("",!0)])]),t("div",Ca,[S(U)&&S(H).length?(a(),i("div",Da,[B(o)?(a(),i("label",Fa,[t("span",$a,_(B(o).roles.length>0?o===0?"Requestor: ":"Approver: ":""),1),t("span",Sa,_(B(o).roles.slice(0,2).join(", ")),1),B(o).roles.length>2?(a(),i("span",{key:0,"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:n=>Ct(o),class:"more-count"}," +"+_(B(o).roles.length-2)+" more ",9,Aa)):b("",!0)])):b("",!0)])):b("",!0),ps(o)&&S(U)!=null&&S(U)!=null&&S(U)!="new"&&B(o).roles.length===0?(a(),i("button",{key:1,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:n=>Ct(o)},[e[71]||(e[71]=t("img",{src:Gl,alt:"Add",class:"me-1"},null,-1)),k(" "+_(o===0?"Add Requestors":"Add Approvers"),1)],8,qa)):b("",!0),S(U)!=null&&S(U)!=null&&S(U)!="new"&&B(o).roles.length>0?(a(),i("button",{key:2,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:n=>Ct(o)},e[72]||(e[72]=[t("i",{class:"bi bi-pencil font-14"},null,-1)]),8,Va)):b("",!0),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteBlock",onClick:n=>Ht(o)},e[73]||(e[73]=[t("i",{class:"bi bi-trash me-1"},null,-1),k(" Delete Block ")]),8,Ea)])])]),t("div",La,[(a(!0),i(q,null,V(l.sections,(n,r)=>(a(),i("div",{key:"section-"+r,class:"dynamicSection mt-0 section"},[t("section",Ta,[t("div",Ua,[D(t("input",{"onUpdate:modelValue":d=>n.label=d,type:"text",class:N(["border-less-input","font-14",{"italic-style":!n.label},{"fw-medium":n.label}]),onChange:d=>ue(o,r),onInput:d=>ue(o,r),placeholder:"Untitled section"},null,42,Ra),[[M,n.label]]),n.errorMsg?(a(),i("small",Ma,_(n.errorMsg),1)):b("",!0)]),t("div",Oa,[t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:d=>vl(o,r)},e[74]||(e[74]=[t("i",{class:"bi bi-trash me-1"},null,-1),k(" Delete Section ")]),8,Ba)])]),t("div",za,[(a(!0),i(q,null,V(n.rows,(d,c)=>(a(),i("section",{class:"row dynamicRow row-container",key:"row-"+c},[t("div",Na,[t("label",Pa,_($l(c)),1),t("div",null,[d.columns.length<3?(a(),i("button",{key:0,class:"btn btn-light bg-transparent border-0 p-1 font-12",onClick:f=>bl(o,r,c)},e[75]||(e[75]=[t("i",{class:"bi bi-plus font-14"},null,-1),k(" Add Column ")]),8,ja)):b("",!0)])]),t("div",Wa,[t("div",Ha,[(a(!0),i(q,null,V(d.columns,(f,u)=>(a(),i("div",{key:"column-"+u,onMouseenter:p=>Ds(o,r,c,u),onMouseleave:Fs,class:"col p-0 dynamicColumn position-relative column-container"},[t("div",Za,[t("div",Ga,[D(t("input",{"onUpdate:modelValue":p=>f.label=p,type:"text",class:N(["border-less-input","ps-1","font-14","inputHeight",{"italic-style":!f.label},{"fw-medium":f.label}]),onChange:p=>ue(o,r,c,u),onInput:p=>ue(o,r,c,u),placeholder:"Column Name"},null,42,Ya),[[M,f.label]]),f.errorMsg?(a(),i("small",Ka,_(f.errorMsg),1)):b("",!0)]),D(t("div",Qa,[t("button",{class:"btn btn-light bg-transparent me-1 btn-sm",onClick:p=>_l(o,r,c,u)},e[76]||(e[76]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Xa)],512),[[bt,$s(o,r,c,u)]])]),f.fields.length===0?(a(),i("div",{key:0,class:"empty-drop-zone",onDragover:e[22]||(e[22]=ie(()=>{},["prevent"])),onDrop:p=>he(p,o,r,c,u,s.fieldIndex)},null,40,xa)):b("",!0),(a(!0),i(q,null,V(f.fields,(p,w)=>{var L;return a(),i("div",{key:"field-"+w,onMouseenter:y=>ws(o,r,c,u,w),onMouseleave:ks,class:"dynamicField m-1 draggable-item",draggable:"true",onDragstart:y=>Mt(y,o,r,c,u,w),onDragover:e[26]||(e[26]=ie(()=>{},["prevent"])),onDrop:y=>he(y,o,r,c,u,w)},[t("div",{class:"drop-zone",onDragover:e[23]||(e[23]=ie(()=>{},["prevent"])),onDrop:y=>he(y,o,r,c,u,w)},null,40,en),p.fieldtype!=="Table"?(a(),i("div",{key:0,class:"px-1 dynamic_fied field-border",draggable:"true",onDragstart:y=>Mt(y,o,r,c,u,w),onDragover:e[24]||(e[24]=ie(()=>{},["prevent"])),onDrop:y=>he(y,o,r,c,u,w)},[t("div",sn,[t("div",ln,[D(t("input",{"onUpdate:modelValue":y=>p.label=y,placeholder:"Name the field",class:N(["border-less-input","font-14","p-0","inputHeight",{"italic-style":!p.label},{"fw-medium":p.label}]),onChange:y=>ue(o,r,c,u,w),onInput:y=>ue(o,r,c,u,w)},null,42,on),[[M,p.label]]),p.errorMsg?(a(),i("small",an,_(p.errorMsg),1)):b("",!0)]),D(t("div",nn,[t("button",{class:"btn btn-light btn-sm bg-transparent py-0",onClick:y=>yl(o,r,c,u,w)},e[77]||(e[77]=[t("i",{class:"ri-file-copy-line font-13 copyIcon"},null,-1)]),8,rn),t("button",{class:"btn btn-light btn-sm bg-transparent trash-btn py-0",onClick:y=>{gl(o,r,c,u,w),ue(o,r,c,u)}},e[78]||(e[78]=[t("i",{class:"bi bi-x-lg font-13"},null,-1)]),8,dn)],512),[[bt,Cs(o,r,c,u,w)]])]),D(t("select",{"onUpdate:modelValue":y=>p.fieldtype=y,class:"form-select mb-2 mt-1 font-13 searchSelect",onChange:y=>wl(o,r,c,u,w)},[e[79]||(e[79]=t("option",{value:""},"Select Type",-1)),(a(),i(q,null,V(rt,y=>t("option",{key:y,value:y.type},_(y.label),9,cn)),64))],40,un),[[Re,p.fieldtype]]),["Select","Table MultiSelect","Small Text"].includes(p.fieldtype)?(a(),i("div",pn,[e[80]||(e[80]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":y=>p.options=y,class:"form-control shadow-none mb-1 font-12"},null,8,mn),[[M,p.options]]),!p.options||p.options.trim()===""?(a(),i("small",fn," Options are required for this field type. ")):b("",!0)])):b("",!0),p.fieldtype==="Link"?(a(),i("div",vn,[t("label",{class:"font-11 fw-light",for:"link-search-"+ve(o,r,c,u,w)}," Search Doctype: ",8,bn),D(t("input",{id:"link-search-"+ve(o,r,c,u,w),type:"text","onUpdate:modelValue":y=>S(m)[o].sections[r].rows[c].columns[u].fields[w].options=y,onInput:y=>hs(S(m)[o].sections[r].rows[c].columns[u].fields[w].options,o,r,c,u,w),onFocus:y=>_s(ve(o,r,c,u,w)),class:"form-control font-12 mb-1",placeholder:"Type to search..."},null,40,_n),[[M,S(m)[o].sections[r].rows[c].columns[u].fields[w].options]]),(L=Ne[ve(o,r,c,u,w)])!=null&&L.length&&gt[ve(o,r,c,u,w)]?(a(),i("ul",hn,[(a(!0),i(q,null,V(Ne[ve(o,r,c,u,w)],(y,g)=>(a(),i("li",{key:g,onClick:C=>gs(o,r,c,u,w,y.name),class:"list-group-item list-group-item-action"},_(y.name),9,gn))),128))])):b("",!0)])):b("",!0),t("div",yn,[t("div",wn,[t("div",kn,[D(t("input",{class:"font-12","onUpdate:modelValue":y=>p.reqd=y,"true-value":1,id:"mandatory-"+o+"-"+r+"-"+c+"-"+u+"-"+w,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,8,Cn),[[Fe,p.reqd]])]),t("div",null,[t("label",{class:"font-12 m-0 fw-light",for:"mandatory-"+o+"-"+r+"-"+c+"-"+u+"-"+w},"Mandatory",8,Dn)])]),t("div",null,[t("button",{class:"btn btn-sm font-12",onClick:y=>p.showDescription=!p.showDescription},_(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Fn)])]),p.showDescription?D((a(),i("textarea",{key:2,"onUpdate:modelValue":y=>p.description=y,class:"form-control font-12 mt-2",placeholder:"Enter field description"},null,8,$n)),[[M,p.description]]):b("",!0),p.error?(a(),i("small",Sn,_(p.error),1)):b("",!0)],40,tn)):b("",!0),t("div",{class:"drop-zone",onDragover:e[25]||(e[25]=ie(()=>{},["prevent"])),onDrop:y=>he(y,o,r,c,u,w)},null,40,An),t("div",qn,[t("div",null,[t("div",null,[t("div",Vn,[p.fieldtype==="Table"?(a(),i("div",En,[(a(!0),i(q,null,V(ee.value,(y,g)=>(a(),i("div",{key:g,class:"childTable"},[g===p.fieldname||g===p.options?(a(),i("h5",Ln,_(g.replace(/_/g," ")),1)):b("",!0),P[g]&&g===zt.value?(a(),i("div",Tn,[t("div",Un,[p.showDescription?D((a(),i("input",{key:0,"onUpdate:modelValue":C=>p.description=C,class:"form-control font-12",placeholder:"Enter field description"},null,8,Rn)),[[M,p.description]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:C=>p.showDescription=!p.showDescription},_(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Mn)])])):b("",!0),g===p.options||g===p.fieldname?(a(),i("table",On,[e[84]||(e[84]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",{onDragover:ie(qs,["prevent"]),onDrop:C=>Vs(C,y)},[(a(!0),i(q,null,V(y,(C,Z)=>{var We,He,Je,Ze,Ge,Ye,Q;return a(),i("tr",{key:Z,draggable:P[g],onDragstart:j=>Ss(Z),onDragend:As,class:N({dragging:we.value===Z})},[t("td",null,_(Z+1),1),P[g]?(a(),i("td",Nn,[D(t("input",{"onUpdate:modelValue":j=>C.label=j,onInput:j=>it(C,g,Z),placeholder:"Field Label",class:N(["form-control",{"border-1 border-danger":(He=(We=A[g])==null?void 0:We[Z])==null?void 0:He.length}])},null,42,Pn),[[M,C.label]]),(Ze=(Je=A[g])==null?void 0:Je[Z])!=null&&Ze.length?(a(),i("div",jn,[(a(!0),i(q,null,V(A[g][Z],(j,Rl)=>(a(),i("div",{key:Rl},_(j),1))),128))])):b("",!0)])):(a(),i("td",Wn,_(C.label),1)),P[g]?(a(),i("td",Hn,[t("div",Jn,[D(t("select",{"onUpdate:modelValue":j=>C.fieldtype=j,onChange:j=>it(C,g,Z),class:N(["form-select form-select-sm",{"border-1 border-danger":(Ye=(Ge=A[g])==null?void 0:Ge[Z])==null?void 0:Ye.length}])},[e[81]||(e[81]=t("option",{value:""},"Select Type",-1)),(a(),i(q,null,V(wt,j=>t("option",{key:j.type,value:j.type},_(j.label),9,Gn)),64))],42,Zn),[[Re,C.fieldtype]]),t("div",Yn,[t("div",Kn,[t("div",Qn,[D(t("input",{class:"font-12 form-control-sm","onUpdate:modelValue":j=>C.description=j,placeholder:"description",type:"text"},null,8,Xn),[[M,C.description]])])]),t("button",{class:"btn btn-light btn-sm",onClick:j=>Js(g,Z)},e[82]||(e[82]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,xn)])]),["Select"].includes(C.fieldtype)?(a(),i("div",In,[e[83]||(e[83]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":j=>C.options=j,onInput:j=>it(C,g,Z),class:"form-control shadow-none mb-1 font-12"},null,40,ei),[[M,C.options]]),!C.options||C.options.trim()===""?(a(),i("small",ti," Options are required for this field type. ")):b("",!0)])):b("",!0),(Q=J[g])!=null&&Q.includes(Z)?(a(),i("span",si,"Type required**")):b("",!0)])):(a(),i("td",li,_(C.fieldtype),1))],42,zn)}),128))],40,Bn)])):b("",!0),p.fieldtype==="Table"&&(p.label===g||p.fieldname===g)?(a(),i("div",oi,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:C=>Zs(g,p.description)},_(P[g]?"Save":"Edit"),9,ai),P[g]?(a(),i("button",{key:0,class:"btn btn-light btn-sm",onClick:C=>Hs(g)}," Add More Field ",8,ni)):b("",!0)])):b("",!0)]))),128))])):b("",!0)])])])])],40,Ia)}),128)),t("div",{class:"drop-zone-bottom",onDragover:e[27]||(e[27]=ie(()=>{},["prevent"])),onDrop:p=>he(p,o,r,c,u,f.fields.length),style:{"background-color":"#f0f0f0",border:"1px dashed #ccc",margin:"4px"}},null,40,ii),t("div",{class:"drop-zone",onDragover:e[28]||(e[28]=ie(()=>{},["prevent"])),onDrop:p=>he(p,o,r,c,u,s.fields.length),style:{height:"10px","background-color":"transparent"}},null,40,ri),t("div",di,[t("button",{class:"btn btn-light btn-sm d-flex align-items-center addField m-2",onClick:p=>hl(o,r,c,u)},e[85]||(e[85]=[t("i",{class:"bi bi-plus fs-5"},null,-1),t("span",null,"Add Field",-1)]),8,ui)])],40,Ja))),128))])])]))),128)),t("div",null,[(a(!0),i(q,null,V(n.afterCreated,(d,c)=>(a(),i("div",{key:c,class:"childTable dynamicColumn m-0 p-2"},[t("h5",ci,_(d.tableName),1),P[d.tableName]?(a(),i("div",pi,[t("div",mi,[d.showDescription?D((a(),i("input",{key:0,"onUpdate:modelValue":f=>d.description=f,class:"form-control font-12",placeholder:"Enter field description"},null,8,fi)),[[M,d.description]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:f=>d.showDescription=!d.showDescription},_(d.showDescription?"Hide Description":d.description?"Edit Description":"Add Description"),9,vi)])])):b("",!0),t("table",bi,[e[91]||(e[91]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",null,[(a(!0),i(q,null,V(d.columns,(f,u)=>{var p,w,L,y;return a(),i("tr",{key:u},[t("td",null,_(u+1),1),P[d.tableName]?(a(),i("td",_i,[D(t("input",{"onUpdate:modelValue":g=>f.label=g,placeholder:"Field Label",class:N(["form-control",{"border-1 border-danger":(p=J[d.tableName])==null?void 0:p.includes(u)}]),onBlur:g=>{var C;f.label=(C=f.label)==null?void 0:C.trim(),Pe(f,d.tableName,u,d.columns)}},null,42,hi),[[M,f.label]]),(w=A[d.tableName])!=null&&w[u]?(a(),i("div",gi,[(a(!0),i(q,null,V(A[d.tableName][u],(g,C)=>(a(),i("span",{key:C},[k(_(g)+" ",1),e[86]||(e[86]=t("br",null,null,-1))]))),128))])):b("",!0)])):(a(),i("td",yi,_(f.label),1)),P[d.tableName]?(a(),i("td",wi,[t("div",ki,[D(t("select",{"onUpdate:modelValue":g=>f.fieldtype=g,class:N(["form-select form-select-sm",{"border-1 border-danger":(L=J[d.tableName])==null?void 0:L.includes(u)}]),onChange:g=>Pe(f,d.tableName,u,d.columns)},[e[87]||(e[87]=t("option",{value:""},"Select Type",-1)),(a(),i(q,null,V(wt,g=>t("option",{key:g.type,value:g.type},_(g.label),9,Di)),64))],42,Ci),[[Re,f.fieldtype]]),t("button",{class:"btn btn-light btn-sm",onClick:g=>js(o,r,d.tableName,u)},e[88]||(e[88]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Fi)]),f.fieldtype==="Select"?(a(),i("div",$i,[e[89]||(e[89]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":g=>f.options=g,class:"form-control shadow-none mb-1 font-12",onInput:g=>Pe(f,d.tableName,u,d.columns)},null,40,Si),[[M,f.options]])])):b("",!0),(y=A[d.tableName])!=null&&y[u]?(a(),i("div",Ai,[(a(!0),i(q,null,V(A[d.tableName][u],(g,C)=>(a(),i("span",{key:C},[k(_(g),1),e[90]||(e[90]=t("br",null,null,-1))]))),128))])):b("",!0)])):(a(),i("td",qi,_(f.fieldtype),1))])}),128))])]),t("div",Vi,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:f=>Ws(o,r,d.tableName)},_(P[d.tableName]?"Save":"Edit"),9,Ei),P[d.tableName]?(a(),i("button",{key:0,class:"btn btn-light btn-sm",onClick:f=>Ps(o,r,d.tableName)}," Add More Field ",8,Li)):b("",!0)])]))),128))])]),t("div",null,[t("div",null,[o==0?(a(),i("button",{key:0,class:"btn btn-light addRow mb-3 mt-4",onClick:d=>Ls(o,r)}," Add New Table ",8,Ti)):b("",!0),(a(!0),i(q,null,V(n.childTables,(d,c)=>{var f;return a(),i("div",{key:`table-${o}-${r}-${c}`,class:"child-table"},[d.newTable?(a(),i("div",Ui,[t("div",Ri,[t("div",null,[t("span",{class:N(d.tableName?"d-none":"text-danger")},"*",2),D(t("input",{"onUpdate:modelValue":u=>d.tableName=u,placeholder:"Table Name",onBlur:u=>Ot(d),class:N(["border-less-input font-14 p-0 inputHeight",{"italic-style":!d.tableName,"fw-medium":d.tableName}])},null,42,Mi),[[M,d.tableName]]),(f=A[`${o}-${r}-${c}`])!=null&&f.tableName?(a(),i("div",Oi,_(A[`${o}-${r}-${c}`].tableName),1)):b("",!0),Te.value?(a(),i("div",Bi,_(Te.value),1)):b("",!0),t("div",zi,[t("div",Ni,[d.showDescription?D((a(),i("input",{key:0,"onUpdate:modelValue":u=>d.as_a_block=u,class:"form-control font-12",placeholder:"Enter field description"},null,8,Pi)),[[M,d.as_a_block]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:u=>d.showDescription=!d.showDescription},_(d.showDescription?"Hide Description":d.description?"Edit Description":"Add Description"),9,ji)])])]),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:u=>Us(o,r,c)},e[92]||(e[92]=[t("i",{class:"bi bi-trash"},null,-1),k(" Remove Table ")]),8,Wi)]),(a(!0),i(q,null,V(d.columns,(u,p)=>{var w,L,y,g,C,Z,We,He,Je,Ze,Ge,Ye;return a(),i("div",{key:p,class:"dynamicField"},[t("div",Hi,[t("div",Ji,[t("div",null,[t("span",{class:N(u.label?"d-none":"text-danger")},"*",2),D(t("input",{"onUpdate:modelValue":Q=>u.label=Q,placeholder:"Name the field",onBlur:()=>{Ot(u),Ms(u,o,r,c,p,d.columns)},class:N(["border-less-input font-14 p-0 inputHeight",{"italic-style":!u.label,"fw-medium":u.label,"is-invalid":(y=(L=(w=A[`${o}-${r}-${c}`])==null?void 0:w.columns)==null?void 0:L[p])==null?void 0:y.label}])},null,42,Zi),[[M,u.label]]),(Z=(C=(g=A[`${o}-${r}-${c}`])==null?void 0:g.columns)==null?void 0:C[p])!=null&&Z.label?(a(),i("div",Gi,_(A[`${o}-${r}-${c}`].columns[p].label),1)):b("",!0)]),t("div",Yi,[t("div",Ki,[u.showDescription?D((a(),i("input",{key:0,"onUpdate:modelValue":Q=>u.description=Q,class:"form-control font-12",placeholder:"Enter field description"},null,8,Qi)),[[M,u.description]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:Q=>u.showDescription=!u.showDescription},_(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,Xi)]),t("button",{class:"btn btn-sm trash-btn py-0",onClick:Q=>Rs(o,r,c,p)},e[93]||(e[93]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,xi)])]),D(t("select",{"onUpdate:modelValue":Q=>u.fieldtype=Q,class:N(["form-select font-13 mb-1",{"is-invalid":(Je=(He=(We=A[`${o}-${r}-${c}`])==null?void 0:We.columns)==null?void 0:He[p])==null?void 0:Je.fieldtype}])},[e[94]||(e[94]=t("option",{value:""},"Select Type",-1)),(a(),i(q,null,V(wt,Q=>t("option",{key:Q.type,value:Q.type},_(Q.label),9,er)),64))],10,Ii),[[Re,u.fieldtype]]),["Select"].includes(u.fieldtype)?(a(),i("div",tr,[e[95]||(e[95]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":Q=>u.options=Q,class:"form-control shadow-none mb-1 font-12"},null,8,sr),[[M,u.options]]),!u.options||u.options.trim()===""?(a(),i("small",lr," Options are required for this field type. ")):b("",!0)])):b("",!0),(Ye=(Ge=(Ze=A[`${o}-${r}-${c}`])==null?void 0:Ze.columns)==null?void 0:Ge[p])!=null&&Ye.fieldtype?(a(),i("div",or,_(A[`${o}-${r}-${c}`].columns[p].fieldtype),1)):b("",!0)])])}),128)),t("button",{class:"btn btn-light btn-sm addField mx-1",onClick:u=>Ts(o,r,c)},e[96]||(e[96]=[t("i",{class:"bi bi-plus"},null,-1),k(" Add Field ")]),8,ar),t("button",{class:"btn btn-dark btn-sm font-12 mx-1",onClick:u=>Ns(o,r,c)}," Create Table ",8,nr),e[97]||(e[97]=t("hr",null,null,-1))])):b("",!0)])}),128))])]),t("div",ir,[t("button",{class:"btn btn-light border font-12",onClick:d=>fl(o,r)},e[98]||(e[98]=[t("i",{class:"bi bi-plus-circle me-1 fs-6"},null,-1),k(" Add Section ")]),8,rr)])]))),128)),o===0?(a(),i("div",dr)):b("",!0)])])),[[bt,o===et.value]])),128))],512)]),Et.value?(a(),i("aside",ur,[t("div",cr,[e[100]||(e[100]=t("h6",{class:"mb-0"},"Field Properties",-1)),t("button",{class:"btn btn-sm btn-link p-0",onClick:e[29]||(e[29]=l=>Et.value=null)},e[99]||(e[99]=[t("i",{class:"bi bi-x-lg"},null,-1)]))]),e[101]||(e[101]=t("div",{class:"properties-content"},[t("p",{class:"text-muted small"},"Select a field to edit its properties")],-1))])):b("",!0)])])):b("",!0),$.value===3?(a(),i("div",pr,[t("div",mr,[t("button",{onClick:e[30]||(e[30]=l=>ut()),class:"btn btn-sm btn-light"},e[102]||(e[102]=[t("i",{class:"bi bi-chevron-left"},null,-1),k(" Back ")])),e[104]||(e[104]=t("h1",{class:"font-14 fw-bold m-0"},"Workflow Setup",-1)),t("button",{class:"btn btn-sm btn-dark",onClick:dt},e[103]||(e[103]=[k(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]))]),t("div",fr,[t("div",vr,[e[110]||(e[110]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),k("Workflow Configuration")])],-1)),t("div",br,[t("div",_r,[t("div",hr,[e[107]||(e[107]=t("label",{class:"form-label fw-bold"},"Workflow Type",-1)),t("div",gr,[D(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"existingWorkflow",value:"existing","onUpdate:modelValue":e[31]||(e[31]=l=>fe.value=l)},null,512),[[os,fe.value]]),e[105]||(e[105]=t("label",{class:"btn btn-outline-primary",for:"existingWorkflow"},[t("i",{class:"bi bi-folder me-1"}),k("Use Existing ")],-1)),D(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"newWorkflow",value:"new","onUpdate:modelValue":e[32]||(e[32]=l=>fe.value=l),checked:""},null,512),[[os,fe.value]]),e[106]||(e[106]=t("label",{class:"btn btn-outline-primary",for:"newWorkflow"},[t("i",{class:"bi bi-plus-circle me-1"}),k("Create New ")],-1))])]),fe.value==="existing"?(a(),i("div",yr,[e[108]||(e[108]=t("label",{class:"form-label fw-bold"},"Select Workflow",-1)),X(S(De),{onOpen:Gt,options:Oe.value,modelValue:me.value,"onUpdate:modelValue":e[33]||(e[33]=l=>me.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:Yt,openDirection:"bottom"},null,8,["options","modelValue"]),e[109]||(e[109]=t("small",{class:"text-muted font-12 ms-2"},[t("i",{class:"bi bi-info-circle me-1"}),k(" Auto-populates requestors and approvers ")],-1))])):b("",!0)])])]),fe.value==="new"?(a(),i("div",wr,[e[117]||(e[117]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-person-plus me-2"}),k("Add Requestors")])],-1)),t("div",kr,[e[116]||(e[116]=t("div",{class:"alert alert-info mb-3"},[t("i",{class:"bi bi-info-circle me-2"}),t("strong",null,"Requestor Configuration:"),k(" Define who can submit requests for this form. ")],-1)),t("button",{class:"btn btn-primary btn-sm",onClick:ql},e[111]||(e[111]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),k("Add Requestor Role ")])),tt.value.length>0?(a(),i("div",Cr,[t("div",Dr,[t("table",Fr,[e[115]||(e[115]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"40%"},"Role"),t("th",{width:"30%"},"Auto Approval"),t("th",{width:"20%"},"Permissions"),t("th",{width:"10%"},"Action")])],-1)),t("tbody",null,[(a(!0),i(q,null,V(tt.value,(l,o)=>(a(),i("tr",{key:o},[t("td",null,[D(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n=>l.role=n,placeholder:"Enter role name"},null,8,$r),[[M,l.role]])]),t("td",null,[t("div",Sr,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":n=>l.autoApproval=n},null,8,Ar),[[Fe,l.autoApproval]]),e[112]||(e[112]=t("label",{class:"form-check-label font-12"},"Enable",-1))])]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:n=>El()},e[113]||(e[113]=[t("i",{class:"bi bi-gear"},null,-1),k(" Configure ")]),8,qr)]),t("td",null,[t("button",{class:"btn btn-sm btn-danger",onClick:n=>Vl(o)},e[114]||(e[114]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Vr)])]))),128))])])])])):b("",!0)])])):b("",!0),fe.value==="existing"&&me.value&&st.value.length>0?(a(),i("div",Er,[e[125]||(e[125]=t("div",{class:"card-header bg-success text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-check-circle me-2"}),k("Loaded Requestors from Workflow")])],-1)),t("div",Lr,[t("div",Tr,[e[118]||(e[118]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),t("strong",null,_(st.value.length),1),e[119]||(e[119]=k(" requestor role(s) loaded from ")),t("strong",null,_(me.value.display_name),1)]),t("div",Ur,[t("table",Rr,[e[121]||(e[121]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Role"),t("th",null,"Auto Approval"),t("th",null,"Columns Allowed")])],-1)),t("tbody",null,[(a(!0),i(q,null,V(st.value,(l,o)=>(a(),i("tr",{key:o},[t("td",null,[t("strong",null,_(l.requestor),1)]),t("td",null,[l.auto_approval?(a(),i("span",Mr,e[120]||(e[120]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),k("Enabled ")]))):(a(),i("span",Or,"Disabled"))]),t("td",null,[t("small",Br,_(l.columns_allowed||"All fields"),1)])]))),128))])])]),t("div",zr,[e[123]||(e[123]=t("h6",{class:"fw-bold"},[t("i",{class:"bi bi-pencil me-2"}),k("Requestor Fields Configuration")],-1)),e[124]||(e[124]=t("p",{class:"text-muted font-12"},"These fields will be available for requestors to fill:",-1)),t("div",Nr,[(a(!0),i(q,null,V(ht.value,(l,o)=>(a(),i("div",{class:"col-md-3",key:o},[t("div",Pr,[e[122]||(e[122]=t("i",{class:"bi bi-tag me-1"},null,-1)),k(_(l.label),1)])]))),128))])])])])):b("",!0),e[126]||(e[126]=ss('<div class="card mt-4" data-v-20cd2ab0><div class="card-header bg-light" data-v-20cd2ab0><h6 class="mb-0 fw-bold" data-v-20cd2ab0><i class="bi bi-shield-check me-2" data-v-20cd2ab0></i>System Generated Fields</h6></div><div class="card-body" data-v-20cd2ab0><div class="alert alert-secondary mb-3" data-v-20cd2ab0><i class="bi bi-info-circle me-2" data-v-20cd2ab0></i> These fields are automatically included for all requestors. </div><div class="row g-3" data-v-20cd2ab0><div class="col-md-6" data-v-20cd2ab0><div class="field-preview-card" data-v-20cd2ab0><label class="form-label fw-bold" data-v-20cd2ab0>Requestor Name</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-20cd2ab0></div></div><div class="col-md-6" data-v-20cd2ab0><div class="field-preview-card" data-v-20cd2ab0><label class="form-label fw-bold" data-v-20cd2ab0>Requestor Email</label><input type="email" class="form-control" value="Auto-populated from user profile" disabled data-v-20cd2ab0></div></div><div class="col-md-6" data-v-20cd2ab0><div class="field-preview-card" data-v-20cd2ab0><label class="form-label fw-bold" data-v-20cd2ab0>Request Date</label><input type="text" class="form-control" value="Auto-populated on submission" disabled data-v-20cd2ab0></div></div><div class="col-md-6" data-v-20cd2ab0><div class="field-preview-card" data-v-20cd2ab0><label class="form-label fw-bold" data-v-20cd2ab0>Department</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-20cd2ab0></div></div></div></div></div>',1))])])):b("",!0),$.value===4?(a(),i("div",jr,[t("div",Wr,[t("button",{onClick:e[34]||(e[34]=l=>ut()),class:"btn btn-sm btn-light"},e[127]||(e[127]=[t("i",{class:"bi bi-chevron-left"},null,-1),k(" Back ")])),e[129]||(e[129]=t("h1",{class:"font-14 fw-bold m-0"},"Approver Blocks",-1)),t("button",{class:"btn btn-sm btn-dark",onClick:dt},e[128]||(e[128]=[k(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]))]),t("div",Hr,[e[142]||(e[142]=t("div",{class:"alert alert-info"},[t("i",{class:"bi bi-info-circle me-2"}),t("strong",null,"Approval Workflow:"),k(" Configure multi-level approval process for this form. ")],-1)),fe.value==="existing"&&me.value&&Be.value.length>0?(a(),i("div",Jr,[e[137]||(e[137]=t("div",{class:"card-header bg-primary text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),k("Loaded Approval Workflow")])],-1)),t("div",Zr,[t("div",Gr,[e[130]||(e[130]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),t("strong",null,_(Be.value.length),1),e[131]||(e[131]=k(" approval level(s) loaded from ")),t("strong",null,_(me.value.display_name),1)]),t("div",Yr,[t("table",Kr,[e[135]||(e[135]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"10%"},"Level"),t("th",{width:"25%"},"Role"),t("th",{width:"15%"},"Mandatory"),t("th",{width:"20%"},"Approval Type"),t("th",{width:"30%"},"Columns Allowed")])],-1)),t("tbody",null,[(a(!0),i(q,null,V(Be.value,(l,o)=>(a(),i("tr",{key:o},[t("td",null,[t("span",Qr,"Level "+_(l.level),1)]),t("td",null,[t("strong",null,_(l.role),1)]),t("td",null,[l.mandatory?(a(),i("span",Xr,e[132]||(e[132]=[t("i",{class:"bi bi-exclamation-circle me-1"},null,-1),k("Required ")]))):(a(),i("span",xr,"Optional"))]),t("td",null,[l.approval_type==="Any"?(a(),i("span",Ir,e[133]||(e[133]=[t("i",{class:"bi bi-person me-1"},null,-1),k("Any User ")]))):l.approval_type==="All"?(a(),i("span",ed,e[134]||(e[134]=[t("i",{class:"bi bi-people me-1"},null,-1),k("All Users ")]))):(a(),i("span",td,_(l.approval_type||"Any"),1))]),t("td",null,[t("small",sd,_(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[136]||(e[136]=t("div",{class:"alert alert-light mt-3"},[t("i",{class:"bi bi-paperclip me-2"}),t("strong",null,"Note:"),k(" Approvers can view and approve based on the fields configured above. To modify field permissions, edit the selected workflow road map. ")],-1))])])):b("",!0),fe.value==="new"||!me.value||Be.value.length===0?(a(),i("div",ld,[e[141]||(e[141]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-gear me-2"}),k("Manual Approval Configuration")])],-1)),t("div",od,[t("button",{class:"btn btn-primary mb-3",onClick:pt},e[138]||(e[138]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),k("Add Approval Level ")])),S(m).length>1?(a(),i("div",ad,[t("div",nd,[t("strong",null,_(S(m).length-1),1),e[139]||(e[139]=k(" approval level(s) configured "))])])):(a(),i("div",id,e[140]||(e[140]=[t("div",{class:"alert alert-warning"},[t("i",{class:"bi bi-exclamation-triangle me-2"}),k(' No approval levels configured yet. Click "Add Approval Level" to create one. ')],-1)])))])])):b("",!0)])])):b("",!0),$.value===5?(a(),i("div",rd,[e[143]||(e[143]=t("div",{class:"stepperbackground d-flex align-items-center justify-content-end gap-2"},[t("div",null,[t("button",{class:"btn btn btn-light previewBtn font-13","data-bs-toggle":"modal","data-bs-target":"#customFormatModal"},"Print Format ")]),t("div")],-1)),X(as,{blockArr:ft.value},null,8,["blockArr"])])):b("",!0)])])])])])])]),t("div",dd,[t("div",ud,[t("div",cd,[e[147]||(e[147]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"customFormatModalLabel"},"Print Format"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",pd,[e[145]||(e[145]=t("label",{for:""},"Form Name",-1)),D(t("input",{"onUpdate:modelValue":e[35]||(e[35]=l=>ot.value=l),multiple:!1,placeholder:S(F).query.id,class:"font-11 form-control",id:"Form_name_print",searchable:!0},null,8,md),[[M,ot.value]]),t("div",fd,[t("div",vd,[D(t("input",{class:"font-12","onUpdate:modelValue":e[36]||(e[36]=l=>Ee.value=l),"true-value":1,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,512),[[Fe,Ee.value]])]),e[144]||(e[144]=t("div",null,[t("label",{for:"mandatory",class:"font-12 fw-bold m-0 fw-light"},"Print Landscape Mode")],-1))])]),t("div",{class:"modal-footer"},[e[146]||(e[146]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),t("button",{type:"button",class:"btn btn-dark",onClick:cl},"Add Print Format")])])])]),t("div",bd,[t("div",_d,[t("div",hd,[e[148]||(e[148]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"formViewModalLabel"},"Form Preview"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",gd,[X(as,{blockArr:ft.value},null,8,["blockArr"])]),e[149]||(e[149]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),t("div",yd,[t("div",wd,[t("span",kd,_(O.value==0?"Add designation for Requestors":`Approval Settings For
          Level-${O.value}`),1),e[150]||(e[150]=t("button",{type:"button",class:"btn-close bg-light text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),t("div",Cd,[t("div",Dd,[t("div",Fd,[O.value!==0?(a(),i("div",$d,[O.value!==0?(a(),i("div",Sd,[e[152]||(e[152]=t("label",{class:"fw-bold font-12 mb-2"},"Approver Type",-1)),D(t("select",{"onUpdate:modelValue":e[37]||(e[37]=l=>de.value=l),class:"form-select shadow-none font-12"},e[151]||(e[151]=[t("option",{value:""},"Any one of the selected approvers",-1),t("option",{value:"ViewOnlyReportee"},"Reporting Manager only",-1),t("option",{value:"all_approvals_required"},"All of the selected approvers",-1),t("option",{value:"requester_as_a_approver"},"Approval by Requestor",-1)]),512),[[Re,de.value]])])):b("",!0)])):b("",!0)])]),t("div",Ad,[t("div",qd,[t("span",Vd," Select "+_(O.value===0?"Requestors":"Approvers"),1),t("span",Ed,_(T.value.length)+" Selected ",1)]),ne.value.length?(a(),i("div",Ld,[t("div",Td,[t("div",Ud,[t("input",{type:"checkbox",id:"selectAll",checked:el.value,onChange:tl,class:"form-check-input me-2 designationCheckBox"},null,40,Rd),t("label",Md," Select all designation ("+_(je.value.length)+") ",1)]),O.value!==0?(a(),i("div",Od,[D(t("input",{type:"checkbox",id:"showHods","onUpdate:modelValue":e[38]||(e[38]=l=>Le.value=l),class:"form-check-input me-2 designationCheckBox"},null,512),[[Fe,Le.value]]),e[153]||(e[153]=t("label",{for:"showHods",class:"form-check-label mt-2 fw-bold"}," Show HODs Only ",-1))])):b("",!0),t("div",null,[T.value.length?(a(),i("button",{key:0,type:"button",class:"btn btn-sm font-12 text-danger",onClick:sl},e[154]||(e[154]=[t("i",{class:"bi bi-x"},null,-1),k(" Clear all ")]))):b("",!0)])]),ne.value.length?(a(),es(S(Hl),{key:0,multiple:!0,modelValue:T.value,"onUpdate:modelValue":e[39]||(e[39]=l=>T.value=l),options:je.value,"close-on-select":!1,"clear-search-on-select":!0,placeholder:"Search & Select Designations"},null,8,["modelValue","options"])):b("",!0)],512)):(a(),i("div",Bd,e[155]||(e[155]=[t("div",{class:"d-flex justify-content-center"},[t("span",null,"No Designations Found")],-1)])))]),O.value!==0?(a(),i("div",zd,[e[156]||(e[156]=t("div",null,[t("label",{for:"",class:"fw-bold font-12"},"On Rejection")],-1)),D(t("select",{"onUpdate:modelValue":e[40]||(e[40]=l=>Ae.value=l),class:"form-select shadow-none font-12 mt-1 me-2"},[(a(!0),i(q,null,V(ys.value,l=>(a(),i("option",{key:l,value:l},_(l===0?"Requestor":"Approver Level "+l),9,Nd))),128))],512),[[Re,Ae.value,void 0,{number:!0}]])])):b("",!0),O.value!==0?(a(),i("div",Pd,[t("div",jd,[t("div",Wd,[D(t("input",{"onUpdate:modelValue":e[41]||(e[41]=l=>Qe.value=l),type:"checkbox","true-value":1,"false-value":0,id:"Approver",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[Fe,Qe.value]]),e[157]||(e[157]=t("label",{for:"Approver",class:"m-0"},"Approval Mandatory",-1))]),_t.value===!0?(a(),i("div",Hd,[D(t("input",{"onUpdate:modelValue":e[42]||(e[42]=l=>Xe.value=l),type:"checkbox","true-value":1,"false-value":0,id:"approver_can_edit",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[Fe,Xe.value]]),e[158]||(e[158]=t("label",{for:"approver_can_edit",class:"m-0"}," Allow this approver to edit the form ",-1))])):b("",!0)])])):b("",!0)]),t("div",Jd,[t("div",Zd,[t("div",null,[X(ts,{class:"btn btn-dark addingDesignations","data-bs-dismiss":"offcanvas",onClick:ll,name:O.value===0?"Add Requestor":"Add Approvers"},null,8,["name"])])])])])]))}},Qd=is(Gd,[["__scopeId","data-v-20cd2ab0"]]);export{Qd as default};
