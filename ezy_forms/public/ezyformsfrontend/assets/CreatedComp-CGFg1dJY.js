import{_ as B,d as i,u as J,e as x,I as M,f as D,w as G,O as Q,o as Y,c as K,b as s,t as W,a as g,D as X,G as Z,P as ee,i as P,Q as te,E as se,k as d,l as f,j as $,n as v,m as oe}from"./index-BHd6CXej.js";const ne={class:"d-flex formsticky align-items-center justify-content-between py-2"},ae={class:"m-0 font-11 pt-1"},ie={class:"d-flex align-items-center gap-2"},re={class:"d-flex align-items-center"},le={class:"mt-2"},me={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},ce={class:"modal-dialog modal-xl"},ue={class:"modal-content"},de={class:"d-block modal-header bg-dark text-white py-2"},fe={class:"d-flex align-items-center justify-content-between"},pe={class:""},_e={class:"modal-body"},he=["innerHTML"],be={__name:"CreatedComp",setup(ge){const y=i(0),C=i(""),k=i({}),m=i([]),_=J(),c=x(()=>se.value);M([]),D(()=>{});const l=i({limit_start:0,limitPageLength:20,form_name:"",form_short_name:"",accessible_departments:"[]",business_unit:"",form_category:"",owner_of_the_form:"",search:""}),R=i("");G(c,e=>{l.value.business_unit=e,e.length&&(R.value=e,m.value=[],p())},{immediate:!0});const w=i([{th:"Form name",td_key:"form_name"},{th:"Short Name",td_key:"form_short_name"},{th:"Form category",td_key:"form_category"},{th:"Owner of form",td_key:"owner_of_the_form"},{th:"Accessible departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"},{th:"Enable/Disable",td_key:"enable"}]),h=Q(),L=i(null),N=i([{name:"View form",icon:"fa-solid fa-eye"},{name:"Edit Form",icon:"fa-solid fa-edit"},{name:"Raise Request",icon:"fa-solid fa-check-circle"}]),O=i([]);function T(e,t){if(t.name==="View form")e!=null&&e.form_json?h.push({name:"FormPreviewComp",query:{routepath:_.path,form_short_name:e.form_short_name,business_unit:c.value}}):(console.warn("There are no form fields"),b(e));else if(t.name==="Edit Form")b(e);else if(t.name==="Download Print format"){k.value=e;const a={form_short_name:e.form_short_name,business_unit:c.value};d.post(f.preview_dynamic_form,a).then(o=>{C.value=o.message}).catch(o=>{console.error("Error fetching data:",o)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}if(t.name==="Raise Request"){const a=JSON.parse(e.form_json),n=localStorage.getItem("employeeData");if(n){const o=JSON.parse(n).designation,r=a.workflow[0].roles;let u=!1;for(let F=0;F<r.length;F++)if(r[F]===o){u=!0;break}u?h.push({name:"RaiseRequest",query:{routepath:_.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):$.info("You are not assigned to raise a request.")}}else t.name==="Edit accessibility to dept."?b(e):t.name==="In-active this form"?E(e,"0"):t.name==="Activate this form"&&E(e,"1")}function q(e,t,a){const n=e.enable=="1"||e.enable===1,o=n?"Disable":"Enable";confirm(`Are you sure you want to ${o} ${e.name} Form?`)&&(e.enable=n?0:1,d.put(`${f.resource}${v.EzyFormDefinitions}/${e.name}`,e).then(r=>{$.success(`Form ${o}d successfully`,{autoClose:700}),window.location.reload()}).catch(r=>{console.error("Error updating toggle:",r)}))}function A(){const e={form_short_name:k.value.form_short_name,name:null,business_unit:c.value};d.post(f.download_pdf_form,e).then(t=>{let a=oe+t.message;a=a.replace("/api","");const n=document.createElement("a");n.href=a,n.download=t.message.split("/").pop(),n.click()}).catch(t=>{console.error("Error fetching data:",t)})}function E(e,t){if(e){const a=e.name,n={active:t};d.put(`${f.resource}${v.EzyFormDefinitions}/${a}`,n).then(o=>{p()}).catch(o=>{console.error("Error updating form status:",o)})}}const S=i(null);function z(e){clearTimeout(S.value),S.value=setTimeout(()=>{const t=[];w.value.forEach(a=>{const n=a.td_key;e[n]&&t.push([n,"like",`%${e[n]}%`])}),p(t.length?t:void 0)},500)}function b(e=null){e==null?h.push({name:"FormStepper",query:{routepath:_.path,business_unit:c.value}}):h.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:_.path,business_unit:c.value,id:e.name}})}const V=e=>{l.value.limitPageLength=e,l.value.limit_start=0,p()},j=([e,t])=>{l.value.limitPageLength=e,l.value.limit_start=t,p()},I=i([]);i([]);const H=i([]);function p(e){const t=[["business_unit","like",`%${l.value.business_unit}%`],["form_status","=","Created"]];e&&t.push(...e);const a={fields:JSON.stringify(["*"]),filters:JSON.stringify(t),limit_page_length:l.value.limitPageLength,limit_start:l.value.limit_start,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"},n={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(t)};d.get(`${f.resource}${v.EzyFormDefinitions}`,{params:n}).then(o=>{y.value=o.data[0].total_count}).catch(o=>{console.error("Error fetching ezyForms data:",o)}),d.get(`${f.resource}${v.EzyFormDefinitions}`,{params:a}).then(o=>{const r=o.data;l.value.limit_start===0?(m.value=r,I.value=[...new Set(r.map(u=>u.form_category))],H.value=[...new Set(r.map(u=>u.owner_of_the_form))]):m.value=m.value.concat(r)}).catch(o=>{console.error("Error fetching ezyForms data:",o)})}const U=x(()=>({form_name:{type:"input"},form_short_name:{type:"input"},form_category:{type:"input"},owner_of_the_form:{type:"input"}}));return(e,t)=>(Y(),K("div",null,[s("div",ne,[s("div",null,[t[2]||(t[2]=s("h1",{class:"m-0 font-13"},"All Forms ",-1)),s("p",ae,W(y.value)+" forms available",1)]),s("div",ie,[s("div",re,[g(X,{class:"buttoncomp",onClick:t[0]||(t[0]=a=>b()),name:"Create form"})])])]),s("div",le,[g(Z,{tHeaders:w.value,tData:m.value,isAction:"true",actionType:"dropdown",enableDisable:"true",onActionClicked:T,onToggleClick:q,isFiltersoption:"true","field-mapping":U.value,actions:N.value,onUpdateFilters:z,isCheckbox:"true"},null,8,["tHeaders","tData","field-mapping","actions"]),g(ee,{currentRecords:m.value.length,totalRecords:y.value,onUpdateValue:V,onLimitStart:j},null,8,["currentRecords","totalRecords"])]),s("div",me,[s("div",ce,[s("div",ue,[s("div",de,[s("div",fe,[t[5]||(t[5]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",pe,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:A},t[3]||(t[3]=[P("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[1]||(t[1]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[4]||(t[4]=[P("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",_e,[s("div",{innerHTML:C.value},null,8,he)]),t[6]||(t[6]=s("div",{class:"modal-footer"},null,-1))])])]),g(te,{blockArr:L.value,formDescriptions:k.value,childHeaders:O.value},null,8,["blockArr","formDescriptions","childHeaders"])]))}},ye=B(be,[["__scopeId","data-v-1e1ecafe"]]);export{ye as default};
