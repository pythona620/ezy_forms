import{_ as D,r as o,M as R,x as S,E as O,u as q,e as U,f as V,w as B,y as h,z as y,K as g,o as J,c as j,d as l,t as H,b as v,G as I,P as M,Y as G,H as K}from"./index-DMZd8UgW.js";const Y={class:"d-flex formsticky align-items-center justify-content-between py-2"},Q={class:"m-0 font-11 pt-1"},W={class:"mt-2"},X={__name:"DraftComp",setup(Z){const m=o(0),P=o({}),i=o([]);o([]);const C=o([]),f=R(),$=o(null),d=S(()=>O.value),_=q();U([]),V(()=>{});function w(e,t){t.name==="View form"&&(e!=null&&e.form_json?f.push({name:"FormPreviewComp",query:{routepath:_.path,form_short_name:e.form_short_name}}):(console.warn(" There is no form fields "),F(e))),t.name==="Edit Form"&&F(e)}const x=o([{name:"View form",icon:"fa-solid fa-eye"},{name:"Edit Form",icon:"fa-solid fa-edit"}]),s=o({limit_start:0,limitPageLength:20,form_name:"",form_short_name:"",accessible_departments:"[]",business_unit:"",form_category:"",owner_of_the_form:"",search:""});B(d,e=>{s.value.business_unit=e,e.length&&(i.value=[],u())},{immediate:!0});const b=o([{th:"Name",td_key:"name"},{th:"Form name",td_key:"form_name"},{th:"Form category",td_key:"form_category"},{th:"Owner of form",td_key:"owner_of_the_form"},{th:"Accessible departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"},{th:"Enable/Disable",td_key:"enable"}]);function F(e=null){e==null?f.push({query:{routepath:_.path,business_unit:d.value},name:"FormStepper"}):f.push({query:{routepath:_.path,business_unit:d.value,id:e.name},name:"FormStepper",params:{paramid:e.name}})}const z=e=>{s.value.limitPageLength=e,s.value.limit_start=0,u()},L=([e,t])=>{s.value.limitPageLength=e,s.value.limit_start=t,u()};function N(e,t,c){const a=e.enable=="1"||e.enable===1,n=a?"Disable":"Enable";confirm(`Are you sure you want to ${n}  ${e.name} Form?`)&&(e.enable=a?0:1,h.put(`${y.resource}${g.EzyFormDefinitions}/${e.name}`,e).then(r=>{K(`Form ${n}d successfully`),window.location.reload()}).catch(r=>{console.error("Error updating toggle:",r)}))}const k=o(null);function T(e){clearTimeout(k.value),k.value=setTimeout(()=>{const t=[];b.value.forEach(c=>{const a=c.td_key;e[a]&&t.push(a,"like",`%${e[a]}%`)}),u(t.length?t:void 0)},500)}const E=o([]);function u(e){const t=[["business_unit","=",`${s.value.business_unit}`],["form_status","=","Draft"],["enable","=",1]];e&&t.push(e);const c={fields:JSON.stringify(["*"]),filters:JSON.stringify(t),limit_page_length:s.value.limitPageLength,limit_start:s.value.limit_start,order_by:"`tabEzy Form Definitions`.`creation` desc"},a={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(t)};h.get(`${y.resource}${g.EzyFormDefinitions}`,{params:a}).then(n=>{m.value=n.data[0].total_count}).catch(n=>{console.error("Error fetching ezyForms data:",n)}),h.get(`${y.resource}${g.EzyFormDefinitions}`,{params:c}).then(n=>{const r=n.data;s.value.limit_start===0?(i.value=r,E.value=[...new Set(r.map(p=>p.form_category))],C.value=[...new Set(r.map(p=>p.owner_of_the_form))]):i.value=i.value.concat(r)}).catch(n=>{console.error("Error fetching ezyForms data:",n)})}const A=S(()=>({form_category:{type:"select",options:E.value},form_name:{type:"input"},owner_of_the_form:{type:"input"}}));return(e,t)=>(J(),j("div",null,[l("div",Y,[l("div",null,[t[0]||(t[0]=l("h1",{class:"m-0 font-13"},"Forms in Draft",-1)),l("p",Q,H(m.value)+" forms available",1)]),t[1]||(t[1]=l("div",{class:"d-flex align-items-center gap-2"},null,-1))]),l("div",W,[v(I,{tHeaders:b.value,tData:i.value,isAction:"true",actionType:"dropdown",enableDisable:"true",onActionClicked:w,isFiltersoption:"true","field-mapping":A.value,actions:x.value,onToggleClick:N,onUpdateFilters:T,isCheckbox:"true"},null,8,["tHeaders","tData","field-mapping","actions"]),v(M,{currentRecords:i.value.length,totalRecords:m.value,onUpdateValue:z,onLimitStart:L},null,8,["currentRecords","totalRecords"])]),v(G,{blockArr:$.value,formDescriptions:P.value},null,8,["blockArr","formDescriptions"])]))}},te=D(X,[["__scopeId","data-v-8ffbe83f"]]);export{te as default};
