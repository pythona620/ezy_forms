var te=Object.defineProperty;var M=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var U=(g,m,p)=>m in g?te(g,m,{enumerable:!0,configurable:!0,writable:!0,value:p}):g[m]=p,L=(g,m)=>{for(var p in m||(m={}))se.call(m,p)&&U(g,p,m[p]);if(M)for(var p of M(m))ae.call(m,p)&&U(g,p,m[p]);return g};import{p as oe,f as j,d as c,e as le,w as ne,q as ie,o as d,c as r,b as s,t as _,g as b,h as u,a as v,F,_ as de,P as re,E as ue,j as ce,l as h,m as R,k as pe,n as J}from"./index-B-ZWE6ER.js";import{B as W}from"./ButtonComp-Ciox4MwK.js";import{_ as me}from"./ApproverPreview-D5zSuqt1.js";const fe={class:"d-flex justify-content-between align-items-center"},_e={class:"m-0 font-11 pt-1"},ve={class:"d-flex gap-3 align-items-center"},be={class:"d-flex align-items-center"},ge={class:"me-2"},ye={key:0,class:"process-date font-12 m-0"},qe={key:1,class:"process-date font-12 m-0"},ke={key:2,class:"process-date font-12 m-0"},we={key:3,class:"process-date font-12 m-0"},he={key:4,class:"process-date font-12 m-0"},Re={key:5,class:"process-date font-12 m-0"},Fe={key:6,class:"process-date font-12 m-0"},xe={type:"button",class:"filterbtn d-flex align-items-center position-relative","data-bs-toggle":"modal","data-bs-target":"#fileterModal"},Se={key:0,class:"badge badge-light colorappiled"},$e={class:"modal fade",id:"fileterModal",tabindex:"-1","aria-labelledby":"fileterModalLabel","aria-hidden":"true"},Ce={class:"modal-dialog modal-lg"},Oe={class:"modal-content"},Ve={class:"modal-body"},Ne={class:"row"},Be={class:"col-6"},Ee={class:"col-6"},Ae={class:"col-6"},Pe={class:"col-6"},Ie={class:"col-6"},Me={class:"modal-footer"},Ue={class:"mt-2"},Le={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},je={class:"modal-dialog modal-dialog-centered modal-lg"},Je={class:"modal-content"},We={class:"modal-header"},De={class:"modal-title font-13",id:"viewRequestLabel"},Te={class:"modal-body approvermodalbody"},He={class:"modal-footer"},ze={class:"d-flex justify-content-between align-items-center mt-3 gap-2"},Ge={__name:"ReceivedForMe",setup(g){const m=j(()=>ue.value),p=c({business_unit:""}),k=c({limitPageLength:"None",limit_start:0}),O=c(0),N=c([]),B=c([]),E=c([]),x=c([]),A=c([{th:"Request ID",td_key:"name"},{th:"Form name",td_key:"doctype_name"},{th:"Owner of form",td_key:"owner"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"}]),D=c({name:{type:"input"},doctype_name:{type:"input"}}),T=c([{name:"View Request",icon:"fa-solid fa-eye"},{name:"Share this form",icon:"fa-solid fa-share-alt"},{name:"Download Form",icon:"fa-solid fa-download"},{name:"Edit Form",icon:"fa-solid fa-edit"}]),V=c([]),e=le({appliedname:!1,applieddoctype_name:!1,appliedaccessible_departments:!1,appliedStatus:!1,appliedrequest_id:!1,appiedrequestedOn:!1,appliedowner:!1,name:"",doctype_name:"",accessible_departments:"",status:"",request_id:"",requested_on:"",owner:""}),i=c({}),S=c(null),$=c([]);function H(a,t){var o,l;if(t.name==="View Request")if(a){i.value=L({},a),console.log(" === selectedReq ==== ",i.value),S.value=ce((l=JSON.parse((o=i.value)==null?void 0:o.json_columns))==null?void 0:l.fields),console.log(S.value,"selected Request");const n=[["wf_generated_request_id","like",`%${i.value.name}%`]],f={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(n),order_by:`\`tab${i.value.doctype_name}\`.\`creation\` desc`};h.get(`${R.resource}${i.value.doctype_name}`,{params:f}).then(C=>{C.data&&($.value=C.data[0],console.log("doctype Form === ",$.value),X($.value,S.value))}).catch(C=>{console.error("Error fetching categories data:",C)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ")}const z=a=>{x.value=x.value.concat(a)};function G(a,t){let o={};x.value.length&&x.value.map(l=>{o[l.fieldname]=l.value}),h.put(`${R.resource}/${i.value.doctype_name}/${$.value.name}`,o).then(l=>{console.log(),l!=null&&l.data&&K(a,t)})}function K(a,t){let o={property:i.value.property,doctype:i.value.doctype_name,request_ids:[i.value.name],reason:"",action:t,files:null,cluster_name:null,url_for_approval_id:"",current_level:i.value.current_level};console.log(a,{request_details:[o]},"---------------------================"),h.post(R.requestApproval,{request_details:[o]}).then(l=>{var n;(n=l==null?void 0:l.message)!=null&&n.success&&(pe.success(`Request ${t}ed`,{autoClose:1e3}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),q())}).catch(l=>{console.error("Error fetching data:",l)})}function Q(a,t){console.log(a);let o={property:i.value.property,doctype:i.value.doctype_name,request_id:i.value.name,reason:"",action:t,files:[],url_for_cancelling_id:"",current_level:i.value.current_level};h.post(R.wf_cancelling_request,o).then(l=>{var n;(n=l.message)!=null&&n.success&&(bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),q())})}function X(a,t){t.forEach(o=>{o.sections.forEach(l=>{l.rows.forEach(n=>{n.columns.forEach(f=>{f.fields.forEach(w=>{a!=null&&a.hasOwnProperty(w==null?void 0:w.fieldname)&&(w.value=a[w.fieldname])})})})})})}const P=j(()=>[{value:e.doctype_name,applied:e.applieddoctype_name},{value:e.name,applied:e.appliedname},{value:e.status,applied:e.appliedStatus},{value:e.accessible_departments,applied:e.appliedaccessible_departments},{value:e.request_id,applied:e.appliedrequest_id},{value:e.requested_on,applied:e.appiedrequestedOn},{value:e.owner,applied:e.appliedowner}].filter(a=>a.applied&&a.value).length);function y(a){a==="name"?(e.name="",e.appliedname=!1):a==="doctype_name"?(e.doctype_name="",e.applieddoctype_name=!1):a==="accessible_departments"?(e.accessible_departments="",e.appliedaccessible_departments=!1):a==="status"?(e.status="",e.appliedStatus=!1):a==="request_id"?(e.request_id="",e.appliedrequest_id=!1):a==="requested_on"?(e.requested_on="",e.appiedrequestedOn=!1):a==="owner"&&(e.owner="",e.appliedowner=!1),I()}function I(){e.appliedname=!!e.name,e.applieddoctype_name=!!e.doctype_name,e.appliedaccessible_departments=!!e.accessible_departments,e.appliedStatus=!!e.status,e.appliedrequest_id=!!e.request_id,e.appiedrequestedOn=!!e.requested_on,e.appliedowner=!!e.owner,q()}const Y=a=>{k.value.limitPageLength=a,k.value.limit_start=0,q()},Z=([a,t])=>{k.value.limitPageLength=a,k.value.limit_start=t,q()};function ee(a){console.log("Applied searchedData:",a);const t=[];A.value.forEach(o=>{const l=o.td_key;a[l]&&t.push([l,"like",`%${a[l]}%`])}),console.log("Dynamic Filters:",t),q()}function q(){const a=JSON.parse(localStorage.getItem("employeeData"));console.log(a,"---------------------");const t=[["assigned_to_users","like",`%${a==null?void 0:a.designation}%`],["property","like",`%${p.value.business_unit}%`]];e.name&&t.push(["name","=",e.name]),e.doctype_name&&t.push(["doctype_name","=",e.doctype_name]),e.accessible_departments&&t.push(["accessible_departments","like",e.accessible_departments]),e.status&&t.push(["status","like",e.status]),e.request_id&&t.push(["request_id","like",e.request_id]),e.requested_on&&t.push(["requested_on","like",e.requested_on]),e.owner&&t.push(["owner","like",e.owner]);const o={fields:JSON.stringify(["*"]),limit_page_length:k.value.limitPageLength,limit_start:k.value.limit_start,filters:JSON.stringify(t),order_by:"`tabWF Workflow Requests`.`creation` desc"},l={fields:JSON.stringify(["count(`tabWF Workflow Requests`.`name`) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(t)};h.get(`${R.resource}${J.WFWorkflowRequests}`,{params:l}).then(n=>{O.value=n.data[0].total_count}).catch(n=>{console.error("Error fetching total count:",n)}),h.get(`${R.resource}${J.WFWorkflowRequests}`,{params:o}).then(n=>{console.log("output-res",n),V.value=n.data,N.value=[...new Set(n.data.map(f=>f.name))],B.value=[...new Set(n.data.map(f=>f.doctype_name))],E.value=[...new Set(n.data.map(f=>f.status))]}).catch(n=>{console.error("Error fetching records:",n)})}return ne(m,a=>{p.value.business_unit=a,a.length&&(console.log(a,"new value of business unit"),q())},{immediate:!0}),ie(()=>{}),(a,t)=>(d(),r("div",null,[s("div",fe,[s("div",null,[t[15]||(t[15]=s("h1",{class:"m-0 font-13"}," Requests received for me ",-1)),s("p",_e,_(O.value)+" request ",1)]),s("div",ve,[s("div",be,[s("div",null,[s("div",ge,[e.name&&e.appliedname?(d(),r("span",ye,[b(_(e.name)+" ",1),e.name?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[0]||(t[0]=o=>y("name"))},t[16]||(t[16]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0),e.doctype_name&&e.applieddoctype_name?(d(),r("span",qe,[b(_(e.doctype_name)+" ",1),e.doctype_name?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[1]||(t[1]=o=>y("doctype_name"))},t[17]||(t[17]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0),e.accessible_departments&&e.appliedaccessible_departments?(d(),r("span",ke,[b(_(e.accessible_departments)+" ",1),e.accessible_departments?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[2]||(t[2]=o=>y("accessible_departments"))},t[18]||(t[18]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0),e.status&&e.appliedStatus?(d(),r("span",we,[b(_(e.status)+" ",1),e.status?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[3]||(t[3]=o=>y("status"))},t[19]||(t[19]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0),e.request_id&&e.appliedrequest_id?(d(),r("span",he,[b(_(e.request_id)+" ",1),e.request_id?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[4]||(t[4]=o=>y("request_id"))},t[20]||(t[20]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0),e.requested_on&&e.appiedrequestedOn?(d(),r("span",Re,[b(_(e.requested_on)+" ",1),e.requested_on?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[5]||(t[5]=o=>y("requested_on"))},t[21]||(t[21]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0),e.owner&&e.appliedowner?(d(),r("span",Fe,[b(_(e.owner)+" ",1),e.owner?(d(),r("span",{key:0,class:"badge badge-icon rounded-3 text-white",onClick:t[6]||(t[6]=o=>y("owner"))},t[22]||(t[22]=[s("i",{class:"ri-close-line close-icon text-dark rounded-3"},null,-1)]))):u("",!0)])):u("",!0)])]),s("div",null,[s("button",xe,[t[23]||(t[23]=s("span",null,[s("i",{class:"ri-filter-2-line"})],-1)),P.value!==0?(d(),r("span",Se," ( "+_(P.value)+") ",1)):u("",!0)])])]),s("div",$e,[s("div",Ce,[s("div",Oe,[s("div",Ve,[s("div",Ne,[s("div",Be,[t[24]||(t[24]=s("label",{class:"font-13 ps-1",for:"Requested"},"Request Id:",-1)),v(F,{tag:"select",placeholder:"Requested Id",class:"mb-3",name:"dept",modelValue:e.name,"onUpdate:modelValue":t[7]||(t[7]=o=>e.name=o),id:"id",Required:!1,options:N.value},null,8,["modelValue","options"])]),s("div",Ee,[t[25]||(t[25]=s("label",{class:"font-13 ps-1",for:"Requested"},"Form Name:",-1)),v(F,{tag:"select",placeholder:"Form Name",class:"mb-3",name:"dept",modelValue:e.doctype_name,"onUpdate:modelValue":t[8]||(t[8]=o=>e.doctype_name=o),id:"id",Required:!1,options:B.value},null,8,["modelValue","options"])]),s("div",Ae,[t[26]||(t[26]=s("label",{class:"font-13 ps-1",for:"dept"},"Requested On:",-1)),v(F,{class:"",tag:"input",type:"search",name:"Requested",id:"Requested",placeholder:"Search",modelValue:e.requested_on,"onUpdate:modelValue":t[9]||(t[9]=o=>e.requested_on=o)},null,8,["modelValue"])]),s("div",Pe,[t[27]||(t[27]=s("label",{class:"font-13 ps-1",for:"status"},"Status:",-1)),v(F,{tag:"select",placeholder:"Status",class:"mb-3",name:"status",modelValue:e.status,"onUpdate:modelValue":t[10]||(t[10]=o=>e.status=o),id:"status",Required:!1,options:E.value},null,8,["modelValue","options"])]),s("div",Ie,[t[28]||(t[28]=s("label",{class:"font-13 ps-1",for:"Requested"},"Owner Of Form:",-1)),v(F,{class:"mb-3",tag:"input",type:"search",name:"Requested",id:"Requested",placeholder:"Search",modelValue:e.owner,"onUpdate:modelValue":t[11]||(t[11]=o=>e.owner=o)},null,8,["modelValue"])])])]),s("div",Me,[s("button",{type:"button",class:"cancelfilter border-0 text-nowrap font-10",onClick:t[12]||(t[12]=(...o)=>a.resetFilters&&a.resetFilters(...o)),"data-bs-dismiss":"modal"},t[29]||(t[29]=[s("span",{class:"font-14 me-1"},"x",-1),b("Cancel Filter")])),s("button",{type:"button",class:"applyfilter text-nowrap border-0 btn btn-dark text-white font-10 d-flex justify-content-center align-items-center","data-bs-dismiss":"modal",onClick:I},t[30]||(t[30]=[s("span",{class:"font-16 me-1"},[s("i",{class:"bi bi-check2"})],-1),b(" Apply Filter")]))])])])])])]),s("div",Ue,[v(de,{tHeaders:A.value,tData:V.value,isAction:"true",actionType:"dropdown",isCheckbox:"true",onUpdateFilters:ee,"field-mapping":D.value,isFiltersoption:"false",actions:T.value,onActionClicked:H},null,8,["tHeaders","tData","field-mapping","actions"]),v(re,{currentRecords:V.value.length,totalRecords:O.value,onUpdateValue:Y,onLimitStart:Z},null,8,["currentRecords","totalRecords"])]),s("div",Le,[s("div",je,[s("div",Je,[s("div",We,[s("h5",De,"Request Id: "+_(i.value.name),1),t[31]||(t[31]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),s("div",Te,[v(me,{blockArr:S.value,onUpdateField:z},null,8,["blockArr"])]),s("div",He,[s("div",ze,[s("div",null,[v(W,{onClick:t[13]||(t[13]=o=>Q(a.formData,"Reject")),type:"button",icon:"x",class:"rejectbtn border-1 text-nowrap font-10",name:"Reject"})]),s("div",null,[v(W,{type:"button",icon:"check2",class:"approvebtn border-1 text-nowrap font-10",onClick:t[14]||(t[14]=o=>G(a.formData,"Approve")),name:"Approve"})])])])])])])]))}},Ze=oe(Ge,[["__scopeId","data-v-d49ba57b"]]);export{Ze as default};
