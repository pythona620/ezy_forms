var ie=Object.defineProperty;var J=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var j=(g,c,u)=>c in g?ie(g,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):g[c]=u,D=(g,c)=>{for(var u in c||(c={}))re.call(c,u)&&j(g,u,c[u]);if(J)for(var u of J(c))de.call(c,u)&&j(g,u,c[u]);return g};import{q as ce,e as ue,d as o,u as me,I as fe,w as ve,f as pe,o as R,c as P,b as t,t as b,a as V,_ as _e,P as ge,j as v,h as B,z as ye,A as he,y as be,E as we,J as ke,l as p,m as _,p as S,n as qe}from"./index-DXneRfP_.js";const Re={class:"d-flex justify-content-between align-items-center py-2"},Pe={class:"m-0 font-11 pt-1"},$e={class:"mt-2"},Ce={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},Ee={class:"modal-dialog modal-dialog-centered modal-lg"},Ne={class:"modal-content"},xe={class:"modal-header py-2 d-block"},Se={class:"d-flex justify-content-between align-items-center"},Oe={class:"m-0 font-13",id:"viewRequest"},Fe={class:""},Le={class:"activity-log-container"},Te={class:"activity-log-content"},Ae={class:"font-12 mb-1"},Me={class:"strong-content"},Je={class:"strong-content"},je={class:"strong-content"},De={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},Ve={class:"modal-dialog modal-xl"},Be={class:"modal-content"},Ie={class:"modal-header py-2 d-block bg-dark text-white"},We={class:"d-flex justify-content-between align-items-center"},Ue={class:""},He={class:"modal-body pdf-body"},ze=["innerHTML"],Ge={__name:"MyTeam",setup(g){const c=ue(()=>we.value),u=o({business_unit:""}),I=me(),W=fe(),h=o({limitPageLength:20,limit_start:0}),E=o(0),n=o({}),O=o(null),w=o([]),U=o([]),H=o([]),z=o([]);o([]);const k=o([]),G=o(""),F=o(""),N=o([]);o([]);const Q=o([]),X=o(""),x=o([]),L=o([{th:"Request ID",td_key:"name"},{th:"Form name",td_key:"doctype_name"},{th:"Owner of form",td_key:"role"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"}]),Y=o({name:{type:"input"},status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},role:{type:"input"},doctype_name:{type:"input"}}),Z=o([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(a,e){var l,i,f;if(e.name==="View Request")if(a){n.value=D({},a),G.value=(l=n.value)==null?void 0:l.total_levels,Q.value=JSON.parse((i=n.value)==null?void 0:i.json_columns).child_table_fields,O.value=ke(JSON.parse((f=n.value)==null?void 0:f.json_columns).fields);const y=[["wf_generated_request_id","like",`%${n.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(y),order_by:`\`tab${n.value.doctype_name}\`.\`creation\` desc`};p.get(`${_.resource}${n.value.doctype_name}`,{params:r}).then(s=>{s.data&&(w.value=s.data,se(w.value[0],O.value),p.get(`${_.resource}${n.value.doctype_name}`).then(d=>{console.log("Data for :",d.data[0])}).catch(d=>{console.error("Error fetching data for :",d)}),p.get(`${_.resource}${n.value.doctype_name}/${s.data[0].name}`).then(d=>{const m=Object.keys(d.data).filter(C=>Array.isArray(d.data[C]));m.length&&(x.value={},m.forEach(C=>{x.value[C]=d.data[C]||[]}))}).catch(d=>{console.error("Error fetching data for :",d)}))}).catch(s=>{console.error("Error fetching categories data:",s)}),p.get(`${_.resource}${S.WFActivityLog}/${n.value.name}`).then(s=>{s.data&&(N.value=s.data.reason||[])}).catch(s=>{console.error("Error fetching activity data:",s)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(e.name==="PDF Format"){n.value=a;const y=[["wf_generated_request_id","like",`%${n.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(y),order_by:`\`tab${n.value.doctype_name}\`.\`creation\` desc`};p.get(`${_.resource}${n.value.doctype_name}`,{params:r}).then(s=>{if(s.data){w.value=s.data;const d={form_short_name:a.doctype_name,name:w.value[0].name,business_unit:c.value};p.post(_.preview_dynamic_form,d).then(m=>{F.value=m.message}).catch(m=>{console.error("Error fetching data:",m)})}}).catch(s=>{console.error("Error fetching categories data:",s)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function ee(a){W.push({name:"ApproveRequest",query:{routepath:I.path,name:a.name,doctype_name:a.doctype_name,type:"myteam",readOnly:"true"}})}function T(){x.value=[],X.value=""}const te=a=>a?new Date(a).toLocaleDateString("en-GB"):"N/A",ae=a=>a?{"Request Cancelled":"cancelled","Request Raised":"raised"}[a]||a.toLowerCase():"performed an action on";function A(){var e;const a={form_short_name:n.value.doctype_name,name:(e=w.value[0])==null?void 0:e.name};p.post(_.download_pdf_form,a).then(l=>{let i=qe+l.message;i=i.replace("/api","");const f=document.createElement("a");f.href=i,f.download=l.message.split("/").pop(),f.click()}).catch(l=>{console.error("Error fetching data:",l)})}function se(a,e){e.forEach(l=>{l.sections.forEach(i=>{i.rows.forEach(f=>{f.columns.forEach(y=>{y.fields.forEach(r=>{a!=null&&a.hasOwnProperty(r==null?void 0:r.fieldname)&&(r.value=a[r==null?void 0:r.fieldname])})})})})})}const oe=a=>{h.value.limitPageLength=a,h.value.limit_start=0,q()},ne=([a,e])=>{h.value.limitPageLength=a,h.value.limit_start=e,q()},M=o(null);function le(a){clearTimeout(M.value),M.value=setTimeout(()=>{const e=[];L.value.forEach(l=>{const i=l.td_key;a[i]&&e.push(i,"like",`%${a[i]}%`)}),e.length?q(e):q()},500)}function q(a){var f,y,r,$;const e=[["property","like",`%${u.value.business_unit}%`]];a&&e.push(a);const l={fields:JSON.stringify(["*"]),limit_page_length:(f=h.value)==null?void 0:f.limitPageLength,limit_start:(y=h.value)==null?void 0:y.limit_start,filters:JSON.stringify(e),order_by:"`tabWF Workflow Requests`.`creation` desc"},i={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(e)};p.get(`${(r=_)==null?void 0:r.resource}${($=S)==null?void 0:$.WFWorkflowRequests}`,{params:i}).then(s=>{E.value=s.data[0].total_count}).catch(s=>{console.error("Error fetching total count:",s)}),p.get(`${_.resource}${S.WFWorkflowRequests}`,{params:l}).then(s=>{const d=s.data;h.value.limit_start===0?(k.value=d,U.value=[...new Set(s.data.map(m=>m.name))],H.value=[...new Set(s.data.map(m=>m.doctype_name))],z.value=[...new Set(s.data.map(m=>m.status))]):k.value=k.value.concat(d)}).catch(s=>{console.error("Error fetching records:",s)})}return ve(c,a=>{u.value.business_unit=a,a.length&&q()},{immediate:!0}),pe(()=>{}),(a,e)=>(R(),P("div",null,[t("div",Re,[t("div",null,[e[0]||(e[0]=t("h1",{class:"m-0 font-13"},"My Team",-1)),t("p",Pe,b(E.value)+" request",1)])]),t("div",$e,[V(_e,{tHeaders:L.value,tData:k.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",actions:Z.value,onActionClicked:K,isFiltersoption:"true","field-mapping":Y.value,onCellClick:ee,onUpdateFilters:le},null,8,["tHeaders","tData","actions","field-mapping"]),V(ge,{currentRecords:k.value.length,totalRecords:E.value,onUpdateValue:oe,onLimitStart:ne},null,8,["currentRecords","totalRecords"])]),t("div",Ce,[t("div",Ee,[t("div",Ne,[t("div",xe,[t("div",Se,[t("div",null,[t("h5",Oe,"Request Id: "+b(n.value.name),1)]),t("div",Fe,[n.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-white text-dark font-13",onClick:A},e[1]||(e[1]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):B("",!0),t("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:T,"data-bs-dismiss":"modal"},e[2]||(e[2]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),e[9]||(e[9]=t("div",{class:"modal-body approvermodalbody"},null,-1)),t("div",Le,[(R(!0),P(ye,null,he(N.value,(l,i)=>(R(),P("div",{key:i,class:be(["activity-log-item",{"last-item":i===N.value.length-1}])},[e[8]||(e[8]=t("div",{class:"activity-log-dot"},null,-1)),t("div",Te,[t("p",Ae,[e[3]||(e[3]=v(" On ")),t("strong",Me,b(te(l.creation)),1),e[4]||(e[4]=v(", ")),e[5]||(e[5]=t("strong",{class:"strong-content"}," you ",-1)),v(" ("+b(l.role)+") ",1),t("strong",Je,b(ae(l.action)),1),e[6]||(e[6]=v(" the request with the comments: ")),t("strong",je,b(l.reason||"N/A"),1),e[7]||(e[7]=v(". "))])])],2))),128))]),e[10]||(e[10]=t("div",{class:"modal-footer"},null,-1))])])]),t("div",De,[t("div",Ve,[t("div",Be,[t("div",Ie,[t("div",We,[e[13]||(e[13]=t("div",null,[t("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),t("div",Ue,[n.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-dark text-white font-13",onClick:A},e[11]||(e[11]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):B("",!0),t("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:T,"data-bs-dismiss":"modal"},e[12]||(e[12]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),t("div",He,[t("div",{innerHTML:F.value},null,8,ze)]),e[14]||(e[14]=t("div",{class:"modal-footer"},null,-1))])])])]))}},Ye=ce(Ge,[["__scopeId","data-v-cb310ef7"]]);export{Ye as default};
