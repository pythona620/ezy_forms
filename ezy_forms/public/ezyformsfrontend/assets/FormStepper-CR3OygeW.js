var vl=Object.defineProperty,bl=Object.defineProperties;var _l=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var yl=Object.prototype.hasOwnProperty,gl=Object.prototype.propertyIsEnumerable;var ut=(I,v,k)=>v in I?vl(I,v,{enumerable:!0,configurable:!0,writable:!0,value:k}):I[v]=k,Y=(I,v)=>{for(var k in v||(v={}))yl.call(v,k)&&ut(I,k,v[k]);if(dt)for(var k of dt(v))gl.call(v,k)&&ut(I,k,v[k]);return I},Fe=(I,v)=>bl(I,_l(v));var Ce=(I,v,k)=>new Promise((F,ae)=>{var J=T=>{try{r(k.next(T))}catch(W){ae(W)}},be=T=>{try{r(k.throw(T))}catch(W){ae(W)}},r=T=>T.done?F(T.value):Promise.resolve(T.value).then(J,be);r((k=k.apply(I,v)).next())});import{_ as hl,u as wl,M as kl,r as n,e as O,x as E,E as Sl,w as j,f as xl,a6 as ct,K as G,y as R,z as N,U as Z,o as i,c as d,d as t,t as _,L as q,l as f,a7 as Fl,m as p,F as Q,h as K,n as ee,b as M,O as ve,R as re,Q as pt,X as de,i as x,v as Cl,N as te,j as le,k as Pe,a8 as Dl,Z as ql,a9 as Ll,S as Bl,H as se,aa as ze,a2 as mt,ab as Al,ac as $l,D as Vl}from"./index-BICkGThB.js";const El={class:""},Ml={class:""},Il={class:"d-flex justify-content-between align-items-center CancelNdSave"},Ol={class:"d-flex align-items-center"},Rl={key:0,class:"font-16"},Nl=["disabled"],Tl={class:"form-container p-0 container-fluid mt-3"},Ul={class:"row g-4"},Pl={class:"col-lg-2 col-md-3 col-sm-12"},zl={class:"steps-sticky-div"},Hl={class:"steps d-sm-inline-flex d-md-block m-0 p-0"},Yl=["onClick"],Jl={key:0,class:"ri-checkbox-circle-fill completedStepIcon"},Wl={class:"step-text"},jl={class:"font-11"},Gl={class:"font-14"},Zl={class:"col-lg-10 col-md-9 col-sm-12 formbackground-color"},Ql={class:"px-2"},Kl={class:"form-content stepsDiv"},Xl={key:0},es={class:""},ts={class:"stepperbackground ps-3 pe-3 py-2 m-0 d-flex justify-content-between align-items-center"},ls={class:"d-flex gap-2 align-items-center"},ss=["disabled"],os={class:"container-fluid aboutFields p-0"},as={class:"row"},ns={class:"col-12"},is={class:"p-4"},rs={class:"card border-0 shadow-sm mb-4"},ds={class:"card-body p-4"},us={class:"row g-4"},cs={class:"col-md-6"},ps={class:"position-relative"},ms={key:0,class:"badge bg-success position-absolute",style:{top:"-8px",right:"10px","z-index":"10"}},fs={key:1,class:"text-danger font-12 ms-1"},vs={class:"col-md-6"},bs={key:0,class:"text-danger font-12 ms-1"},_s={class:"col-md-6"},ys={class:"card border-0 shadow-sm mb-4"},gs={class:"card-body p-4"},hs={class:"row g-4"},ws={class:"col-md-6"},ks={class:"form-label font-13 fw-medium"},Ss={key:0,class:"text-danger"},xs={class:"col-md-6"},Fs={class:"form-label font-13 fw-medium"},Cs={key:0,class:"text-danger"},Ds={class:"col-md-12"},qs={class:"form-label font-13 fw-medium"},Ls={key:0,class:"text-danger"},Bs={class:"custom-option"},As=["checked","onChange"],$s={class:"card border-0 shadow-sm mb-4"},Vs={class:"card-body p-4"},Es={class:"row g-4"},Ms={class:"col-md-6"},Is={class:"text-muted font-11 ms-1"},Os={key:0,class:"text-success"},Rs={key:1},Ns={class:"col-md-6"},Ts={key:0,class:"col-md-6"},Us={key:0,class:"card border-0 shadow-sm mb-4"},Ps={class:"card-body p-4"},zs={class:"row g-4"},Hs={class:"col-md-6"},Ys={class:"col-md-6"},Js={key:1,class:"card border-0 shadow-sm mb-4"},Ws={class:"card-body p-4"},js={class:"row g-4"},Gs={class:"col-md-12"},Zs={class:"form-check"},Qs=["disabled"],Ks={key:0,class:"col-md-12"},Xs={class:"position-relative"},eo=["disabled"],to={key:0,class:"list-group position-absolute w-100 z-3",style:{"max-height":"200px","overflow-y":"auto"}},lo=["onMousedown"],so={key:1,class:"frappe-form-builder"},oo={class:"frappe-nav-bar"},ao={class:"nav-left"},no={class:"nav-center"},io={class:"btn-group btn-group-sm",role:"group"},ro=["onClick"],uo=["onClick"],co={class:"nav-right"},po={class:"frappe-builder-container"},mo={class:"frappe-field-library"},fo={class:"field-library-body"},vo={class:"category-title"},bo=["onClick","onDragstart"],_o={class:"field-item-info"},yo={class:"field-item-label"},go={class:"field-item-desc"},ho={class:"frappe-form-canvas"},wo={class:"canvas-header"},ko={class:"mb-0 font-13"},So={class:"field-count"},xo={class:"fields-list"},Fo=["onClick","onDragstart","onDrop"],Co={class:"field-header"},Do={class:"field-label"},qo={key:0,class:"field-required"},Lo={class:"field-actions"},Bo=["onClick"],Ao=["onClick"],$o={class:"field-type-badge"},Vo={key:0,class:"field-meta"},Eo={class:"text-muted"},Mo={key:0,class:"empty-state"},Io={class:"frappe-properties-panel"},Oo={key:0,class:"properties-content"},Ro={class:"properties-header"},No={class:"property-group"},To={class:"property-field"},Uo={class:"property-field"},Po=["value"],zo={class:"property-field"},Ho={key:0,class:"property-group"},Yo={class:"property-field"},Jo={key:1,class:"property-group"},Wo={class:"property-field"},jo={class:"property-group"},Go={class:"property-checkbox"},Zo=["id"],Qo=["for"],Ko={class:"property-checkbox"},Xo=["id"],ea=["for"],ta={class:"property-checkbox"},la=["id"],sa=["for"],oa={class:"property-group"},aa={class:"property-field"},na={class:"property-group"},ia={class:"property-field"},ra={key:1,class:"no-field-selected"},da={class:"modal fade",id:"formViewModal",tabindex:"-1","aria-labelledby":"formViewModalLabel","aria-hidden":"true"},ua={class:"modal-dialog modal-xl modal-dialog-scrollable"},ca={class:"modal-content"},pa={class:"modal-body"},ma={class:"offcanvas addOffCanvas offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},fa={class:"offcanvas-header add_designationHeader"},va={id:"offcanvasRightLabel",class:"font-14 fw-bold"},ba={class:"offcanvas-body add_desig_offCanvas_body p-0"},_a={class:""},ya={key:0,class:"p-3 approval-border-bottom"},ga={class:"px-3 listofdesignations"},ha={class:"my-1 d-flex justify-content-between"},wa={class:"font-12 fw-bold"},ka={class:"italic-style text-secondary font-12"},Sa={key:0,ref:"resizableDiv",class:"my-1 disgnationlist_div"},xa={class:"d-flex align-items-center justify-content-between gap-1"},Fa={class:"form-check ps-1 d-flex align-items-center m-0"},Ca=["checked"],Da={for:"selectAll",class:"form-check-label SelectallDesignation mt-2 fw-bold"},qa={key:0,class:"form-check d-flex align-items-center m-0"},La={key:1},Ba={key:1,class:"p-3"},Aa=["value"],$a={key:2},Va={class:""},Ea={class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Ma={key:0,class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Ia={class:"offcanvas-footer"},Oa={class:"text-end p-3"},oe="Select All",Ra={__name:"FormStepper",setup(I){const v=wl(),k=kl(),F=n(1),ae=n([]);n([]);const J=n([]),be=n([]);O([]);let r=O([]),T=O([]);const W=n([]),B=n([]),De=n([]),U=n(""),A=n(""),C=n("");let D=O([]);const _e=n("");n(!1),n(!1),n(!1);const ye=n(""),qe=n(""),Le=n(""),ft=n([]),vt=n([]);O({});const He=n([]),Be=n(!1),ge=n([]),he=n(!1);let Ye=null;const bt=n("");let V=n("");const _t=n(null);n(null),n(null),n(0);const L=n(0),yt=n(!0),y=n(null),we=n(null),Je=n(!1),We=n(!1),je=n(!1);n(!1);const ke=n([]),Ae=n(null),gt=n("new");n([]);const $e=n([]);n([]);const Se=n([]),ue=E(()=>Sl);n(!1),O([]);const $=n({routepath:v.query.routepath,business_unit:v.query.business_unit,formId:v.query.id});n("");const ht=n(!1),ce=n(!1),Ge=[{label:"Public",value:1},{label:"Private",value:0}],Ve=E({get(){return Ge.find(s=>s.value===a.value.as_web_view)},set(s){a.value.as_web_view=s?s.value:null}}),Ze=E({get(){return a.value.form_name||v.query.form_name||""},set(s){a.value.form_name=s}}),a=n({form_name:"",form_short_name:"",accessible_departments:[],business_unit:`${ue.value.value||$.value.business_unit||v.query.business_unit}`,form_category:"",owner_of_the_form:"",series:"",has_workflow:"",workflow_check:"",is_linked:0,is_linked_form:"",is_predefined_doctype:v.query.id?1:0,as_web_view:0,mail_id:""});j(()=>v.query.form_name,s=>{s&&(a.value.form_name=s,a.value.form_short_name=s)},{immediate:!0});const wt=["name","parent","creation","owner","modified","modified_by","parentfield","parenttype","file_list","flags","docstatus","idx","doctype","company_field","business_unit"].map(s=>s.toLowerCase().trim()),kt=["Approver","Approved on","Approved By"].map(s=>s.toLowerCase().trim());E(()=>a.value),n(""),n(!1),j(ue,s=>{s&&s.value&&(a.value.business_unit=s.value)},{immediate:!0}),j(()=>a.value.form_name,s=>{a.value.form_name=s.trim()}),j(()=>a.value.form_short_name,s=>{a.value.form_short_name=s.trim()}),j(()=>a.value.series,s=>{a.value.series=s.trim()}),j(()=>gt.value,s=>{s==="existing"&&(r.splice(0,r.length),Se.value=[],D.length=0)}),n(null),n(""),n(null);function St(){const s=a.value.is_linked_form;if(!s){ge.value=[];return}clearTimeout(Ye),Ye=setTimeout(()=>{const e=[["business_unit","=",`${ue.value.value}`],["name","like",`%${s}%`]],l={fields:JSON.stringify(["name"]),limit_page_length:10,limit_start:0,filters:JSON.stringify(e),doctype:G.EzyFormDefinitions,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"};R.get(`${N.GetDoctypeData}`,{params:l}).then(o=>{ge.value=o.message.data||[]}).catch(o=>{console.error("Error fetching form definitions:",o)})},300)}function xt(s){a.value.is_linked_form=s,he.value=!1}function Ft(){setTimeout(()=>{he.value=!1},200)}O({query:"",key:""}),O({}),O({}),O({});const Ct=E(()=>r!=null&&r.length?C.value===1?[0]:Array.from({length:C.value},(s,e)=>e).filter(s=>s<C.value):[]);n(null),n(null);const Qe=n([{form_json:""}]),X=n("");xl(()=>{ot(),X.value=v.query.Clone,V.value=v.query.id||"new",X.value==="1"&&(a.value.series=""),V.value!=null&&V.value!=null&&V.value!="new"&&st(),sessionStorage.getItem("allow_approver_to_edit_form")=="1"?Be.value=!0:Be.value=!1;let s=localStorage.getItem("Bu");if(a.value.business_unit=s,v.query.preId==="PreDefine"){const e=localStorage.getItem("form_json");if(e){Qe.value[0].form_json=e;const l=Qe.value[0],o=JSON.parse(l.form_json),u=ct(o.fields);He.value=o.child_table_fields,u.forEach(m=>{r.push(m)})}}}),n(null),O({}),n(null);const Dt=n([]);n([]),O({});const Ee=n([{id:1,label:"Form Info",stepno:"Step 1",icon:"bi bi-info-circle"},{id:2,label:"Form Fields & Workflow",stepno:"Step 2",icon:"bi bi-grid-3x3-gap"}]),xe=[{label:"Data",type:"Data",icon:"bi-input-cursor-text",category:"Basic",description:"Single line text input"},{label:"Small Text",type:"Small Text",icon:"bi-textarea-t",category:"Basic",description:"Multi-line text, comma-separated values"},{label:"Text Editor",type:"Text",icon:"bi-file-earmark-richtext",category:"Basic",description:"Rich text editor"},{label:"Code",type:"Code",icon:"bi-code-slash",category:"Basic",description:"Code editor with syntax highlighting"},{label:"Int",type:"Int",icon:"bi-123",category:"Number",description:"Integer number"},{label:"Float",type:"Float",icon:"bi-hash",category:"Number",description:"Decimal number"},{label:"Currency",type:"Currency",icon:"bi-currency-dollar",category:"Number",description:"Money amount with currency"},{label:"Percent",type:"Percent",icon:"bi-percent",category:"Number",description:"Percentage value"},{label:"Check",type:"Check",icon:"bi-check-square",category:"Selection",description:"Checkbox (Yes/No)"},{label:"Select",type:"Select",icon:"bi-menu-button-wide",category:"Selection",description:"Dropdown selection"},{label:"Table MultiSelect",type:"Table MultiSelect",icon:"bi-ui-checks-grid",category:"Selection",description:"Select multiple items"},{label:"Link",type:"Link",icon:"bi-link-45deg",category:"Selection",description:"Link to another DocType"},{label:"Dynamic Link",type:"Dynamic Link",icon:"bi-diagram-3",category:"Selection",description:"Dynamic link based on another field"},{label:"Rating",type:"Rating",icon:"bi-star",category:"Selection",description:"Star rating field"},{label:"Date",type:"Date",icon:"bi-calendar",category:"DateTime",description:"Date picker"},{label:"Datetime",type:"Datetime",icon:"bi-calendar-event",category:"DateTime",description:"Date and time picker"},{label:"Time",type:"Time",icon:"bi-clock",category:"DateTime",description:"Time picker"},{label:"Duration",type:"Duration",icon:"bi-hourglass-split",category:"DateTime",description:"Time duration (HH:MM:SS)"},{label:"Attach",type:"Attach",icon:"bi-paperclip",category:"Media",description:"File attachment"},{label:"Attach Image",type:"Attach Image",icon:"bi-image",category:"Media",description:"Image upload with preview"},{label:"Image",type:"Image",icon:"bi-file-image",category:"Media",description:"Display image from URL"},{label:"Signature",type:"Signature",icon:"bi-pen",category:"Media",description:"Digital signature pad"},{label:"Password",type:"Password",icon:"bi-key",category:"Special",description:"Masked password input"},{label:"Color",type:"Color",icon:"bi-palette",category:"Special",description:"Color picker"},{label:"Barcode",type:"Barcode",icon:"bi-upc-scan",category:"Special",description:"Barcode/QR code display"},{label:"Geolocation",type:"Geolocation",icon:"bi-geo-alt",category:"Special",description:"Map location picker"},{label:"HTML",type:"HTML",icon:"bi-filetype-html",category:"Special",description:"Custom HTML content"},{label:"JSON",type:"JSON",icon:"bi-braces",category:"Special",description:"JSON data editor"},{label:"Read Only",type:"Read Only",icon:"bi-eye",category:"Special",description:"Display-only text"},{label:"Table",type:"Table",icon:"bi-table",category:"Table",description:"Child table with rows"},{label:"Column Break",type:"Column Break",icon:"bi-layout-three-columns",category:"Layout",description:"Start new column"},{label:"Section Break",type:"Section Break",icon:"bi-layout-sidebar",category:"Layout",description:"Start new section"},{label:"Heading",type:"Heading",icon:"bi-type-h1",category:"Layout",description:"Section heading text"},{label:"Button",type:"Button",icon:"bi-square",category:"Layout",description:"Custom action button"}],ne=s=>{if(!s||!s.sections)return[];const e=[],l=["Column Break","Section Break","Heading","Button"];return s.sections.forEach(o=>{o.rows&&o.rows.forEach(u=>{u.columns&&u.columns.forEach(m=>{m.fields&&m.fields.forEach(c=>{l.includes(c.fieldtype)||e.push({label:c.label||"",fieldtype:c.fieldtype||"",fieldname:c.fieldname||"",options:c.options||"",reqd:c.reqd||0,read_only:c.read_only||0,hidden:c.hidden||0,description:c.description||"",default:c.default||"",value:c.value||""})})})})}),e},Ke=(s,e)=>{(!s.sections||s.sections.length===0)&&(s.sections=[{label:"",rows:[]}]),(!s.sections[0].rows||s.sections[0].rows.length===0)&&(s.sections[0].rows=[{label:"",columns:[]}]),(!s.sections[0].rows[0].columns||s.sections[0].rows[0].columns.length===0)&&(s.sections[0].rows[0].columns=[{label:"",fields:[]}]),s.sections[0].rows[0].columns[0].fields.push(e)},qt=(s,e,l)=>{let o=0;const u=["Column Break","Section Break","Heading","Button"];for(let m of s.sections||[])for(let c of m.rows||[])for(let g of c.columns||[])for(let S=0;S<(g.fields||[]).length;S++)if(!u.includes(g.fields[S].fieldtype)){if(o===e)return Object.assign(g.fields[S],l),!0;o++}return!1},Lt=(s,e)=>{let l=0;const o=["Column Break","Section Break","Heading","Button"];for(let u of s.sections||[])for(let m of u.rows||[])for(let c of m.columns||[])for(let g=0;g<(c.fields||[]).length;g++)if(!o.includes(c.fields[g].fieldtype)){if(l===e)return c.fields.splice(g,1),!0;l++}return!1},Bt=(s,e,l)=>{const o=ne(s),[u]=o.splice(e,1);o.splice(l,0,u);for(let m of s.sections||[])for(let c of m.rows||[])for(let g of c.columns||[])g.fields=[];o.forEach(m=>{s.sections&&s.sections[0]&&s.sections[0].rows&&s.sections[0].rows[0]&&s.sections[0].rows[0].columns&&s.sections[0].rows[0].columns[0]&&s.sections[0].rows[0].columns[0].fields.push(m)})},At=E(()=>[...new Set(xe.map(e=>e.category))].filter(e=>e!=="Layout")),$t=s=>xe.filter(e=>e.category===s),Vt=s=>{const e=xe.find(l=>l.type===s);return(e==null?void 0:e.icon)||"bi-file-text"},Me=()=>{const s=r[L.value];return s?ne(s):[]},Xe=()=>Me().length,b=()=>y.value===null?{}:Me()[y.value]||{},Et=s=>{y.value=s},P=()=>{if(y.value===null)return;const s=r[L.value];if(!s)return;const e=b();qt(s,y.value,e),r.splice(L.value,1,Y({},s))},Mt=()=>{const s=b();["Select","Small Text","Table MultiSelect","Link"].includes(s.fieldtype)||(s.options=""),P()},It=s=>{const e=r[L.value];if(!e)return;const l={label:s.label,fieldtype:s.type,fieldname:et(s.label),reqd:0,read_only:0,hidden:0,options:"",description:"",default:"",value:""};Ke(e,l),r.splice(L.value,1,Y({},e));const o=ne(e);y.value=o.length-1,se(`${s.label} field added successfully`)},et=s=>s.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),Ot=s=>{const e=r[L.value];if(!e)return;const l=ne(e);if(s<0||s>=l.length)return;const o=l[s],u=Fe(Y({},o),{label:`${o.label} (Copy)`,fieldname:`${o.fieldname||et(o.label)}_copy_${Date.now()}`});Ke(e,u),r.splice(L.value,1,Y({},e));const m=ne(e);y.value=m.length-1,se("Field duplicated successfully")},Rt=s=>{const e=r[L.value];if(!e)return;const l=ne(e);s<0||s>=l.length||(y.value===s?y.value=null:y.value!==null&&y.value>s&&y.value--,Lt(e,s),r.splice(L.value,1,Y({},e)),se("Field deleted successfully"))},Nt=s=>{_t.value=s},Tt=s=>{we.value=s},Ut=s=>{if(we.value===null)return;const e=r[L.value];if(!e)return;const l=we.value;Bt(e,l,s),r.splice(L.value,1,Y({},e)),y.value===l&&(y.value=s),we.value=null},Pt=E(()=>[oe,...J.value]),zt=E(()=>{const s=a.value.accessible_departments;return s.includes(oe)?"All Selected":s.length>1?`${s[0]}.. +${s.length-1} more selected`:s.join(", ")}),Ht=s=>s===oe?a.value.accessible_departments.length===J.value.length:a.value.accessible_departments.includes(s),Yt=(s,e)=>{s===oe?e.target.checked?a.value.accessible_departments=[...J.value]:a.value.accessible_departments=[]:(e.target.checked?a.value.accessible_departments.push(s):a.value.accessible_departments=a.value.accessible_departments.filter(l=>l!==s),a.value.accessible_departments.length===J.value.length?a.value.accessible_departments=[...J.value]:a.value.accessible_departments=a.value.accessible_departments.filter(l=>l!==oe))},Jt=s=>{s===oe&&(a.value.accessible_departments=[...J.value])},Wt=s=>{s===oe&&(a.value.accessible_departments=[])},Ie=n(!1),pe=E(()=>{var e;let s=[...W.value];if(ce.value&&(s=s.filter(l=>l.is_hod===1)),(e=_e.value)!=null&&e.trim()){const l=_e.value.toLowerCase();s=s.filter(o=>o.role.toLowerCase().includes(l))}return s.sort((l,o)=>l.role.localeCompare(o.role)),s.sort((l,o)=>{const u=B.value.includes(l.role),m=B.value.includes(o.role);return u===m?0:u?1:-1}),s.map(l=>l.role)}),jt=E(()=>{const s=pe.value;return s.length>0&&s.every(e=>B.value.includes(e))});j([B,pe],()=>{const s=pe.value;Ie.value=s.length>0&&s.every(e=>B.value.includes(e))},{immediate:!0,deep:!0});function Gt(s){const e=s.target.checked,l=W.value.filter(o=>{var u;return!(ce.value&&o.is_hod!==1||(u=_e.value)!=null&&u.trim()&&!o.role.toLowerCase().includes(_e.value.toLowerCase()))}).map(o=>o.role);e?B.value=Array.from(new Set([...B.value,...l])):B.value=B.value.filter(o=>!l.includes(o)),Ie.value=e}function Zt(){B.value=[],Ie.value=!1,ce.value=!1}const me=n("");function Qt(){const s=r[C.value];if(!s||!s.sections){console.error("Error: Invalid block or sections not found.");return}let e={type:C.value==0?"requestor":"approver",roles:B.value,approval_required:qe.value,approver_can_edit:Le.value,fields:s.sections.flatMap(ze),idx:C.value};C.value!==0&&(e.view_only_reportee=me.value==="ViewOnlyReportee"?1:0,e.all_approvals_required=me.value==="all_approvals_required"?1:0,e.requester_as_a_approver=me.value==="requester_as_a_approver"?1:0,e.on_rejection=ye.value?ye.value:0);const l=D.findIndex(o=>o.idx===e.idx);l!==-1?D[l]=e:D.push(e),Kt()}function Kt(){R.post(N.add_roles_WF,{workflow_setup:D,doctype:a.value.form_short_name,business_unit:a.value.business_unit}).then(s=>{console.log(s),C.value==0?se("Requestor Added"):se(`Approver-${C.value} Added`)})}function Xt(){k.push({path:$.value.routepath||localStorage.getItem("routepath")}),localStorage.removeItem("form_json")}function el(){a.value.form_name="",a.value.form_short_name="",a.value.owner_of_the_form="",a.value.form_category="",a.value.accessible_departments=[],a.value.series="",a.value.has_workflow="",a.value.is_linked=0,a.value.is_linked_form="",a.value.mail_id="",a.value.public_form_response="",U.value="",A.value="",ae.value=[],Ae.value=null}const tl=s=>{if(fe.value){Z("Please check all required fields before proceeding.");return}s<F.value?lt():s>F.value&&tt()},tt=()=>{if(fe.value){Z("Please check all required fields before proceeding.");return}F.value<Ee.value.length&&(F.value+=1,F.value===2&&(Ue.value=r))},lt=()=>{F.value>1&&(F.value-=1)},ll=n([]);function st(){je.value=!0;const s={fields:JSON.stringify(["*"]),limit_page_length:"none",doctype:G.EzyFormDefinitions,doc_id:V.value};R.get(N.GetDoctypeData,{params:s}).then(e=>{var o;let l=e==null?void 0:e.message.data;if(l){l.accessible_departments&&typeof l.accessible_departments=="string"?l.accessible_departments=l.accessible_departments.split(",").filter(c=>c.trim()!==""):l.accessible_departments=[],a.value=Fe(Y(Y({},a.value),l),{owner_of_the_form:l.owner_of_the_form||a.value.owner_of_the_form||""}),a.value.owner_of_the_form&&Oe(a.value.owner_of_the_form);const u=JSON.parse((o=e.message.data)==null?void 0:o.form_json);ft.value=u.workflow,bt.value=u.fields.filter(c=>c.fieldtype==="Table"),ll.value=u.fields.filter(c=>c.fieldtype==="Table"),ht.value=e.message.data.is_landscape;let m=ct(JSON.parse(l==null?void 0:l.form_json).fields);He.value=JSON.parse(e.message.data.form_json).child_table_fields,Dt.value=[],vt.value=[],m.forEach((c,g)=>{r.push(c)}),JSON.parse(l==null?void 0:l.form_json).workflow.forEach((c,g)=>{D.push(c)})}}).catch(e=>{console.error("Error fetching data:",e),Z("Failed to load form data. Please try again.")}).finally(()=>{je.value=!1})}function ot(){const s={fields:JSON.stringify(["name","department_name"]),limit_page_length:"none",business_unit:`${$.value.business_unit||v.query.business_unit}`,doctype:G.departments};Je.value=!0,R.get(N.GetDoctypeData,{params:s}).then(e=>{var l;(l=e==null?void 0:e.message.data)!=null&&l.length&&(be.value=e.message.data.map(o=>o.name),J.value=e.message.data.map(o=>o.name))}).catch(e=>{console.error("Error fetching department data:",e),Z("Failed to load departments. Please refresh the page.")}).finally(()=>{Je.value=!1})}n(""),j(()=>a.value.owner_of_the_form,s=>{s&&Oe(s)});function Oe(s){s&&typeof s=="string"&&s.trim()!==""&&sl(s)}function sl(s){We.value=!0;const e={fields:JSON.stringify(["ezy_departments_items"]),doctype:G.departments,doc_id:s};R.get(N.GetDoctypeData,{params:e}).then(l=>{var o;(o=l==null?void 0:l.message.data)!=null&&o.ezy_departments_items&&(ae.value=l.message.data.ezy_departments_items.map(u=>u.category))}).catch(l=>{console.error("Error fetching categories data:",l),Z("Failed to load form categories. Please try again.")}).finally(()=>{We.value=!1})}function Re(s){let e=$l(r);const l=Fe(Y({},a.value),{fields:e,doctype:G.EzyFormDefinitions,workflow_setup:D,form_status:s==="save"?"Created":"Draft"});l.accessible_departments=l.accessible_departments.toString(),R.post(N.savedata,l).then(o=>{if(o&&o.message&&o.message.message){let u=localStorage.getItem("preName");if(u){let m={installed:"Yes"};R.put(`${N.resource}${G.preDefinedForm}/${u}`,m).then(c=>{localStorage.removeItem("preName")}).catch(c=>{console.error("Error fetching ezyForms data:",c)})}if(k.push({params:{paramid:o.message.message},query:{id:o.message.message}}),V.value=o.message.message,V&&V!=="new"&&(r.splice(0,r.length),st()),D.length<r.length)Vl("Add Workflow");else if(nt.value===!0){se("Form Created Successfully!",{autoClose:2e3,transition:"zoom"});let m=localStorage.getItem("routepath");s==="save"?k.push({path:m}):s==="Draft"&&k.push({path:m})}}else console.error("Invalid response structure:",o)}).catch(o=>{console.error("Error saving form data:",o)})}const Ne=n(""),at=()=>{var l,o;const s=r.length,e={label:s===0?"requestor":`approver-${s}`,parent:`${(l=ue.value)==null?void 0:l.value}-${(o=a.value)==null?void 0:o.form_short_name}`,sections:[{label:"",parent:`${ue.value.value}-${a.value.form_short_name}`,childTables:[],afterCreated:{},rows:s===0?[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Requested By",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Requested On",fieldtype:"Datetime",options:"",reqd:!1}]}]},{label:`row_0_1_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1,description:""}]}]}]:[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Approver",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved On",fieldtype:"Datetime",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved By",fieldtype:"Attach",options:"",reqd:!1}]}]}]}]};r.push(e),mt(()=>{Ne.value&&Ne.value.scrollTo({top:Ne.value.scrollHeight,behavior:"smooth"})})},nt=n(!1),ol=s=>{let e=r[s];e.parent&&T.push(e);let l=[];D.length>s&&D[s].roles&&(l=[...D[s].roles]),r.splice(s,1),D.length>s&&D.splice(s,1),r.forEach((o,u)=>{o.sections.forEach((m,c)=>{m.rows.forEach((g,S)=>{g.columns.forEach((h,w)=>{dl(u,c,S,w)})})})}),l.length&&al(l,s)};function al(s,e){const l={role:s,level:e,document_type:a.value.form_name,short_name:a.value.form_short_name,property:a.value.business_unit};R.post(N.deleteAssigneRoles,l).then(o=>{o&&Re()})}function nl(s){return wt.includes(s==null?void 0:s.trim().toLowerCase())}function il(s){return/[^a-zA-Z0-9 _\/!@#$%^&*()?.:;|/\\[\]{}]/.test(s)||s.includes('"')||s.includes("'")}function rl(s){return s.flatMap(e=>{var l;return[(l=e.label)==null?void 0:l.trim().toLowerCase(),...e.sections.flatMap(o=>{var u;return[(u=o.label)==null?void 0:u.trim().toLowerCase(),...o.rows.flatMap(m=>m.columns.flatMap(c=>{var g;return[(g=c.label)==null?void 0:g.trim().toLowerCase(),...c.fields.map(S=>{var h;return(h=S.label)==null?void 0:h.trim().toLowerCase()})]}))]})]}).filter(e=>e!==""&&!kt.includes(e))}function dl(s,e,l,o,u){const c=rl(r).filter((h,w,z)=>z.indexOf(h)!==w),g=Al(r);r.splice(0,r.length,...g);function S(h,w){if(!h){w.errorMsg="";return}nl(h)?w.errorMsg="Entered label is restricted":il(h)?w.errorMsg=`Label should not contain special characters, double quotes (") or single quotes (')`:h.length>64?w.errorMsg="Label should not exceed 64 characters":w.errorMsg=c.includes(h.trim().toLowerCase())?"Duplicate Label Name":""}o!==void 0&&S(r[s].sections[e].rows[l].columns[o].label,r[s].sections[e].rows[l].columns[o]),o===void 0&&u===void 0&&S(r[s].sections[e].label,r[s].sections[e]),r.forEach(h=>{h.sections.forEach(w=>{S(w.label,w),w.rows.forEach(z=>{z.columns.forEach(ie=>{S(ie.label,ie),ie.fields.forEach(H=>{S(H.label,H)})})})})})}const Te=E(()=>{function s(e){return!e||typeof e!="object"?!1:"fieldtype"in e&&e.fieldtype===""||"error"in e&&e.error||"errorMsg"in e&&e.errorMsg||["Select","Table MultiSelect"].includes(e.fieldtype)&&(!e.options||e.options.trim()==="")?!0:Array.isArray(e)?e.some(s):Object.values(e).some(s)}return s(r)}),fe=E(()=>U.value.length>0||A.value.length>0||!a.value.form_category||!a.value.owner_of_the_form||a.value.accessible_departments.length===0),ul=E(()=>r.some(s=>s.sections.some(e=>e.rows.some(l=>l.columns.some(o=>o.fields.some(u=>u.label&&u.fieldtype))))));function it(s,e){let l=s.target.value.trim();if(!l){e==="form_name"?U.value="Input cannot be empty or only spaces":e==="form_short_name"&&(A.value="Input cannot be empty or only spaces");return}if(l.length>63){e==="form_name"?U.value="Name cannot exceed 63 characters":e==="form_short_name"&&(A.value="Short name cannot exceed 63 characters");return}if(/^\d/.test(l)){e==="form_short_name"&&(A.value="First character must be a letter");return}else A.value="";if(e==="form_short_name"&&l.length<2){A.value="Short name must have at least 2 letters";return}if(e==="form_short_name"&&/[^a-zA-Z ]/.test(l)){A.value="Only alphabets and spaces are allowed";return}if(/[^a-zA-Z0-9& ]/.test(l)){e==="form_name"?U.value="Special characters are not allowed":e==="form_short_name"&&(A.value="Special characters are not allowed");return}else e==="form_name"?U.value="":e==="form_short_name"&&(A.value="");const o=[[e,"=",`${l}`],["business_unit","=",`${a.value.business_unit}`]],u={fields:JSON.stringify(["form_name","form_short_name"]),filters:JSON.stringify(o),doctype:G.EzyFormDefinitions};R.get(`${N.GetDoctypeData}`,{params:u}).then(m=>{De.value=m.message.data,e==="form_name"?U.value=l&&De.value.some(c=>c.form_name&&c.form_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Name already exists":"":e==="form_short_name"&&(A.value=l&&De.value.some(c=>c.form_short_name&&c.form_short_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Short name already exists":"")}).catch(m=>{console.error("Error fetching ezyForms data:",m),e==="form_name"?U.value="":e==="form_short_name"&&(A.value="")})}const Ue=n([]),cl=()=>{r.length&&(Ue.value=r,new bootstrap.Modal(document.getElementById("formViewModal")).show())};function pl(){R.post(N.delete_form_items,{deleted_fields:T.flatMap(ze),doctype:V}).then(s=>{var e;(e=s==null?void 0:s.message)!=null&&e.success&&Re()})}function rt(s){return Ce(this,null,function*(){if(Te.value){Z("Please fix the errors before proceeding.");return}nt.value=!0;let e=T.flatMap(ze);V!=null&&V!=null&&V!="new"&&e.length?pl():Re(s)})}const ml=()=>Ce(this,null,function*(){var s;if(!(ke.value.length>0))try{const e={doctype:"WF Roadmap",fields:JSON.stringify(["name","roadmap_title","document_type","workflow_levels","property","cluster_name"]),filters:JSON.stringify([])},l=yield R.get(N.GetDoctypeData,{params:e});(s=l==null?void 0:l.message)!=null&&s.data&&(ke.value=l.message.data.map(o=>({roadmap_title:o.name,display_name:`${o.roadmap_title} (${o.document_type})`,document_type:o.document_type,workflow_levels:o.workflow_levels,property:o.property,cluster_name:o.cluster_name})),console.log("Fetched WF Road Maps:",ke.value))}catch(e){console.error("Error fetching WF Road Maps:",e),Z("Failed to fetch workflow road maps")}}),fl=s=>Ce(this,null,function*(){var e;try{console.log("Selected WF Road Map:",s);const l=yield R.get(`${N.resource}${G.wfRoadmap}/${s.roadmap_title}`),o=((e=l==null?void 0:l.data)==null?void 0:e.data)||(l==null?void 0:l.data)||{};console.log("WF Road Map Data:",o);const u=(o.wf_requestors&&o.wf_requestors.length>0,1),m={};o.wf_level_setup&&o.wf_level_setup.length>0&&o.wf_level_setup.forEach(h=>{m[h.level]||(m[h.level]=[]),m[h.level].push(h)});const c=Object.keys(m).length,g=u+c;for(console.log(`Required blocks: ${g} (1 requestor + ${c} approver levels)`),D=[],$e.value=[],Se.value=[];r.length>g;)r.pop();for(;r.length<g;)at();console.log(`Block adjustment complete: ${r.length} blocks`);let S=0;o.wf_requestors&&o.wf_requestors.length>0?($e.value=o.wf_requestors,console.log(`Loaded ${o.wf_requestors.length} requestor role(s)`),o.wf_requestors.forEach(h=>{D.push({type:"requestor",roles:[h.requestor],auto_approval:h.auto_approval||0,columns_allowed:h.columns_allowed||"",fields:[],idx:0})})):console.warn("No Requestors found in roadmap, creating default requestor setup"),S=1,o.wf_level_setup&&o.wf_level_setup.length>0?(Se.value=o.wf_level_setup.sort((w,z)=>w.level-z.level),console.log(`Loaded ${o.wf_level_setup.length} approver level(s)`),Object.keys(m).sort((w,z)=>parseInt(w)-parseInt(z)).forEach(w=>{const z=m[w],ie=S;console.log(`Level ${w} → Block Index ${ie}, Roles: ${z.length}`),z.forEach(H=>{D.push({type:"approver",level:parseInt(w),roles:[H.role],approval_required:H.mandatory?1:0,approver_can_edit:0,view_only_reportee:H.view_only_reportee||0,all_approvals_required:H.all_approvals_required||0,requester_as_a_approver:H.requester_as_a_approver||0,on_rejection:H.on_rejection||0,columns_allowed:H.columns_allowed||"",fields:[],idx:ie})}),S++})):console.warn("No approver levels found in roadmap"),console.log("Final blockArr length:",r.length),console.log("Final workflowSetup:",D),se(`Workflow configured! ${$e.value.length} requestor role(s), ${Se.value.length} approver level(s) across ${r.length} blocks.`),mt(()=>{L.value=0})}catch(l){console.error("Error in handleWFRoadMapSelect:",l),Z("Failed to load workflow. Please try again.")}});return(s,e)=>(i(),d("div",null,[t("div",El,[t("div",Ml,[t("div",Il,[t("div",Ol,[t("div",{class:"ps-1 my-2 d-flex align-items-center",onClick:e[0]||(e[0]=l=>Xt())},e[40]||(e[40]=[t("button",{class:"btn font-13 ms-3"},[t("i",{class:"bi bi-arrow-left"}),t("span",{class:"ms-2"},"Back")],-1)])),s.$route.query.id||s.$route.query.preId?(i(),d("span",Rl,"("+_($.value.formId||q(v).query.form_name)+")",1)):f("",!0)]),t("div",null,[F.value===2&&q(r).length&&!s.$route.query.id?(i(),d("button",{key:0,disabled:Te.value||fe.value,style:Fl({cursor:Te.value?"not-allowed":"pointer"}),type:"butoon",class:"btn font-13 btn-light",onClick:e[1]||(e[1]=l=>rt("Draft"))},e[41]||(e[41]=[t("i",{class:"bi bi-bookmark-check-fill"},null,-1),p(" Save As Draft ")]),12,Nl)):f("",!0)])]),t("div",Tl,[t("div",Ul,[t("div",Pl,[t("div",zl,[t("ul",Hl,[(i(!0),d(Q,null,K(Ee.value,l=>(i(),d("li",{key:l.id,class:ee({active:F.value===l.id,completed:F.value>l.id})},[t("div",{class:ee(["d-flex gap-3 align-items-center",{"not-allowed":fe.value&&F.value+1===l.id}]),onClick:o=>tl(l.id)},[F.value>l.id?(i(),d("i",Jl)):(i(),d("i",{key:1,class:ee(l.icon)},null,2)),t("div",Wl,[t("span",jl,_(l.stepno),1),e[42]||(e[42]=t("br",null,null,-1)),t("span",Gl,_(l.label),1)])],10,Yl)],2))),128))])])]),t("div",Zl,[t("div",Ql,[t("div",Kl,[F.value===1?(i(),d("div",Xl,[t("div",es,[t("div",ts,[e[45]||(e[45]=t("div",null,[t("h1",{class:"font-16 fw-bold m-0"},"Form Information"),t("p",{class:"font-12 text-muted m-0"},"Configure basic form settings and permissions")],-1)),t("div",ls,[!s.$route.query.id&&!s.$route.query.preId?(i(),d("button",{key:0,class:"btn btn-outline-secondary font-13",type:"button",onClick:el},e[43]||(e[43]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),p("Clear Form ")]))):f("",!0),F.value<Ee.value.length?(i(),d("button",{key:1,class:"btn btn-dark font-13 px-4",disabled:fe.value,onClick:tt},e[44]||(e[44]=[p(" Next "),t("i",{class:"bi bi-arrow-right ms-1"},null,-1)]),8,ss)):f("",!0)])])]),t("div",os,[t("div",as,[t("div",ns,[t("div",is,[t("div",rs,[e[50]||(e[50]=t("div",{class:"card-header bg-light border-bottom"},[t("h6",{class:"m-0 fw-bold font-14"},[t("i",{class:"bi bi-file-earmark-text me-2"}),p("Form Details")])],-1)),t("div",ds,[t("div",us,[t("div",cs,[t("div",ps,[q(v).query.preId?(i(),d("span",ms,e[46]||(e[46]=[t("i",{class:"bi bi-check2-circle me-1"},null,-1),p("Predefined ")]))):f("",!0),M(ve,{disabled:($.value.formId&&$.value.formId.length>0||q(v).query.form_name)&&X.value!=="1",labeltext:"Form Name",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formName",validationStar:"true",placeholder:"Enter form name (e.g., Leave Request)",onChange:e[2]||(e[2]=l=>it(l,"form_name")),modelValue:Ze.value,"onUpdate:modelValue":e[3]||(e[3]=l=>Ze.value=l)},null,8,["disabled","modelValue"]),U.value?(i(),d("span",fs,[e[47]||(e[47]=t("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),p(_(U.value),1)])):f("",!0)])]),t("div",vs,[M(ve,{disabled:($.value.formId&&$.value.formId.length>0||q(v).query.form_name)&&X.value!=="1",labeltext:"Form Short Code",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formShortCode",validationStar:"true",placeholder:"Enter short code (e.g., LR, PR)",onChange:e[4]||(e[4]=l=>it(l,"form_short_name")),modelValue:a.value.form_short_name,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.form_short_name=l)},null,8,["disabled","modelValue"]),A.value?(i(),d("span",bs,[e[48]||(e[48]=t("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),p(_(A.value),1)])):f("",!0)]),t("div",_s,[M(ve,{disabled:$.value.formId&&$.value.formId.length>0&&X.value!=="1",labeltext:"Form Naming Series",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"e.g., YY-YY, YYYY, or ABC",modelValue:a.value.series,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.series=l)},null,8,["disabled","modelValue"]),e[49]||(e[49]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p(" Format examples: "),t("code",null,"YY-YY"),p(" → 24-25-0001, "),t("code",null,"YYYY"),p(" → 2025-0001, "),t("code",null,"ABC"),p(" → ABC-0001 ")],-1))])])])]),t("div",ys,[e[57]||(e[57]=t("div",{class:"card-header bg-light border-bottom"},[t("h6",{class:"m-0 fw-bold font-14"},[t("i",{class:"bi bi-building me-2"}),p("Department & Permissions")])],-1)),t("div",gs,[t("div",hs,[t("div",ws,[t("label",ks,[e[51]||(e[51]=p(" Owner Department ")),a.value.owner_of_the_form?f("",!0):(i(),d("span",Ss,"*"))]),M(q(re),{disabled:$.value.formId&&$.value.formId.length>0&&X.value!=="1",onOpen:ot,options:be.value,onChange:Oe,modelValue:a.value.owner_of_the_form,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.owner_of_the_form=l),placeholder:"Select owning department",multiple:!1,class:"font-12 multiselect",searchable:!0,openDirection:"bottom"},null,8,["disabled","options","modelValue"]),e[52]||(e[52]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p("Department that owns and manages this form ")],-1))]),t("div",xs,[t("label",Fs,[e[53]||(e[53]=p(" Form Category ")),a.value.form_category?f("",!0):(i(),d("span",Cs,"*"))]),M(q(re),{disabled:$.value.formId&&$.value.formId.length>0&&X.value!=="1",options:ae.value,modelValue:a.value.form_category,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.form_category=l),placeholder:"Select a category",multiple:!1,searchable:!0,class:"font-12 multiselect"},null,8,["disabled","options","modelValue"]),e[54]||(e[54]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p("Categorize this form for better organization ")],-1))]),t("div",Ds,[t("label",qs,[e[55]||(e[55]=p(" Accessible to Departments ")),a.value.accessible_departments.length?f("",!0):(i(),d("span",Ls,"*"))]),M(q(re),{modelValue:a.value.accessible_departments,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.accessible_departments=l),options:Pt.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Select departments that can access this form",class:"font-12",onSelect:Jt,onRemove:Wt,openDirection:"bottom"},{option:pt(({option:l})=>[t("div",Bs,[t("input",{type:"checkbox",checked:Ht(l),class:"custom-checkbox",onChange:o=>Yt(l,o),onClick:e[9]||(e[9]=de(()=>{},["stop"]))},null,40,As),t("span",null,_(l),1)])]),selection:pt(({values:l,isOpen:o})=>[l.length?x((i(),d("span",{key:0,class:"multiselect__single font-11"},_(zt.value),513)),[[Cl,!o]]):f("",!0)]),_:1},8,["modelValue","options"]),e[56]||(e[56]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p("Users from these departments can raise requests using this form ")],-1))])])])]),t("div",$s,[e[64]||(e[64]=t("div",{class:"card-header bg-light border-bottom"},[t("h6",{class:"m-0 fw-bold font-14"},[t("i",{class:"bi bi-gear me-2"}),p("Form Settings")])],-1)),t("div",Vs,[t("div",Es,[t("div",Ms,[e[59]||(e[59]=t("label",{class:"form-label font-13 fw-medium"},"Form Type",-1)),M(q(re),{options:Ge,modelValue:Ve.value,"onUpdate:modelValue":e[11]||(e[11]=l=>Ve.value=l),placeholder:"Select form visibility",multiple:!1,searchable:!0,label:"label","track-by":"value",reduce:l=>l.value,class:"font-12 multiselect",openDirection:"bottom"},null,8,["modelValue","reduce"]),t("small",Is,[e[58]||(e[58]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),Ve.value===1?(i(),d("span",Os,"Public forms are accessible via QR code without login")):(i(),d("span",Rs,"Private forms require authentication to access"))])]),t("div",Ns,[e[60]||(e[60]=t("label",{class:"form-label font-13 fw-medium"},[p(" Enable Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),M(q(re),{options:["Yes","No"],modelValue:a.value.has_workflow,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.has_workflow=l),placeholder:"Enable approval workflow?",multiple:!1,class:"font-12 multiselect",searchable:!0},null,8,["modelValue"]),e[61]||(e[61]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p("Enable if this form requires multi-level approvals ")],-1))]),a.value.has_workflow==="Yes"?(i(),d("div",Ts,[e[62]||(e[62]=t("label",{class:"form-label font-13 fw-medium"},[p(" Use Existing Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),M(q(re),{onOpen:ml,options:ke.value,modelValue:Ae.value,"onUpdate:modelValue":e[13]||(e[13]=l=>Ae.value=l),placeholder:"Select a workflow roadmap",multiple:!1,class:"font-12 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:fl,openDirection:"bottom"},null,8,["options","modelValue"]),e[63]||(e[63]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p(" Auto-populates requestor and approver configurations from existing workflow ")],-1))])):f("",!0)])])]),a.value.as_web_view===1?(i(),d("div",Us,[e[69]||(e[69]=t("div",{class:"card-header bg-light border-bottom"},[t("h6",{class:"m-0 fw-bold font-14"},[t("i",{class:"bi bi-qr-code me-2"}),p("Public Form Settings")])],-1)),t("div",Ps,[t("div",zs,[t("div",Hs,[e[65]||(e[65]=t("label",{class:"form-label font-13 fw-medium"},[p(" Submit Response Message "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),M(ve,{class:"formHeight",type:"text",tag:"input",name:"Value",id:"formSubmitResponse",placeholder:"e.g., Thank you! Your request has been submitted.",modelValue:a.value.public_form_response,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.public_form_response=l)},null,8,["modelValue"]),e[66]||(e[66]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p("Message shown to users after successful form submission ")],-1))]),t("div",Ys,[e[67]||(e[67]=t("label",{class:"form-label font-13 fw-medium"},[p(" Notification Email(s) "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),M(ve,{class:"formHeight",type:"text",tag:"input",name:"Value",id:"formSubmitEmail",placeholder:"email1@example.com, email2@example.com",modelValue:a.value.mail_id,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.mail_id=l)},null,8,["modelValue"]),e[68]||(e[68]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),p("Email addresses to notify on form submission (comma-separated) ")],-1))])])])])):f("",!0),q(v).query.preId?(i(),d("div",Js,[e[73]||(e[73]=t("div",{class:"card-header bg-light border-bottom"},[t("h6",{class:"m-0 fw-bold font-14"},[t("i",{class:"bi bi-link-45deg me-2"}),p("Advanced Options")])],-1)),t("div",Ws,[t("div",js,[t("div",Gs,[t("div",Zs,[x(t("input",{class:"form-check-input",disabled:a.value.is_predefined_doctype==1,type:"checkbox",id:"is_linked","onUpdate:modelValue":e[16]||(e[16]=l=>a.value.is_linked=l),"true-value":1,"false-value":0},null,8,Qs),[[te,a.value.is_linked]]),e[70]||(e[70]=t("label",{class:"form-check-label font-13",for:"is_linked"}," Link this form to another form ",-1))]),e[71]||(e[71]=t("small",{class:"text-muted font-11 ms-4"},[t("i",{class:"bi bi-info-circle me-1"}),p("Create a relationship between this form and an existing form ")],-1))]),a.value.is_linked?(i(),d("div",Ks,[e[72]||(e[72]=t("label",{class:"form-label font-13 fw-medium"},"Linked Form",-1)),t("div",Xs,[x(t("input",{type:"text",class:"form-control font-13",id:"standardFormInput",disabled:a.value.is_predefined_doctype==1,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.is_linked_form=l),placeholder:"Type to search and select a form...",onInput:St,onFocus:e[18]||(e[18]=l=>he.value=!0),onBlur:Ft},null,40,eo),[[le,a.value.is_linked_form]]),he.value&&ge.value.length?(i(),d("ul",to,[(i(!0),d(Q,null,K(ge.value,(l,o)=>(i(),d("li",{class:"list-group-item list-group-item-action font-12",key:o,onMousedown:de(u=>xt(l.name),["prevent"]),style:{cursor:"pointer"}},_(l.name),41,lo))),128))])):f("",!0)])])):f("",!0)])])])):f("",!0)])])])])])):f("",!0),F.value===2?(i(),d("div",so,[t("div",oo,[t("div",ao,[t("button",{onClick:e[19]||(e[19]=l=>lt()),class:"btn btn-sm btn-link text-dark"},e[74]||(e[74]=[t("i",{class:"bi bi-chevron-left me-1"},null,-1),p("Back ")]))]),t("div",no,[t("div",io,[(i(!0),d(Q,null,K(q(r),(l,o)=>(i(),d("button",{key:o,type:"button",class:ee(["btn",L.value===o?"btn-primary":"btn-outline-secondary"]),onClick:u=>L.value=o},[p(_(o===0?"Requestor":`Approver ${o}`)+" ",1),q(r).length>1?(i(),d("i",{key:0,class:"bi bi-x ms-2",onClick:de(u=>ol(o),["stop"])},null,8,uo)):f("",!0)],10,ro))),128))])]),t("div",co,[t("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:at},e[75]||(e[75]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),p("Add Block ")])),ul.value?(i(),d("button",{key:0,class:"btn btn-sm btn-outline-secondary me-2",onClick:cl},e[76]||(e[76]=[t("i",{class:"bi bi-eye me-1"},null,-1),p("Preview ")]))):f("",!0),q(r).length?(i(),d("button",{key:1,class:"btn btn-sm btn-primary",onClick:e[20]||(e[20]=l=>rt("save"))},[e[77]||(e[77]=t("i",{class:"bi bi-save me-1"},null,-1)),p(_(q(V)!=="new"?"Update":"Save"),1)])):f("",!0)])]),t("div",po,[t("aside",mo,[e[78]||(e[78]=t("div",{class:"field-library-header"},[t("h6",{class:"mb-0 font-13 fw-bold"},"Add Field")],-1)),t("div",fo,[(i(!0),d(Q,null,K(At.value,l=>(i(),d("div",{key:l,class:"field-category"},[t("div",vo,_(l),1),(i(!0),d(Q,null,K($t(l),o=>(i(),d("div",{key:o.type,class:"field-item",onClick:u=>It(o),draggable:"true",onDragstart:u=>Nt(o)},[t("i",{class:ee(o.icon||"bi-file-text")},null,2),t("div",_o,[t("div",yo,_(o.label),1),t("div",go,_(o.description),1)])],40,bo))),128))]))),128))])]),t("div",ho,[t("div",wo,[t("h6",ko,_(L.value===0?"Requestor Fields":`Approver ${L.value} Fields`),1),t("span",So,_(Xe())+" fields",1)]),t("div",xo,[(i(!0),d(Q,null,K(Me(),(l,o)=>(i(),d("div",{key:"field-"+o,class:ee(["form-field-item",{selected:y.value===o}]),onClick:u=>Et(o),draggable:"true",onDragstart:u=>Tt(o),onDragover:e[21]||(e[21]=de(()=>{},["prevent"])),onDrop:u=>Ut(o)},[t("div",Co,[t("div",Do,[p(_(l.label||"Unnamed Field")+" ",1),l.reqd?(i(),d("span",qo,"*")):f("",!0)]),t("div",Lo,[t("button",{class:"btn btn-sm btn-link p-0 text-secondary",onClick:de(u=>Ot(o),["stop"]),title:"Duplicate"},e[79]||(e[79]=[t("i",{class:"bi bi-files"},null,-1)]),8,Bo),t("button",{class:"btn btn-sm btn-link p-0 text-danger",onClick:de(u=>Rt(o),["stop"]),title:"Delete"},e[80]||(e[80]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Ao)])]),t("div",$o,[t("i",{class:ee(Vt(l.fieldtype))},null,2),p(" "+_(l.fieldtype||"Data"),1)]),l.options&&["Select","Link"].includes(l.fieldtype)?(i(),d("div",Vo,[t("small",Eo,_(l.options),1)])):f("",!0)],42,Fo))),128)),t("div",{class:"add-field-btn",onClick:e[22]||(e[22]=l=>yt.value=!0)},e[81]||(e[81]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),p(" Add Field ")])),Xe()===0?(i(),d("div",Mo,e[82]||(e[82]=[t("i",{class:"bi bi-inbox"},null,-1),t("p",null,"No fields yet",-1),t("small",null,'Click "Add Field" or drag a field type from the left',-1)]))):f("",!0)])]),t("aside",Io,[y.value!==null?(i(),d("div",Oo,[t("div",Ro,[e[84]||(e[84]=t("div",{class:"properties-title"},[t("i",{class:"bi bi-sliders me-2"}),p(" Field Properties ")],-1)),t("button",{class:"btn btn-sm btn-link p-0 text-secondary",onClick:e[23]||(e[23]=l=>y.value=null)},e[83]||(e[83]=[t("i",{class:"bi bi-x-lg"},null,-1)]))]),t("div",No,[e[90]||(e[90]=t("div",{class:"property-group-title"},"Basic",-1)),t("div",To,[e[85]||(e[85]=t("label",{class:"property-label"},"Label",-1)),x(t("input",{type:"text",class:"property-input","onUpdate:modelValue":e[24]||(e[24]=l=>b().label=l),placeholder:"Field Label",onInput:P},null,544),[[le,b().label]])]),t("div",Uo,[e[87]||(e[87]=t("label",{class:"property-label"},"Field Type",-1)),x(t("select",{class:"property-input","onUpdate:modelValue":e[25]||(e[25]=l=>b().fieldtype=l),onChange:Mt},[e[86]||(e[86]=t("option",{value:""},"Select Type",-1)),(i(),d(Q,null,K(xe,l=>t("option",{key:l.type,value:l.type},_(l.label),9,Po)),64))],544),[[Pe,b().fieldtype]])]),t("div",zo,[e[88]||(e[88]=t("label",{class:"property-label"},"Field Name",-1)),x(t("input",{type:"text",class:"property-input","onUpdate:modelValue":e[26]||(e[26]=l=>b().fieldname=l),placeholder:"field_name",onInput:P},null,544),[[le,b().fieldname]]),e[89]||(e[89]=t("small",{class:"property-help-text"},"Internal field name (lowercase, underscores)",-1))])]),["Select","Small Text","Table MultiSelect"].includes(b().fieldtype)?(i(),d("div",Ho,[e[92]||(e[92]=t("div",{class:"property-group-title"},"Options",-1)),t("div",Yo,[e[91]||(e[91]=t("label",{class:"property-label"},"Options (one per line)",-1)),x(t("textarea",{class:"property-input",rows:"4","onUpdate:modelValue":e[27]||(e[27]=l=>b().options=l),placeholder:`Option 1
Option 2
Option 3`,onInput:P},null,544),[[le,b().options]])])])):f("",!0),b().fieldtype==="Link"?(i(),d("div",Jo,[e[94]||(e[94]=t("div",{class:"property-group-title"},"Link Settings",-1)),t("div",Wo,[e[93]||(e[93]=t("label",{class:"property-label"},"Link To (DocType)",-1)),x(t("input",{type:"text",class:"property-input","onUpdate:modelValue":e[28]||(e[28]=l=>b().options=l),placeholder:"Enter DocType name",onInput:P},null,544),[[le,b().options]])])])):f("",!0),t("div",jo,[e[95]||(e[95]=t("div",{class:"property-group-title"},"Validation",-1)),t("div",Go,[x(t("input",{type:"checkbox",id:"mandatory-"+y.value,"onUpdate:modelValue":e[29]||(e[29]=l=>b().reqd=l),"true-value":1,"false-value":0,onChange:P},null,40,Zo),[[te,b().reqd]]),t("label",{for:"mandatory-"+y.value},"Mandatory",8,Qo)]),t("div",Ko,[x(t("input",{type:"checkbox",id:"readonly-"+y.value,"onUpdate:modelValue":e[30]||(e[30]=l=>b().read_only=l),"true-value":1,"false-value":0,onChange:P},null,40,Xo),[[te,b().read_only]]),t("label",{for:"readonly-"+y.value},"Read Only",8,ea)]),t("div",ta,[x(t("input",{type:"checkbox",id:"hidden-"+y.value,"onUpdate:modelValue":e[31]||(e[31]=l=>b().hidden=l),"true-value":1,"false-value":0,onChange:P},null,40,la),[[te,b().hidden]]),t("label",{for:"hidden-"+y.value},"Hidden",8,sa)])]),t("div",oa,[e[97]||(e[97]=t("div",{class:"property-group-title"},"Help",-1)),t("div",aa,[e[96]||(e[96]=t("label",{class:"property-label"},"Description",-1)),x(t("textarea",{class:"property-input",rows:"3","onUpdate:modelValue":e[32]||(e[32]=l=>b().description=l),placeholder:"Help text for this field",onInput:P},null,544),[[le,b().description]])])]),t("div",na,[t("div",ia,[e[98]||(e[98]=t("label",{class:"property-label"},"Default Value",-1)),x(t("input",{type:"text",class:"property-input","onUpdate:modelValue":e[33]||(e[33]=l=>b().default=l),placeholder:"Default value",onInput:P},null,544),[[le,b().default]])])])])):(i(),d("div",ra,e[99]||(e[99]=[t("i",{class:"bi bi-hand-index"},null,-1),t("p",null,"Select a field",-1),t("small",null,"Click on a field to edit its properties",-1)])))])])])):f("",!0)])])])])])])]),t("div",da,[t("div",ua,[t("div",ca,[e[100]||(e[100]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"formViewModalLabel"},"Form Preview"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",pa,[M(Dl,{blockArr:Ue.value},null,8,["blockArr"])]),e[101]||(e[101]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),t("div",ma,[t("div",fa,[t("span",va,_(C.value==0?"Add Requestors":`Approval Settings - Level ${C.value}`),1),e[102]||(e[102]=t("button",{type:"button",class:"btn-close bg-light text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),t("div",ba,[t("div",_a,[C.value!==0?(i(),d("div",ya,[e[104]||(e[104]=t("label",{class:"fw-bold font-12 mb-2"},"Approver Type",-1)),x(t("select",{"onUpdate:modelValue":e[34]||(e[34]=l=>me.value=l),class:"form-select shadow-none font-12"},e[103]||(e[103]=[t("option",{value:""},"Any one of the selected approvers",-1),t("option",{value:"ViewOnlyReportee"},"Reporting Manager only",-1),t("option",{value:"all_approvals_required"},"All of the selected approvers",-1),t("option",{value:"requester_as_a_approver"},"Approval by Requestor",-1)]),512),[[Pe,me.value]])])):f("",!0),t("div",ga,[t("div",ha,[t("span",wa," Select "+_(C.value===0?"Requestors":"Approvers"),1),t("span",ka,_(B.value.length)+" Selected ",1)]),W.value.length?(i(),d("div",Sa,[t("div",xa,[t("div",Fa,[t("input",{type:"checkbox",id:"selectAll",checked:jt.value,onChange:Gt,class:"form-check-input me-2 designationCheckBox"},null,40,Ca),t("label",Da," Select all designation ("+_(pe.value.length)+") ",1)]),C.value!==0?(i(),d("div",qa,[x(t("input",{type:"checkbox",id:"showHods","onUpdate:modelValue":e[35]||(e[35]=l=>ce.value=l),class:"form-check-input me-2 designationCheckBox"},null,512),[[te,ce.value]]),e[105]||(e[105]=t("label",{for:"showHods",class:"form-check-label mt-2 fw-bold"}," Show HODs Only ",-1))])):f("",!0),t("div",null,[B.value.length?(i(),d("button",{key:0,type:"button",class:"btn btn-sm font-12 text-danger",onClick:Zt},e[106]||(e[106]=[t("i",{class:"bi bi-x"},null,-1),p(" Clear all ")]))):f("",!0)])]),W.value.length?(i(),ql(q(Ll),{key:0,multiple:!0,modelValue:B.value,"onUpdate:modelValue":e[36]||(e[36]=l=>B.value=l),options:pe.value,"close-on-select":!1,"clear-search-on-select":!0,placeholder:"Search & Select Designations"},null,8,["modelValue","options"])):f("",!0)],512)):(i(),d("div",La,e[107]||(e[107]=[t("div",{class:"d-flex justify-content-center"},[t("span",null,"No Designations Found")],-1)])))]),C.value!==0?(i(),d("div",Ba,[e[108]||(e[108]=t("div",null,[t("label",{for:"",class:"fw-bold font-12"},"On Rejection")],-1)),x(t("select",{"onUpdate:modelValue":e[37]||(e[37]=l=>ye.value=l),class:"form-select shadow-none font-12 mt-1 me-2"},[(i(!0),d(Q,null,K(Ct.value,l=>(i(),d("option",{key:l,value:l},_(l===0?"Requestor":"Approver Level "+l),9,Aa))),128))],512),[[Pe,ye.value,void 0,{number:!0}]])])):f("",!0),C.value!==0?(i(),d("div",$a,[t("div",Va,[t("div",Ea,[x(t("input",{"onUpdate:modelValue":e[38]||(e[38]=l=>qe.value=l),type:"checkbox","true-value":1,"false-value":0,id:"Approver",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[te,qe.value]]),e[109]||(e[109]=t("label",{for:"Approver",class:"m-0"},"Approval Mandatory",-1))]),Be.value===!0?(i(),d("div",Ma,[x(t("input",{"onUpdate:modelValue":e[39]||(e[39]=l=>Le.value=l),type:"checkbox","true-value":1,"false-value":0,id:"approver_can_edit",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[te,Le.value]]),e[110]||(e[110]=t("label",{for:"approver_can_edit",class:"m-0"}," Allow this approver to edit the form ",-1))])):f("",!0)])])):f("",!0)]),t("div",Ia,[t("div",Oa,[M(Bl,{class:"btn btn-dark addingDesignations","data-bs-dismiss":"offcanvas",onClick:Qt,name:C.value===0?"Add Requestor":"Add Approvers"},null,8,["name"])])])])])]))}},Ua=hl(Ra,[["__scopeId","data-v-f0746e47"]]);export{Ua as default};
