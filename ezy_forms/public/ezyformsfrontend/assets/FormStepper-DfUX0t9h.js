var Ml=Object.defineProperty,Ol=Object.defineProperties;var Bl=Object.getOwnPropertyDescriptors;var pt=Object.getOwnPropertySymbols;var Kt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var Zt=(U,D,V)=>D in U?Ml(U,D,{enumerable:!0,configurable:!0,writable:!0,value:V}):U[D]=V,I=(U,D)=>{for(var V in D||(D={}))Kt.call(D,V)&&Zt(U,V,D[V]);if(pt)for(var V of pt(D))Qt.call(D,V)&&Zt(U,V,D[V]);return U},Fe=(U,D)=>Ol(U,Bl(D));var Dt=(U,D)=>{var V={};for(var $ in U)Kt.call(U,$)&&D.indexOf($)<0&&(V[$]=U[$]);if(U!=null&&pt)for(var $ of pt(U))D.indexOf($)<0&&Qt.call(U,$)&&(V[$]=U[$]);return V};var Me=(U,D,V)=>new Promise(($,de)=>{var le=Y=>{try{f(V.next(Y))}catch(ne){de(ne)}},qe=Y=>{try{f(V.throw(Y))}catch(ne){de(ne)}},f=Y=>Y.done?$(Y.value):Promise.resolve(Y.value).then(le,qe);f((V=V.apply(U,D)).next())});import{_ as is,r as h,x as se,o as i,c as r,d as t,i as F,j as M,F as E,h as L,t as b,u as zl,M as Nl,e as oe,E as Pl,w as be,f as jl,a6 as Xt,K as ie,y as z,z as N,L as S,l as _,a7 as Wl,m as k,n as P,Z as xt,S as It,b as X,O as Xe,B as es,R as De,Q as ts,X as re,v as mt,N as $e,k as Oe,a8 as ss,a9 as ls,aa as Hl,U as ae,H as pe,ab as $t,a2 as os,ac as as,D as ns,ad as Jl}from"./index-DsyNaQS0.js";const Gl="/assets/ezy_forms/ezyformsfrontend/assets/oui_app-users-roles-C_V_SNI2.svg",Yl={class:"simple-field-library"},Zl={class:"field-search"},Kl={class:"field-types-grid"},Ql=["onDragstart","onClick"],Xl={__name:"SimpleFieldLibrary",props:{fields:{type:Array,required:!0}},emits:["field-add","field-dragstart","field-dragend"],setup(U,{emit:D}){const V=U,$=D,de=h(""),le=h(!1),qe=se(()=>{if(!de.value)return V.fields;const R=de.value.toLowerCase();return V.fields.filter(ee=>ee.label.toLowerCase().includes(R))}),f=(R,ee)=>{le.value=!0,R.dataTransfer.effectAllowed="copy",R.dataTransfer.setData("text/plain",ee.type),$("field-dragstart",ee.type)},Y=()=>{le.value=!1,$("field-dragend")},ne=R=>{$("field-add",R.type)};return(R,ee)=>(i(),r("div",Yl,[t("div",Zl,[ee[1]||(ee[1]=t("i",{class:"bi bi-search"},null,-1)),F(t("input",{"onUpdate:modelValue":ee[0]||(ee[0]=Z=>de.value=Z),type:"text",placeholder:"Search fields",class:"search-input"},null,512),[[M,de.value]])]),t("div",Kl,[(i(!0),r(E,null,L(qe.value,Z=>(i(),r("button",{key:Z.type,class:"field-type-btn",draggable:!0,onDragstart:K=>f(K,Z),onDragend:Y,onClick:K=>ne(Z)},b(Z.label),41,Ql))),128))])]))}},xl=is(Xl,[["__scopeId","data-v-cb64d6f9"]]),Il={class:""},eo={class:""},to={class:"d-flex justify-content-between align-items-center CancelNdSave"},so={class:"d-flex align-items-center"},lo={key:0,class:"font-16"},oo=["disabled"],ao={class:"form-container p-0 container-fluid mt-3"},no={class:"row g-4"},io={class:"col-lg-2 col-md-3 col-sm-12"},ro={class:"steps-sticky-div"},uo={class:"steps d-sm-inline-flex d-md-block m-0 p-0"},co=["onClick"],po={key:0,class:"ri-checkbox-circle-fill completedStepIcon"},mo={class:"step-text"},fo={class:"font-11"},vo={class:"font-14"},_o={class:"col-lg-10 col-md-9 col-sm-12 formbackground-color"},bo={class:"px-2"},ho={class:"form-content stepsDiv"},go={key:0},yo={class:""},wo={class:"stepperbackground ps-2 pe-2 m-0 d-flex justify-content-between align-items-center"},ko={class:"container-fluid aboutFields p-0"},Co={class:"row"},Fo={class:"col-sm-12 col-md-12 mt-lg-3 p-lg-4"},Do={class:"container-fluid"},$o={class:"row g-3"},So={class:"col-md-6"},qo={class:"position-relative"},Ao={key:0,class:"font-12 position-absolute PredefinedLabel"},Vo={key:1,class:"text-danger ErrorMsg ms-2"},Eo={class:"col-md-6"},Lo={key:0,class:"text-danger ErrorMsg ms-2"},Ro={class:"col-md-6"},To={class:"col-md-6"},Uo={key:0,class:"text-danger"},Mo={class:"col-md-6"},Oo={key:0,class:"text-danger"},Bo={class:"col-md-6"},zo={key:0,class:"text-danger"},No={class:"custom-option"},Po=["checked","onChange"],jo={class:"col-md-6"},Wo={class:"col-md-6"},Ho={key:0,class:"col-md-6"},Jo={key:1,class:"col-md-6"},Go={key:2,class:"col-md-6"},Yo={key:3,class:"col-md-6"},Zo={class:"form-check d-flex align-items-center p-0 pe-3"},Ko=["disabled"],Qo={key:4,class:"col-md-6"},Xo=["disabled"],xo={key:0,class:"list-group position-absolute w-100 z-3 formslist"},Io=["onMousedown"],ea={key:1,class:"zoho-form-builder"},ta={class:"zoho-toolbar"},sa={class:"toolbar-left"},la={class:"zoho-tabs"},oa=["onClick"],aa=["onClick"],na={class:"toolbar-right"},ia={class:"zoho-builder-container"},ra={class:"d-flex align-items-center justify-content-between w-100"},da={class:"mb-0 font-14 fw-bold"},ua={class:"btn btn-sm btn-link p-0 text-dark"},ca={key:0,class:"library-content"},pa={class:"zoho-form-canvas"},ma={class:"requestandAppHeader"},fa={class:"d-flex justify-content-between align-items-center"},va={class:""},_a={class:"ps-2 mb-0 fw-bolder font-14 blockTitle"},ba={class:"text-center ms-2 mt-1"},ha={key:0,class:"font-12 d-flex align-items-center"},ga={class:"font-12 approver_type_div"},ya={class:"font-12 fw-bold"},wa={class:"font-12 text-danger ms-1"},ka={class:"d-flex align-items-center"},Ca={key:0,class:"role-container"},Fa={key:0,class:"role-text d-flex align-items-center"},Da={class:"role-label fw-bold"},$a={class:"role-names text-primary"},Sa=["onClick"],qa=["onClick"],Aa=["onClick"],Va=["onClick"],Ea={class:"pt-0 section_block"},La={class:"d-flex justify-content-between align-items-center"},Ra={class:"d-flex flex-column"},Ta=["onUpdate:modelValue","onChange","onInput"],Ua={key:0,class:"text-danger ps-3 font-10"},Ma={class:"d-flex align-items-center"},Oa=["onClick"],Ba={class:"container-fluid"},za={class:"d-flex justify-content-between align-items-center"},Na={class:"rownames m-0"},Pa=["onClick"],ja={class:"col"},Wa={class:"row"},Ha=["onMouseenter"],Ja={class:"column_name d-flex align-items-center justify-content-between"},Ga={class:"d-flex flex-column ps-2"},Ya=["onUpdate:modelValue","onChange","onInput"],Za={key:0,class:"text-danger ps-2 font-10"},Ka={class:"position-absolute top-0 end-0"},Qa=["onClick"],Xa=["onDrop"],xa=["onMouseenter","onDragstart","onDrop"],Ia=["onDrop"],en=["onDragstart","onDrop"],tn={class:"d-flex justify-content-between"},sn={class:"flex-column d-flex"},ln=["onUpdate:modelValue","onChange","onInput"],on={key:0,class:"text-danger font-10"},an={class:"FieldcopyRemove"},nn=["onClick"],rn=["onClick"],dn=["onUpdate:modelValue","onChange"],un=["value"],cn={key:0},pn=["onUpdate:modelValue"],mn={key:0,class:"text-danger font-10"},fn={key:1},vn=["for"],_n=["id","onUpdate:modelValue","onInput","onFocus"],bn={key:0,class:"list-group mt-1",style:{"max-height":"200px","overflow-y":"auto"}},hn=["onClick"],gn={class:"d-flex align-items-center justify-content-between"},yn={class:"d-flex align-items-center gap-2"},wn={class:"d-flex align-items-center"},kn=["onUpdate:modelValue","id"],Cn=["for"],Fn=["onClick"],Dn=["onUpdate:modelValue"],$n={key:3,class:"text-danger font-10"},Sn=["onDrop"],qn={class:"childtableShow"},An={class:"mt-2"},Vn={key:0,class:"childTableContainer"},En={key:0,class:"font-13"},Ln={key:1,class:"d-flex align-items-center gap-2"},Rn={class:"d-flex align-items-center"},Tn=["onUpdate:modelValue"],Un=["onClick"],Mn={key:2,class:"table table-bordered rounded-table"},On=["onDrop"],Bn=["draggable","onDragstart"],zn={key:0},Nn=["onUpdate:modelValue","onInput"],Pn={key:0,class:"text-danger font-11"},jn={key:1},Wn={key:2},Hn={class:"d-flex gap-1"},Jn=["onUpdate:modelValue","onChange"],Gn=["value"],Yn={class:"d-flex"},Zn={class:"d-flex align-items-center gap-2"},Kn={class:"d-flex align-items-center"},Qn=["onUpdate:modelValue"],Xn=["onClick"],xn={key:0},In=["onUpdate:modelValue","onInput"],ei={key:0,class:"text-danger font-10"},ti={key:1,class:"font-11 text-danger"},si={key:3},li={key:3,class:"mb-2 mt-3"},oi=["onClick"],ai=["onClick"],ni=["onDrop"],ii=["onDrop"],ri={class:"d-flex justify-content-center align-items-center my-2"},di=["onClick"],ui={class:"font-13"},ci={key:0,class:"d-flex align-items-center gap-2"},pi={class:"d-flex align-items-center"},mi=["onUpdate:modelValue"],fi=["onClick"],vi={class:"table table-bordered rounded-table"},_i={key:0},bi=["onUpdate:modelValue","onBlur"],hi={key:0,class:"text-danger font-11 mt-1"},gi={key:1},yi={key:2},wi={class:"d-flex gap-1 align-items-center"},ki=["onUpdate:modelValue","onChange"],Ci=["value"],Fi=["onClick"],Di={key:0,class:"mt-1"},$i=["onUpdate:modelValue","onInput"],Si={key:1,class:"text-danger font-11 mt-1"},qi={key:3},Ai={class:"mb-2"},Vi=["onClick"],Ei=["onClick"],Li=["onClick"],Ri={key:0},Ti={class:"d-flex justify-content-between align-items-center mt-1 mb-2"},Ui=["onUpdate:modelValue","onBlur"],Mi={key:0,class:"text-danger font-12"},Oi={key:1,class:"text-danger font-12"},Bi={class:"d-flex align-items-center gap-2"},zi={class:"d-flex align-items-center"},Ni=["onUpdate:modelValue"],Pi=["onClick"],ji=["onClick"],Wi={class:"px-1 field-border"},Hi={class:"d-flex justify-content-between"},Ji=["onUpdate:modelValue","onBlur"],Gi={key:0,class:"text-danger font-12"},Yi={class:"d-flex align-items-center"},Zi={class:"d-flex my-1"},Ki=["onUpdate:modelValue"],Qi=["onClick"],Xi=["onClick"],xi=["onUpdate:modelValue"],Ii=["value"],er={key:0},tr=["onUpdate:modelValue"],sr={key:0,class:"text-danger font-10"},lr={key:1,class:"text-danger font-12"},or=["onClick"],ar=["onClick"],nr={class:"d-flex justify-content-center align-items-center py-2 add-section-btn"},ir=["onClick"],rr={key:0,class:"m-2"},dr={key:0,class:"zoho-properties-panel"},ur={class:"properties-header"},cr={key:2},pr={class:"stepperbackground d-flex align-items-center justify-content-between p-3"},mr={class:"container-fluid mt-4 p-4"},fr={class:"card mb-4"},vr={class:"card-body"},_r={class:"row g-3"},br={class:"col-md-6"},hr={class:"btn-group w-100",role:"group"},gr={key:0,class:"col-md-6"},yr={key:0,class:"card mb-4"},wr={class:"card-body"},kr={key:0,class:"table-responsive"},Cr={class:"table table-bordered"},Fr=["onUpdate:modelValue"],Dr={class:"form-check form-switch"},$r=["onUpdate:modelValue"],Sr={class:"form-check-label font-12"},qr=["onClick"],Ar=["onClick"],Vr={key:1,class:"card mb-4"},Er={class:"card-body"},Lr={class:"alert alert-success"},Rr={class:"table-responsive"},Tr={class:"table table-bordered"},Ur={key:0,class:"badge bg-success"},Mr={key:1,class:"badge bg-secondary"},Or={class:"text-muted"},Br={key:2,class:"card mb-4"},zr={class:"card-body"},Nr={class:"alert alert-success"},Pr={class:"table-responsive"},jr={class:"table table-bordered table-hover"},Wr={class:"badge bg-dark"},Hr={key:0,class:"badge bg-danger"},Jr={key:1,class:"badge bg-secondary"},Gr={key:0,class:"badge bg-info"},Yr={key:1,class:"badge bg-warning text-dark"},Zr={key:2,class:"badge bg-success"},Kr={key:3,class:"badge bg-secondary"},Qr={class:"text-muted"},Xr={key:3},xr={class:"modal fade",id:"customFormatModal",tabindex:"-1","aria-labelledby":"customFormatModalLabel","aria-hidden":"true"},Ir={class:"modal-dialog modal-dialog-centered"},ed={class:"modal-content"},td={class:"modal-body"},sd=["placeholder"],ld={class:"d-flex align-items-center gap-2"},od={class:"d-flex align-items-center py-2"},ad={class:"modal fade",id:"formViewModal",tabindex:"-1","aria-labelledby":"formViewModalLabel","aria-hidden":"true"},nd={class:"modal-dialog modal-xl modal-dialog-scrollable"},id={class:"modal-content"},rd={class:"modal-body"},dd={class:"offcanvas addOffCanvas offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},ud={class:"offcanvas-header add_designationHeader"},cd={id:"offcanvasRightLabel",class:"font-14 fw-bold"},pd={class:"offcanvas-body add_desig_offCanvas_body p-0"},md={class:""},fd={key:0,class:"p-3 approval-border-bottom"},vd={class:"px-3 listofdesignations"},_d={class:"my-1 d-flex justify-content-between"},bd={class:"font-12 fw-bold"},hd={class:"italic-style text-secondary font-12"},gd={key:0,ref:"resizableDiv",class:"my-1 disgnationlist_div"},yd={class:"d-flex align-items-center justify-content-between gap-1"},wd={class:"form-check ps-1 d-flex align-items-center m-0"},kd=["checked"],Cd={for:"selectAll",class:"form-check-label SelectallDesignation mt-2 fw-bold"},Fd={key:0,class:"form-check d-flex align-items-center m-0"},Dd={key:1},$d={key:1,class:"p-3"},Sd=["value"],qd={key:2},Ad={class:""},Vd={class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Ed={key:0,class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Ld={class:"offcanvas-footer"},Rd={class:"text-end p-3"},Se="Select All",Td={__name:"FormStepper",setup(U){const D=zl(),V=Nl(),$=h(1),de=h([]);h([]);const le=h([]),qe=h([]);oe([]);let f=oe([]),Y=oe([]);const ne=h([]),R=h([]),ee=h([]),Z=h(""),K=h(""),j=h("");let O=oe([]);const Be=h("");h(!1),h(!1),h(!1);const Ae=h(""),xe=h(""),Ie=h(""),rs=h([]),ds=h([]),A=oe({}),te=h([]),ft=h(!1),et=h([]),tt=h(!1);let St=null;const us=h("");let T=h("");const he=h(null),qt=h(null),Ve=h(!0),ze=h(0),Ne=h([]),fe=h(null),me=h("new"),st=h([]),Ee=h([]);h([]);const ge=h([]),Le=se(()=>Pl);h(!1);const lt=oe([]),x=h({routepath:D.query.routepath,business_unit:D.query.business_unit,formId:D.query.id}),ot=h(""),Re=h(!1),Te=h(!1),At=[{label:"Public",value:1},{label:"Private",value:0}],Vt=se({get(){return At.find(s=>s.value===v.value.as_web_view)},set(s){v.value.as_web_view=s?s.value:null}}),Et=se({get(){return v.value.form_name||D.query.form_name||""},set(s){v.value.form_name=s}}),v=h({form_name:"",form_short_name:"",accessible_departments:[],business_unit:`${Le.value.value||x.value.business_unit||D.query.business_unit}`,form_category:"",owner_of_the_form:"",series:"",has_workflow:"",workflow_check:"",is_linked:0,is_linked_form:"",is_predefined_doctype:D.query.id?1:0,as_web_view:0,mail_id:""});be(()=>D.query.form_name,s=>{s&&(v.value.form_name=s,v.value.form_short_name=s)},{immediate:!0});const at=["name","parent","creation","owner","modified","modified_by","parentfield","parenttype","file_list","flags","docstatus","idx","doctype","company_field","business_unit"].map(s=>s.toLowerCase().trim()),Lt=["Approver","Approved on","Approved By"].map(s=>s.toLowerCase().trim());function cs(s){return s.toLowerCase().replace(/\s+/g,"_").replace(/[^\w_]/g,"")}se(()=>v.value),h(""),h(!1),be(Le,s=>{s&&s.value&&(v.value.business_unit=s.value)},{immediate:!0});function ps(s){if(T==null||T==="new")return!1;const e=B(s).roles;if(s===0)return e.length===0;const l=B(s-1).roles;return l.length>0&&l[0]!==null&&l[0]!==""&&e.length===0}be(()=>v.value.form_name,s=>{v.value.form_name=s.trim()}),be(()=>v.value.form_short_name,s=>{v.value.form_short_name=s.trim()}),be(()=>v.value.series,s=>{v.value.series=s.trim()}),be(()=>me.value,s=>{s==="existing"&&(f.splice(0,f.length),ge.value=[],O.length=0)});const Pe=h(null),Rt=(s,e,l,o,a,n)=>{Pe.value={blockIndex:e,sectionIndex:l,rowIndex:o,columnIndex:a,fieldIndex:n}},ye=(s,e,l,o,a,n)=>{if(s.preventDefault(),s.stopPropagation(),console.log("Field dropped at index:",{targetBlock:e,targetSection:l,targetRow:o,targetColumn:a,insertIndex:n,draggedField:Pe.value,draggedFieldType:he.value}),he.value){console.log("Dropping from field library:",he.value);const w=Yt(he.value);if(!w){console.error("Failed to create field from type:",he.value);return}const C=f[e];if(!C){ae("Target block not found");return}C.sections||(C.sections=[]),C.sections[l]||(C.sections[l]={label:"",rows:[]}),C.sections[l].rows||(C.sections[l].rows=[]),C.sections[l].rows[o]||(C.sections[l].rows[o]={label:"",columns:[]}),C.sections[l].rows[o].columns||(C.sections[l].rows[o].columns=[]),C.sections[l].rows[o].columns[a]||(C.sections[l].rows[o].columns[a]={label:"",fields:[]}),C.sections[l].rows[o].columns[a].fields.splice(n,0,w),console.log("Field added successfully:",w),pe(`${w.label} field added`),he.value=null;return}if(!Pe.value){console.log("No dragged field found");return}const{blockIndex:u,sectionIndex:c,rowIndex:m,columnIndex:d,fieldIndex:p}=Pe.value,y=f[u].sections[c].rows[m].columns[d].fields,q=f[e].sections[l].rows[o].columns[a].fields;if(u===e&&c===l&&m===o&&d===a&&p===n)return;const g=y.splice(p,1)[0];y===q&&p<n&&n--,q.splice(n,0,g),Pe.value=null},Ue=h(""),ms=s=>Me(this,null,function*(){const e=[["module","in",["User Forms"]],["istable","=",1]];s!=null&&s.trim()&&e.push(["name","=",`${s}`]);const l={fields:JSON.stringify(["name"]),filters:JSON.stringify(e),limit_page_length:"None",doctype:ie.doctypesList};try{return(yield z.get(N.GetDoctypeData,{params:l})).message.data||[]}catch(o){return console.error("Error fetching doctype list:",o),[]}}),nt=h(null),Tt=s=>Me(this,null,function*(){if(Ue.value="",nt.value=null,s.tableName){let e=s.tableName.trim();if(e.length>64){Ue.value="Table name cannot exceed 64 characters";return}if(!/^[a-zA-Z]+( [a-zA-Z]+)*$/.test(e)){Ue.value="Table name can only contain letters and spaces (no leading/trailing spaces or special characters)";return}const o=yield ms(e);nt.value=o.find(a=>a.name.toLowerCase()===e.toLowerCase()),nt.value&&(Ue.value="Table already exists"),s.tableName=e}s.label&&(s.fieldname=cs(s.label))});function fs(){const s=v.value.is_linked_form;if(!s){et.value=[];return}clearTimeout(St),St=setTimeout(()=>{const e=[["business_unit","=",`${Le.value.value}`],["name","like",`%${s}%`]],l={fields:JSON.stringify(["name"]),limit_page_length:10,limit_start:0,filters:JSON.stringify(e),doctype:ie.EzyFormDefinitions,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"};z.get(`${N.GetDoctypeData}`,{params:l}).then(o=>{et.value=o.message.data||[]}).catch(o=>{console.error("Error fetching form definitions:",o)})},300)}function vs(s){v.value.is_linked_form=s,tt.value=!1}function _s(){setTimeout(()=>{tt.value=!1},200)}oe({query:"",key:""});function ve(s,e,l,o,a){return`${s}-${e}-${l}-${o}-${a}`}oe({});const je=oe({}),vt=oe({});function bs(s){vt[s]=!0}function hs(s,e,l,o,a,n){const u=ve(e,l,o,a,n),c=[["istable","=",0]];s!=null&&s.trim()&&c.push(["name","like",`%${s}%`]);const m={fields:JSON.stringify(["name"]),filters:JSON.stringify(c),limit_page_length:"none",doctype:ie.doctypesList};z.get(N.GetDoctypeData,{params:m}).then(d=>{je[u]=d.message.data||[]}).catch(d=>{console.error("Error fetching doctype list:",d),je[u]=[]})}function gs(s,e,l,o,a,n){f[s].sections[e].rows[l].columns[o].fields[a].options=n;const u=ve(s,e,l,o,a);je[u]=[],vt[u]=!1}const ys=se(()=>f!=null&&f.length?j.value===1?[0]:Array.from({length:j.value},(s,e)=>e).filter(s=>s<j.value):[]),_e=h(null),we=h(null),ws=(s,e,l,o,a)=>{_e.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o,fieldIndex:a}},ks=()=>{_e.value=null},Cs=(s,e,l,o,a)=>_e.value&&_e.value.blockIndex===s&&_e.value.sectionIndex===e&&_e.value.rowIndex===l&&_e.value.columnIndex===o&&_e.value.fieldIndex===a,Fs=(s,e,l,o)=>{we.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o}},Ds=()=>{we.value=null},$s=(s,e,l,o)=>we.value&&we.value.blockIndex===s&&we.value.sectionIndex===e&&we.value.rowIndex===l&&we.value.columnIndex===o,Ut=h([{form_json:""}]),ke=h("");jl(()=>{zt(),ke.value=D.query.Clone,T.value=D.query.id||"new",ke.value==="1"&&(v.value.series=""),T.value!=null&&T.value!=null&&T.value!="new"&&(Bt(),kt()),sessionStorage.getItem("allow_approver_to_edit_form")=="1"?ft.value=!0:ft.value=!1;let s=localStorage.getItem("Bu");if(v.value.business_unit=s,D.query.preId==="PreDefine"){const e=localStorage.getItem("form_json");if(e){Ut.value[0].form_json=e;const l=Ut.value[0],o=JSON.parse(l.form_json),a=Xt(o.fields);te.value=o.child_table_fields,a.forEach(n=>{f.push(n)})}}});const Ce=h(null),J=oe({}),Mt=h(null),Ss=s=>{Ce.value=s},qs=()=>{Ce.value=null},As=s=>{s.preventDefault()},Vs=(s,e)=>{const l=s.target.closest("tr");if(!l)return;const o=Array.from(l.parentNode.children).indexOf(l);if(o!==Ce.value){const a=e[Ce.value];e.splice(Ce.value,1),e.splice(o,0,a),Ce.value=o}},Es=h([]),_t=s=>{if(["Select","Table MultiSelect","Check","Small Text"].includes(s.fieldtype)&&s.options){const e=s.options.split(`
`).map(a=>a.trim()).filter(a=>a),l=[],o=new Set;return e.forEach(a=>{const n=a.toLowerCase();o.has(n)||(o.add(n),l.push(a))}),`
`+l.join(`
`)}else if(["Link","Table"].includes(s.fieldtype)&&s.options)return s.options.trim();return s.options},Ls=(s,e)=>{const l=f[s].sections[e];l.childTables||(l.childTables=[]);const o=l.childTables.length;l.childTables.push({label:"",fieldname:"",fieldtype:"Table",idx:o,reqd:!1,as_a_block:"",description:"false",columns:[I({label:"",fieldname:"",fieldtype:"",idx:0,description:"",reqd:!1},lt.fieldtype==="Select"&&lt.options?{options:lt.options?`
${lt.options}`:`
`}:{})],newTable:!0})},Rs=(s,e,l)=>{const o=f[s].sections[e].childTables[l];o.columns||(o.columns=[]),o.columns.push(I({label:"",fieldname:"",fieldtype:"",idx:o.columns.length,description:"",reqd:!1},o.columns.fieldtype==="Select"&&o.columns.options?{options:o.columns.options?`
${o.columns.options}`:`
`}:{}))},Ts=(s,e,l)=>{f[s].sections[e].childTables.splice(l,1)},Us=(s,e,l,o)=>{f[s].sections[e].childTables[l].columns.splice(o,1)};function Ms(s,e,l,o,a,n){var d;const u=`${e}-${l}-${o}`;A[u]||(A[u]={columns:[]});const c={},m=((d=s.label)==null?void 0:d.trim())||"";if(!m)c.label="Field Label is required";else{const p=m.toLowerCase();if(at.includes(p)&&!Lt.includes(p))c.label=`"${m}" is a restricted field label`;else if(m.length>64)c.label="Field Label cannot exceed 64 characters";else if(!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(m))c.label="Field Label can only contain letters, numbers, and single spaces between words";else{const y=n.map((q,g)=>{var w;return{label:(w=q.label)==null?void 0:w.trim().toLowerCase(),index:g}}).filter(q=>q.label===p);if(y.length>1){const q=y[0].index;a!==q&&(c.label=`"${m}" is already used in this table`)}}}A[u].columns[a]=c}function it(s,e,l){var n;A[e]||(A[e]={});const o=[],a=((n=s.label)==null?void 0:n.trim())||"";a||o.push("Label is required"),a.length>64&&o.push("Label cannot exceed 64 characters"),a&&!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(a)&&o.push("No special characters allowed"),a&&at.includes(a.toLowerCase().trim())&&o.push("This label is restricted"),a&&te.value[e].map(m=>{var d;return(d=m.label)==null?void 0:d.trim().toLowerCase()}).filter(Boolean).filter(m=>m===a.toLowerCase()).length>1&&o.push("Duplicate label is not allowed"),s.fieldtype||o.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||s.options.trim()==="")&&o.push("Options are required"),A[e][l]=o}const Os=(s,e,l)=>{var u;const o=f[s].sections[e].childTables[l],a={tableName:!1,columns:[]};let n=!1;return(u=o.tableName)!=null&&u.trim()||(a.tableName="Table name is required.",n=!0),o.columns.forEach((c,m)=>{var p,y;const d={};(p=c.label)!=null&&p.trim()||(d.label="Field Label is required",n=!0),(y=c.fieldtype)!=null&&y.trim()||(d.fieldtype="Please select field type",n=!0),a.columns[m]=d}),A[`${s}-${e}-${l}`]=a,n},Bs=(s,e,l)=>{var a,n;const o=(n=(a=f[s])==null?void 0:a.sections)==null?void 0:n[e];o&&!Array.isArray(o[l])&&(o[l]=[])},zs=s=>s?s.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,""):"",Ns=(s,e,l)=>{if(Os(s,e,l)){ae("Please fix validation errors before creating the table",{transition:"zoom"});return}if(nt.value){ae("Table already exists",{transition:"zoom"});return}const a=f[s].sections[e].childTables[l],n=f[s].sections[e];a.columns=a.columns.map((c,m)=>Fe(I({},c),{idx:m,options:_t(c)})),a.newTable=!1;const u={form_short_name:a.tableName,fields:a.columns,idx:a.idx,as_a_block:a.as_a_block?a.as_a_block:"false"};z.post(N.childtable,u).then(c=>{var m,d,p;if(c){Bs(s,e,"afterCreated"),n.afterCreated[l]=I({},a),pe("Table created successfully!");const y=(p=(d=(m=c.message)==null?void 0:m[0])==null?void 0:d[0])==null?void 0:p.child_doc;y&&(f[s].sections[e].childTables[l]=Fe(I(I({},f[s].sections[e].childTables[l]),y),{newTable:!1}))}}).catch(c=>{console.error("Error creating table:",c)})},We=(s,e,l,o=[])=>{var u;J[e]||(J[e]=[]),J[e]=J[e].filter(c=>c!==l),A[e]||(A[e]=[]),A[e][l]=[];const a=[],n=((u=s.label)==null?void 0:u.trim())||"";if(n?at.includes(n.toLowerCase())?a.push("This label is restricted"):n.length>64?a.push("Label cannot exceed 64 characters"):/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(n)||a.push("Only letters, numbers, and single spaces allowed"):a.push("Label is required"),o.length){const c=n.toLowerCase(),m=o.map((d,p)=>{var y;return{label:(y=d.label)==null?void 0:y.trim().toLowerCase(),idx:p}}).filter(d=>d.label===c);if(m.length>1){const d=m[0].idx;l!==d?(a.push("Duplicate label not allowed"),s._duplicate=!0):s._duplicate=!1}else s._duplicate=!1}return s.fieldtype||a.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||!s.options.trim())&&a.push("Options are required"),A[e][l]=a,a.length>0&&J[e].push(l),a.length===0},Ps=(s,e,l)=>{const a=f[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!a)return;const n=a.columns.length,u={fieldname:"",fieldtype:"",idx:n+1,label:"",value:"",isNew:!0,description:""};a.columns.push(u),We(u,l,n,a.columns)},Ot=h([]),js=(s,e,l,o)=>{const n=f[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!n)return;n.columns.splice(o,1),n.columns.forEach((c,m)=>{c.idx=m+1});const u=J.value[l];u&&(J.value[l]=u.filter(c=>c!==o).map(c=>c>o?c-1:c))},Ws=(s,e,l)=>{const a=f[s].sections[e].afterCreated.find(n=>n.tableName===l);if(a){if(W[l]){J[l]=[];let n=!0;if(a.columns.forEach((m,d)=>{We(m,l,d,a.columns)||(n=!1)}),!n){ae("Please fix the errors in the highlighted fields before saving!");return}const u=a.columns.map((y,p)=>{var q=y,{isNew:m}=q,d=Dt(q,["isNew"]);return Fe(I({},d),{idx:p+1,options:_t(d)})}),c={form_short_name:zs(l),fields:u,as_a_block:a.description};z.post(N.childtable,c).then(m=>{Ot.value=m.data,pe("Fields updated successfully!")}).catch(m=>{console.error("❌ Saving fields failed:",m)})}W[l]=!W[l]}},W=oe({}),Hs=s=>{te.value[s]||(te.value[s]=[]);const e=te.value[s].length+1;te.value[s].push({fieldname:"",fieldtype:"",idx:e,label:"",value:"",isNew:!0,description:"",options:te.value[s].options?`
${te.value[s].options}`:""})},Js=(s,e)=>{te.value[s]&&te.value[s].splice(e,1)},Gs=(s,e)=>{if(!s)return;J.value||(J.value={}),J.value[s]||(J.value[s]=[]);const l=te.value[s];if(l){if(W[s]){J.value[s]=[];let o=!0;if(l.forEach((u,c)=>{var d;it(u,s,c);const m=(d=A[s])==null?void 0:d[c];m&&m.length>0&&(J.value[s].push(c),o=!1),u.label&&(u.label=u.label.trim())}),!o){ae("Please fix the errors before saving");return}const a=l.map((d,m)=>{var p=d,{isNew:u}=p,c=Dt(p,["isNew"]);return Fe(I({},c),{idx:m+1,options:_t(c)})}),n={form_short_name:s,fields:a,as_a_block:e};z.post(N.childtable,n).then(u=>{Ot.value=u.data,pe("Fields updated successfully!")}).catch(u=>{console.error("❌ Saving fields failed:",u)})}W[s]=!W[s],Mt.value=W[s]?s:null}},Ys=h([{id:1,label:"Form Info",stepno:"Step 1",icon:"bi bi-info-circle"},{id:2,label:"Form Fields",stepno:"Step 2",icon:"bi bi-grid-3x3-gap"},{id:3,label:"Workflow Setup",stepno:"Step 3",icon:"bi bi-diagram-3"},{id:4,label:"Print Format",stepno:"Step 4",icon:"ri-checkbox-circle-line"}]),bt=[{label:"Text",type:"Data"},{label:"Select",type:"Select"},{label:"Attach",type:"Attach"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Number",type:"Int"},{label:"TextArea",type:"Text"}],rt=[{label:"Text",type:"Data"},{label:"Time",type:"Time"},{label:"Text Area",type:"Text"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Attach",type:"Attach"},{label:"Phone",type:"Data"},{label:"Check",type:"Check"},{label:"Number",type:"Int"},{label:"Select",type:"Select"},{label:"Multi Select",type:"Small Text"},{label:"Link",type:"Link"}],Zs=se(()=>[Se,...le.value]),Ks=se(()=>{const s=v.value.accessible_departments;return s.includes(Se)?"All Selected":s.length>1?`${s[0]}.. +${s.length-1} more selected`:s.join(", ")}),Qs=s=>s===Se?v.value.accessible_departments.length===le.value.length:v.value.accessible_departments.includes(s),Xs=(s,e)=>{s===Se?e.target.checked?v.value.accessible_departments=[...le.value]:v.value.accessible_departments=[]:(e.target.checked?v.value.accessible_departments.push(s):v.value.accessible_departments=v.value.accessible_departments.filter(l=>l!==s),v.value.accessible_departments.length===le.value.length?v.value.accessible_departments=[...le.value]:v.value.accessible_departments=v.value.accessible_departments.filter(l=>l!==Se))},xs=s=>{s===Se&&(v.value.accessible_departments=[...le.value])},Is=s=>{s===Se&&(v.value.accessible_departments=[])},ht=h(!1),He=se(()=>{var e;let s=[...ne.value];if(Te.value&&(s=s.filter(l=>l.is_hod===1)),(e=Be.value)!=null&&e.trim()){const l=Be.value.toLowerCase();s=s.filter(o=>o.role.toLowerCase().includes(l))}return s.sort((l,o)=>l.role.localeCompare(o.role)),s.sort((l,o)=>{const a=R.value.includes(l.role),n=R.value.includes(o.role);return a===n?0:a?1:-1}),s.map(l=>l.role)}),el=se(()=>{const s=He.value;return s.length>0&&s.every(e=>R.value.includes(e))});be([R,He],()=>{const s=He.value;ht.value=s.length>0&&s.every(e=>R.value.includes(e))},{immediate:!0,deep:!0});function tl(s){const e=s.target.checked,l=ne.value.filter(o=>{var a;return!(Te.value&&o.is_hod!==1||(a=Be.value)!=null&&a.trim()&&!o.role.toLowerCase().includes(Be.value.toLowerCase()))}).map(o=>o.role);e?R.value=Array.from(new Set([...R.value,...l])):R.value=R.value.filter(o=>!l.includes(o)),ht.value=e}function sl(){R.value=[],ht.value=!1,Te.value=!1}const ue=h("");function ll(){const s=f[j.value];if(!s||!s.sections){console.error("Error: Invalid block or sections not found.");return}let e={type:j.value==0?"requestor":"approver",roles:R.value,approval_required:xe.value,approver_can_edit:Ie.value,fields:s.sections.flatMap($t),idx:j.value};j.value!==0&&(e.view_only_reportee=ue.value==="ViewOnlyReportee"?1:0,e.all_approvals_required=ue.value==="all_approvals_required"?1:0,e.requester_as_a_approver=ue.value==="requester_as_a_approver"?1:0,e.on_rejection=Ae.value?Ae.value:0);const l=O.findIndex(o=>o.idx===e.idx);l!==-1?O[l]=e:O.push(e),nl()}function B(s){const e=O.filter(a=>a.idx===s);if(e.length===0)return{roles:[]};if(e.length===1)return e[0];const l=I({},e[0]),o=[];return e.forEach(a=>{a.roles&&Array.isArray(a.roles)&&o.push(...a.roles)}),l.roles=o,console.log(`getWorkflowSetup(${s}): Found ${e.length} entries, merged roles:`,o),l}function ol(s){const e=B(s),l=e.roles||[];R.value=[...l],Ae.value=e.on_rejection,xe.value=e.approval_required,Ie.value=e.approver_can_edit,e.view_only_reportee===1?ue.value="ViewOnlyReportee":e.all_approvals_required===1?ue.value="all_approvals_required":e.requester_as_a_approver===1?ue.value="requester_as_a_approver":ue.value=""}const gt=s=>{Te.value=!1,Be.value="",ue.value="",Ae.value="",v.value.accessible_departments.length&&al(s,v.value.accessible_departments),j.value=s,ol(s)};function al(s,e){let l={index:s,departments:e,property:v.value.business_unit};z.post(N.addDesignationroles,l).then(o=>{o.message&&(ne.value=o.message)}).catch(o=>{console.error("Error fetching designations data:",o)})}function nl(){z.post(N.add_roles_WF,{workflow_setup:O,doctype:v.value.form_short_name,business_unit:v.value.business_unit}).then(s=>{console.log(s),j.value==0?pe("Requestor Added"):pe(`Approver-${j.value} Added`)})}function il(){V.push({path:x.value.routepath||localStorage.getItem("routepath")}),localStorage.removeItem("form_json")}function rl(){v.value.form_name="",v.value.form_short_name="",v.value.owner_of_the_form="",v.value.business_unit="",v.value.form_category="",v.value.accessible_departments=[]}const dl=s=>{if(ut.value){ae("Please check all required fields before proceeding.");return}s<$.value?wt():s>$.value&&yt()},yt=()=>{if(ut.value){ae("Please check all required fields before proceeding.");return}$.value<4&&($.value+=1,$.value===4&&(ct.value=f))},wt=()=>{$.value>1&&($.value-=1)},ul=h([]);function Bt(){const s={fields:JSON.stringify(["*"]),limit_page_length:"none",doctype:ie.EzyFormDefinitions,doc_id:T.value};z.get(N.GetDoctypeData,{params:s}).then(e=>{var o;let l=e==null?void 0:e.message.data;if(l){l.accessible_departments&&(l.accessible_departments=l.accessible_departments.split(",")),v.value=Fe(I(I({},v.value),l),{owner_of_the_form:l.owner_of_the_form||v.value.owner_of_the_form||""});const a=JSON.parse((o=e.message.data)==null?void 0:o.form_json);rs.value=a.workflow,us.value=a.fields.filter(u=>u.fieldtype==="Table"),ul.value=a.fields.filter(u=>u.fieldtype==="Table"),Re.value=e.message.data.is_landscape;let n=Xt(JSON.parse(l==null?void 0:l.form_json).fields);te.value=JSON.parse(e.message.data.form_json).child_table_fields,Es.value=[],ds.value=[],n.forEach((u,c)=>{f.push(u)}),JSON.parse(l==null?void 0:l.form_json).workflow.forEach((u,c)=>{O.push(u)})}}).catch(e=>{console.error("Error fetching  data:",e)})}function cl(){const s={};ot.value&&(s.print_format=ot.value),Re.value!==void 0&&Re.value!==null&&(s.is_landscape=Re.value),z.put(N.resource+ie.EzyFormDefinitions+`/${D.query.id}`,s).then(e=>{console.log(e),bootstrap.Modal.getInstance(document.getElementById("customFormatModal")).hide(),pe("Print Format Added Successfully")}).catch(e=>{console.error("Error fetching  data:",e)})}function zt(){const s={fields:JSON.stringify(["name","department_name"]),limit_page_length:"none",business_unit:`${x.value.business_unit||D.query.business_unit}`,doctype:ie.departments};z.get(N.GetDoctypeData,{params:s}).then(e=>{var l;(l=e==null?void 0:e.message.data)!=null&&l.length&&(qe.value=e.message.data.map(o=>o.name),le.value=e.message.data.map(o=>o.name))}).catch(e=>{console.error("Error fetching department data:",e)})}h(""),be(()=>v.value.owner_of_the_form,s=>{s&&kt(s)});function kt(s){s&&typeof s=="string"&&s.trim()!==""&&pl(s)}function pl(s){const e={fields:JSON.stringify(["ezy_departments_items"]),doctype:ie.departments,doc_id:s};z.get(N.GetDoctypeData,{params:e}).then(l=>{var o;(o=l==null?void 0:l.message.data)!=null&&o.ezy_departments_items&&(de.value=l.message.data.ezy_departments_items.map(a=>a.category))}).catch(l=>{console.error("Error fetching categories data:",l)})}function Ct(s){let e=Jl(f);const l=Fe(I({},v.value),{fields:e,doctype:ie.EzyFormDefinitions,workflow_setup:O,form_status:s==="save"?"Created":"Draft"});l.accessible_departments=l.accessible_departments.toString(),z.post(N.savedata,l).then(o=>{if(o&&o.message&&o.message.message){let a=localStorage.getItem("preName");if(a){let n={installed:"Yes"};z.put(`${N.resource}${ie.preDefinedForm}/${a}`,n).then(u=>{localStorage.removeItem("preName")}).catch(u=>{console.error("Error fetching ezyForms data:",u)})}if(V.push({params:{paramid:o.message.message},query:{id:o.message.message}}),T.value=o.message.message,T&&T!=="new"&&(f.splice(0,f.length),Bt()),O.length<f.length)ns("Add Workflow");else if(Pt.value===!0){pe("Form Created Successfully!",{autoClose:2e3,transition:"zoom"});let n=localStorage.getItem("routepath");s==="save"?V.push({path:n}):s==="Draft"&&V.push({path:n})}}else console.error("Invalid response structure:",o)}).catch(o=>{console.error("Error saving form data:",o)})}const dt=h(""),Nt=()=>{var l,o;const s=f.length,e={label:s===0?"requestor":`approver-${s}`,parent:`${(l=Le.value)==null?void 0:l.value}-${(o=v.value)==null?void 0:o.form_short_name}`,sections:[{label:"",parent:`${Le.value.value}-${v.value.form_short_name}`,childTables:[],afterCreated:{},rows:s===0?[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Requested By",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Requested On",fieldtype:"Datetime",options:"",reqd:!1}]}]},{label:`row_0_1_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1,description:""}]}]}]:[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Approver",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved On",fieldtype:"Datetime",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved By",fieldtype:"Attach",options:"",reqd:!1}]}]}]}]};f.push(e),os(()=>{dt.value&&dt.value.scrollTo({top:dt.value.scrollHeight,behavior:"smooth"})})},Pt=h(!1),jt=s=>{let e=f[s];e.parent&&Y.push(e);let l=[];O.length>s&&O[s].roles&&(l=[...O[s].roles]),f.splice(s,1),O.length>s&&O.splice(s,1),f.forEach((o,a)=>{o.sections.forEach((n,u)=>{n.rows.forEach((c,m)=>{c.columns.forEach((d,p)=>{ce(a,u,m,p)})})})}),l.length&&ml(l,s)};function ml(s,e){const l={role:s,level:e,document_type:v.value.form_name,short_name:v.value.form_short_name,property:v.value.business_unit};z.post(N.deleteAssigneRoles,l).then(o=>{o&&Ct()})}const fl=(s,e)=>{const l={label:"",parent:`${Le.value.value}-${v.value.form_short_name}`,rows:[{label:`row_0_${e}_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]}]}]};f[s].sections.splice(e+1,0,l)},vl=(s,e)=>{let l=f[s].sections[e];l.parent&&Y.push(l),f[s].sections.splice(e,1),f[s].sections.forEach((o,a)=>{o.rows.forEach((n,u)=>{n.columns.forEach((c,m)=>{ce(s,a,u,m)})})})},_l=(s,e,l)=>{f[s].sections[e].rows[l].columns.push({label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]})},bl=(s,e,l,o)=>{const n=f[s].sections[e].rows[l].columns,u=n[o];u.parent&&Y.push(u),n.length===1?f[s].sections[e].rows.splice(l,1):n.splice(o,1),f[s].sections.forEach((c,m)=>{c.rows.forEach((d,p)=>{d.columns.forEach((y,q)=>{ce(s,m,p,q)})})})},hl=(s,e,l,o)=>{f[s].sections[e].rows[l].columns[o].fields.push({label:"",fieldtype:"",options:"",reqd:!1})},gl=(s,e,l,o,a)=>{let n=f[s].sections[e].rows[l].columns[o].fields[a];n.parent&&Y.push(n),f[s].sections[e].rows[l].columns[o].fields.splice(a,1)},yl=(s,e,l,o,a)=>{const n=f[s].sections[e].rows[l].columns[o].fields[a],u=I({},n);u.name=`${n.name} Name the field`,f[s].sections[e].rows[l].columns[o].fields.splice(a+1,0,u)},wl=(s,e,l,o,a)=>{const n=as(f);f.splice(0,f.length,...n);let u=f[s].sections[e].rows[l].columns[o].fields[a].fieldtype;(u!=="Select"||u!=="radio"||u!=="multiselect")&&(f[s].sections[e].rows[l].columns[o].fields[a].options="")};function kl(s){return at.includes(s==null?void 0:s.trim().toLowerCase())}function Cl(s){return/[^a-zA-Z0-9 _\/!@#$%^&*()?.:;|/\\[\]{}]/.test(s)||s.includes('"')||s.includes("'")}function Fl(s){return s.flatMap(e=>{var l;return[(l=e.label)==null?void 0:l.trim().toLowerCase(),...e.sections.flatMap(o=>{var a;return[(a=o.label)==null?void 0:a.trim().toLowerCase(),...o.rows.flatMap(n=>n.columns.flatMap(u=>{var c;return[(c=u.label)==null?void 0:c.trim().toLowerCase(),...u.fields.map(m=>{var d;return(d=m.label)==null?void 0:d.trim().toLowerCase()})]}))]})]}).filter(e=>e!==""&&!Lt.includes(e))}function ce(s,e,l,o,a){const u=Fl(f).filter((d,p,y)=>y.indexOf(d)!==p),c=as(f);f.splice(0,f.length,...c);function m(d,p){if(!d){p.errorMsg="";return}kl(d)?p.errorMsg="Entered label is restricted":Cl(d)?p.errorMsg=`Label should not contain special characters, double quotes (") or single quotes (')`:d.length>64?p.errorMsg="Label should not exceed 64 characters":p.errorMsg=u.includes(d.trim().toLowerCase())?"Duplicate Label Name":""}a!==void 0&&m(f[s].sections[e].rows[l].columns[o].fields[a].label,f[s].sections[e].rows[l].columns[o].fields[a]),a===void 0&&o!==void 0&&m(f[s].sections[e].rows[l].columns[o].label,f[s].sections[e].rows[l].columns[o]),o===void 0&&a===void 0&&m(f[s].sections[e].label,f[s].sections[e]),f.forEach(d=>{d.sections.forEach(p=>{m(p.label,p),p.rows.forEach(y=>{y.columns.forEach(q=>{m(q.label,q),q.fields.forEach(g=>{m(g.label,g)})})})})})}const Ft=se(()=>{function s(e){return!e||typeof e!="object"?!1:"fieldtype"in e&&e.fieldtype===""||"error"in e&&e.error||"errorMsg"in e&&e.errorMsg||["Select","Table MultiSelect"].includes(e.fieldtype)&&(!e.options||e.options.trim()==="")?!0:Array.isArray(e)?e.some(s):Object.values(e).some(s)}return s(f)}),ut=se(()=>Z.value.length>0||K.value.length>0||!v.value.form_category||!v.value.owner_of_the_form||v.value.accessible_departments.length===0),Dl=se(()=>f.some(s=>s.sections.some(e=>e.rows.some(l=>l.columns.some(o=>o.fields.some(a=>a.label&&a.fieldtype))))));function Wt(s,e){let l=s.target.value.trim();if(!l){e==="form_name"?Z.value="Input cannot be empty or only spaces":e==="form_short_name"&&(K.value="Input cannot be empty or only spaces");return}if(l.length>63){e==="form_name"?Z.value="Name cannot exceed 63 characters":e==="form_short_name"&&(K.value="Short name cannot exceed 63 characters");return}if(/^\d/.test(l)){e==="form_short_name"&&(K.value="First character must be a letter");return}else K.value="";if(e==="form_short_name"&&l.length<2){K.value="Short name must have at least 2 letters";return}if(e==="form_short_name"&&/[^a-zA-Z ]/.test(l)){K.value="Only alphabets and spaces are allowed";return}if(/[^a-zA-Z0-9& ]/.test(l)){e==="form_name"?Z.value="Special characters are not allowed":e==="form_short_name"&&(K.value="Special characters are not allowed");return}else e==="form_name"?Z.value="":e==="form_short_name"&&(K.value="");const o=[[e,"=",`${l}`],["business_unit","=",`${v.value.business_unit}`]],a={fields:JSON.stringify(["form_name","form_short_name"]),filters:JSON.stringify(o),doctype:ie.EzyFormDefinitions};z.get(`${N.GetDoctypeData}`,{params:a}).then(n=>{ee.value=n.message.data,e==="form_name"?Z.value=l&&ee.value.some(u=>u.form_name&&u.form_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Name already exists":"":e==="form_short_name"&&(K.value=l&&ee.value.some(u=>u.form_short_name&&u.form_short_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Short name already exists":"")}).catch(n=>{console.error("Error fetching ezyForms data:",n),e==="form_name"?Z.value="":e==="form_short_name"&&(K.value="")})}const $l=s=>s===0?"1st row":s===1?"2nd row":s===2?"3rd row":`${s+1}th row`,ct=h([]),Sl=()=>{f.length&&(ct.value=f,new bootstrap.Modal(document.getElementById("formViewModal")).show())};function ql(){z.post(N.delete_form_items,{deleted_fields:Y.flatMap($t),doctype:T}).then(s=>{var e;(e=s==null?void 0:s.message)!=null&&e.success&&Ct()})}function Ht(s){return Me(this,null,function*(){if(Ft.value){ae("Please fix the errors before proceeding.");return}Pt.value=!0;let e=Y.flatMap($t);T!=null&&T!=null&&T!="new"&&e.length?ql():Ct(s)})}const Al=()=>{st.value.push({role:"",autoApproval:!1,permissions:{}})},Vl=s=>{st.value.splice(s,1)},El=s=>{ns("Permission configuration modal will be implemented here")},Jt=()=>Me(this,null,function*(){var s;if(!(Ne.value.length>0))try{const e={doctype:"WF Roadmap",fields:JSON.stringify(["name","roadmap_title","document_type","workflow_levels","property","cluster_name"]),filters:JSON.stringify([])},l=yield z.get(N.GetDoctypeData,{params:e});(s=l==null?void 0:l.message)!=null&&s.data&&(Ne.value=l.message.data.map(o=>({roadmap_title:o.name,display_name:`${o.roadmap_title} (${o.document_type})`,document_type:o.document_type,workflow_levels:o.workflow_levels,property:o.property,cluster_name:o.cluster_name})),console.log("Fetched WF Road Maps:",Ne.value))}catch(e){console.error("Error fetching WF Road Maps:",e),ae("Failed to fetch workflow road maps")}}),Gt=s=>Me(this,null,function*(){var e;try{console.log("Selected WF Road Map:",s);const l=yield z.get(`${N.resource}${ie.wfRoadmap}/${s.roadmap_title}`),o=((e=l==null?void 0:l.data)==null?void 0:e.data)||(l==null?void 0:l.data)||{};console.log("WF Road Map Data:",o);const a=(o.wf_requestors&&o.wf_requestors.length>0,1),n={};o.wf_level_setup&&o.wf_level_setup.length>0&&o.wf_level_setup.forEach(d=>{n[d.level]||(n[d.level]=[]),n[d.level].push(d)});const u=Object.keys(n).length,c=a+u;for(console.log(`Required blocks: ${c} (1 requestor + ${u} approver levels)`),O=[],Ee.value=[],ge.value=[];f.length>c;)f.pop();for(;f.length<c;)Nt();console.log(`Block adjustment complete: ${f.length} blocks`);let m=0;o.wf_requestors&&o.wf_requestors.length>0?(Ee.value=o.wf_requestors,console.log(`Loaded ${o.wf_requestors.length} requestor role(s)`),o.wf_requestors.forEach(d=>{O.push({type:"requestor",roles:[d.requestor],auto_approval:d.auto_approval||0,columns_allowed:d.columns_allowed||"",fields:[],idx:0})})):console.warn("No Requestors found in roadmap, creating default requestor setup"),m=1,o.wf_level_setup&&o.wf_level_setup.length>0?(ge.value=o.wf_level_setup.sort((p,y)=>p.level-y.level),console.log(`Loaded ${o.wf_level_setup.length} approver level(s)`),Object.keys(n).sort((p,y)=>parseInt(p)-parseInt(y)).forEach(p=>{const y=n[p],q=m;console.log(`Level ${p} → Block Index ${q}, Roles: ${y.length}`),y.forEach(g=>{O.push({type:"approver",level:parseInt(p),roles:[g.role],approval_required:g.mandatory?1:0,approver_can_edit:0,view_only_reportee:g.view_only_reportee||0,all_approvals_required:g.all_approvals_required||0,requester_as_a_approver:g.requester_as_a_approver||0,on_rejection:g.on_rejection||0,columns_allowed:g.columns_allowed||"",fields:[],idx:q})}),m++})):console.warn("No approver levels found in roadmap"),console.log("Final blockArr length:",f.length),console.log("Final workflowSetup:",O),pe(`Workflow configured! ${Ee.value.length} requestor role(s), ${ge.value.length} approver level(s) across ${f.length} blocks.`),os(()=>{ze.value=0})}catch(l){console.error("Error in handleWFRoadMapSelect:",l),ae("Failed to load workflow. Please try again.")}}),Ll=s=>{console.log("Field added from library:",s);const e=ze.value,l=f[e];if(!l){ae("Please create a block first before adding fields");return}const o=Yt(s);if(!o)return;l.sections||(l.sections=[]),l.sections.length===0&&l.sections.push({label:"",rows:[[{label:"",fields:[]}]]});const u=l.sections[0].rows[0][0];u.fields||(u.fields=[]),u.fields.push(o),console.log("Field added successfully:",o),pe(`${o.label} field added successfully`)},Rl=s=>{console.log("Drag started:",s),he.value=s},Tl=()=>{console.log("Drag ended")},Yt=s=>{console.log("Creating field from Frappe type:",s);const e=rt.find(n=>n.type===s);if(!e)return console.error("Field type not found:",s),console.error("Available types:",rt.map(n=>n.type)),ae(`Field type "${s}" not found. Please try again.`),null;const l=Date.now(),o=Math.random().toString(36).substring(2,6),a=`field_${l}_${o}`;return{id:`field_${l}_${o}`,fieldname:a,label:e.label,fieldtype:e.type,options:"",reqd:0,read_only:0,hidden:0,description:"",default:"",placeholder:""}};return(s,e)=>(i(),r("div",null,[t("div",Il,[t("div",eo,[t("div",to,[t("div",so,[t("div",{class:"ps-1 my-2 d-flex align-items-center",onClick:e[0]||(e[0]=l=>il())},e[42]||(e[42]=[t("button",{class:"btn font-13 ms-3"},[t("i",{class:"bi bi-arrow-left"}),t("span",{class:"ms-2"},"Back")],-1)])),s.$route.query.id||s.$route.query.preId?(i(),r("span",lo,"("+b(x.value.formId||S(D).query.form_name)+")",1)):_("",!0)]),t("div",null,[$.value===2&&S(f).length&&!s.$route.query.id?(i(),r("button",{key:0,disabled:Ft.value||ut.value,style:Wl({cursor:Ft.value?"not-allowed":"pointer"}),type:"butoon",class:"btn font-13 btn-light",onClick:e[1]||(e[1]=l=>Ht("Draft"))},e[43]||(e[43]=[t("i",{class:"bi bi-bookmark-check-fill"},null,-1),k(" Save As Draft ")]),12,oo)):_("",!0)])]),t("div",ao,[t("div",no,[t("div",io,[t("div",ro,[t("ul",uo,[(i(!0),r(E,null,L(Ys.value,l=>(i(),r("li",{key:l.id,class:P({active:$.value===l.id,completed:$.value>l.id})},[t("div",{class:P(["d-flex gap-3 align-items-center",{"not-allowed":ut.value&&$.value+1===l.id}]),onClick:o=>dl(l.id)},[$.value>l.id?(i(),r("i",po)):(i(),r("i",{key:1,class:P(l.icon)},null,2)),t("div",mo,[t("span",fo,b(l.stepno),1),e[44]||(e[44]=t("br",null,null,-1)),t("span",vo,b(l.label),1)])],10,co)],2))),128))])])]),t("div",_o,[t("div",bo,[t("div",ho,[$.value===1?(i(),r("div",go,[t("div",yo,[t("div",wo,[e[45]||(e[45]=t("div",null,null,-1)),e[46]||(e[46]=t("h1",{class:"font-14 fw-bold m-0"},"Form Info",-1)),t("div",null,[!s.$route.query.id&&!s.$route.query.preId?(i(),r("button",{key:0,class:"btn btn-light font-12 mx-2",type:"button",onClick:rl},"Clear Form")):_("",!0),$.value<5?(i(),xt(It,{key:1,class:"btn btn-dark bg-dark text-white fw-bold font-13",name:"Next",onClick:yt})):_("",!0)])])]),t("div",ko,[t("div",Co,[e[62]||(e[62]=t("div",{class:"col-sm-none col-md-4"},null,-1)),t("div",Fo,[t("div",Do,[t("div",$o,[t("div",So,[t("div",qo,[S(D).query.preId?(i(),r("span",Ao,e[47]||(e[47]=[k("Predefined "),t("i",{class:"bi bi-check2-circle"},null,-1)]))):_("",!0),X(Xe,{disabled:(x.value.formId&&x.value.formId.length>0||S(D).query.form_name)&&ke.value!=="1",labeltext:"Form Name",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formName",validationStar:"true",placeholder:"Untitled Form",onChange:e[2]||(e[2]=l=>Wt(l,"form_name")),modelValue:Et.value,"onUpdate:modelValue":e[3]||(e[3]=l=>Et.value=l)},null,8,["disabled","modelValue"]),Z.value?(i(),r("span",Vo,b(Z.value),1)):_("",!0)])]),t("div",Eo,[X(Xe,{disabled:(x.value.formId&&x.value.formId.length>0||S(D).query.form_name)&&ke.value!=="1",labeltext:"Form Short Code",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formShortCode",validationStar:"true",placeholder:"Untitled Form",onChange:e[4]||(e[4]=l=>Wt(l,"form_short_name")),modelValue:v.value.form_short_name,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value.form_short_name=l)},null,8,["disabled","modelValue"]),K.value?(i(),r("span",Lo,b(K.value),1)):_("",!0)]),t("div",Ro,[X(Xe,{disabled:x.value.formId&&x.value.formId.length>0&&ke.value!=="1",labeltext:"Form Naming series",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Naming series",modelValue:v.value.series,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value.series=l)},null,8,["disabled","modelValue"]),e[48]||(e[48]=es('<small class="text-muted" style="font-size:12px;" data-v-3aa5272a> Note : Enter <code data-v-3aa5272a>YY-YY</code>, <code data-v-3aa5272a>YYYY</code>, or <code data-v-3aa5272a>ABC</code>. The system will default to the format <code data-v-3aa5272a> 24-25-0001</code>, <code data-v-3aa5272a> 2025-0001</code>, or <code data-v-3aa5272a> ABC-0001</code> respectively. </small>',1))]),t("div",To,[t("label",null,[e[49]||(e[49]=k("Owner Of The Form ")),v.value.owner_of_the_form?_("",!0):(i(),r("span",Uo,"*"))]),X(S(De),{disabled:x.value.formId&&x.value.formId.length>0&&ke.value!=="1",onOpen:zt,options:qe.value,onChange:kt,modelValue:v.value.owner_of_the_form,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value.owner_of_the_form=l),placeholder:"Select Department",multiple:!1,class:"font-11 multiselect",searchable:!0,openDirection:"bottom"},null,8,["disabled","options","modelValue"])]),t("div",Mo,[t("label",null,[e[50]||(e[50]=k("Form Category ")),v.value.form_category?_("",!0):(i(),r("span",Oo,"*"))]),X(S(De),{disabled:x.value.formId&&x.value.formId.length>0&&ke.value!=="1",options:de.value,modelValue:v.value.form_category,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value.form_category=l),placeholder:"Select Category",multiple:!1,searchable:!0,class:"font-11 multiselect"},null,8,["disabled","options","modelValue"])]),t("div",Bo,[t("label",null,[e[51]||(e[51]=k("Accessible to Department ")),v.value.accessible_departments.length?_("",!0):(i(),r("span",zo,"*"))]),X(S(De),{modelValue:v.value.accessible_departments,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value.accessible_departments=l),options:Zs.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Select Department",class:"font-11",onSelect:xs,onRemove:Is,openDirection:"bottom"},{option:ts(({option:l})=>[t("div",No,[t("input",{type:"checkbox",checked:Qs(l),class:"custom-checkbox",onChange:o=>Xs(l,o),onClick:e[9]||(e[9]=re(()=>{},["stop"]))},null,40,Po),t("span",null,b(l),1)])]),selection:ts(({values:l,isOpen:o})=>[l.length?F((i(),r("span",{key:0,class:"multiselect__single font-10"},b(Ks.value),513)),[[mt,!o]]):_("",!0)]),_:1},8,["modelValue","options"])]),t("div",jo,[e[52]||(e[52]=t("label",null,"Form Type",-1)),X(S(De),{options:At,modelValue:Vt.value,"onUpdate:modelValue":e[11]||(e[11]=l=>Vt.value=l),placeholder:"Select Form Type",multiple:!1,searchable:!0,label:"label","track-by":"value",reduce:l=>l.value,class:"font-11 multiselect",openDirection:"top"},null,8,["modelValue","reduce"]),e[53]||(e[53]=t("small",{class:"text-muted font-12 ms-2"},"Note: Public form is accessible by anyone through QR code.",-1))]),t("div",Wo,[e[54]||(e[54]=t("label",null,[k("Has Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(S(De),{options:["Yes","No"],modelValue:v.value.has_workflow,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.has_workflow=l),placeholder:"Select",multiple:!1,class:"font-11 multiselect",searchable:!0},null,8,["modelValue"])]),v.value.has_workflow==="Yes"?(i(),r("div",Ho,[e[55]||(e[55]=t("label",null,[k("Use Existing Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(S(De),{onOpen:Jt,options:Ne.value,modelValue:fe.value,"onUpdate:modelValue":e[13]||(e[13]=l=>fe.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:Gt,openDirection:"bottom"},null,8,["options","modelValue"]),e[56]||(e[56]=t("small",{class:"text-muted font-12 ms-2"},[t("i",{class:"bi bi-info-circle me-1"}),k(" Select to auto-populate requestor and approver configurations ")],-1))])):_("",!0),v.value.as_web_view===1?(i(),r("div",Jo,[e[57]||(e[57]=t("label",null,[k("Form Submit Response "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(Xe,{class:"formHeight mt-2",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Submit Response",modelValue:v.value.public_form_response,"onUpdate:modelValue":e[14]||(e[14]=l=>v.value.public_form_response=l)},null,8,["modelValue"])])):_("",!0),v.value.as_web_view===1?(i(),r("div",Go,[e[58]||(e[58]=t("label",null,[k("Submit Notification Email "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(Xe,{class:"formHeight mt-2",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"Form Submit mail",modelValue:v.value.mail_id,"onUpdate:modelValue":e[15]||(e[15]=l=>v.value.mail_id=l)},null,8,["modelValue"]),e[59]||(e[59]=t("small",{class:"text-muted font-12 ms-2"},"Note : If multiple Emails, separate with commas (,).",-1))])):_("",!0),S(D).query.preId?(i(),r("div",Yo,[t("div",Zo,[F(t("input",{class:"form-check-input linketoCheck p-1",disabled:v.value.is_predefined_doctype==1,type:"checkbox",id:"is_linked","onUpdate:modelValue":e[16]||(e[16]=l=>v.value.is_linked=l),"true-value":1,"false-value":0},null,8,Ko),[[$e,v.value.is_linked]]),e[60]||(e[60]=t("label",{class:"form-check-label font-12 mx-2 mb-0 ps-1",for:"is_linked"}," Link ",-1))])])):_("",!0),v.value.is_linked?(i(),r("div",Qo,[e[61]||(e[61]=t("label",{for:"standardFormInput"},"Form",-1)),F(t("input",{type:"text",class:"form-control standardFormInput",id:"standardFormInput",disabled:v.value.is_predefined_doctype==1,"onUpdate:modelValue":e[17]||(e[17]=l=>v.value.is_linked_form=l),placeholder:"Type to search Form Name...",onInput:fs,onFocus:e[18]||(e[18]=l=>tt.value=!0),onBlur:_s},null,40,Xo),[[M,v.value.is_linked_form]]),tt.value&&et.value.length?(i(),r("ul",xo,[(i(!0),r(E,null,L(et.value,(l,o)=>(i(),r("li",{class:"list-group-item formlistitem",key:o,onMousedown:re(a=>vs(l.name),["prevent"])},b(l.name),41,Io))),128))])):_("",!0)])):_("",!0)])])]),e[63]||(e[63]=t("div",{class:"col-sm-none col-md-4"},null,-1))])])])):_("",!0),$.value===2?(i(),r("div",ea,[t("div",ta,[t("div",sa,[t("button",{onClick:e[19]||(e[19]=l=>wt()),class:"btn btn-sm btn-light"},e[64]||(e[64]=[t("i",{class:"bi bi-chevron-left"},null,-1),k(" Back ")]))]),t("div",la,[(i(!0),r(E,null,L(S(f),(l,o)=>(i(),r("button",{key:o,class:P(["zoho-tab",{active:ze.value===o}]),onClick:a=>ze.value=o},[e[65]||(e[65]=t("i",{class:"bi bi-file-earmark-text me-1"},null,-1)),k(" "+b(o===0?"Requestor Block":`Approver Block ${o}`)+" ",1),S(f).length>1?(i(),r("i",{key:0,class:"bi bi-x-lg ms-2",onClick:re(a=>jt(o),["stop"])},null,8,aa)):_("",!0)],10,oa))),128))]),t("div",na,[t("button",{class:"btn btn-sm btn-primary me-2",onClick:Nt},e[66]||(e[66]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),k("Add Block ")])),Dl.value?(i(),r("button",{key:0,class:"btn btn-sm btn-light me-2",onClick:Sl},e[67]||(e[67]=[t("i",{class:"bi bi-eye me-1"},null,-1),k("Preview ")]))):_("",!0),S(f).length?(i(),r("button",{key:1,class:"btn btn-sm btn-dark",onClick:e[20]||(e[20]=l=>Ht("save"))},b(S(T)!=="new"?"Update Form":"Create Form"),1)):_("",!0)])]),t("div",ia,[t("aside",{class:P(["zoho-field-library",{collapsed:!Ve.value}])},[t("div",{class:"library-header",onClick:e[21]||(e[21]=l=>Ve.value=!Ve.value)},[t("div",ra,[t("h6",da,[e[68]||(e[68]=t("i",{class:"bi bi-grid-3x3-gap me-2"},null,-1)),k(" "+b(Ve.value?"Field Types":"Fields"),1)]),t("button",ua,[t("i",{class:P(Ve.value?"bi bi-chevron-left":"bi bi-chevron-right")},null,2)])])]),Ve.value?(i(),r("div",ca,[X(xl,{fields:rt,onFieldAdd:Ll,onFieldDragstart:Rl,onFieldDragend:Tl})])):_("",!0)],2),t("div",pa,[t("div",{class:"canvas-inner",ref_key:"mainBlockRef",ref:dt},[(i(!0),r(E,null,L(S(f),(l,o)=>F((i(),r("div",{class:"block-level",key:o},[t("div",ma,[t("div",fa,[t("div",va,[t("h6",_a,b(o===0?"Requestor Block":`Approver
                                  Block ${o}
                                  `),1),t("div",ba,[o!==0&&B(o).view_only_reportee||B(o).all_approvals_required||B(o).requester_as_a_approver?(i(),r("div",ha,[t("span",ga,b(B(o).view_only_reportee===1?"Reporting Manager only":"")+" "+b(B(o).all_approvals_required===1?"All of the selected approvers":"")+" "+b(B(o).requester_as_a_approver===1?"Approval by Requestor":""),1),t("span",null,[e[69]||(e[69]=t("span",{class:"ms-1"}," on rejection escalating to ",-1)),t("span",ya,b(B(o).on_rejection?`Level ${B(o).on_rejection}`:"Requestor"),1)]),t("span",wa,b(B(o).all_approvals_required===1?"":"(Skipping multi approval)"),1)])):_("",!0)])]),t("div",ka,[S(T)&&S(O).length?(i(),r("div",Ca,[B(o)?(i(),r("label",Fa,[t("span",Da,b(B(o).roles.length>0?o===0?"Requestor Roles: ":"Approver Roles: ":""),1),t("span",$a,b(B(o).roles.slice(0,2).join(", ")),1),B(o).roles.length>2?(i(),r("span",{key:0,"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:a=>gt(o),class:"more-count badge bg-primary ms-2",style:{cursor:"pointer"}}," +"+b(B(o).roles.length-2)+" more ",9,Sa)):_("",!0)])):_("",!0)])):_("",!0),ps(o)&&S(T)!=null&&S(T)!=null&&S(T)!="new"&&B(o).roles.length===0?(i(),r("button",{key:1,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:a=>gt(o)},[e[70]||(e[70]=t("img",{src:Gl,alt:"Add",class:"me-1"},null,-1)),k(" "+b(o===0?"Add Requestors":"Add Approvers"),1)],8,qa)):_("",!0),S(T)!=null&&S(T)!=null&&S(T)!="new"&&B(o).roles.length>0?(i(),r("button",{key:2,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:a=>gt(o)},e[71]||(e[71]=[t("i",{class:"bi bi-pencil font-14"},null,-1)]),8,Aa)):_("",!0),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteBlock",onClick:a=>jt(o)},e[72]||(e[72]=[t("i",{class:"bi bi-trash me-1"},null,-1),k(" Delete Block ")]),8,Va)])])]),t("div",Ea,[(i(!0),r(E,null,L(l.sections,(a,n)=>(i(),r("div",{key:"section-"+n,class:"dynamicSection mt-0 section"},[t("section",La,[t("div",Ra,[F(t("input",{"onUpdate:modelValue":u=>a.label=u,type:"text",class:P(["border-less-input","font-14",{"italic-style":!a.label},{"fw-medium":a.label}]),onChange:u=>ce(o,n),onInput:u=>ce(o,n),placeholder:"Untitled section"},null,42,Ta),[[M,a.label]]),a.errorMsg?(i(),r("small",Ua,b(a.errorMsg),1)):_("",!0)]),t("div",Ma,[t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:u=>vl(o,n)},e[73]||(e[73]=[t("i",{class:"bi bi-trash me-1"},null,-1),k(" Delete Section ")]),8,Oa)])]),t("div",Ba,[(i(!0),r(E,null,L(a.rows,(u,c)=>(i(),r("section",{class:"row dynamicRow row-container",key:"row-"+c},[t("div",za,[t("label",Na,b($l(c)),1),t("div",null,[u.columns.length<3?(i(),r("button",{key:0,class:"btn btn-light bg-transparent border-0 p-1 font-12",onClick:m=>_l(o,n,c)},e[74]||(e[74]=[t("i",{class:"bi bi-plus font-14"},null,-1),k(" Add Column ")]),8,Pa)):_("",!0)])]),t("div",ja,[t("div",Wa,[(i(!0),r(E,null,L(u.columns,(m,d)=>(i(),r("div",{key:"column-"+d,onMouseenter:p=>Fs(o,n,c,d),onMouseleave:Ds,class:"col p-0 dynamicColumn position-relative column-container"},[t("div",Ja,[t("div",Ga,[F(t("input",{"onUpdate:modelValue":p=>m.label=p,type:"text",class:P(["border-less-input","ps-1","font-14","inputHeight",{"italic-style":!m.label},{"fw-medium":m.label}]),onChange:p=>ce(o,n,c,d),onInput:p=>ce(o,n,c,d),placeholder:"Column Name"},null,42,Ya),[[M,m.label]]),m.errorMsg?(i(),r("small",Za,b(m.errorMsg),1)):_("",!0)]),F(t("div",Ka,[t("button",{class:"btn btn-light bg-transparent me-1 btn-sm",onClick:p=>bl(o,n,c,d)},e[75]||(e[75]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Qa)],512),[[mt,$s(o,n,c,d)]])]),m.fields.length===0?(i(),r("div",{key:0,class:"empty-drop-zone",onDragover:e[22]||(e[22]=re(()=>{},["prevent"])),onDrop:p=>ye(p,o,n,c,d,s.fieldIndex)},null,40,Xa)):_("",!0),(i(!0),r(E,null,L(m.fields,(p,y)=>{var q;return i(),r("div",{key:"field-"+y,onMouseenter:g=>ws(o,n,c,d,y),onMouseleave:ks,class:"dynamicField m-1 draggable-item",draggable:"true",onDragstart:g=>Rt(g,o,n,c,d,y),onDragover:e[26]||(e[26]=re(()=>{},["prevent"])),onDrop:g=>ye(g,o,n,c,d,y)},[t("div",{class:"drop-zone",onDragover:e[23]||(e[23]=re(()=>{},["prevent"])),onDrop:g=>ye(g,o,n,c,d,y)},null,40,Ia),p.fieldtype!=="Table"?(i(),r("div",{key:0,class:"px-1 dynamic_fied field-border",draggable:"true",onDragstart:g=>Rt(g,o,n,c,d,y),onDragover:e[24]||(e[24]=re(()=>{},["prevent"])),onDrop:g=>ye(g,o,n,c,d,y)},[t("div",tn,[t("div",sn,[F(t("input",{"onUpdate:modelValue":g=>p.label=g,placeholder:"Name the field",class:P(["border-less-input","font-14","p-0","inputHeight",{"italic-style":!p.label},{"fw-medium":p.label}]),onChange:g=>ce(o,n,c,d,y),onInput:g=>ce(o,n,c,d,y)},null,42,ln),[[M,p.label]]),p.errorMsg?(i(),r("small",on,b(p.errorMsg),1)):_("",!0)]),F(t("div",an,[t("button",{class:"btn btn-light btn-sm bg-transparent py-0",onClick:g=>yl(o,n,c,d,y)},e[76]||(e[76]=[t("i",{class:"ri-file-copy-line font-13 copyIcon"},null,-1)]),8,nn),t("button",{class:"btn btn-light btn-sm bg-transparent trash-btn py-0",onClick:g=>{gl(o,n,c,d,y),ce(o,n,c,d)}},e[77]||(e[77]=[t("i",{class:"bi bi-x-lg font-13"},null,-1)]),8,rn)],512),[[mt,Cs(o,n,c,d,y)]])]),F(t("select",{"onUpdate:modelValue":g=>p.fieldtype=g,class:"form-select mb-2 mt-1 font-13 searchSelect",onChange:g=>wl(o,n,c,d,y)},[e[78]||(e[78]=t("option",{value:""},"Select Type",-1)),(i(),r(E,null,L(rt,g=>t("option",{key:g,value:g.type},b(g.label),9,un)),64))],40,dn),[[Oe,p.fieldtype]]),["Select","Table MultiSelect","Small Text"].includes(p.fieldtype)?(i(),r("div",cn,[e[79]||(e[79]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),F(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":g=>p.options=g,class:"form-control shadow-none mb-1 font-12"},null,8,pn),[[M,p.options]]),!p.options||p.options.trim()===""?(i(),r("small",mn," Options are required for this field type. ")):_("",!0)])):_("",!0),p.fieldtype==="Link"?(i(),r("div",fn,[t("label",{class:"font-11 fw-light",for:"link-search-"+ve(o,n,c,d,y)}," Search Doctype: ",8,vn),F(t("input",{id:"link-search-"+ve(o,n,c,d,y),type:"text","onUpdate:modelValue":g=>S(f)[o].sections[n].rows[c].columns[d].fields[y].options=g,onInput:g=>hs(S(f)[o].sections[n].rows[c].columns[d].fields[y].options,o,n,c,d,y),onFocus:g=>bs(ve(o,n,c,d,y)),class:"form-control font-12 mb-1",placeholder:"Type to search..."},null,40,_n),[[M,S(f)[o].sections[n].rows[c].columns[d].fields[y].options]]),(q=je[ve(o,n,c,d,y)])!=null&&q.length&&vt[ve(o,n,c,d,y)]?(i(),r("ul",bn,[(i(!0),r(E,null,L(je[ve(o,n,c,d,y)],(g,w)=>(i(),r("li",{key:w,onClick:C=>gs(o,n,c,d,y,g.name),class:"list-group-item list-group-item-action"},b(g.name),9,hn))),128))])):_("",!0)])):_("",!0),t("div",gn,[t("div",yn,[t("div",wn,[F(t("input",{class:"font-12","onUpdate:modelValue":g=>p.reqd=g,"true-value":1,id:"mandatory-"+o+"-"+n+"-"+c+"-"+d+"-"+y,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,8,kn),[[$e,p.reqd]])]),t("div",null,[t("label",{class:"font-12 m-0 fw-light",for:"mandatory-"+o+"-"+n+"-"+c+"-"+d+"-"+y},"Mandatory",8,Cn)])]),t("div",null,[t("button",{class:"btn btn-sm font-12",onClick:g=>p.showDescription=!p.showDescription},b(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Fn)])]),p.showDescription?F((i(),r("textarea",{key:2,"onUpdate:modelValue":g=>p.description=g,class:"form-control font-12 mt-2",placeholder:"Enter field description"},null,8,Dn)),[[M,p.description]]):_("",!0),p.error?(i(),r("small",$n,b(p.error),1)):_("",!0)],40,en)):_("",!0),t("div",{class:"drop-zone",onDragover:e[25]||(e[25]=re(()=>{},["prevent"])),onDrop:g=>ye(g,o,n,c,d,y)},null,40,Sn),t("div",qn,[t("div",null,[t("div",null,[t("div",An,[p.fieldtype==="Table"?(i(),r("div",Vn,[(i(!0),r(E,null,L(te.value,(g,w)=>(i(),r("div",{key:w,class:"childTable"},[w===p.fieldname||w===p.options?(i(),r("h5",En,b(w.replace(/_/g," ")),1)):_("",!0),W[w]&&w===Mt.value?(i(),r("div",Ln,[t("div",Rn,[p.showDescription?F((i(),r("input",{key:0,"onUpdate:modelValue":C=>p.description=C,class:"form-control font-12",placeholder:"Enter field description"},null,8,Tn)),[[M,p.description]]):_("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:C=>p.showDescription=!p.showDescription},b(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Un)])])):_("",!0),w===p.options||w===p.fieldname?(i(),r("table",Mn,[e[83]||(e[83]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",{onDragover:re(As,["prevent"]),onDrop:C=>Vs(C,g)},[(i(!0),r(E,null,L(g,(C,G)=>{var Je,Ge,Ye,Ze,Ke,Qe,Q;return i(),r("tr",{key:G,draggable:W[w],onDragstart:H=>Ss(G),onDragend:qs,class:P({dragging:Ce.value===G})},[t("td",null,b(G+1),1),W[w]?(i(),r("td",zn,[F(t("input",{"onUpdate:modelValue":H=>C.label=H,onInput:H=>it(C,w,G),placeholder:"Field Label",class:P(["form-control",{"border-1 border-danger":(Ge=(Je=A[w])==null?void 0:Je[G])==null?void 0:Ge.length}])},null,42,Nn),[[M,C.label]]),(Ze=(Ye=A[w])==null?void 0:Ye[G])!=null&&Ze.length?(i(),r("div",Pn,[(i(!0),r(E,null,L(A[w][G],(H,Ul)=>(i(),r("div",{key:Ul},b(H),1))),128))])):_("",!0)])):(i(),r("td",jn,b(C.label),1)),W[w]?(i(),r("td",Wn,[t("div",Hn,[F(t("select",{"onUpdate:modelValue":H=>C.fieldtype=H,onChange:H=>it(C,w,G),class:P(["form-select form-select-sm",{"border-1 border-danger":(Qe=(Ke=A[w])==null?void 0:Ke[G])==null?void 0:Qe.length}])},[e[80]||(e[80]=t("option",{value:""},"Select Type",-1)),(i(),r(E,null,L(bt,H=>t("option",{key:H.type,value:H.type},b(H.label),9,Gn)),64))],42,Jn),[[Oe,C.fieldtype]]),t("div",Yn,[t("div",Zn,[t("div",Kn,[F(t("input",{class:"font-12 form-control-sm","onUpdate:modelValue":H=>C.description=H,placeholder:"description",type:"text"},null,8,Qn),[[M,C.description]])])]),t("button",{class:"btn btn-light btn-sm",onClick:H=>Js(w,G)},e[81]||(e[81]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Xn)])]),["Select"].includes(C.fieldtype)?(i(),r("div",xn,[e[82]||(e[82]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),F(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":H=>C.options=H,onInput:H=>it(C,w,G),class:"form-control shadow-none mb-1 font-12"},null,40,In),[[M,C.options]]),!C.options||C.options.trim()===""?(i(),r("small",ei," Options are required for this field type. ")):_("",!0)])):_("",!0),(Q=J[w])!=null&&Q.includes(G)?(i(),r("span",ti,"Type required**")):_("",!0)])):(i(),r("td",si,b(C.fieldtype),1))],42,Bn)}),128))],40,On)])):_("",!0),p.fieldtype==="Table"&&(p.label===w||p.fieldname===w)?(i(),r("div",li,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:C=>Gs(w,p.description)},b(W[w]?"Save":"Edit"),9,oi),W[w]?(i(),r("button",{key:0,class:"btn btn-light btn-sm",onClick:C=>Hs(w)}," Add More Field ",8,ai)):_("",!0)])):_("",!0)]))),128))])):_("",!0)])])])])],40,xa)}),128)),t("div",{class:"drop-zone-bottom",onDragover:e[27]||(e[27]=re(()=>{},["prevent"])),onDrop:p=>ye(p,o,n,c,d,m.fields.length),style:{"background-color":"#f0f0f0",border:"1px dashed #ccc",margin:"4px"}},null,40,ni),t("div",{class:"drop-zone",onDragover:e[28]||(e[28]=re(()=>{},["prevent"])),onDrop:p=>ye(p,o,n,c,d,s.fields.length),style:{height:"10px","background-color":"transparent"}},null,40,ii),t("div",ri,[t("button",{class:"btn btn-light btn-sm d-flex align-items-center addField m-2",onClick:p=>hl(o,n,c,d)},e[84]||(e[84]=[t("i",{class:"bi bi-plus fs-5"},null,-1),t("span",null,"Add Field",-1)]),8,di)])],40,Ha))),128))])])]))),128)),t("div",null,[(i(!0),r(E,null,L(a.afterCreated,(u,c)=>(i(),r("div",{key:c,class:"childTable dynamicColumn m-0 p-2"},[t("h5",ui,b(u.tableName),1),W[u.tableName]?(i(),r("div",ci,[t("div",pi,[u.showDescription?F((i(),r("input",{key:0,"onUpdate:modelValue":m=>u.description=m,class:"form-control font-12",placeholder:"Enter field description"},null,8,mi)),[[M,u.description]]):_("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:m=>u.showDescription=!u.showDescription},b(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,fi)])])):_("",!0),t("table",vi,[e[90]||(e[90]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",null,[(i(!0),r(E,null,L(u.columns,(m,d)=>{var p,y,q,g;return i(),r("tr",{key:d},[t("td",null,b(d+1),1),W[u.tableName]?(i(),r("td",_i,[F(t("input",{"onUpdate:modelValue":w=>m.label=w,placeholder:"Field Label",class:P(["form-control",{"border-1 border-danger":(p=J[u.tableName])==null?void 0:p.includes(d)}]),onBlur:w=>{var C;m.label=(C=m.label)==null?void 0:C.trim(),We(m,u.tableName,d,u.columns)}},null,42,bi),[[M,m.label]]),(y=A[u.tableName])!=null&&y[d]?(i(),r("div",hi,[(i(!0),r(E,null,L(A[u.tableName][d],(w,C)=>(i(),r("span",{key:C},[k(b(w)+" ",1),e[85]||(e[85]=t("br",null,null,-1))]))),128))])):_("",!0)])):(i(),r("td",gi,b(m.label),1)),W[u.tableName]?(i(),r("td",yi,[t("div",wi,[F(t("select",{"onUpdate:modelValue":w=>m.fieldtype=w,class:P(["form-select form-select-sm",{"border-1 border-danger":(q=J[u.tableName])==null?void 0:q.includes(d)}]),onChange:w=>We(m,u.tableName,d,u.columns)},[e[86]||(e[86]=t("option",{value:""},"Select Type",-1)),(i(),r(E,null,L(bt,w=>t("option",{key:w.type,value:w.type},b(w.label),9,Ci)),64))],42,ki),[[Oe,m.fieldtype]]),t("button",{class:"btn btn-light btn-sm",onClick:w=>js(o,n,u.tableName,d)},e[87]||(e[87]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Fi)]),m.fieldtype==="Select"?(i(),r("div",Di,[e[88]||(e[88]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),F(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":w=>m.options=w,class:"form-control shadow-none mb-1 font-12",onInput:w=>We(m,u.tableName,d,u.columns)},null,40,$i),[[M,m.options]])])):_("",!0),(g=A[u.tableName])!=null&&g[d]?(i(),r("div",Si,[(i(!0),r(E,null,L(A[u.tableName][d],(w,C)=>(i(),r("span",{key:C},[k(b(w),1),e[89]||(e[89]=t("br",null,null,-1))]))),128))])):_("",!0)])):(i(),r("td",qi,b(m.fieldtype),1))])}),128))])]),t("div",Ai,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:m=>Ws(o,n,u.tableName)},b(W[u.tableName]?"Save":"Edit"),9,Vi),W[u.tableName]?(i(),r("button",{key:0,class:"btn btn-light btn-sm",onClick:m=>Ps(o,n,u.tableName)}," Add More Field ",8,Ei)):_("",!0)])]))),128))])]),t("div",null,[t("div",null,[o==0?(i(),r("button",{key:0,class:"btn btn-light addRow mb-3 mt-4",onClick:u=>Ls(o,n)}," Add New Table ",8,Li)):_("",!0),(i(!0),r(E,null,L(a.childTables,(u,c)=>{var m;return i(),r("div",{key:`table-${o}-${n}-${c}`,class:"child-table"},[u.newTable?(i(),r("div",Ri,[t("div",Ti,[t("div",null,[t("span",{class:P(u.tableName?"d-none":"text-danger")},"*",2),F(t("input",{"onUpdate:modelValue":d=>u.tableName=d,placeholder:"Table Name",onBlur:d=>Tt(u),class:P(["border-less-input font-14 p-0 inputHeight",{"italic-style":!u.tableName,"fw-medium":u.tableName}])},null,42,Ui),[[M,u.tableName]]),(m=A[`${o}-${n}-${c}`])!=null&&m.tableName?(i(),r("div",Mi,b(A[`${o}-${n}-${c}`].tableName),1)):_("",!0),Ue.value?(i(),r("div",Oi,b(Ue.value),1)):_("",!0),t("div",Bi,[t("div",zi,[u.showDescription?F((i(),r("input",{key:0,"onUpdate:modelValue":d=>u.as_a_block=d,class:"form-control font-12",placeholder:"Enter field description"},null,8,Ni)),[[M,u.as_a_block]]):_("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:d=>u.showDescription=!u.showDescription},b(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,Pi)])])]),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:d=>Ts(o,n,c)},e[91]||(e[91]=[t("i",{class:"bi bi-trash"},null,-1),k(" Remove Table ")]),8,ji)]),(i(!0),r(E,null,L(u.columns,(d,p)=>{var y,q,g,w,C,G,Je,Ge,Ye,Ze,Ke,Qe;return i(),r("div",{key:p,class:"dynamicField"},[t("div",Wi,[t("div",Hi,[t("div",null,[t("span",{class:P(d.label?"d-none":"text-danger")},"*",2),F(t("input",{"onUpdate:modelValue":Q=>d.label=Q,placeholder:"Name the field",onBlur:()=>{Tt(d),Ms(d,o,n,c,p,u.columns)},class:P(["border-less-input font-14 p-0 inputHeight",{"italic-style":!d.label,"fw-medium":d.label,"is-invalid":(g=(q=(y=A[`${o}-${n}-${c}`])==null?void 0:y.columns)==null?void 0:q[p])==null?void 0:g.label}])},null,42,Ji),[[M,d.label]]),(G=(C=(w=A[`${o}-${n}-${c}`])==null?void 0:w.columns)==null?void 0:C[p])!=null&&G.label?(i(),r("div",Gi,b(A[`${o}-${n}-${c}`].columns[p].label),1)):_("",!0)]),t("div",Yi,[t("div",Zi,[d.showDescription?F((i(),r("input",{key:0,"onUpdate:modelValue":Q=>d.description=Q,class:"form-control font-12",placeholder:"Enter field description"},null,8,Ki)),[[M,d.description]]):_("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:Q=>d.showDescription=!d.showDescription},b(d.showDescription?"Hide Description":d.description?"Edit Description":"Add Description"),9,Qi)]),t("button",{class:"btn btn-sm trash-btn py-0",onClick:Q=>Us(o,n,c,p)},e[92]||(e[92]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Xi)])]),F(t("select",{"onUpdate:modelValue":Q=>d.fieldtype=Q,class:P(["form-select font-13 mb-1",{"is-invalid":(Ye=(Ge=(Je=A[`${o}-${n}-${c}`])==null?void 0:Je.columns)==null?void 0:Ge[p])==null?void 0:Ye.fieldtype}])},[e[93]||(e[93]=t("option",{value:""},"Select Type",-1)),(i(),r(E,null,L(bt,Q=>t("option",{key:Q.type,value:Q.type},b(Q.label),9,Ii)),64))],10,xi),[[Oe,d.fieldtype]]),["Select"].includes(d.fieldtype)?(i(),r("div",er,[e[94]||(e[94]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),F(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":Q=>d.options=Q,class:"form-control shadow-none mb-1 font-12"},null,8,tr),[[M,d.options]]),!d.options||d.options.trim()===""?(i(),r("small",sr," Options are required for this field type. ")):_("",!0)])):_("",!0),(Qe=(Ke=(Ze=A[`${o}-${n}-${c}`])==null?void 0:Ze.columns)==null?void 0:Ke[p])!=null&&Qe.fieldtype?(i(),r("div",lr,b(A[`${o}-${n}-${c}`].columns[p].fieldtype),1)):_("",!0)])])}),128)),t("button",{class:"btn btn-light btn-sm addField mx-1",onClick:d=>Rs(o,n,c)},e[95]||(e[95]=[t("i",{class:"bi bi-plus"},null,-1),k(" Add Field ")]),8,or),t("button",{class:"btn btn-dark btn-sm font-12 mx-1",onClick:d=>Ns(o,n,c)}," Create Table ",8,ar),e[96]||(e[96]=t("hr",null,null,-1))])):_("",!0)])}),128))])]),t("div",nr,[t("button",{class:"btn btn-light border font-12",onClick:u=>fl(o,n)},e[97]||(e[97]=[t("i",{class:"bi bi-plus-circle me-1 fs-6"},null,-1),k(" Add Section ")]),8,ir)])]))),128)),o===0?(i(),r("div",rr)):_("",!0)])])),[[mt,o===ze.value]])),128))],512)]),qt.value?(i(),r("aside",dr,[t("div",ur,[e[99]||(e[99]=t("h6",{class:"mb-0"},"Field Properties",-1)),t("button",{class:"btn btn-sm btn-link p-0",onClick:e[29]||(e[29]=l=>qt.value=null)},e[98]||(e[98]=[t("i",{class:"bi bi-x-lg"},null,-1)]))]),e[100]||(e[100]=t("div",{class:"properties-content"},[t("p",{class:"text-muted small"},"Select a field to edit its properties")],-1))])):_("",!0)])])):_("",!0),$.value===3?(i(),r("div",cr,[t("div",pr,[t("button",{onClick:e[30]||(e[30]=l=>wt()),class:"btn btn-sm btn-light"},e[101]||(e[101]=[t("i",{class:"bi bi-chevron-left"},null,-1),k(" Back ")])),e[103]||(e[103]=t("h1",{class:"font-14 fw-bold m-0"},"Workflow Setup",-1)),t("button",{class:"btn btn-sm btn-dark",onClick:yt},e[102]||(e[102]=[k(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]))]),t("div",mr,[t("div",fr,[e[109]||(e[109]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),k("Workflow Configuration")])],-1)),t("div",vr,[t("div",_r,[t("div",br,[e[106]||(e[106]=t("label",{class:"form-label fw-bold"},"Workflow Type",-1)),t("div",hr,[F(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"existingWorkflow",value:"existing","onUpdate:modelValue":e[31]||(e[31]=l=>me.value=l)},null,512),[[ss,me.value]]),e[104]||(e[104]=t("label",{class:"btn btn-outline-primary",for:"existingWorkflow"},[t("i",{class:"bi bi-folder me-1"}),k("Use Existing ")],-1)),F(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"newWorkflow",value:"new","onUpdate:modelValue":e[32]||(e[32]=l=>me.value=l),checked:""},null,512),[[ss,me.value]]),e[105]||(e[105]=t("label",{class:"btn btn-outline-primary",for:"newWorkflow"},[t("i",{class:"bi bi-plus-circle me-1"}),k("Create New ")],-1))])]),me.value==="existing"?(i(),r("div",gr,[e[107]||(e[107]=t("label",{class:"form-label fw-bold"},"Select Workflow",-1)),X(S(De),{onOpen:Jt,options:Ne.value,modelValue:fe.value,"onUpdate:modelValue":e[33]||(e[33]=l=>fe.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:Gt,openDirection:"bottom"},null,8,["options","modelValue"]),e[108]||(e[108]=t("small",{class:"text-muted font-12 mt-1 d-block"},[t("i",{class:"bi bi-info-circle me-1"}),k("Auto-populates requestors and approvers ")],-1))])):_("",!0)])])]),me.value==="new"?(i(),r("div",yr,[e[115]||(e[115]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-person-plus me-2"}),k("Requestor Configuration")])],-1)),t("div",wr,[e[114]||(e[114]=t("p",{class:"text-muted font-12 mb-3"},[t("i",{class:"bi bi-info-circle me-1"}),k(" Define who can submit requests for this form based on WF Requestors ")],-1)),t("button",{class:"btn btn-primary btn-sm mb-3",onClick:Al},e[110]||(e[110]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),k("Add Requestor Role ")])),st.value.length>0?(i(),r("div",kr,[t("table",Cr,[e[113]||(e[113]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"40%"},"Role"),t("th",{width:"30%"},"Auto Approval"),t("th",{width:"20%"},"Permissions"),t("th",{width:"10%"},"Action")])],-1)),t("tbody",null,[(i(!0),r(E,null,L(st.value,(l,o)=>(i(),r("tr",{key:o},[t("td",null,[F(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":a=>l.role=a,placeholder:"Enter role name"},null,8,Fr),[[M,l.role]])]),t("td",null,[t("div",Dr,[F(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a=>l.autoApproval=a},null,8,$r),[[$e,l.autoApproval]]),t("label",Sr,b(l.autoApproval?"Yes":"No"),1)])]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:a=>El()},e[111]||(e[111]=[t("i",{class:"bi bi-gear"},null,-1),k(" Configure ")]),8,qr)]),t("td",null,[t("button",{class:"btn btn-sm btn-danger",onClick:a=>Vl(o)},e[112]||(e[112]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Ar)])]))),128))])])])):_("",!0)])])):_("",!0),me.value==="existing"&&fe.value&&Ee.value.length>0?(i(),r("div",Vr,[e[121]||(e[121]=t("div",{class:"card-header bg-success text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-check-circle me-2"}),k("Loaded Requestors")])],-1)),t("div",Er,[t("div",Lr,[e[116]||(e[116]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),t("strong",null,b(Ee.value.length),1),e[117]||(e[117]=k(" requestor role(s) loaded from ")),t("strong",null,b(fe.value.display_name),1)]),t("div",Rr,[t("table",Tr,[e[119]||(e[119]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Role"),t("th",null,"Auto Approval"),t("th",null,"Columns Allowed")])],-1)),t("tbody",null,[(i(!0),r(E,null,L(Ee.value,(l,o)=>(i(),r("tr",{key:o},[t("td",null,[t("strong",null,b(l.requestor),1)]),t("td",null,[l.auto_approval?(i(),r("span",Ur,e[118]||(e[118]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),k("Yes ")]))):(i(),r("span",Mr,"No"))]),t("td",null,[t("small",Or,b(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[120]||(e[120]=t("div",{class:"alert alert-info mt-3"},[t("i",{class:"bi bi-info-circle me-1"}),k(" Go to "),t("strong",null,"Step 2"),k(" and click "),t("strong",null,'"Add Requestors"'),k(" to select specific designations for these roles ")],-1))])])):_("",!0),me.value==="existing"&&fe.value&&ge.value.length>0?(i(),r("div",Br,[e[130]||(e[130]=t("div",{class:"card-header bg-primary text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),k("Loaded Approval Workflow")])],-1)),t("div",zr,[t("div",Nr,[e[122]||(e[122]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),t("strong",null,b(ge.value.length),1),e[123]||(e[123]=k(" approval level(s) loaded from ")),t("strong",null,b(fe.value.display_name),1)]),t("div",Pr,[t("table",jr,[e[128]||(e[128]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"10%"},"Level"),t("th",{width:"25%"},"Role"),t("th",{width:"15%"},"Mandatory"),t("th",{width:"20%"},"Approval Type"),t("th",{width:"30%"},"Columns Allowed")])],-1)),t("tbody",null,[(i(!0),r(E,null,L(ge.value,(l,o)=>(i(),r("tr",{key:o},[t("td",null,[t("span",Wr,"Level "+b(l.level),1)]),t("td",null,[t("strong",null,b(l.role),1)]),t("td",null,[l.mandatory?(i(),r("span",Hr,e[124]||(e[124]=[t("i",{class:"bi bi-exclamation-circle me-1"},null,-1),k("Required ")]))):(i(),r("span",Jr,"Optional"))]),t("td",null,[l.view_only_reportee?(i(),r("span",Gr,e[125]||(e[125]=[t("i",{class:"bi bi-person me-1"},null,-1),k("Reporting Manager ")]))):l.all_approvals_required?(i(),r("span",Yr,e[126]||(e[126]=[t("i",{class:"bi bi-people me-1"},null,-1),k("All Users ")]))):l.requester_as_a_approver?(i(),r("span",Zr,e[127]||(e[127]=[t("i",{class:"bi bi-person-check me-1"},null,-1),k("Requestor ")]))):(i(),r("span",Kr," Any One "))]),t("td",null,[t("small",Qr,b(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[129]||(e[129]=t("div",{class:"alert alert-info mt-3"},[t("i",{class:"bi bi-info-circle me-1"}),k(" Go to "),t("strong",null,"Step 2"),k(" and click "),t("strong",null,'"Add Approvers"'),k(" for each level to select specific designations ")],-1))])])):_("",!0),e[131]||(e[131]=es('<div class="card mt-4" data-v-3aa5272a><div class="card-header bg-light" data-v-3aa5272a><h6 class="mb-0 fw-bold" data-v-3aa5272a><i class="bi bi-shield-check me-2" data-v-3aa5272a></i>System Generated Fields</h6></div><div class="card-body" data-v-3aa5272a><div class="alert alert-secondary mb-3" data-v-3aa5272a><i class="bi bi-info-circle me-2" data-v-3aa5272a></i> These fields are automatically included for all requestors. </div><div class="row g-3" data-v-3aa5272a><div class="col-md-6" data-v-3aa5272a><div class="field-preview-card" data-v-3aa5272a><label class="form-label fw-bold" data-v-3aa5272a>Requestor Name</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-3aa5272a></div></div><div class="col-md-6" data-v-3aa5272a><div class="field-preview-card" data-v-3aa5272a><label class="form-label fw-bold" data-v-3aa5272a>Requestor Email</label><input type="email" class="form-control" value="Auto-populated from user profile" disabled data-v-3aa5272a></div></div><div class="col-md-6" data-v-3aa5272a><div class="field-preview-card" data-v-3aa5272a><label class="form-label fw-bold" data-v-3aa5272a>Request Date</label><input type="text" class="form-control" value="Auto-populated on submission" disabled data-v-3aa5272a></div></div><div class="col-md-6" data-v-3aa5272a><div class="field-preview-card" data-v-3aa5272a><label class="form-label fw-bold" data-v-3aa5272a>Department</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-3aa5272a></div></div></div></div></div>',1))])])):_("",!0),$.value===4?(i(),r("div",Xr,[e[132]||(e[132]=t("div",{class:"stepperbackground d-flex align-items-center justify-content-end gap-2"},[t("div",null,[t("button",{class:"btn btn btn-light previewBtn font-13","data-bs-toggle":"modal","data-bs-target":"#customFormatModal"},"Print Format ")]),t("div")],-1)),X(ls,{blockArr:ct.value},null,8,["blockArr"])])):_("",!0)])])])])])])]),t("div",xr,[t("div",Ir,[t("div",ed,[e[136]||(e[136]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"customFormatModalLabel"},"Print Format"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",td,[e[134]||(e[134]=t("label",{for:""},"Form Name",-1)),F(t("input",{"onUpdate:modelValue":e[34]||(e[34]=l=>ot.value=l),multiple:!1,placeholder:S(D).query.id,class:"font-11 form-control",id:"Form_name_print",searchable:!0},null,8,sd),[[M,ot.value]]),t("div",ld,[t("div",od,[F(t("input",{class:"font-12","onUpdate:modelValue":e[35]||(e[35]=l=>Re.value=l),"true-value":1,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,512),[[$e,Re.value]])]),e[133]||(e[133]=t("div",null,[t("label",{for:"mandatory",class:"font-12 fw-bold m-0 fw-light"},"Print Landscape Mode")],-1))])]),t("div",{class:"modal-footer"},[e[135]||(e[135]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),t("button",{type:"button",class:"btn btn-dark",onClick:cl},"Add Print Format")])])])]),t("div",ad,[t("div",nd,[t("div",id,[e[137]||(e[137]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"formViewModalLabel"},"Form Preview"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",rd,[X(ls,{blockArr:ct.value},null,8,["blockArr"])]),e[138]||(e[138]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),t("div",dd,[t("div",ud,[t("span",cd,b(j.value==0?"Add Requestors":`Approval Settings - Level ${j.value}`),1),e[139]||(e[139]=t("button",{type:"button",class:"btn-close bg-light text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),t("div",pd,[t("div",md,[j.value!==0?(i(),r("div",fd,[e[141]||(e[141]=t("label",{class:"fw-bold font-12 mb-2"},"Approver Type",-1)),F(t("select",{"onUpdate:modelValue":e[36]||(e[36]=l=>ue.value=l),class:"form-select shadow-none font-12"},e[140]||(e[140]=[t("option",{value:""},"Any one of the selected approvers",-1),t("option",{value:"ViewOnlyReportee"},"Reporting Manager only",-1),t("option",{value:"all_approvals_required"},"All of the selected approvers",-1),t("option",{value:"requester_as_a_approver"},"Approval by Requestor",-1)]),512),[[Oe,ue.value]])])):_("",!0),t("div",vd,[t("div",_d,[t("span",bd," Select "+b(j.value===0?"Requestors":"Approvers"),1),t("span",hd,b(R.value.length)+" Selected ",1)]),ne.value.length?(i(),r("div",gd,[t("div",yd,[t("div",wd,[t("input",{type:"checkbox",id:"selectAll",checked:el.value,onChange:tl,class:"form-check-input me-2 designationCheckBox"},null,40,kd),t("label",Cd," Select all designation ("+b(He.value.length)+") ",1)]),j.value!==0?(i(),r("div",Fd,[F(t("input",{type:"checkbox",id:"showHods","onUpdate:modelValue":e[37]||(e[37]=l=>Te.value=l),class:"form-check-input me-2 designationCheckBox"},null,512),[[$e,Te.value]]),e[142]||(e[142]=t("label",{for:"showHods",class:"form-check-label mt-2 fw-bold"}," Show HODs Only ",-1))])):_("",!0),t("div",null,[R.value.length?(i(),r("button",{key:0,type:"button",class:"btn btn-sm font-12 text-danger",onClick:sl},e[143]||(e[143]=[t("i",{class:"bi bi-x"},null,-1),k(" Clear all ")]))):_("",!0)])]),ne.value.length?(i(),xt(S(Hl),{key:0,multiple:!0,modelValue:R.value,"onUpdate:modelValue":e[38]||(e[38]=l=>R.value=l),options:He.value,"close-on-select":!1,"clear-search-on-select":!0,placeholder:"Search & Select Designations"},null,8,["modelValue","options"])):_("",!0)],512)):(i(),r("div",Dd,e[144]||(e[144]=[t("div",{class:"d-flex justify-content-center"},[t("span",null,"No Designations Found")],-1)])))]),j.value!==0?(i(),r("div",$d,[e[145]||(e[145]=t("div",null,[t("label",{for:"",class:"fw-bold font-12"},"On Rejection")],-1)),F(t("select",{"onUpdate:modelValue":e[39]||(e[39]=l=>Ae.value=l),class:"form-select shadow-none font-12 mt-1 me-2"},[(i(!0),r(E,null,L(ys.value,l=>(i(),r("option",{key:l,value:l},b(l===0?"Requestor":"Approver Level "+l),9,Sd))),128))],512),[[Oe,Ae.value,void 0,{number:!0}]])])):_("",!0),j.value!==0?(i(),r("div",qd,[t("div",Ad,[t("div",Vd,[F(t("input",{"onUpdate:modelValue":e[40]||(e[40]=l=>xe.value=l),type:"checkbox","true-value":1,"false-value":0,id:"Approver",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[$e,xe.value]]),e[146]||(e[146]=t("label",{for:"Approver",class:"m-0"},"Approval Mandatory",-1))]),ft.value===!0?(i(),r("div",Ed,[F(t("input",{"onUpdate:modelValue":e[41]||(e[41]=l=>Ie.value=l),type:"checkbox","true-value":1,"false-value":0,id:"approver_can_edit",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[$e,Ie.value]]),e[147]||(e[147]=t("label",{for:"approver_can_edit",class:"m-0"}," Allow this approver to edit the form ",-1))])):_("",!0)])])):_("",!0)]),t("div",Ld,[t("div",Rd,[X(It,{class:"btn btn-dark addingDesignations","data-bs-dismiss":"offcanvas",onClick:ll,name:j.value===0?"Add Requestor":"Add Approvers"},null,8,["name"])])])])])]))}},Od=is(Td,[["__scopeId","data-v-3aa5272a"]]);export{Od as default};
