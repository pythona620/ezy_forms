import{_ as j,e as g,d as o,w as b,p as I,o as i,c as r,b as t,a as E,G as M,P as $,t as d,C as k,D as L,i as u,x as N,E as q,k as V,l as B,n as S}from"./index-OTUT9Deo.js";const G={class:"mt-2"},H={class:"offcanvas offcanvas-end","data-bs-backdrop":"static",tabindex:"-1",id:"staticBackdrop","aria-labelledby":"staticBackdropLabel"},W={class:"offcanvas-header"},K=["title"],Q={class:"offcanvas-body"},X={key:0,class:"offcanvas-div"},Y={class:"m-0 font-13"},Z={class:"m-0 font-13"},ee={key:1,class:"m-0 font-13"},te={key:1,class:"offcanvas-div"},ae={class:"m-0 font-13"},se={class:"m-0 font-13"},ne={class:"m-0 font-13"},oe={key:2},le={__name:"AuditLog",setup(ie){const O=g(()=>q.value),C=o(0),c=o([]);o(["yes","no"]),o([]),o(""),o(null),o(""),o([]),o({ezy_departments_items:[]});const F=o([]),D=o(null),m=o([]),l=o({limitPageLength:20,limit_start:0,filters:[]}),v=o({department_code:"",department_name:""}),A=o([]),w=o([{th:"Document Name",td_key:"docname"},{th:"Doctype Name",td_key:"ref_doctype"},{th:"Modified By",td_key:"modified_by"},{th:"Modified Date",td_key:"modified"}]),J=o({docname:{type:"input"},ref_doctype:{type:"input"},modified_by:{type:"input"}}),_=o({department_code:"",department_name:"",business_unit:"",ezy_departments_items:[]});b(()=>_.value.department_code,a=>{const e=a.trim().toLowerCase();A.value.filter(s=>s!==null).map(s=>s.trim().toLowerCase()).includes(e)?v.value.department_code="Department code already exists.":v.value.department_code=""}),b(()=>_.value.department_name,a=>{const e=a.trim().toLowerCase();F.value.filter(s=>s!==null).map(s=>s.trim().toLowerCase()).includes(e)?v.value.department_name="Department name already exists.":v.value.department_name=""}),I({applieddepartment_name:!1,applieddepartment_code:!1,department_name:"",department_code:""}),b(O,a=>{_.value.business_unit=a,console.log("teDepartments",_.value.business_unit),a.length&&f()},{immediate:!0});function R(a){clearTimeout(D.value),D.value=setTimeout(()=>{l.value.filters=[],w.value.forEach(e=>{const n=e.td_key;a[n]&&l.value.filters.push([n,"like",`%${a[n]}%`])}),l.value.filters.length?f(l.value.filters):f()},500)}const U=a=>{l.value.limitPageLength=a,l.value.limit_start=0,f()},z=([a,e])=>{l.value.limitPageLength=a,l.value.limit_start=e,f()};function f(a){a&&l.value.filters.push(...a),l.value.filters.push(["ref_doctype","in",["User","Ezy Departments","WF Roles"]]);const e={fields:JSON.stringify(["*"]),filters:JSON.stringify(l.value.filters),limit_page_length:l.value.limitPageLength,limit_start:l.value.limit_start,order_by:"`tabVersion`.`creation` desc"},n={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(l.value.filters)};V.get(`${B.resource}${S.version}`,{params:n}).then(s=>{C.value=s.data[0].total_count}).catch(s=>{console.error("Error fetching ezyForms data:",s)}),V.get(B.resource+S.version,{params:e}).then(s=>{if(s.data){const p=s.data;l.value.limit_start===0?c.value=p:c.value=c.value.concat(p)}}).catch(s=>{console.error("Error fetching department data:",s)})}function T(a){m.value=a,JSON.parse(a.data).changed.forEach(p=>{});const n=document.getElementById("staticBackdrop");new bootstrap.Offcanvas(n).show()}const x=g(()=>{var a;try{return(a=m.value)!=null&&a.data?JSON.parse(m.value.data):{}}catch(e){return{}}}),y=g(()=>x.value.added||[]),h=g(()=>x.value.changed||[]);return(a,e)=>(i(),r("div",null,[e[8]||(e[8]=t("div",{class:"d-flex justify-content-between align-items-center py-2"},[t("div",null,[t("h1",{class:"mt-3 font-13"}," Audit Log ")])],-1)),t("div",G,[E(M,{tHeaders:w.value,tData:c.value,isAction:"true",viewType:"viewPdf",onCellClick:T,isCheckbox:"true",isFiltersoption:"true","field-mapping":J.value,onUpdateFilters:R},null,8,["tHeaders","tData","field-mapping"]),E($,{currentRecords:c.value.length,totalRecords:C.value,onUpdateValue:U,onLimitStart:z},null,8,["currentRecords","totalRecords"])]),t("div",H,[t("div",W,[t("h5",{class:"offcanvas-title",id:"staticBackdropLabel",title:m.value.docname},d(m.value.docname),9,K),e[0]||(e[0]=t("button",{type:"button",class:"btn-close shadow-none","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),t("div",Q,[y.value.length?(i(),r("div",X,[e[3]||(e[3]=t("h6",{class:"font-9"},"Added",-1)),t("ul",null,[(i(!0),r(k,null,L(y.value,(n,s)=>(i(),r("li",{class:"mb-2",key:"added-"+s},[t("p",Y,[e[1]||(e[1]=t("strong",null,"Field Name =",-1)),u(" "+d(n[0]),1)]),typeof n[1]=="object"&&n[1]!==null?(i(!0),r(k,{key:0},L(n[1],(p,P)=>(i(),r("div",{key:P},[t("p",Z,[t("strong",null,d(P)+":",1),u(" "+d(p),1)])]))),128)):(i(),r("p",ee,[e[2]||(e[2]=t("strong",null,"Value =",-1)),u(" "+d(n[1]),1)]))]))),128))])])):N("",!0),h.value.length?(i(),r("div",te,[e[7]||(e[7]=t("h6",{class:"font-9"},"Changes",-1)),t("ul",null,[(i(!0),r(k,null,L(h.value,(n,s)=>(i(),r("li",{class:"mb-2",key:"changed-"+s},[t("p",ae,[e[4]||(e[4]=t("strong",null,"Field Name =",-1)),u(" "+d(n[0]),1)]),t("p",se,[e[5]||(e[5]=t("strong",null,"Old Value =",-1)),u(" "+d(n[1]),1)]),t("p",ne,[e[6]||(e[6]=t("strong",null,"New Value =",-1)),u(" "+d(n[2]),1)])]))),128))])])):N("",!0),!y.value.length&&!h.value.length?(i(),r("div",oe," No added or changed data. ")):N("",!0)])])]))}},de=j(le,[["__scopeId","data-v-4b87de35"]]);export{de as default};
