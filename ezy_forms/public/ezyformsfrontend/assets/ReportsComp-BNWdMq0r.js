import{_ as te,r as n,f as le,a1 as oe,g as ae,o as f,c as b,F as N,d as t,b as x,G as O,P as ne,m as se,l as L,i as D,S as ie,t as de,k as re,j as T,y as F,z as _,H as ue}from"./index-DMZd8UgW.js";const ce={class:"d-flex justify-content-between align-content-center py-3"},ve={class:"d-flex align-items-center gap-2"},me={class:"position-relative"},pe={class:"d-flex gap-2"},fe={class:"btn-group dropdown"},be={class:"dropdown-menu font-12",style:{transform:"translate(-124px, 42px) !important"}},ge={class:"modal fade",id:"SendMailModal",tabindex:"-1","aria-hidden":"true"},ye={class:"modal-dialog modal-dialog-centered"},_e={class:"modal-content"},we={class:"modal-footer"},he=["disabled"],ke={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ce={key:1},xe={class:"modal fade",id:"filtersModal",tabindex:"-1","aria-hidden":"true"},Le={class:"modal-dialog modal-lg modal-dialog-centered"},De={class:"modal-content"},Me={class:"modal-header"},Re={class:"modal-title font-14"},Ee={class:"modal-body"},Fe={class:"pb-3 mb-3"},Se={class:"row g-2 align-items-end"},Pe={class:"col-md-3"},Ue={class:"col-md-3"},je={class:"col-md-3"},Be={class:"modal-footer"},Ie=["disabled"],Ne={__name:"ReportsComp",setup(Oe){const c=n(!1),w=n(0),M=n(!1),p=n([]);n([]);const V=n({name:{type:"input"},source:{type:"select",options:["report","ezy_form_definition"]}}),h=n([]),m=n([]),d=n({limitPageLength:20,limit_start:0,filters:[]}),S=n(null);function $(l=m.value){const e=l.slice(d.value.limit_start,d.value.limit_start+d.value.limitPageLength);p.value=e,w.value=l.length}function A(l){clearTimeout(S.value),S.value=setTimeout(()=>{m.value=h.value.filter(e=>U.value.every(a=>{const o=a.td_key;return l[o]?String(e[o]||"").toLowerCase().includes(String(l[o]).toLowerCase()):!0})),w.value=m.value.length,d.value.limitPageLength=20,d.value.limit_start=0,p.value=m.value.slice(0,d.value.limitPageLength)},500)}function H(l){d.value.limitPageLength=l,d.value.limit_start=0,$()}function z(){d.value.limit_start+=d.value.limitPageLength;const l=m.value.slice(d.value.limit_start,d.value.limit_start+d.value.limitPageLength);p.value=[...p.value,...l]}function J(){F.get(_.getReportList).then(l=>{Array.isArray(l.message)?h.value=l.message:h.value=[],m.value=[...h.value],w.value=m.value.length,d.value.limit_start=0,p.value=m.value.slice(0,d.value.limitPageLength)}).catch(l=>{console.error("Error:",l)})}const k=n([]),C=n([]);n([]);const r=n(""),g=n("");function K(l){r.value=l.name,g.value=l.source,M.value=!0;const e={doctype_name:r.value,source:g.value,filters:null};E(e)}function G(){const l=document.getElementById("datatable");if(l){l.focus();const e=new KeyboardEvent("keydown",{key:"f",keyCode:70,ctrlKey:!0,bubbles:!0});l.dispatchEvent(e)}}function P(l){l.ctrlKey&&l.key==="f"&&(l.preventDefault(),G())}function q(){M.value=!1}const U=n([{th:"Name",td_key:"name"},{th:"Source",td_key:"source"}]);function j(l){if(g.value==="report"){const e=r.value,a=l,o=_.ExportReport+`?report_name=${encodeURIComponent(e)}&file_format_type=${encodeURIComponent(a)}`;window.open(o,"_blank")}else{if(!k.value.length){alert("No data to export!");return}const e=C.value.map(s=>s.th),a=C.value.map(s=>s.td_key),o=k.value.map(s=>a.map(y=>{let v=s[y];return v==null?v="":typeof v=="object"?v=JSON.stringify(v):v=String(v),`"${v.replace(/\|/g,",").replace(/"/g,'""')}"`}).join(",")),u=[e.join(","),...o].join(`
`);l==="Csv"?B(u,"report.csv","text/csv"):l==="Excel"&&B(u,"report.xls","application/vnd.ms-excel")}}function B(l,e,a){const o=new Blob([l],{type:a}),u=URL.createObjectURL(o),s=document.createElement("a");s.href=u,s.download=e,s.click(),URL.revokeObjectURL(u)}const I=n("");function Y(l,e,a){if(I.value=l,a==="download"){if(!(l!=null&&l.name)||!(r!=null&&r.value)){console.error("Missing required data for PDF download");return}const o=r.value,u=l.name||l.Name||l.id||l.report_name,s=_.getReportData+`?doctype=${encodeURIComponent(o)}&name=${encodeURIComponent(u)}`;window.open(s,"_blank")}a==="mail"&&new bootstrap.Modal(document.getElementById("SendMailModal")).show()}function Q(){c.value=!0;const l={docname:I.value.name,doctype:r.value};F.post(_.reportMailSend,l).then(e=>{e&&(ue("Mail send successfully"),bootstrap.Modal.getInstance(document.getElementById("SendMailModal")).hide(),c.value=!1)}).catch(e=>{console.error("Upload error:",e)}).finally(()=>{c.value=!1})}function W(){new bootstrap.Modal(document.getElementById("filtersModal")).show()}const R=n([{field:"",condition:"is",value:""}]),i=n({date_field:"",start_date:"",end_date:""});function X(){c.value=!0;const l=[];R.value.forEach(a=>{a.field&&a.value&&l.push({[a.field]:a.value})}),i.value.date_field&&i.value.start_date&&i.value.end_date&&l.push({[i.value.date_field]:[i.value.start_date,i.value.end_date]});const e={doctype_name:r.value,source:g.value,filters:JSON.stringify(l)};console.log("âœ… Final Payload:",JSON.stringify(e,null,2)),E(e),setTimeout(()=>{c.value=!1,bootstrap.Modal.getInstance(document.getElementById("filtersModal")).hide()},500)}function Z(){i.value={date_field:"",start_date:"",end_date:""},R.value=[{field:"",condition:"is",value:""}]}function ee(){i.value={date_field:"",start_date:"",end_date:""},R.value=[{field:"",condition:"is",value:""}];let l={doctype_name:r.value,source:g.value};E(l)}function E(l){F.get(_.repostListData,{params:l}).then(e=>{var a,o,u;e&&(a=e==null?void 0:e.message)!=null&&a.columns&&(k.value=(o=e==null?void 0:e.message)==null?void 0:o.result,C.value=(u=e==null?void 0:e.message)==null?void 0:u.columns.map(s=>{let y={};return y.th=s==null?void 0:s.label,y.td_key=s==null?void 0:s.fieldname,y}))}).catch(e=>{console.error("Error",e)})}return le(()=>{J(),document.addEventListener("keydown",P)}),oe(()=>{document.removeEventListener("keydown",P)}),(l,e)=>{const a=ae("tooltip");return f(),b("section",null,[M.value?(f(),b(N,{key:1},[e[20]||(e[20]=t("div",{class:"d-flex justify-content-between align-items-center py-2"},null,-1)),t("section",null,[t("div",ce,[t("div",ve,[t("button",{type:"button",class:"font-12 btn btn-light backtoListbtn",onClick:q},e[7]||(e[7]=[t("i",{class:"bi bi-chevron-left"},null,-1),se(" Back to Report List ")])),t("div",me,[g.value==="ezy_form_definition"?(f(),b("button",{key:0,type:"button",class:"btn btn-dark font-12",onClick:W},"Filters")):L("",!0),i.value.date_field.length||i.value.start_date.length||i.value.end_date.length?D((f(),b("button",{key:1,type:"button",class:"btn btn-light btn-sm clear_filters position-absolute top-0 right-0",onClick:ee},e[8]||(e[8]=[t("i",{class:"bi bi-x"},null,-1)]))),[[a,"Clear Filters",void 0,{bottom:!0}]]):L("",!0)])]),t("div",pe,[t("div",fe,[x(ie,{class:"btn-outline-primary m-0 dropdown-toggle d-flex justify-content-center align-items-center bg-white",name:"Export",type:"button",id:"exportDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"}),t("ul",be,[t("li",null,[t("a",{class:"dropdown-item",onClick:e[0]||(e[0]=o=>j("Csv"))},"Download Csv")]),t("li",null,[t("a",{class:"dropdown-item",onClick:e[1]||(e[1]=o=>j("Excel"))},"Download Excel")])])])])])]),t("section",null,[x(O,{class:"newtable",tHeaders:C.value,tData:k.value,onCellClick:Y,isAction:"true",download:"true"},null,8,["tHeaders","tData"]),t("div",ge,[t("div",ye,[t("div",_e,[e[11]||(e[11]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Send Mail"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e[12]||(e[12]=t("div",{class:"modal-body"}," Are you sure you want to send the mail? ",-1)),t("div",we,[e[10]||(e[10]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-dark",disabled:c.value,onClick:e[2]||(e[2]=o=>Q())},[c.value?(f(),b("span",ke)):L("",!0),c.value?L("",!0):(f(),b("span",Ce,e[9]||(e[9]=[t("span",{class:"font-12 fw-bold"},"Yes, Proceed",-1)])))],8,he)])])])]),t("div",xe,[t("div",Le,[t("div",De,[t("div",Me,[t("h5",Re,de(r.value)+" Filters",1),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal",onClick:Z,"aria-label":"Close"})]),t("div",Ee,[t("div",Fe,[e[17]||(e[17]=t("h6",{class:"font-13 fw-bold mb-2"},"Date Filter",-1)),t("div",Se,[t("div",Pe,[e[14]||(e[14]=t("label",{class:"form-label font-12"},"Label",-1)),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.date_field=o),placeholder:"Select",class:"form-select font-12"},e[13]||(e[13]=[t("option",{value:"",disabled:""},"Select",-1),t("option",{value:"creation"},"Created On",-1),t("option",{value:"modified"},"Last Updated On",-1)]),512),[[re,i.value.date_field]])]),t("div",Ue,[e[15]||(e[15]=t("label",{class:"form-label font-12"},"Start Date",-1)),D(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=o=>i.value.start_date=o),class:"form-control font-12"},null,512),[[T,i.value.start_date]])]),t("div",je,[e[16]||(e[16]=t("label",{class:"form-label font-12"},"End Date",-1)),D(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=o=>i.value.end_date=o),class:"form-control font-12"},null,512),[[T,i.value.end_date]])])])])]),t("div",Be,[e[19]||(e[19]=t("button",{type:"button",class:"btn btn-outline-secondary font-12","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-dark h-auto",disabled:c.value,onClick:X},e[18]||(e[18]=[t("span",{class:"font-12 fw-bold"},"Apply Filters",-1)]),8,Ie)])])])])])],64)):(f(),b(N,{key:0},[e[6]||(e[6]=t("div",{class:"d-flex justify-content-between align-items-center py-2"},[t("div")],-1)),t("div",null,[x(O,{tHeaders:U.value,tData:p.value,onCellClick:K,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onUpdateFilters:A,"field-mapping":V.value,isFiltersoption:"true"},null,8,["tHeaders","tData","field-mapping"]),x(ne,{currentRecords:p.value.length,totalRecords:w.value,"items-per-page":d.value.limitPageLength,onUpdateValue:H,onLimitStart:z},null,8,["currentRecords","totalRecords","items-per-page"])])],64))])}}},Ve=te(Ne,[["__scopeId","data-v-05a65a82"]]);export{Ve as default};
