import{r as l,u as Q,e as W,E as X,w as Z,f as g,g as y,h as S,i as ee,j as c,o as T,c as q,d as s,t as te,b as x,H as se,s as ae,G as oe,P as ne,k as I,l as O,m as p,p as ie}from"./index-DxID15hf.js";const le={class:""},re={class:"d-flex align-items-center justify-content-between py-3"},de={class:"m-0 font-11 pt-1"},ue={key:0,class:"d-flex align-items-center gap-2"},me={class:"d-flex align-items-center gap-2"},ce={class:"mt-1"},fe={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},pe={class:"modal-dialog modal-xl"},ve={class:"modal-content"},be={class:"d-block modal-header bg-dark text-white py-2"},he={class:"d-flex align-items-center justify-content-between"},_e={class:""},ge={class:"modal-body"},ye=["innerHTML"],Ce={__name:"CreateForm",props:["id"],setup(ke){const w=l(0),E=l([{th:"Form Name",td_key:"form_name"},{th:"Form Short Code",td_key:"form_short_name"},{th:"Accessible Departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"}]),R=l({});l(null);const v=l([]),$=l([]),r=Q(),D=l("");l([]);const k=l(""),A=l(""),u=W(()=>X.value),B=l(""),o=l({limitPageLength:20,limit_start:0,filters:[]}),M=l({form_short_name:{type:"input"},form_category:{type:"input"},form_status:{type:"select",options:["Active","Retired"]},form_name:{type:"input"},enable:{type:"select",options:["Enabled","Disabled"]}});function N(e=null){e==null?c.push({name:"FormStepper",query:{routepath:r.path,business_unit:u.value}}):c.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:r.path,business_unit:u.value,id:e.name}}),localStorage.setItem("routepath",r.path)}function V(e,t,a){if(a==="view"&&e&&c.push({name:"FormPreviewComp",query:{routepath:r.path,form_short_name:e.form_short_name,business_unit:u.value}}),a==="raiseRequest"){const n=JSON.parse(e.form_json),i=localStorage.getItem("employeeData");if(i){const d=JSON.parse(i).designation;n.workflow.length||p.info("No Roles Added",{autoClose:500});const h=n.workflow[0].roles;let _=!1;for(let f=0;f<h.length;f++)if(h[f]===d){_=!0;break}_?c.push({name:"RaiseRequest",query:{routepath:r.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):p.info("You do not have permission to access this Form.")}}}const P=l([]);function J(e){const t=[{name:"View form",icon:"fa-solid fa-eye"}];e.form_status==="Created"&&(t.push({name:"Raise Request",icon:"fa fa-file-text"}),t.push({name:"In-active this form",icon:"fa-solid fa-ban"})),e.form_status==="Draft"&&t.push({name:"Actived this form",icon:"fa-solid fa-check"}),k.value==1&&t.push({name:"Edit Form",icon:"fa-solid fa-edit"}),P.value=t}function j(e,t){var a;if(t.name==="View form"?e?c.push({name:"FormPreviewComp",query:{routepath:r.path,form_short_name:e.form_short_name,business_unit:u.value}}):p.warn(" There is no form fields "):t.name==="Edit Form"&&N(e),t.name==="Raise Request"){const n=JSON.parse(e.form_json),i=localStorage.getItem("employeeData");if(i){const d=JSON.parse(i).designation;(a=n.workflow)!=null&&a.length||p.info("No Roles Added",{autoClose:500});const h=n.workflow[0].roles;let _=!1;for(let f=0;f<h.length;f++)if(h[f]===d){_=!0;break}_&&e.enable===1?e.form_name==="Contract One"?c.push({name:"vendorcomparison"}):c.push({name:"RaiseRequest",query:{routepath:r.path,selectedForm:e.form_short_name,business_unit:e.business_unit,has_workflow:e.has_workflow}}):e.enable===0?p.info("This form is currently disabled.",{autoClose:500}):p.info("You do not have permission to access this Form.",{autoClose:500})}}if(t.name==="Download Print format"){R.value=e;const n={form_short_name:e.form_short_name,business_unit:u.value};g.post(y.preview_dynamic_form,n).then(d=>{D.value=d.message}).catch(d=>{console.error("Error fetching data:",d)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}t.name==="Actived this form"&&F(e),t.name==="In-active this form"&&F(e)}function z(){const e={form_short_name:R.value.form_short_name,name:null,business_unit:u.value};g.post(y.download_pdf_form,e).then(t=>{let a=ie+t.message;a=a.replace("/api","");const n=document.createElement("a");n.href=a,n.download=t.message.split("/").pop(),n.click()}).catch(t=>{console.error("Error fetching data:",t)})}const U=l([]),m=l(null),C=l("");function F(e,t,a){m.value=e;const n=e.enable=="1"||e.enable===1;C.value=n?"Disable":"Restore",document.getElementById("actionTextSpan").innerText=C.value,document.getElementById("rowNameSpan").innerText=e.name;const i=new bootstrap.Modal(document.getElementById("EnableDisable"));i.show(),window.currentModal=i}function H(){if(!m.value)return;const e=m.value.enable=="1"||m.value.enable===1;m.value.enable=e?0:1,m.value.form_status=e?"Draft":"Created",g.put(`${y.resource}${S.EzyFormDefinitions}/${m.value.name}`,m.value).then(t=>{U.value=t.data,p.success(`Form ${C.value}d successfully`,{autoClose:700}),setTimeout(()=>{b()},1e3),window.currentModal&&window.currentModal.hide()}).catch(t=>{console.error("Error updating toggle:",t)})}Z(u,e=>{e&&e.length&&(B.value=e,b())},{immediate:!0});const Y=e=>{o.value.limitPageLength=e,o.value.limit_start=0,b()},G=([e,t])=>{o.value.limitPageLength=e,o.value.limit_start=t,b()},L=l(null);function K(e){clearTimeout(L.value),L.value=setTimeout(()=>{o.value.filters=[],e.form_status==="Active"&&o.value.filters.push(["form_status","like","Created"]),e.form_status==="Retired"&&o.value.filters.push(["form_status","like","Draft"]),e.enable==="Enabled"?o.value.filters.push(["enable","=",1]):e.enable==="Disabled"&&o.value.filters.push(["enable","=",0]),E.value.forEach(t=>{const a=t.td_key,n=e[a];a==="form_status"||a==="enable"||n&&o.value.filters.push([a,"like",`%${n}%`])}),o.value.filters.length?b(null,o.value.filters):b()},500)}function b(e){const t=[["business_unit","like",`%${u.value}%`]];o.value.filters.push(...t),e&&t.push(...e);const a={fields:JSON.stringify(["*"]),limit_page_length:o.value.limitPageLength,limit_start:o.value.limit_start,filters:JSON.stringify(o.value.filters),order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"},n={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(o.value.filters)};g.get(`${y.resource}${S.EzyFormDefinitions}`,{params:n}).then(i=>{w.value=i.data[0].total_count}).catch(i=>{console.error("Error fetching ezyForms data:",i)}),g.get(`${y.resource}${S.EzyFormDefinitions}`,{params:a}).then(i=>{o.value.limit_start===0?(v.value=i.data,$.value=[...new Set(v.value.map(d=>d.form_category))]):v.value=v.value.concat(i.data)}).catch(i=>{console.error("Error fetching department details:",i)})}return ee(()=>{localStorage.removeItem("routepath");const e=JSON.parse(localStorage.getItem("employeeData"));k.value=e.is_admin||"",k.value==1&&(A.value="true"),(r.path==="/forms/department/allforms"||r.path==="/forms/department/allforms")&&c.replace("/forms/department/allforms")}),(e,t)=>(T(),q("div",le,[s("div",null,[s("div",re,[s("div",null,[t[2]||(t[2]=s("h1",{class:"m-0 font-13"}," All Forms ",-1)),s("p",de,te(w.value)+" Forms Available ",1)]),k.value==1?(T(),q("div",ue,[s("div",me,[x(se,{class:"buttoncomp",onClick:t[0]||(t[0]=a=>N()),name:"Create Form"})])])):ae("",!0)]),s("div",ce,[x(oe,{tHeaders:E.value,tData:v.value,isCheckbox:"true",isAction:"true",actionType:"dropdown",onActionClickedDropDown:J,raiseRequest:"true",enableDisable:A.value,onCellClick:V,onActionClicked:j,onToggleClick:F,actions:P.value,onUpdateFilters:K,"field-mapping":M.value,isFiltersoption:"true"},null,8,["tHeaders","tData","enableDisable","actions","field-mapping"]),x(ne,{currentRecords:v.value.length,totalRecords:w.value,onUpdateValue:Y,onLimitStart:G},null,8,["currentRecords","totalRecords"])])]),t[9]||(t[9]=I('<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel"><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasRightLabel">Asset Request Form</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><div class="d-flex align-items-baseline position-relative gap-3"><div class="d-flex flex-column"><span><i class="dashedcircle ri-checkbox-blank-circle-fill"></i></span><div class="dashed_line mt-4"></div></div><div>data</div></div></div></div>',1)),s("div",fe,[s("div",pe,[s("div",ve,[s("div",be,[s("div",he,[t[5]||(t[5]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",_e,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:z},t[3]||(t[3]=[O("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[1]||(t[1]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[4]||(t[4]=[O("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",ge,[s("div",{innerHTML:D.value},null,8,ye)]),t[6]||(t[6]=s("div",{class:"modal-footer"},null,-1))])])]),s("div",{class:"modal fade",id:"EnableDisable",tabindex:"-1","aria-labelledby":"EnableDisableLabel","aria-hidden":"true"},[s("div",{class:"modal-dialog modal-dialog-centered"},[s("div",{class:"modal-content"},[t[8]||(t[8]=I('<div class="modal-header"><h5 class="modal-title" id="EnableDisableLabel">Confirm Action</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> Are you sure you want to <span id="actionTextSpan"></span> <span class="fw-bold font-13" id="rowNameSpan"></span> Form? </div>',2)),s("div",{class:"modal-footer"},[t[7]||(t[7]=s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),s("button",{type:"button",class:"btn btn-dark",onClick:H},"Yes, Proceed")])])])])]))}};export{Ce as default};
