var le=Object.defineProperty;var V=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var j=(y,c,u)=>c in y?le(y,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):y[c]=u,W=(y,c)=>{for(var u in c||(c={}))re.call(c,u)&&j(y,u,c[u]);if(V)for(var u of V(c))de.call(c,u)&&j(y,u,c[u]);return y};import{_ as ce,e as ue,E as me,r as o,u as fe,L as pe,w as ve,i as _e,o as R,c as P,d as t,t as b,b as B,G as ye,P as ge,l as p,s as I,C as he,D as be,n as we,W as ke,f as v,g as _,h as L,p as qe}from"./index-DxID15hf.js";const Re={class:"d-flex justify-content-between align-items-center py-2"},Pe={class:"m-0 font-11 pt-1"},Ce={class:"mt-2"},Ne={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},$e={class:"modal-dialog modal-dialog-centered modal-lg"},xe={class:"modal-content"},Ee={class:"modal-header py-2 d-block"},Le={class:"d-flex justify-content-between align-items-center"},Oe={class:"m-0 font-13",id:"viewRequest"},Fe={class:""},Se={class:"activity-log-container"},Te={class:"activity-log-content"},Ae={class:"font-12 mb-1"},Me={class:"strong-content"},De={class:"strong-content"},Je={class:"strong-content"},Ve={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},je={class:"modal-dialog modal-xl"},We={class:"modal-content"},Be={class:"modal-header py-2 d-block bg-dark text-white"},Ie={class:"d-flex justify-content-between align-items-center"},Ue={class:""},He={class:"modal-body pdf-body"},Ge=["innerHTML"],ze={__name:"MyTeam",setup(y){const c=ue(()=>me.value),u=o({business_unit:""}),O=fe(),F=pe(),h=o({limitPageLength:20,limit_start:0}),$=o(0),i=o({}),S=o(null),w=o([]),U=o([]),H=o([]),G=o([]);o([]);const k=o([]),z=o(""),T=o(""),x=o([]);o([]);const Q=o([]),X=o(""),E=o([]),A=o([{th:"Request ID",td_key:"name"},{th:"Form Name",td_key:"doctype_name"},{th:"Owner of form",td_key:"role"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Pending With",td_key:"assigned_to_users"},{th:"Linked ID",td_key:"linked_form_id"}]),Y=o({name:{type:"input"},status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},role:{type:"input"},doctype_name:{type:"input"},requested_on:{type:"date"}}),Z=o([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(a,e){var n,l,f;if(e.name==="View Request")if(a){i.value=W({},a),z.value=(n=i.value)==null?void 0:n.total_levels,Q.value=JSON.parse((l=i.value)==null?void 0:l.json_columns).child_table_fields,S.value=ke(JSON.parse((f=i.value)==null?void 0:f.json_columns).fields);const g=[["wf_generated_request_id","like",`%${i.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(g),order_by:`\`tab${i.value.doctype_name}\`.\`creation\` desc`};v.get(`${_.resource}${i.value.doctype_name}`,{params:r}).then(s=>{s.data&&(w.value=s.data,se(w.value[0],S.value),v.get(`${_.resource}${i.value.doctype_name}`).then(d=>{console.log("Data for :",d.data[0])}).catch(d=>{console.error("Error fetching data for :",d)}),v.get(`${_.resource}${i.value.doctype_name}/${s.data[0].name}`).then(d=>{const m=Object.keys(d.data).filter(N=>Array.isArray(d.data[N]));m.length&&(E.value={},m.forEach(N=>{E.value[N]=d.data[N]||[]}))}).catch(d=>{console.error("Error fetching data for :",d)}))}).catch(s=>{console.error("Error fetching categories data:",s)}),v.get(`${_.resource}${L.WFActivityLog}/${i.value.name}`).then(s=>{s.data&&(x.value=s.data.reason||[])}).catch(s=>{console.error("Error fetching activity data:",s)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(e.name==="PDF Format"){i.value=a;const g=[["wf_generated_request_id","like",`%${i.value.name}%`]],r={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(g),order_by:`\`tab${i.value.doctype_name}\`.\`creation\` desc`};v.get(`${_.resource}${i.value.doctype_name}`,{params:r}).then(s=>{if(s.data){w.value=s.data;const d={form_short_name:a.doctype_name,name:w.value[0].name,business_unit:c.value};v.post(_.preview_dynamic_form,d).then(m=>{T.value=m.message}).catch(m=>{console.error("Error fetching data:",m)})}}).catch(s=>{console.error("Error fetching categories data:",s)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function ee(a,e,n){n==="view"&&F.push({name:"ApproveRequest",query:{routepath:O.path,name:a.name,doctype_name:a.doctype_name,type:"myteam",readOnly:"true"}}),n==="td_key"&&a.linked_form_id&&F.push({name:"ApproveRequest",query:{routepath:O.path,name:a.linked_form_id,business_unit:a.property,type:"linkedForm",readOnly:"true"}})}function M(){E.value=[],X.value=""}const te=a=>a?new Date(a).toLocaleDateString("en-GB"):"N/A",ae=a=>a?{"Request Cancelled":"cancelled","Request Raised":"raised"}[a]||a.toLowerCase():"performed an action on";function D(){var e;const a={form_short_name:i.value.doctype_name,name:(e=w.value[0])==null?void 0:e.name};v.post(_.download_pdf_form,a).then(n=>{let l=qe+n.message;l=l.replace("/api","");const f=document.createElement("a");f.href=l,f.download=n.message.split("/").pop(),f.click()}).catch(n=>{console.error("Error fetching data:",n)})}function se(a,e){e.forEach(n=>{n.sections.forEach(l=>{l.rows.forEach(f=>{f.columns.forEach(g=>{g.fields.forEach(r=>{a!=null&&a.hasOwnProperty(r==null?void 0:r.fieldname)&&(r.value=a[r==null?void 0:r.fieldname])})})})})})}const oe=a=>{h.value.limitPageLength=a,h.value.limit_start=0,q()},ne=([a,e])=>{h.value.limitPageLength=a,h.value.limit_start=e,q()},J=o(null);function ie(a){clearTimeout(J.value),J.value=setTimeout(()=>{const e=[];A.value.forEach(n=>{const l=n.td_key;a[l]&&e.push([l,"like",`%${a[l]}%`])}),e.length?q(e):q()},500)}function q(a){var f,g,r,C;const e=[["property","like",`%${u.value.business_unit}%`]];a&&e.push(...a);const n={fields:JSON.stringify(["*"]),limit_page_length:(f=h.value)==null?void 0:f.limitPageLength,limit_start:(g=h.value)==null?void 0:g.limit_start,filters:JSON.stringify(e),order_by:"`tabWF Workflow Requests`.`creation` desc"},l={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(e)};v.get(`${(r=_)==null?void 0:r.resource}${(C=L)==null?void 0:C.WFWorkflowRequests}`,{params:l}).then(s=>{$.value=s.data[0].total_count}).catch(s=>{console.error("Error fetching total count:",s)}),v.get(`${_.resource}${L.WFWorkflowRequests}`,{params:n}).then(s=>{const d=s.data;h.value.limit_start===0?(k.value=d,U.value=[...new Set(s.data.map(m=>m.name))],H.value=[...new Set(s.data.map(m=>m.doctype_name))],G.value=[...new Set(s.data.map(m=>m.status))]):k.value=k.value.concat(d)}).catch(s=>{console.error("Error fetching records:",s)})}return ve(c,a=>{u.value.business_unit=a,a.length&&q()},{immediate:!0}),_e(()=>{}),(a,e)=>(R(),P("div",null,[t("div",Re,[t("div",null,[e[0]||(e[0]=t("h1",{class:"m-0 font-13"},"My Team Requests ",-1)),t("p",Pe,b($.value)+" request",1)])]),t("div",Ce,[B(ye,{tHeaders:A.value,tData:k.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",actions:Z.value,onActionClicked:K,isFiltersoption:"true","field-mapping":Y.value,onCellClick:ee,onUpdateFilters:ie},null,8,["tHeaders","tData","actions","field-mapping"]),B(ge,{currentRecords:k.value.length,totalRecords:$.value,onUpdateValue:oe,onLimitStart:ne},null,8,["currentRecords","totalRecords"])]),t("div",Ne,[t("div",$e,[t("div",xe,[t("div",Ee,[t("div",Le,[t("div",null,[t("h5",Oe,"Request Id: "+b(i.value.name),1)]),t("div",Fe,[i.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-white text-dark font-13",onClick:D},e[1]||(e[1]=[p(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):I("",!0),t("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:M,"data-bs-dismiss":"modal"},e[2]||(e[2]=[p(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),e[9]||(e[9]=t("div",{class:"modal-body approvermodalbody"},null,-1)),t("div",Se,[(R(!0),P(he,null,be(x.value,(n,l)=>(R(),P("div",{key:l,class:we(["activity-log-item",{"last-item":l===x.value.length-1}])},[e[8]||(e[8]=t("div",{class:"activity-log-dot"},null,-1)),t("div",Te,[t("p",Ae,[e[3]||(e[3]=p(" On ")),t("strong",Me,b(te(n.creation)),1),e[4]||(e[4]=p(", ")),e[5]||(e[5]=t("strong",{class:"strong-content"}," you ",-1)),p(" ("+b(n.role)+") ",1),t("strong",De,b(ae(n.action)),1),e[6]||(e[6]=p(" the request with the comments: ")),t("strong",Je,b(n.reason||"N/A"),1),e[7]||(e[7]=p(". "))])])],2))),128))]),e[10]||(e[10]=t("div",{class:"modal-footer"},null,-1))])])]),t("div",Ve,[t("div",je,[t("div",We,[t("div",Be,[t("div",Ie,[e[13]||(e[13]=t("div",null,[t("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),t("div",Ue,[i.value.status==="Completed"?(R(),P("button",{key:0,button:"button",class:"btn btn-dark text-white font-13",onClick:D},e[11]||(e[11]=[p(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)]))):I("",!0),t("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:M,"data-bs-dismiss":"modal"},e[12]||(e[12]=[p(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),t("div",He,[t("div",{innerHTML:T.value},null,8,Ge)]),e[14]||(e[14]=t("div",{class:"modal-footer"},null,-1))])])])]))}},Ye=ce(ze,[["__scopeId","data-v-f2a73955"]]);export{Ye as default};
