import{_ as I,e as v,d as n,w as b,I as j,o as i,c as r,b as a,a as P,G as q,P as M,t as d,A as h,B as x,q as k,i as w,E as $,k as B,l as z,n as S}from"./index-BHd6CXej.js";const G={class:"mt-2"},H={class:"offcanvas offcanvas-end","data-bs-backdrop":"static",tabindex:"-1",id:"staticBackdrop","aria-labelledby":"staticBackdropLabel"},W={class:"offcanvas-header"},K=["title"],Q={class:"offcanvas-body p-3"},X={key:0,class:"mb-2"},Y={class:"ps-0 list-unstyled"},Z={class:"m-0 mb-1",style:{"font-weight":"500",color:"#4b5563"}},ee={key:0,class:"ps-2"},te={class:"text-muted"},ae={style:{"background-color":"#e0e7ff",padding:"2px 6px","border-radius":"4px",color:"#4338ca","margin-left":"5px","word-wrap":"break-word"}},se={key:1,style:{"font-size":"13px",color:"#6b7280"}},oe={style:{"background-color":"#dbeafe",padding:"2px 6px","border-radius":"4px",color:"#1e3a8a","margin-left":"5px","word-wrap":"break-word"}},ne={key:1},le={class:"list-unstyled ps-0"},ie={class:"m-0 mb-1",style:{"font-weight":"500","font-size":"12px",color:"#4b5563"}},re={class:"m-0",style:{"font-size":"11px",color:"#6b7280","line-height":"20px"}},de={style:{"background-color":"#e0e7ff",padding:"2px 6px","border-radius":"4px",color:"#4338ca","word-wrap":"break-word"}},ce={style:{"background-color":"#d1fae5",padding:"2px 6px","border-radius":"4px",color:"#065f46"}},ue={key:2,class:"text-center text-muted mt-4"},pe={__name:"AuditLog",setup(me){const V=v(()=>$.value),L=n(0),c=n([]);n(["yes","no"]),n([]),n(""),n(null),n(""),n([]),n({ezy_departments_items:[]});const O=n([]),C=n(null),u=n([]),l=n({limitPageLength:20,limit_start:0,filters:[]}),f=n({department_code:"",department_name:""}),A=n([]),N=n([{th:"Document Name",td_key:"docname"},{th:"Doctype Name",td_key:"ref_doctype"},{th:"Modified By",td_key:"modified_by"},{th:"Modified Date",td_key:"modified"}]),F=n({docname:{type:"input"},ref_doctype:{type:"input"},modified_by:{type:"input"}}),_=n({department_code:"",department_name:"",business_unit:"",ezy_departments_items:[]});b(()=>_.value.department_code,t=>{const e=t.trim().toLowerCase();A.value.filter(s=>s!==null).map(s=>s.trim().toLowerCase()).includes(e)?f.value.department_code="Department code already exists.":f.value.department_code=""}),b(()=>_.value.department_name,t=>{const e=t.trim().toLowerCase();O.value.filter(s=>s!==null).map(s=>s.trim().toLowerCase()).includes(e)?f.value.department_name="Department name already exists.":f.value.department_name=""}),j({applieddepartment_name:!1,applieddepartment_code:!1,department_name:"",department_code:""}),b(V,t=>{_.value.business_unit=t,t.length&&p()},{immediate:!0});function J(t){clearTimeout(C.value),C.value=setTimeout(()=>{l.value.filters=[],N.value.forEach(e=>{const o=e.td_key;t[o]&&l.value.filters.push([o,"like",`%${t[o]}%`])}),l.value.filters.length?p(l.value.filters):p()},500)}const R=t=>{l.value.limitPageLength=t,l.value.limit_start=0,p()},T=([t,e])=>{l.value.limitPageLength=t,l.value.limit_start=e,p()};function p(t){t&&l.value.filters.push(...t),l.value.filters.push(["ref_doctype","in",["Ezy Employee","Ezy Departments","WF Roles"]]);const e={fields:JSON.stringify(["*"]),filters:JSON.stringify(l.value.filters),limit_page_length:l.value.limitPageLength,limit_start:l.value.limit_start,order_by:"`tabVersion`.`creation` desc"},o={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(l.value.filters)};B.get(`${z.resource}${S.version}`,{params:o}).then(s=>{L.value=s.data[0].total_count}).catch(s=>{console.error("Error fetching ezyForms data:",s)}),B.get(z.resource+S.version,{params:e}).then(s=>{if(s.data){const m=s.data;l.value.limit_start===0?c.value=m:c.value=c.value.concat(m)}}).catch(s=>{console.error("Error fetching department data:",s)})}function U(t){u.value=t,JSON.parse(t.data).changed.forEach(m=>{});const o=document.getElementById("staticBackdrop");new bootstrap.Offcanvas(o).show()}const D=v(()=>{var t;try{return(t=u.value)!=null&&t.data?JSON.parse(u.value.data):{}}catch(e){return{}}}),g=v(()=>D.value.added||[]),y=v(()=>D.value.changed||[]);return(t,e)=>(i(),r("div",null,[e[7]||(e[7]=a("div",{class:"d-flex justify-content-between align-items-center py-2"},[a("div",null,[a("h1",{class:"mt-3 font-13"}," Audit Log ")])],-1)),a("div",G,[P(q,{tHeaders:N.value,tData:c.value,isAction:"true",viewType:"viewPdf",onCellClick:U,isCheckbox:"true",isFiltersoption:"true","field-mapping":F.value,onUpdateFilters:J},null,8,["tHeaders","tData","field-mapping"]),P(M,{currentRecords:c.value.length,totalRecords:L.value,onUpdateValue:R,onLimitStart:T},null,8,["currentRecords","totalRecords"])]),a("div",H,[a("div",W,[a("h5",{class:"offcanvas-title",id:"staticBackdropLabel",title:u.value.docname},d(u.value.docname),9,K),e[0]||(e[0]=a("button",{type:"button",class:"btn-close shadow-none","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),a("div",Q,[g.value.length?(i(),r("div",X,[e[2]||(e[2]=a("h6",{class:"text-muted fw-bold mb-3"},"âž• Added",-1)),a("ul",Y,[(i(!0),r(h,null,x(g.value,(o,s)=>(i(),r("li",{key:"added-"+s,class:"px-3 rounded",style:{"background-color":"#f9fafb",color:"#333"}},[a("p",Z,d(o[0])+" added with: ",1),typeof o[1]=="object"&&o[1]!==null?(i(),r("div",ee,[(i(!0),r(h,null,x(o[1],(m,E)=>(i(),r("div",{key:E,class:"mb-1",style:{"font-size":"13px",color:"#6b7280"}},[a("span",te,d(E)+":",1),a("span",ae,d(m),1)]))),128))])):(i(),r("div",se,[e[1]||(e[1]=a("span",null,"Value:",-1)),a("span",oe,d(o[1]),1)]))]))),128))])])):k("",!0),y.value.length?(i(),r("div",ne,[e[5]||(e[5]=a("h6",{class:"text-muted fw-bold mb-3"},"ðŸ”„ Changes",-1)),a("ul",le,[(i(!0),r(h,null,x(y.value,(o,s)=>(i(),r("li",{key:"changed-"+s,class:"mb-2 px-3 py-2 rounded",style:{"background-color":"#f9fafb",color:"#333"}},[a("p",ie,d(o[0].replace(/_/g," ")),1),a("p",re,[e[3]||(e[3]=w(" Changed from ")),a("span",de,d(o[1]),1),e[4]||(e[4]=w(" to ")),a("span",ce,d(o[2]),1)])]))),128))])])):k("",!0),!g.value.length&&!y.value.length?(i(),r("div",ue,e[6]||(e[6]=[a("i",{class:"bi bi-info-circle me-2"},null,-1),w("No added or changed data. ")]))):k("",!0)])])]))}},ve=I(pe,[["__scopeId","data-v-6ba9358a"]]);export{ve as default};
