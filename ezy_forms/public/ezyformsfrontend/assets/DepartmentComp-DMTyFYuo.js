var ae=Object.defineProperty,ne=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var R=(_,d,u)=>d in _?ae(_,d,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[d]=u,x=(_,d)=>{for(var u in d||(d={}))le.call(d,u)&&R(_,u,d[u]);if(J)for(var u of J(d))oe.call(d,u)&&R(_,u,d[u]);return _},S=(_,d)=>ne(_,se(d));import{_ as re,e as ie,E as de,r,w as U,f as h,g as k,h as y,o as c,c as p,d as t,b as C,G as me,P as ue,l as V,F as N,t as L,s as B,J as ce,H as pe,C as _e,D as ve,x as fe,B as ye,m as z}from"./index-DxID15hf.js";const ge={class:"mt-2"},be={class:"modal fade",id:"viewCategory","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewCategoryLabel","aria-hidden":"true"},Ce={class:"modal-dialog"},he={class:"modal-content"},ke={class:"modal-header"},ze={class:"modal-body"},De={class:"mb-3"},we={key:0,class:"text-danger font-12"},xe={class:"mb-3"},Ve={key:0,class:"text-danger font-12"},Ee={class:"d-flex w-100 gap-3"},Ne={key:0,class:"table mt-3 global-table"},Le={key:0},$e={key:1},Pe=["onChange"],Se={class:"text-center"},Ue=["onClick"],Be=["onClick"],Fe=["onClick"],Me={class:"modal-footer"},Ie=["disabled"],Oe=["disabled"],qe={__name:"DepartmentComp",setup(_){const d=ie(()=>de.value),u=r(0),$=r([]),f=r(""),v=r(null),g=r(""),i=r({ezy_departments_items:[]}),F=r([]),T=r([{name:"View Categories",icon:"fa-solid fa-eye"}]),m=r({department_code:"",department_name:""}),M=r([]),D=r(!1),H=r(null),I=r(""),O=r(""),b=r({limitPageLength:"None",limit_start:0}),G=a=>{b.value.limitPageLength=a,b.value.limit_start=0,fetchTable()},K=([a,e])=>{b.value.limitPageLength=a,b.value.limit_start=e,fetchTable()};function Q(){Object.assign(n.value,{department_code:"",department_name:"",ezy_departments_items:[]}),i.value.ezy_departments_items=[],f.value=""}const q=r([{th:"Department Code",td_key:"department_code"},{th:"Department Name",td_key:"department_name"},{th:"Business Unit",td_key:"business_unit"}]),W=r({department_code:{type:"input"},department_name:{type:"input"},form_category:{type:"select",options:["Software","Hardware"]}}),n=r({department_code:"",department_name:"",business_unit:"",ezy_departments_items:[]});U(()=>n.value.department_code,a=>{const e=a.trim().toLowerCase(),s=M.value.filter(o=>o!==null).map(o=>o.trim().toLowerCase()),l=I.value.trim().toLowerCase();D.value&&e===l?m.value.department_code="":s.includes(e)?m.value.department_code="Department code already exists.":m.value.department_code=""}),U(()=>n.value.department_name,a=>{const e=a.trim().toLowerCase(),s=F.value.filter(o=>o!==null).map(o=>o.trim().toLowerCase()),l=O.value.trim().toLowerCase();D.value&&e===l?m.value.department_name="":s.includes(e)?m.value.department_name="Department name already exists.":m.value.department_name=""}),U(d,a=>{n.value.business_unit=a,a.length&&w()},{immediate:!0});function X(a,e){A(),e.name==="View Categories"&&(D.value=!0,I.value=a.department_code,O.value=a.department_name,H.value=a.id,n.value=x({},a),a?(n.value=x({},a),h.get(`${k.resource}${y.departments}/${a.name}`).then(l=>{l.data&&(i.value=l.data)}).catch(l=>{console.error("Error fetching categories data:",l)}),new bootstrap.Modal(document.getElementById("viewCategory"),{}).show()):(console.warn("No form fields provided."),formCreation(a)))}function j(){f.value&&(i.value.ezy_departments_items.push({category:f.value,parentfield:"ezy_departments_items"}),f.value="")}function Y(a,e){v.value=a,g.value=e}function E(a){const e=g.value.trim();e?i.value.ezy_departments_items[a].category=e:i.value.ezy_departments_items.splice(a,1),v.value=null,g.value=""}function P(a){i.value.ezy_departments_items.splice(a,1)}function Z(a){const e=[];q.value.forEach(s=>{const l=s.td_key;a[l]&&e.push([l,"like",`%${a[l]}%`])}),e.length?w(e):w()}function A(){D.value=!1,i.value.ezy_departments_items=[];const a=[["business_unit","like",`%${n.value.business_unit}%`]],e={fields:JSON.stringify(["department_name","department_code"]),filters:JSON.stringify(a),limit_page_length:"None",limit_start:b.value.limit_start,order_by:"`tabEzy Departments`.`creation` desc"};h.get(k.resource+y.departments,{params:e}).then(s=>{s.data&&(F.value=[...new Set(s.data.map(l=>l.department_name))],M.value=[...new Set(s.data.map(l=>l.department_code))])}).catch(s=>{console.error("Error fetching department data:",s)})}function w(a){const e=[["business_unit","like",`%${n.value.business_unit}%`]];a&&e.push(...a);const s={fields:JSON.stringify(["*"]),filters:JSON.stringify(e),limit_page_length:b.value.limitPageLength,limit_start:b.value.limit_start,order_by:"`tabEzy Departments`.`creation` desc"},l={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(e)};h.get(`${k.resource}${y.departments}`,{params:l}).then(o=>{u.value=o.data[0].total_count}).catch(o=>{console.error("Error fetching ezyForms data:",o)}),h.get(k.resource+y.departments,{params:s}).then(o=>{o.data&&($.value=o.data)}).catch(o=>{console.error("Error fetching department data:",o)})}function ee(){if(v.value!==null&&(g.value.trim()?E(v.value):P(v.value)),!i.value.ezy_departments_items||i.value.ezy_departments_items.length===0){z.error("At least one category is required");return}if(!m.value.department_code&&!m.value.department_name){n.value.ezy_departments_items=i.value.ezy_departments_items;const a=S(x({},n.value),{doctype:y.departments});h.post(k.resource+y.departments,a).then(e=>{e.data&&(z.success("Department Created successfully",{autoClose:500,transition:"zoom"}),w(),n.value={department_code:"",department_name:"",ezy_departments_items:[]},f.value="",bootstrap.Modal.getInstance(document.getElementById("viewCategory")).hide())})}else z.error("Please correct the required fields")}function te(){if(v.value!==null&&(g.value.trim()?E(v.value):P(v.value)),!i.value.ezy_departments_items||i.value.ezy_departments_items.length===0){z.error("At least one category is required");return}if(!n.value.department_code||!n.value.department_name||!n.value.business_unit||m.value.department_code||m.value.department_name){z.error("Please correct the required fields",{autoClose:1e3,transition:"zoom"});return}n.value.ezy_departments_items=i.value.ezy_departments_items;const a=S(x({},n.value),{doctype:y.departments});h.put(`${k.resource}${y.departments}/${n.value.name}`,a).then(e=>{e.data&&(z.success("Department Updated successfully",{autoClose:500,transition:"zoom"}),w(),n.value={department_code:"",department_name:"",ezy_departments_items:[]},f.value="",bootstrap.Modal.getInstance(document.getElementById("viewCategory")).hide())}).catch(e=>{var s;console.error("Error updating department:",((s=e.response)==null?void 0:s.data)||e)})}return(a,e)=>(c(),p("div",null,[t("div",{class:"d-flex justify-content-between align-items-center py-2"},[e[6]||(e[6]=t("div",null,[t("h1",{class:"m-0 font-13"},"Departments")],-1)),t("div",{class:"d-flex gap-2 align-items-center"},[t("div",{class:"d-flex align-items-center"},[t("button",{type:"button",class:"btn btn-dark buttoncomp CreateDepartments d-flex align-items-center",onClick:A,"data-bs-toggle":"modal","data-bs-target":"#viewCategory"}," Create Department ")])])]),t("div",ge,[C(me,{tHeaders:q.value,tData:$.value,onActionClicked:X,isAction:"true",actions:T.value,actionType:"dropdown",isCheckbox:"true",isFiltersoption:"true","field-mapping":W.value,onUpdateFilters:Z},null,8,["tHeaders","tData","actions","field-mapping"]),C(ue,{currentRecords:$.value.length,totalRecords:u.value,onUpdateValue:G,onLimitStart:K},null,8,["currentRecords","totalRecords"])]),t("div",be,[t("div",Ce,[t("div",he,[t("div",ke,[e[7]||(e[7]=t("h6",{class:"modal-title",id:"viewCategoryLabel"},"Department",-1)),t("button",{type:"button",class:"btn-close shadow-none",onClick:e[0]||(e[0]=s=>Q()),"data-bs-dismiss":"modal","aria-label":"Close"})]),t("div",ze,[t("div",null,[t("div",De,[e[8]||(e[8]=t("label",{class:"font-13 ps-1",for:"DepartmentCode"},[V("Department Code"),t("span",{class:"text-danger ps-1"},"*")],-1)),C(N,{tag:"input",type:"text",name:"DepartmentCode",id:"DepartmentCode",placeholder:"Enter department code",modelValue:n.value.department_code,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.department_code=s),modelModifiers:{trim:!0}},null,8,["modelValue"]),m.value.department_code?(c(),p("span",we,L(m.value.department_code),1)):B("",!0)]),t("div",xe,[e[9]||(e[9]=t("label",{class:"font-13 ps-1",for:"Requedepartment_namested"},[V("Department name"),t("span",{class:"text-danger ps-1"},"*")],-1)),C(N,{tag:"input",type:"text",name:"department_name",id:"department_name",placeholder:"Enter department name",modelValue:n.value.department_name,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.department_name=s),modelModifiers:{trim:!0}},null,8,["modelValue"]),m.value.department_name?(c(),p("span",Ve,L(m.value.department_name),1)):B("",!0)]),e[10]||(e[10]=t("label",{class:"font-13 ps-1",for:"business_unit"},"Business Unit",-1)),C(N,{tag:"input",type:"text",disabled:!!n.value.business_unit,placeholder:"",class:"mb-3",name:"business_unit",id:"business_unit",modelValue:n.value.business_unit,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.business_unit=s)},null,8,["disabled","modelValue"])]),e[12]||(e[12]=t("label",{class:"font-13 ps-1",for:"Requedepartment_namested"},[V("Category"),t("span",{class:"text-danger ps-1"},"*")],-1)),t("div",Ee,[C(N,{class:"w-100",tag:"input",type:"text",name:"ezy_departments_items",id:"ezy_departments_items",onKeydown:ce(j,["enter"]),placeholder:"Enter category",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=s=>f.value=s),modelModifiers:{trim:!0}},null,8,["modelValue"]),C(pe,{class:"buttoncomp",name:"Add",onClick:j})]),i.value.ezy_departments_items?(c(),p("table",Ne,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Category Name"),t("th",{class:"text-center"},"Actions")])],-1)),t("tbody",null,[(c(!0),p(_e,null,ve(i.value.ezy_departments_items,(s,l)=>(c(),p("tr",{key:l},[t("td",null,L(l+1),1),v.value!==l?(c(),p("td",Le,L(s.category),1)):(c(),p("td",$e,[fe(t("input",{type:"text",class:"shadow-none rounded-1","onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),onChange:o=>E(l),placeholder:"Enter Category"},null,40,Pe),[[ye,g.value,void 0,{trim:!0}]])])),t("td",Se,[v.value!==l?(c(),p("i",{key:0,class:"bi bi-pencil",onClick:o=>Y(l,s.category)},null,8,Ue)):(c(),p("i",{key:1,class:"bi bi-check font-20",onClick:o=>E(l)},null,8,Be)),t("i",{class:"bi bi-trash ms-2",onClick:o=>P(l)},null,8,Fe)])]))),128))])])):B("",!0)]),t("div",Me,[D.value?(c(),p("button",{key:0,type:"button",class:"applyfilter btn btn-dark text-nowrap font-10 d-flex justify-content-center align-items-center",disabled:!n.value.department_code||!n.value.department_name||!n.value.business_unit,onClick:te},e[13]||(e[13]=[t("span",{class:"font-16 me-1"},[t("i",{class:"bi bi-check2"})],-1),V(" Save Department ")]),8,Ie)):(c(),p("button",{key:1,type:"button",class:"applyfilter btn btn-dark text-nowrap font-10 d-flex justify-content-center align-items-center",disabled:!n.value.department_code||!n.value.department_name||!n.value.business_unit,onClick:ee},e[14]||(e[14]=[t("span",{class:"font-16 me-1"},[t("i",{class:"bi bi-check2"})],-1),V(" Create Department ")]),8,Oe))])])])])]))}},Je=re(qe,[["__scopeId","data-v-4dd89d58"]]);export{Je as default};
