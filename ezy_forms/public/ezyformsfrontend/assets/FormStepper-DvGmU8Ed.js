var Ol=Object.defineProperty,zl=Object.defineProperties;var Bl=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var It=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var xt=(M,F,V)=>F in M?Ol(M,F,{enumerable:!0,configurable:!0,writable:!0,value:V}):M[F]=V,ee=(M,F)=>{for(var V in F||(F={}))It.call(F,V)&&xt(M,V,F[V]);if(ft)for(var V of ft(F))es.call(F,V)&&xt(M,V,F[V]);return M},$e=(M,F)=>zl(M,Bl(F));var St=(M,F)=>{var V={};for(var $ in M)It.call(M,$)&&F.indexOf($)<0&&(V[$]=M[$]);if(M!=null&&ft)for(var $ of ft(M))F.indexOf($)<0&&es.call(M,$)&&(V[$]=M[$]);return V};var ze=(M,F,V)=>new Promise(($,ie)=>{var oe=K=>{try{v(V.next(K))}catch(re){ie(re)}},Ve=K=>{try{v(V.throw(K))}catch(re){ie(re)}},v=K=>K.done?$(K.value):Promise.resolve(K.value).then(oe,Ve);v((V=V.apply(M,F)).next())});import{_ as rs,r as _,x as le,o as n,c as r,d as t,i as D,j as O,F as E,h as L,t as g,u as Pl,M as Nl,e as ne,E as jl,w as he,f as Wl,a6 as ts,K as de,y as P,z as N,U as x,L as S,l as b,a7 as Hl,m as h,n as U,v as ge,b as X,O as et,R as Se,Q as ss,X as ue,N as qe,k as Be,a8 as ls,B as Yl,a9 as os,Z as Jl,aa as Gl,S as Zl,H as me,ab as qt,a2 as as,ac as ns,D as is,ad as Kl}from"./index-WKIkaBT2.js";const Ql="/assets/ezy_forms/ezyformsfrontend/assets/oui_app-users-roles-C_V_SNI2.svg",Xl={class:"simple-field-library"},xl={class:"field-search"},Il={class:"field-types-grid"},eo=["onDragstart","onClick"],to={__name:"SimpleFieldLibrary",props:{fields:{type:Array,required:!0}},emits:["field-add","field-dragstart","field-dragend"],setup(M,{emit:F}){const V=M,$=F,ie=_(""),oe=_(!1),Ve=le(()=>{if(!ie.value)return V.fields;const R=ie.value.toLowerCase();return V.fields.filter(te=>te.label.toLowerCase().includes(R))}),v=(R,te)=>{oe.value=!0,R.dataTransfer.effectAllowed="copy",R.dataTransfer.setData("text/plain",te.type),$("field-dragstart",te.type)},K=()=>{oe.value=!1,$("field-dragend")},re=R=>{$("field-add",R.type)};return(R,te)=>(n(),r("div",Xl,[t("div",xl,[te[1]||(te[1]=t("i",{class:"bi bi-search"},null,-1)),D(t("input",{"onUpdate:modelValue":te[0]||(te[0]=Y=>ie.value=Y),type:"text",placeholder:"Search fields",class:"search-input"},null,512),[[O,ie.value]])]),t("div",Il,[(n(!0),r(E,null,L(Ve.value,Y=>(n(),r("button",{key:Y.type,class:"field-type-btn",draggable:!0,onDragstart:J=>v(J,Y),onDragend:K,onClick:J=>re(Y)},g(Y.label),41,eo))),128))])]))}},so=rs(to,[["__scopeId","data-v-cb64d6f9"]]),lo={class:""},oo={class:""},ao={class:"d-flex justify-content-between align-items-center CancelNdSave"},no={class:"d-flex align-items-center"},io={key:0,class:"font-16"},ro=["disabled"],uo={class:"form-container p-0 container-fluid mt-3"},co={class:"row g-4"},po={class:"col-lg-2 col-md-3 col-sm-12"},mo={class:"steps-sticky-div"},fo={class:"steps d-sm-inline-flex d-md-block m-0 p-0"},vo=["onClick"],bo={key:0,class:"ri-checkbox-circle-fill completedStepIcon"},_o={class:"step-text"},ho={class:"font-11"},go={class:"font-14"},yo={class:"col-lg-10 col-md-9 col-sm-12 formbackground-color"},wo={class:"px-2"},ko={class:"form-content stepsDiv"},Co={key:0,class:"form-info-builder"},Do={class:"zoho-toolbar"},Fo={class:"zoho-tabs"},$o={class:"toolbar-right"},So=["disabled"],qo={class:"zoho-builder-container",style:{padding:"2rem"}},Ao={class:"row g-4"},Vo={class:"col-md-6"},Eo={class:"position-relative"},Lo={key:0,class:"badge bg-success position-absolute",style:{top:"-8px",right:"10px","z-index":"10"}},Ro={key:1,class:"text-danger font-12 ms-1"},To={class:"col-md-6"},Uo={key:0,class:"text-danger font-12 ms-1"},Mo={class:"col-md-6"},Oo={class:"row g-4"},zo={class:"col-md-6"},Bo={class:"form-label font-13 fw-medium"},Po={key:0,class:"text-danger"},No={class:"col-md-6"},jo={class:"form-label font-13 fw-medium"},Wo={key:0,class:"text-danger"},Ho={class:"col-md-12"},Yo={class:"form-label font-13 fw-medium"},Jo={key:0,class:"text-danger"},Go={class:"custom-option"},Zo=["checked","onChange"],Ko={class:"row g-4"},Qo={class:"col-md-6"},Xo={class:"text-muted font-11 ms-1"},xo={key:0,class:"text-success"},Io={key:1},ea={class:"col-md-6"},ta={key:0,class:"col-md-6"},sa={class:"row g-4"},la={key:0,class:"col-12"},oa={class:"col-md-6"},aa={class:"col-md-6"},na={key:1,class:"col-12"},ia={class:"col-md-12"},ra={class:"form-check"},da=["disabled"],ua={key:2,class:"col-md-12"},ca={class:"position-relative"},pa=["disabled"],ma={key:0,class:"list-group position-absolute w-100 z-3",style:{"max-height":"200px","overflow-y":"auto"}},fa=["onMousedown"],va={key:1,class:"zoho-form-builder"},ba={class:"zoho-toolbar"},_a={class:"toolbar-left"},ha={class:"zoho-tabs"},ga=["onClick"],ya=["onClick"],wa={class:"toolbar-right"},ka={class:"zoho-builder-container"},Ca={class:"d-flex align-items-center justify-content-between w-100"},Da={class:"mb-0 font-14 fw-bold"},Fa={class:"btn btn-sm btn-link p-0 text-dark"},$a={key:0,class:"library-content"},Sa={class:"zoho-form-canvas"},qa={class:"requestandAppHeader"},Aa={class:"d-flex justify-content-between align-items-center"},Va={class:""},Ea={class:"ps-2 mb-0 fw-bolder font-14 blockTitle"},La={class:"text-center ms-2 mt-1"},Ra={key:0,class:"font-12 d-flex align-items-center"},Ta={class:"font-12 approver_type_div"},Ua={class:"font-12 fw-bold"},Ma={class:"font-12 text-danger ms-1"},Oa={class:"d-flex align-items-center"},za={key:0,class:"role-container"},Ba={key:0,class:"role-text d-flex align-items-center"},Pa={class:"role-label fw-bold"},Na={class:"role-names text-primary"},ja=["onClick"],Wa=["onClick"],Ha=["onClick"],Ya=["onClick"],Ja={class:"pt-0 section_block"},Ga={class:"d-flex justify-content-between align-items-center"},Za={class:"d-flex flex-column"},Ka=["onUpdate:modelValue","onChange","onInput"],Qa={key:0,class:"text-danger ps-3 font-10"},Xa={class:"d-flex align-items-center"},xa=["onClick"],Ia={class:"container-fluid"},en={class:"d-flex justify-content-between align-items-center"},tn={class:"rownames m-0"},sn=["onClick"],ln={class:"col"},on={class:"row"},an=["onMouseenter"],nn={class:"column_name d-flex align-items-center justify-content-between"},rn={class:"d-flex flex-column ps-2"},dn=["onUpdate:modelValue","onChange","onInput"],un={key:0,class:"text-danger ps-2 font-10"},cn={class:"position-absolute top-0 end-0"},pn=["onClick"],mn=["onDrop"],fn=["onMouseenter","onDragstart","onDrop"],vn=["onDrop"],bn=["onDragstart","onDrop"],_n={class:"d-flex justify-content-between"},hn={class:"flex-column d-flex"},gn=["onUpdate:modelValue","onChange","onInput"],yn={key:0,class:"text-danger font-10"},wn={class:"FieldcopyRemove"},kn=["onClick"],Cn=["onClick"],Dn=["onUpdate:modelValue","onChange"],Fn=["value"],$n={key:0},Sn=["onUpdate:modelValue"],qn={key:0,class:"text-danger font-10"},An={key:1},Vn=["for"],En=["id","onUpdate:modelValue","onInput","onFocus"],Ln={key:0,class:"list-group mt-1",style:{"max-height":"200px","overflow-y":"auto"}},Rn=["onClick"],Tn={class:"d-flex align-items-center justify-content-between"},Un={class:"d-flex align-items-center gap-2"},Mn={class:"d-flex align-items-center"},On=["onUpdate:modelValue","id"],zn=["for"],Bn=["onClick"],Pn=["onUpdate:modelValue"],Nn={key:3,class:"text-danger font-10"},jn=["onDrop"],Wn={class:"childtableShow"},Hn={class:"mt-2"},Yn={key:0,class:"childTableContainer"},Jn={key:0,class:"font-13"},Gn={key:1,class:"d-flex align-items-center gap-2"},Zn={class:"d-flex align-items-center"},Kn=["onUpdate:modelValue"],Qn=["onClick"],Xn={key:2,class:"table table-bordered rounded-table"},xn=["onDrop"],In=["draggable","onDragstart"],ei={key:0},ti=["onUpdate:modelValue","onInput"],si={key:0,class:"text-danger font-11"},li={key:1},oi={key:2},ai={class:"d-flex gap-1"},ni=["onUpdate:modelValue","onChange"],ii=["value"],ri={class:"d-flex"},di={class:"d-flex align-items-center gap-2"},ui={class:"d-flex align-items-center"},ci=["onUpdate:modelValue"],pi=["onClick"],mi={key:0},fi=["onUpdate:modelValue","onInput"],vi={key:0,class:"text-danger font-10"},bi={key:1,class:"font-11 text-danger"},_i={key:3},hi={key:3,class:"mb-2 mt-3"},gi=["onClick"],yi=["onClick"],wi=["onDrop"],ki=["onDrop"],Ci={class:"d-flex justify-content-center align-items-center my-2"},Di=["onClick"],Fi={class:"font-13"},$i={key:0,class:"d-flex align-items-center gap-2"},Si={class:"d-flex align-items-center"},qi=["onUpdate:modelValue"],Ai=["onClick"],Vi={class:"table table-bordered rounded-table"},Ei={key:0},Li=["onUpdate:modelValue","onBlur"],Ri={key:0,class:"text-danger font-11 mt-1"},Ti={key:1},Ui={key:2},Mi={class:"d-flex gap-1 align-items-center"},Oi=["onUpdate:modelValue","onChange"],zi=["value"],Bi=["onClick"],Pi={key:0,class:"mt-1"},Ni=["onUpdate:modelValue","onInput"],ji={key:1,class:"text-danger font-11 mt-1"},Wi={key:3},Hi={class:"mb-2"},Yi=["onClick"],Ji=["onClick"],Gi=["onClick"],Zi={key:0},Ki={class:"d-flex justify-content-between align-items-center mt-1 mb-2"},Qi=["onUpdate:modelValue","onBlur"],Xi={key:0,class:"text-danger font-12"},xi={key:1,class:"text-danger font-12"},Ii={class:"d-flex align-items-center gap-2"},er={class:"d-flex align-items-center"},tr=["onUpdate:modelValue"],sr=["onClick"],lr=["onClick"],or={class:"px-1 field-border"},ar={class:"d-flex justify-content-between"},nr=["onUpdate:modelValue","onBlur"],ir={key:0,class:"text-danger font-12"},rr={class:"d-flex align-items-center"},dr={class:"d-flex my-1"},ur=["onUpdate:modelValue"],cr=["onClick"],pr=["onClick"],mr=["onUpdate:modelValue"],fr=["value"],vr={key:0},br=["onUpdate:modelValue"],_r={key:0,class:"text-danger font-10"},hr={key:1,class:"text-danger font-12"},gr=["onClick"],yr=["onClick"],wr={class:"d-flex justify-content-center align-items-center py-2 add-section-btn"},kr=["onClick"],Cr={key:0,class:"m-2"},Dr={key:0,class:"zoho-properties-panel"},Fr={class:"properties-header"},$r={key:2},Sr={class:"stepperbackground d-flex align-items-center justify-content-between p-3"},qr={class:"container-fluid mt-4 p-4"},Ar={class:"card mb-4"},Vr={class:"card-body"},Er={class:"row g-3"},Lr={class:"col-md-6"},Rr={class:"btn-group w-100",role:"group"},Tr={key:0,class:"col-md-6"},Ur={key:0,class:"card mb-4"},Mr={class:"card-body"},Or={key:0,class:"table-responsive"},zr={class:"table table-bordered"},Br=["onUpdate:modelValue"],Pr={class:"form-check form-switch"},Nr=["onUpdate:modelValue"],jr={class:"form-check-label font-12"},Wr=["onClick"],Hr=["onClick"],Yr={key:1,class:"card mb-4"},Jr={class:"card-body"},Gr={class:"alert alert-success"},Zr={class:"table-responsive"},Kr={class:"table table-bordered"},Qr={key:0,class:"badge bg-success"},Xr={key:1,class:"badge bg-secondary"},xr={class:"text-muted"},Ir={key:2,class:"card mb-4"},ed={class:"card-body"},td={class:"alert alert-success"},sd={class:"table-responsive"},ld={class:"table table-bordered table-hover"},od={class:"badge bg-dark"},ad={key:0,class:"badge bg-danger"},nd={key:1,class:"badge bg-secondary"},id={key:0,class:"badge bg-info"},rd={key:1,class:"badge bg-warning text-dark"},dd={key:2,class:"badge bg-success"},ud={key:3,class:"badge bg-secondary"},cd={class:"text-muted"},pd={key:3},md={class:"modal fade",id:"customFormatModal",tabindex:"-1","aria-labelledby":"customFormatModalLabel","aria-hidden":"true"},fd={class:"modal-dialog modal-dialog-centered"},vd={class:"modal-content"},bd={class:"modal-body"},_d=["placeholder"],hd={class:"d-flex align-items-center gap-2"},gd={class:"d-flex align-items-center py-2"},yd={class:"modal fade",id:"formViewModal",tabindex:"-1","aria-labelledby":"formViewModalLabel","aria-hidden":"true"},wd={class:"modal-dialog modal-xl modal-dialog-scrollable"},kd={class:"modal-content"},Cd={class:"modal-body"},Dd={class:"offcanvas addOffCanvas offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},Fd={class:"offcanvas-header add_designationHeader"},$d={id:"offcanvasRightLabel",class:"font-14 fw-bold"},Sd={class:"offcanvas-body add_desig_offCanvas_body p-0"},qd={class:""},Ad={key:0,class:"p-3 approval-border-bottom"},Vd={class:"px-3 listofdesignations"},Ed={class:"my-1 d-flex justify-content-between"},Ld={class:"font-12 fw-bold"},Rd={class:"italic-style text-secondary font-12"},Td={key:0,ref:"resizableDiv",class:"my-1 disgnationlist_div"},Ud={class:"d-flex align-items-center justify-content-between gap-1"},Md={class:"form-check ps-1 d-flex align-items-center m-0"},Od=["checked"],zd={for:"selectAll",class:"form-check-label SelectallDesignation mt-2 fw-bold"},Bd={key:0,class:"form-check d-flex align-items-center m-0"},Pd={key:1},Nd={key:1,class:"p-3"},jd=["value"],Wd={key:2},Hd={class:""},Yd={class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Jd={key:0,class:"px-4 py-1 mt-2 d-flex align-items-center user-select-none"},Gd={class:"offcanvas-footer"},Zd={class:"text-end p-3"},Ae="Select All",Kd={__name:"FormStepper",setup(M){const F=Pl(),V=Nl(),$=_(1),ie=_([]);_([]);const oe=_([]),Ve=_([]);ne([]);let v=ne([]),K=ne([]);const re=_([]),R=_([]),te=_([]),Y=_(""),J=_(""),j=_("");let z=ne([]);const Pe=_("");_(!1),_(!1),_(!1);const Ee=_(""),tt=_(""),st=_(""),ds=_([]),us=_([]),A=ne({}),se=_([]),vt=_(!1),lt=_([]),ot=_(!1);let At=null;const cs=_("");let T=_("");const ye=_(null),Vt=_(null);_(null);const ae=_(0),Ne=_(0),Le=_(!0),Et=_(!1),Lt=_(!1),Rt=_(!1);_(!1);const je=_([]),fe=_(null),ve=_("new"),at=_([]),Re=_([]);_([]);const we=_([]),Te=le(()=>jl);_(!1);const nt=ne([]),I=_({routepath:F.query.routepath,business_unit:F.query.business_unit,formId:F.query.id}),it=_(""),Ue=_(!1),Me=_(!1),Tt=[{label:"Public",value:1},{label:"Private",value:0}],bt=le({get(){return Tt.find(s=>s.value===m.value.as_web_view)},set(s){m.value.as_web_view=s?s.value:null}}),Ut=le({get(){return m.value.form_name||F.query.form_name||""},set(s){m.value.form_name=s}}),m=_({form_name:"",form_short_name:"",accessible_departments:[],business_unit:`${Te.value.value||I.value.business_unit||F.query.business_unit}`,form_category:"",owner_of_the_form:"",series:"",has_workflow:"",workflow_check:"",is_linked:0,is_linked_form:"",is_predefined_doctype:F.query.id?1:0,as_web_view:0,mail_id:""});he(()=>F.query.form_name,s=>{s&&(m.value.form_name=s,m.value.form_short_name=s)},{immediate:!0});const rt=["name","parent","creation","owner","modified","modified_by","parentfield","parenttype","file_list","flags","docstatus","idx","doctype","company_field","business_unit"].map(s=>s.toLowerCase().trim()),Mt=["Approver","Approved on","Approved By"].map(s=>s.toLowerCase().trim());function ps(s){return s.toLowerCase().replace(/\s+/g,"_").replace(/[^\w_]/g,"")}le(()=>m.value),_(""),_(!1),he(Te,s=>{s&&s.value&&(m.value.business_unit=s.value)},{immediate:!0});function ms(s){if(T==null||T==="new")return!1;const e=B(s).roles;if(s===0)return e.length===0;const l=B(s-1).roles;return l.length>0&&l[0]!==null&&l[0]!==""&&e.length===0}he(()=>m.value.form_name,s=>{m.value.form_name=s.trim()}),he(()=>m.value.form_short_name,s=>{m.value.form_short_name=s.trim()}),he(()=>m.value.series,s=>{m.value.series=s.trim()}),he(()=>ve.value,s=>{s==="existing"&&(v.splice(0,v.length),we.value=[],z.length=0)});const We=_(null),Ot=(s,e,l,o,a,i)=>{We.value={blockIndex:e,sectionIndex:l,rowIndex:o,columnIndex:a,fieldIndex:i}},ke=(s,e,l,o,a,i)=>{if(s.preventDefault(),s.stopPropagation(),console.log("Field dropped at index:",{targetBlock:e,targetSection:l,targetRow:o,targetColumn:a,insertIndex:i,draggedField:We.value,draggedFieldType:ye.value}),ye.value){console.log("Dropping from field library:",ye.value);const k=Xt(ye.value);if(!k){console.error("Failed to create field from type:",ye.value);return}const C=v[e];if(!C){x("Target block not found");return}C.sections||(C.sections=[]),C.sections[l]||(C.sections[l]={label:"",rows:[]}),C.sections[l].rows||(C.sections[l].rows=[]),C.sections[l].rows[o]||(C.sections[l].rows[o]={label:"",columns:[]}),C.sections[l].rows[o].columns||(C.sections[l].rows[o].columns=[]),C.sections[l].rows[o].columns[a]||(C.sections[l].rows[o].columns[a]={label:"",fields:[]}),C.sections[l].rows[o].columns[a].fields.splice(i,0,k),console.log("Field added successfully:",k),me(`${k.label} field added`),ye.value=null;return}if(!We.value){console.log("No dragged field found");return}const{blockIndex:u,sectionIndex:c,rowIndex:f,columnIndex:d,fieldIndex:p}=We.value,w=v[u].sections[c].rows[f].columns[d].fields,q=v[e].sections[l].rows[o].columns[a].fields;if(u===e&&c===l&&f===o&&d===a&&p===i)return;const y=w.splice(p,1)[0];w===q&&p<i&&i--,q.splice(i,0,y),We.value=null},Oe=_(""),fs=s=>ze(this,null,function*(){const e=[["module","in",["User Forms"]],["istable","=",1]];s!=null&&s.trim()&&e.push(["name","=",`${s}`]);const l={fields:JSON.stringify(["name"]),filters:JSON.stringify(e),limit_page_length:"None",doctype:de.doctypesList};try{return(yield P.get(N.GetDoctypeData,{params:l})).message.data||[]}catch(o){return console.error("Error fetching doctype list:",o),[]}}),dt=_(null),zt=s=>ze(this,null,function*(){if(Oe.value="",dt.value=null,s.tableName){let e=s.tableName.trim();if(e.length>64){Oe.value="Table name cannot exceed 64 characters";return}if(!/^[a-zA-Z]+( [a-zA-Z]+)*$/.test(e)){Oe.value="Table name can only contain letters and spaces (no leading/trailing spaces or special characters)";return}const o=yield fs(e);dt.value=o.find(a=>a.name.toLowerCase()===e.toLowerCase()),dt.value&&(Oe.value="Table already exists"),s.tableName=e}s.label&&(s.fieldname=ps(s.label))});function vs(){const s=m.value.is_linked_form;if(!s){lt.value=[];return}clearTimeout(At),At=setTimeout(()=>{const e=[["business_unit","=",`${Te.value.value}`],["name","like",`%${s}%`]],l={fields:JSON.stringify(["name"]),limit_page_length:10,limit_start:0,filters:JSON.stringify(e),doctype:de.EzyFormDefinitions,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"};P.get(`${N.GetDoctypeData}`,{params:l}).then(o=>{lt.value=o.message.data||[]}).catch(o=>{console.error("Error fetching form definitions:",o)})},300)}function bs(s){m.value.is_linked_form=s,ot.value=!1}function _s(){setTimeout(()=>{ot.value=!1},200)}ne({query:"",key:""});function be(s,e,l,o,a){return`${s}-${e}-${l}-${o}-${a}`}ne({});const He=ne({}),_t=ne({});function hs(s){_t[s]=!0}function gs(s,e,l,o,a,i){const u=be(e,l,o,a,i),c=[["istable","=",0]];s!=null&&s.trim()&&c.push(["name","like",`%${s}%`]);const f={fields:JSON.stringify(["name"]),filters:JSON.stringify(c),limit_page_length:"none",doctype:de.doctypesList};P.get(N.GetDoctypeData,{params:f}).then(d=>{He[u]=d.message.data||[]}).catch(d=>{console.error("Error fetching doctype list:",d),He[u]=[]})}function ys(s,e,l,o,a,i){v[s].sections[e].rows[l].columns[o].fields[a].options=i;const u=be(s,e,l,o,a);He[u]=[],_t[u]=!1}const ws=le(()=>v!=null&&v.length?j.value===1?[0]:Array.from({length:j.value},(s,e)=>e).filter(s=>s<j.value):[]),_e=_(null),Ce=_(null),ks=(s,e,l,o,a)=>{_e.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o,fieldIndex:a}},Cs=()=>{_e.value=null},Ds=(s,e,l,o,a)=>_e.value&&_e.value.blockIndex===s&&_e.value.sectionIndex===e&&_e.value.rowIndex===l&&_e.value.columnIndex===o&&_e.value.fieldIndex===a,Fs=(s,e,l,o)=>{Ce.value={blockIndex:s,sectionIndex:e,rowIndex:l,columnIndex:o}},$s=()=>{Ce.value=null},Ss=(s,e,l,o)=>Ce.value&&Ce.value.blockIndex===s&&Ce.value.sectionIndex===e&&Ce.value.rowIndex===l&&Ce.value.columnIndex===o,Bt=_([{form_json:""}]),De=_("");Wl(()=>{Wt(),De.value=F.query.Clone,T.value=F.query.id||"new",De.value==="1"&&(m.value.series=""),T.value!=null&&T.value!=null&&T.value!="new"&&jt(),sessionStorage.getItem("allow_approver_to_edit_form")=="1"?vt.value=!0:vt.value=!1;let s=localStorage.getItem("Bu");if(m.value.business_unit=s,F.query.preId==="PreDefine"){const e=localStorage.getItem("form_json");if(e){Bt.value[0].form_json=e;const l=Bt.value[0],o=JSON.parse(l.form_json),a=ts(o.fields);se.value=o.child_table_fields,a.forEach(i=>{v.push(i)})}}});const Fe=_(null),G=ne({}),Pt=_(null),qs=s=>{Fe.value=s},As=()=>{Fe.value=null},Vs=s=>{s.preventDefault()},Es=(s,e)=>{const l=s.target.closest("tr");if(!l)return;const o=Array.from(l.parentNode.children).indexOf(l);if(o!==Fe.value){const a=e[Fe.value];e.splice(Fe.value,1),e.splice(o,0,a),Fe.value=o}},Ls=_([]),ht=s=>{if(["Select","Table MultiSelect","Check","Small Text"].includes(s.fieldtype)&&s.options){const e=s.options.split(`
`).map(a=>a.trim()).filter(a=>a),l=[],o=new Set;return e.forEach(a=>{const i=a.toLowerCase();o.has(i)||(o.add(i),l.push(a))}),`
`+l.join(`
`)}else if(["Link","Table"].includes(s.fieldtype)&&s.options)return s.options.trim();return s.options},Rs=(s,e)=>{const l=v[s].sections[e];l.childTables||(l.childTables=[]);const o=l.childTables.length;l.childTables.push({label:"",fieldname:"",fieldtype:"Table",idx:o,reqd:!1,as_a_block:"",description:"false",columns:[ee({label:"",fieldname:"",fieldtype:"",idx:0,description:"",reqd:!1},nt.fieldtype==="Select"&&nt.options?{options:nt.options?`
${nt.options}`:`
`}:{})],newTable:!0})},Ts=(s,e,l)=>{const o=v[s].sections[e].childTables[l];o.columns||(o.columns=[]),o.columns.push(ee({label:"",fieldname:"",fieldtype:"",idx:o.columns.length,description:"",reqd:!1},o.columns.fieldtype==="Select"&&o.columns.options?{options:o.columns.options?`
${o.columns.options}`:`
`}:{}))},Us=(s,e,l)=>{v[s].sections[e].childTables.splice(l,1)},Ms=(s,e,l,o)=>{v[s].sections[e].childTables[l].columns.splice(o,1)};function Os(s,e,l,o,a,i){var d;const u=`${e}-${l}-${o}`;A[u]||(A[u]={columns:[]});const c={},f=((d=s.label)==null?void 0:d.trim())||"";if(!f)c.label="Field Label is required";else{const p=f.toLowerCase();if(rt.includes(p)&&!Mt.includes(p))c.label=`"${f}" is a restricted field label`;else if(f.length>64)c.label="Field Label cannot exceed 64 characters";else if(!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(f))c.label="Field Label can only contain letters, numbers, and single spaces between words";else{const w=i.map((q,y)=>{var k;return{label:(k=q.label)==null?void 0:k.trim().toLowerCase(),index:y}}).filter(q=>q.label===p);if(w.length>1){const q=w[0].index;a!==q&&(c.label=`"${f}" is already used in this table`)}}}A[u].columns[a]=c}function ut(s,e,l){var i;A[e]||(A[e]={});const o=[],a=((i=s.label)==null?void 0:i.trim())||"";a||o.push("Label is required"),a.length>64&&o.push("Label cannot exceed 64 characters"),a&&!/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(a)&&o.push("No special characters allowed"),a&&rt.includes(a.toLowerCase().trim())&&o.push("This label is restricted"),a&&se.value[e].map(f=>{var d;return(d=f.label)==null?void 0:d.trim().toLowerCase()}).filter(Boolean).filter(f=>f===a.toLowerCase()).length>1&&o.push("Duplicate label is not allowed"),s.fieldtype||o.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||s.options.trim()==="")&&o.push("Options are required"),A[e][l]=o}const zs=(s,e,l)=>{var u;const o=v[s].sections[e].childTables[l],a={tableName:!1,columns:[]};let i=!1;return(u=o.tableName)!=null&&u.trim()||(a.tableName="Table name is required.",i=!0),o.columns.forEach((c,f)=>{var p,w;const d={};(p=c.label)!=null&&p.trim()||(d.label="Field Label is required",i=!0),(w=c.fieldtype)!=null&&w.trim()||(d.fieldtype="Please select field type",i=!0),a.columns[f]=d}),A[`${s}-${e}-${l}`]=a,i},Bs=(s,e,l)=>{var a,i;const o=(i=(a=v[s])==null?void 0:a.sections)==null?void 0:i[e];o&&!Array.isArray(o[l])&&(o[l]=[])},Ps=s=>s?s.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,""):"",Ns=(s,e,l)=>{if(zs(s,e,l)){x("Please fix validation errors before creating the table",{transition:"zoom"});return}if(dt.value){x("Table already exists",{transition:"zoom"});return}const a=v[s].sections[e].childTables[l],i=v[s].sections[e];a.columns=a.columns.map((c,f)=>$e(ee({},c),{idx:f,options:ht(c)})),a.newTable=!1;const u={form_short_name:a.tableName,fields:a.columns,idx:a.idx,as_a_block:a.as_a_block?a.as_a_block:"false"};P.post(N.childtable,u).then(c=>{var f,d,p;if(c){Bs(s,e,"afterCreated"),i.afterCreated[l]=ee({},a),me("Table created successfully!");const w=(p=(d=(f=c.message)==null?void 0:f[0])==null?void 0:d[0])==null?void 0:p.child_doc;w&&(v[s].sections[e].childTables[l]=$e(ee(ee({},v[s].sections[e].childTables[l]),w),{newTable:!1}))}}).catch(c=>{console.error("Error creating table:",c)})},Ye=(s,e,l,o=[])=>{var u;G[e]||(G[e]=[]),G[e]=G[e].filter(c=>c!==l),A[e]||(A[e]=[]),A[e][l]=[];const a=[],i=((u=s.label)==null?void 0:u.trim())||"";if(i?rt.includes(i.toLowerCase())?a.push("This label is restricted"):i.length>64?a.push("Label cannot exceed 64 characters"):/^[A-Za-z0-9]+(?: [A-Za-z0-9]+)*$/.test(i)||a.push("Only letters, numbers, and single spaces allowed"):a.push("Label is required"),o.length){const c=i.toLowerCase(),f=o.map((d,p)=>{var w;return{label:(w=d.label)==null?void 0:w.trim().toLowerCase(),idx:p}}).filter(d=>d.label===c);if(f.length>1){const d=f[0].idx;l!==d?(a.push("Duplicate label not allowed"),s._duplicate=!0):s._duplicate=!1}else s._duplicate=!1}return s.fieldtype||a.push("Field type is required"),s.fieldtype==="Select"&&(!s.options||!s.options.trim())&&a.push("Options are required"),A[e][l]=a,a.length>0&&G[e].push(l),a.length===0},js=(s,e,l)=>{const a=v[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!a)return;const i=a.columns.length,u={fieldname:"",fieldtype:"",idx:i+1,label:"",value:"",isNew:!0,description:""};a.columns.push(u),Ye(u,l,i,a.columns)},Nt=_([]),Ws=(s,e,l,o)=>{const i=v[s].sections[e].afterCreated.find(c=>c.tableName===l);if(!i)return;i.columns.splice(o,1),i.columns.forEach((c,f)=>{c.idx=f+1});const u=G.value[l];u&&(G.value[l]=u.filter(c=>c!==o).map(c=>c>o?c-1:c))},Hs=(s,e,l)=>{const a=v[s].sections[e].afterCreated.find(i=>i.tableName===l);if(a){if(W[l]){G[l]=[];let i=!0;if(a.columns.forEach((f,d)=>{Ye(f,l,d,a.columns)||(i=!1)}),!i){x("Please fix the errors in the highlighted fields before saving!");return}const u=a.columns.map((w,p)=>{var q=w,{isNew:f}=q,d=St(q,["isNew"]);return $e(ee({},d),{idx:p+1,options:ht(d)})}),c={form_short_name:Ps(l),fields:u,as_a_block:a.description};P.post(N.childtable,c).then(f=>{Nt.value=f.data,me("Fields updated successfully!")}).catch(f=>{console.error("❌ Saving fields failed:",f)})}W[l]=!W[l]}},W=ne({}),Ys=s=>{se.value[s]||(se.value[s]=[]);const e=se.value[s].length+1;se.value[s].push({fieldname:"",fieldtype:"",idx:e,label:"",value:"",isNew:!0,description:"",options:se.value[s].options?`
${se.value[s].options}`:""})},Js=(s,e)=>{se.value[s]&&se.value[s].splice(e,1)},Gs=(s,e)=>{if(!s)return;G.value||(G.value={}),G.value[s]||(G.value[s]=[]);const l=se.value[s];if(l){if(W[s]){G.value[s]=[];let o=!0;if(l.forEach((u,c)=>{var d;ut(u,s,c);const f=(d=A[s])==null?void 0:d[c];f&&f.length>0&&(G.value[s].push(c),o=!1),u.label&&(u.label=u.label.trim())}),!o){x("Please fix the errors before saving");return}const a=l.map((d,f)=>{var p=d,{isNew:u}=p,c=St(p,["isNew"]);return $e(ee({},c),{idx:f+1,options:ht(c)})}),i={form_short_name:s,fields:a,as_a_block:e};P.post(N.childtable,i).then(u=>{Nt.value=u.data,me("Fields updated successfully!")}).catch(u=>{console.error("❌ Saving fields failed:",u)})}W[s]=!W[s],Pt.value=W[s]?s:null}},Zs=_([{id:1,label:"Form Info",stepno:"Step 1",icon:"bi bi-info-circle"},{id:2,label:"Form Fields",stepno:"Step 2",icon:"bi bi-grid-3x3-gap"},{id:3,label:"Workflow Setup",stepno:"Step 3",icon:"bi bi-diagram-3"},{id:4,label:"Print Format",stepno:"Step 4",icon:"ri-checkbox-circle-line"}]),gt=[{label:"Text",type:"Data"},{label:"Select",type:"Select"},{label:"Attach",type:"Attach"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Number",type:"Int"},{label:"TextArea",type:"Text"}],ct=[{label:"Text",type:"Data"},{label:"Time",type:"Time"},{label:"Text Area",type:"Text"},{label:"Date",type:"Date"},{label:"Datetime",type:"Datetime"},{label:"Attach",type:"Attach"},{label:"Phone",type:"Data"},{label:"Check",type:"Check"},{label:"Number",type:"Int"},{label:"Select",type:"Select"},{label:"Multi Select",type:"Small Text"},{label:"Link",type:"Link"}],Ks=le(()=>[Ae,...oe.value]),Qs=le(()=>{const s=m.value.accessible_departments;return s.includes(Ae)?"All Selected":s.length>1?`${s[0]}.. +${s.length-1} more selected`:s.join(", ")}),Xs=s=>s===Ae?m.value.accessible_departments.length===oe.value.length:m.value.accessible_departments.includes(s),xs=(s,e)=>{s===Ae?e.target.checked?m.value.accessible_departments=[...oe.value]:m.value.accessible_departments=[]:(e.target.checked?m.value.accessible_departments.push(s):m.value.accessible_departments=m.value.accessible_departments.filter(l=>l!==s),m.value.accessible_departments.length===oe.value.length?m.value.accessible_departments=[...oe.value]:m.value.accessible_departments=m.value.accessible_departments.filter(l=>l!==Ae))},Is=s=>{s===Ae&&(m.value.accessible_departments=[...oe.value])},el=s=>{s===Ae&&(m.value.accessible_departments=[])},yt=_(!1),Je=le(()=>{var e;let s=[...re.value];if(Me.value&&(s=s.filter(l=>l.is_hod===1)),(e=Pe.value)!=null&&e.trim()){const l=Pe.value.toLowerCase();s=s.filter(o=>o.role.toLowerCase().includes(l))}return s.sort((l,o)=>l.role.localeCompare(o.role)),s.sort((l,o)=>{const a=R.value.includes(l.role),i=R.value.includes(o.role);return a===i?0:a?1:-1}),s.map(l=>l.role)}),tl=le(()=>{const s=Je.value;return s.length>0&&s.every(e=>R.value.includes(e))});he([R,Je],()=>{const s=Je.value;yt.value=s.length>0&&s.every(e=>R.value.includes(e))},{immediate:!0,deep:!0});function sl(s){const e=s.target.checked,l=re.value.filter(o=>{var a;return!(Me.value&&o.is_hod!==1||(a=Pe.value)!=null&&a.trim()&&!o.role.toLowerCase().includes(Pe.value.toLowerCase()))}).map(o=>o.role);e?R.value=Array.from(new Set([...R.value,...l])):R.value=R.value.filter(o=>!l.includes(o)),yt.value=e}function ll(){R.value=[],yt.value=!1,Me.value=!1}const ce=_("");function ol(){const s=v[j.value];if(!s||!s.sections){console.error("Error: Invalid block or sections not found.");return}let e={type:j.value==0?"requestor":"approver",roles:R.value,approval_required:tt.value,approver_can_edit:st.value,fields:s.sections.flatMap(qt),idx:j.value};j.value!==0&&(e.view_only_reportee=ce.value==="ViewOnlyReportee"?1:0,e.all_approvals_required=ce.value==="all_approvals_required"?1:0,e.requester_as_a_approver=ce.value==="requester_as_a_approver"?1:0,e.on_rejection=Ee.value?Ee.value:0);const l=z.findIndex(o=>o.idx===e.idx);l!==-1?z[l]=e:z.push(e),il()}function B(s){const e=z.filter(a=>a.idx===s);if(e.length===0)return{roles:[]};if(e.length===1)return e[0];const l=ee({},e[0]),o=[];return e.forEach(a=>{a.roles&&Array.isArray(a.roles)&&o.push(...a.roles)}),l.roles=o,console.log(`getWorkflowSetup(${s}): Found ${e.length} entries, merged roles:`,o),l}function al(s){const e=B(s),l=e.roles||[];R.value=[...l],Ee.value=e.on_rejection,tt.value=e.approval_required,st.value=e.approver_can_edit,e.view_only_reportee===1?ce.value="ViewOnlyReportee":e.all_approvals_required===1?ce.value="all_approvals_required":e.requester_as_a_approver===1?ce.value="requester_as_a_approver":ce.value=""}const wt=s=>{Me.value=!1,Pe.value="",ce.value="",Ee.value="",m.value.accessible_departments.length&&nl(s,m.value.accessible_departments),j.value=s,al(s)};function nl(s,e){let l={index:s,departments:e,property:m.value.business_unit};P.post(N.addDesignationroles,l).then(o=>{o.message&&(re.value=o.message)}).catch(o=>{console.error("Error fetching designations data:",o)})}function il(){P.post(N.add_roles_WF,{workflow_setup:z,doctype:m.value.form_short_name,business_unit:m.value.business_unit}).then(s=>{console.log(s),j.value==0?me("Requestor Added"):me(`Approver-${j.value} Added`)})}function rl(){V.push({path:I.value.routepath||localStorage.getItem("routepath")}),localStorage.removeItem("form_json")}function dl(){m.value.form_name="",m.value.form_short_name="",m.value.owner_of_the_form="",m.value.form_category="",m.value.accessible_departments=[],m.value.series="",m.value.has_workflow="",m.value.is_linked=0,m.value.is_linked_form="",m.value.mail_id="",m.value.public_form_response="",Y.value="",J.value="",ie.value=[],fe.value=null}const ul=s=>{if(Ge.value){x("Please check all required fields before proceeding.");return}s<$.value?Ct():s>$.value&&kt()},kt=()=>{if(Ge.value){x("Please check all required fields before proceeding.");return}$.value<4&&($.value+=1,$.value===4&&(mt.value=v))},Ct=()=>{$.value>1&&($.value-=1)},cl=_([]);function jt(){Rt.value=!0;const s={fields:JSON.stringify(["*"]),limit_page_length:"none",doctype:de.EzyFormDefinitions,doc_id:T.value};P.get(N.GetDoctypeData,{params:s}).then(e=>{var o;let l=e==null?void 0:e.message.data;if(l){l.accessible_departments&&typeof l.accessible_departments=="string"?l.accessible_departments=l.accessible_departments.split(",").filter(u=>u.trim()!==""):l.accessible_departments=[],m.value=$e(ee(ee({},m.value),l),{owner_of_the_form:l.owner_of_the_form||m.value.owner_of_the_form||""}),m.value.owner_of_the_form&&Dt(m.value.owner_of_the_form);const a=JSON.parse((o=e.message.data)==null?void 0:o.form_json);ds.value=a.workflow,cs.value=a.fields.filter(u=>u.fieldtype==="Table"),cl.value=a.fields.filter(u=>u.fieldtype==="Table"),Ue.value=e.message.data.is_landscape;let i=ts(JSON.parse(l==null?void 0:l.form_json).fields);se.value=JSON.parse(e.message.data.form_json).child_table_fields,Ls.value=[],us.value=[],i.forEach((u,c)=>{v.push(u)}),JSON.parse(l==null?void 0:l.form_json).workflow.forEach((u,c)=>{z.push(u)})}}).catch(e=>{console.error("Error fetching data:",e),x("Failed to load form data. Please try again.")}).finally(()=>{Rt.value=!1})}function pl(){const s={};it.value&&(s.print_format=it.value),Ue.value!==void 0&&Ue.value!==null&&(s.is_landscape=Ue.value),P.put(N.resource+de.EzyFormDefinitions+`/${F.query.id}`,s).then(e=>{console.log(e),bootstrap.Modal.getInstance(document.getElementById("customFormatModal")).hide(),me("Print Format Added Successfully")}).catch(e=>{console.error("Error fetching  data:",e)})}function Wt(){const s={fields:JSON.stringify(["name","department_name"]),limit_page_length:"none",business_unit:`${I.value.business_unit||F.query.business_unit}`,doctype:de.departments};Et.value=!0,P.get(N.GetDoctypeData,{params:s}).then(e=>{var l;(l=e==null?void 0:e.message.data)!=null&&l.length&&(Ve.value=e.message.data.map(o=>o.name),oe.value=e.message.data.map(o=>o.name))}).catch(e=>{console.error("Error fetching department data:",e),x("Failed to load departments. Please refresh the page.")}).finally(()=>{Et.value=!1})}_(""),he(()=>m.value.owner_of_the_form,s=>{s&&Dt(s)});function Dt(s){s&&typeof s=="string"&&s.trim()!==""&&ml(s)}function ml(s){Lt.value=!0;const e={fields:JSON.stringify(["ezy_departments_items"]),doctype:de.departments,doc_id:s};P.get(N.GetDoctypeData,{params:e}).then(l=>{var o;(o=l==null?void 0:l.message.data)!=null&&o.ezy_departments_items&&(ie.value=l.message.data.ezy_departments_items.map(a=>a.category))}).catch(l=>{console.error("Error fetching categories data:",l),x("Failed to load form categories. Please try again.")}).finally(()=>{Lt.value=!1})}function Ft(s){let e=Kl(v);const l=$e(ee({},m.value),{fields:e,doctype:de.EzyFormDefinitions,workflow_setup:z,form_status:s==="save"?"Created":"Draft"});l.accessible_departments=l.accessible_departments.toString(),P.post(N.savedata,l).then(o=>{if(o&&o.message&&o.message.message){let a=localStorage.getItem("preName");if(a){let i={installed:"Yes"};P.put(`${N.resource}${de.preDefinedForm}/${a}`,i).then(u=>{localStorage.removeItem("preName")}).catch(u=>{console.error("Error fetching ezyForms data:",u)})}if(V.push({params:{paramid:o.message.message},query:{id:o.message.message}}),T.value=o.message.message,T&&T!=="new"&&(v.splice(0,v.length),jt()),z.length<v.length)is("Add Workflow");else if(Yt.value===!0){me("Form Created Successfully!",{autoClose:2e3,transition:"zoom"});let i=localStorage.getItem("routepath");s==="save"?V.push({path:i}):s==="Draft"&&V.push({path:i})}}else console.error("Invalid response structure:",o)}).catch(o=>{console.error("Error saving form data:",o)})}const pt=_(""),Ht=()=>{var l,o;const s=v.length,e={label:s===0?"requestor":`approver-${s}`,parent:`${(l=Te.value)==null?void 0:l.value}-${(o=m.value)==null?void 0:o.form_short_name}`,sections:[{label:"",parent:`${Te.value.value}-${m.value.form_short_name}`,childTables:[],afterCreated:{},rows:s===0?[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Requested By",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Requested On",fieldtype:"Datetime",options:"",reqd:!1}]}]},{label:`row_0_1_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1,description:""}]}]}]:[{label:`row_0_0_${s}`,columns:[{label:"",fields:[{label:"Approver",fieldtype:"Data",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved On",fieldtype:"Datetime",options:"",reqd:!1}]},{label:"",fields:[{label:"Approved By",fieldtype:"Attach",options:"",reqd:!1}]}]}]}]};v.push(e),as(()=>{pt.value&&pt.value.scrollTo({top:pt.value.scrollHeight,behavior:"smooth"})})},Yt=_(!1),Jt=s=>{let e=v[s];e.parent&&K.push(e);let l=[];z.length>s&&z[s].roles&&(l=[...z[s].roles]),v.splice(s,1),z.length>s&&z.splice(s,1),v.forEach((o,a)=>{o.sections.forEach((i,u)=>{i.rows.forEach((c,f)=>{c.columns.forEach((d,p)=>{pe(a,u,f,p)})})})}),l.length&&fl(l,s)};function fl(s,e){const l={role:s,level:e,document_type:m.value.form_name,short_name:m.value.form_short_name,property:m.value.business_unit};P.post(N.deleteAssigneRoles,l).then(o=>{o&&Ft()})}const vl=(s,e)=>{const l={label:"",parent:`${Te.value.value}-${m.value.form_short_name}`,rows:[{label:`row_0_${e}_${s}`,columns:[{label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]}]}]};v[s].sections.splice(e+1,0,l)},bl=(s,e)=>{let l=v[s].sections[e];l.parent&&K.push(l),v[s].sections.splice(e,1),v[s].sections.forEach((o,a)=>{o.rows.forEach((i,u)=>{i.columns.forEach((c,f)=>{pe(s,a,u,f)})})})},_l=(s,e,l)=>{v[s].sections[e].rows[l].columns.push({label:"",fields:[{label:"",fieldtype:"",options:"",reqd:!1}]})},hl=(s,e,l,o)=>{const i=v[s].sections[e].rows[l].columns,u=i[o];u.parent&&K.push(u),i.length===1?v[s].sections[e].rows.splice(l,1):i.splice(o,1),v[s].sections.forEach((c,f)=>{c.rows.forEach((d,p)=>{d.columns.forEach((w,q)=>{pe(s,f,p,q)})})})},gl=(s,e,l,o)=>{v[s].sections[e].rows[l].columns[o].fields.push({label:"",fieldtype:"",options:"",reqd:!1})},yl=(s,e,l,o,a)=>{let i=v[s].sections[e].rows[l].columns[o].fields[a];i.parent&&K.push(i),v[s].sections[e].rows[l].columns[o].fields.splice(a,1)},wl=(s,e,l,o,a)=>{const i=v[s].sections[e].rows[l].columns[o].fields[a],u=ee({},i);u.name=`${i.name} Name the field`,v[s].sections[e].rows[l].columns[o].fields.splice(a+1,0,u)},kl=(s,e,l,o,a)=>{const i=ns(v);v.splice(0,v.length,...i);let u=v[s].sections[e].rows[l].columns[o].fields[a].fieldtype;(u!=="Select"||u!=="radio"||u!=="multiselect")&&(v[s].sections[e].rows[l].columns[o].fields[a].options="")};function Cl(s){return rt.includes(s==null?void 0:s.trim().toLowerCase())}function Dl(s){return/[^a-zA-Z0-9 _\/!@#$%^&*()?.:;|/\\[\]{}]/.test(s)||s.includes('"')||s.includes("'")}function Fl(s){return s.flatMap(e=>{var l;return[(l=e.label)==null?void 0:l.trim().toLowerCase(),...e.sections.flatMap(o=>{var a;return[(a=o.label)==null?void 0:a.trim().toLowerCase(),...o.rows.flatMap(i=>i.columns.flatMap(u=>{var c;return[(c=u.label)==null?void 0:c.trim().toLowerCase(),...u.fields.map(f=>{var d;return(d=f.label)==null?void 0:d.trim().toLowerCase()})]}))]})]}).filter(e=>e!==""&&!Mt.includes(e))}function pe(s,e,l,o,a){const u=Fl(v).filter((d,p,w)=>w.indexOf(d)!==p),c=ns(v);v.splice(0,v.length,...c);function f(d,p){if(!d){p.errorMsg="";return}Cl(d)?p.errorMsg="Entered label is restricted":Dl(d)?p.errorMsg=`Label should not contain special characters, double quotes (") or single quotes (')`:d.length>64?p.errorMsg="Label should not exceed 64 characters":p.errorMsg=u.includes(d.trim().toLowerCase())?"Duplicate Label Name":""}a!==void 0&&f(v[s].sections[e].rows[l].columns[o].fields[a].label,v[s].sections[e].rows[l].columns[o].fields[a]),a===void 0&&o!==void 0&&f(v[s].sections[e].rows[l].columns[o].label,v[s].sections[e].rows[l].columns[o]),o===void 0&&a===void 0&&f(v[s].sections[e].label,v[s].sections[e]),v.forEach(d=>{d.sections.forEach(p=>{f(p.label,p),p.rows.forEach(w=>{w.columns.forEach(q=>{f(q.label,q),q.fields.forEach(y=>{f(y.label,y)})})})})})}const $t=le(()=>{function s(e){return!e||typeof e!="object"?!1:"fieldtype"in e&&e.fieldtype===""||"error"in e&&e.error||"errorMsg"in e&&e.errorMsg||["Select","Table MultiSelect"].includes(e.fieldtype)&&(!e.options||e.options.trim()==="")?!0:Array.isArray(e)?e.some(s):Object.values(e).some(s)}return s(v)}),Ge=le(()=>Y.value.length>0||J.value.length>0||!m.value.form_category||!m.value.owner_of_the_form||m.value.accessible_departments.length===0),$l=le(()=>v.some(s=>s.sections.some(e=>e.rows.some(l=>l.columns.some(o=>o.fields.some(a=>a.label&&a.fieldtype))))));function Gt(s,e){let l=s.target.value.trim();if(!l){e==="form_name"?Y.value="Input cannot be empty or only spaces":e==="form_short_name"&&(J.value="Input cannot be empty or only spaces");return}if(l.length>63){e==="form_name"?Y.value="Name cannot exceed 63 characters":e==="form_short_name"&&(J.value="Short name cannot exceed 63 characters");return}if(/^\d/.test(l)){e==="form_short_name"&&(J.value="First character must be a letter");return}else J.value="";if(e==="form_short_name"&&l.length<2){J.value="Short name must have at least 2 letters";return}if(e==="form_short_name"&&/[^a-zA-Z ]/.test(l)){J.value="Only alphabets and spaces are allowed";return}if(/[^a-zA-Z0-9& ]/.test(l)){e==="form_name"?Y.value="Special characters are not allowed":e==="form_short_name"&&(J.value="Special characters are not allowed");return}else e==="form_name"?Y.value="":e==="form_short_name"&&(J.value="");const o=[[e,"=",`${l}`],["business_unit","=",`${m.value.business_unit}`]],a={fields:JSON.stringify(["form_name","form_short_name"]),filters:JSON.stringify(o),doctype:de.EzyFormDefinitions};P.get(`${N.GetDoctypeData}`,{params:a}).then(i=>{te.value=i.message.data,e==="form_name"?Y.value=l&&te.value.some(u=>u.form_name&&u.form_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Name already exists":"":e==="form_short_name"&&(J.value=l&&te.value.some(u=>u.form_short_name&&u.form_short_name.replace(/\s+/g,"").toLowerCase()===l.replace(/\s+/g,"").toLowerCase())?"Short name already exists":"")}).catch(i=>{console.error("Error fetching ezyForms data:",i),e==="form_name"?Y.value="":e==="form_short_name"&&(J.value="")})}const Sl=s=>s===0?"1st row":s===1?"2nd row":s===2?"3rd row":`${s+1}th row`,mt=_([]),ql=()=>{v.length&&(mt.value=v,new bootstrap.Modal(document.getElementById("formViewModal")).show())};function Al(){P.post(N.delete_form_items,{deleted_fields:K.flatMap(qt),doctype:T}).then(s=>{var e;(e=s==null?void 0:s.message)!=null&&e.success&&Ft()})}function Zt(s){return ze(this,null,function*(){if($t.value){x("Please fix the errors before proceeding.");return}Yt.value=!0;let e=K.flatMap(qt);T!=null&&T!=null&&T!="new"&&e.length?Al():Ft(s)})}const Vl=()=>{at.value.push({role:"",autoApproval:!1,permissions:{}})},El=s=>{at.value.splice(s,1)},Ll=s=>{is("Permission configuration modal will be implemented here")},Kt=()=>ze(this,null,function*(){var s;if(!(je.value.length>0))try{const e={doctype:"WF Roadmap",fields:JSON.stringify(["name","roadmap_title","document_type","workflow_levels","property","cluster_name"]),filters:JSON.stringify([])},l=yield P.get(N.GetDoctypeData,{params:e});(s=l==null?void 0:l.message)!=null&&s.data&&(je.value=l.message.data.map(o=>({roadmap_title:o.name,display_name:`${o.roadmap_title} (${o.document_type})`,document_type:o.document_type,workflow_levels:o.workflow_levels,property:o.property,cluster_name:o.cluster_name})),console.log("Fetched WF Road Maps:",je.value))}catch(e){console.error("Error fetching WF Road Maps:",e),x("Failed to fetch workflow road maps")}}),Qt=s=>ze(this,null,function*(){var e;try{console.log("Selected WF Road Map:",s);const l=yield P.get(`${N.resource}${de.wfRoadmap}/${s.roadmap_title}`),o=((e=l==null?void 0:l.data)==null?void 0:e.data)||(l==null?void 0:l.data)||{};console.log("WF Road Map Data:",o);const a=(o.wf_requestors&&o.wf_requestors.length>0,1),i={};o.wf_level_setup&&o.wf_level_setup.length>0&&o.wf_level_setup.forEach(d=>{i[d.level]||(i[d.level]=[]),i[d.level].push(d)});const u=Object.keys(i).length,c=a+u;for(console.log(`Required blocks: ${c} (1 requestor + ${u} approver levels)`),z=[],Re.value=[],we.value=[];v.length>c;)v.pop();for(;v.length<c;)Ht();console.log(`Block adjustment complete: ${v.length} blocks`);let f=0;o.wf_requestors&&o.wf_requestors.length>0?(Re.value=o.wf_requestors,console.log(`Loaded ${o.wf_requestors.length} requestor role(s)`),o.wf_requestors.forEach(d=>{z.push({type:"requestor",roles:[d.requestor],auto_approval:d.auto_approval||0,columns_allowed:d.columns_allowed||"",fields:[],idx:0})})):console.warn("No Requestors found in roadmap, creating default requestor setup"),f=1,o.wf_level_setup&&o.wf_level_setup.length>0?(we.value=o.wf_level_setup.sort((p,w)=>p.level-w.level),console.log(`Loaded ${o.wf_level_setup.length} approver level(s)`),Object.keys(i).sort((p,w)=>parseInt(p)-parseInt(w)).forEach(p=>{const w=i[p],q=f;console.log(`Level ${p} → Block Index ${q}, Roles: ${w.length}`),w.forEach(y=>{z.push({type:"approver",level:parseInt(p),roles:[y.role],approval_required:y.mandatory?1:0,approver_can_edit:0,view_only_reportee:y.view_only_reportee||0,all_approvals_required:y.all_approvals_required||0,requester_as_a_approver:y.requester_as_a_approver||0,on_rejection:y.on_rejection||0,columns_allowed:y.columns_allowed||"",fields:[],idx:q})}),f++})):console.warn("No approver levels found in roadmap"),console.log("Final blockArr length:",v.length),console.log("Final workflowSetup:",z),me(`Workflow configured! ${Re.value.length} requestor role(s), ${we.value.length} approver level(s) across ${v.length} blocks.`),as(()=>{Ne.value=0})}catch(l){console.error("Error in handleWFRoadMapSelect:",l),x("Failed to load workflow. Please try again.")}}),Rl=s=>{console.log("Field added from library:",s);const e=Ne.value,l=v[e];if(!l){x("Please create a block first before adding fields");return}const o=Xt(s);if(!o)return;l.sections||(l.sections=[]),l.sections.length===0&&l.sections.push({label:"",rows:[[{label:"",fields:[]}]]});const u=l.sections[0].rows[0][0];u.fields||(u.fields=[]),u.fields.push(o),console.log("Field added successfully:",o),me(`${o.label} field added successfully`)},Tl=s=>{console.log("Drag started:",s),ye.value=s},Ul=()=>{console.log("Drag ended")},Xt=s=>{console.log("Creating field from Frappe type:",s);const e=ct.find(i=>i.type===s);if(!e)return console.error("Field type not found:",s),console.error("Available types:",ct.map(i=>i.type)),x(`Field type "${s}" not found. Please try again.`),null;const l=Date.now(),o=Math.random().toString(36).substring(2,6),a=`field_${l}_${o}`;return{id:`field_${l}_${o}`,fieldname:a,label:e.label,fieldtype:e.type,options:"",reqd:0,read_only:0,hidden:0,description:"",default:"",placeholder:""}};return(s,e)=>(n(),r("div",null,[t("div",lo,[t("div",oo,[t("div",ao,[t("div",no,[t("div",{class:"ps-1 my-2 d-flex align-items-center",onClick:e[0]||(e[0]=l=>rl())},e[46]||(e[46]=[t("button",{class:"btn font-13 ms-3"},[t("i",{class:"bi bi-arrow-left"}),t("span",{class:"ms-2"},"Back")],-1)])),s.$route.query.id||s.$route.query.preId?(n(),r("span",io,"("+g(I.value.formId||S(F).query.form_name)+")",1)):b("",!0)]),t("div",null,[$.value===2&&S(v).length&&!s.$route.query.id?(n(),r("button",{key:0,disabled:$t.value||Ge.value,style:Hl({cursor:$t.value?"not-allowed":"pointer"}),type:"butoon",class:"btn font-13 btn-light",onClick:e[1]||(e[1]=l=>Zt("Draft"))},e[47]||(e[47]=[t("i",{class:"bi bi-bookmark-check-fill"},null,-1),h(" Save As Draft ")]),12,ro)):b("",!0)])]),t("div",uo,[t("div",co,[t("div",po,[t("div",mo,[t("ul",fo,[(n(!0),r(E,null,L(Zs.value,l=>(n(),r("li",{key:l.id,class:U({active:$.value===l.id,completed:$.value>l.id})},[t("div",{class:U(["d-flex gap-3 align-items-center",{"not-allowed":Ge.value&&$.value+1===l.id}]),onClick:o=>ul(l.id)},[$.value>l.id?(n(),r("i",bo)):(n(),r("i",{key:1,class:U(l.icon)},null,2)),t("div",_o,[t("span",ho,g(l.stepno),1),e[48]||(e[48]=t("br",null,null,-1)),t("span",go,g(l.label),1)])],10,vo)],2))),128))])])]),t("div",yo,[t("div",wo,[t("div",ko,[$.value===1?(n(),r("div",Co,[t("div",Do,[e[55]||(e[55]=t("div",{class:"toolbar-left"},[t("h1",{class:"font-14 fw-bold m-0"},"Form Information")],-1)),t("div",Fo,[t("button",{class:U(["zoho-tab",{active:ae.value===0}]),onClick:e[2]||(e[2]=l=>ae.value=0)},e[49]||(e[49]=[t("i",{class:"bi bi-file-earmark-text me-1"},null,-1),h(" Basic Details ")]),2),t("button",{class:U(["zoho-tab",{active:ae.value===1}]),onClick:e[3]||(e[3]=l=>ae.value=1)},e[50]||(e[50]=[t("i",{class:"bi bi-building me-1"},null,-1),h(" Permissions ")]),2),t("button",{class:U(["zoho-tab",{active:ae.value===2}]),onClick:e[4]||(e[4]=l=>ae.value=2)},e[51]||(e[51]=[t("i",{class:"bi bi-gear me-1"},null,-1),h(" Settings ")]),2),m.value.as_web_view===1||S(F).query.preId?(n(),r("button",{key:0,class:U(["zoho-tab",{active:ae.value===3}]),onClick:e[5]||(e[5]=l=>ae.value=3)},e[52]||(e[52]=[t("i",{class:"bi bi-sliders me-1"},null,-1),h(" Advanced ")]),2)):b("",!0)]),t("div",$o,[!s.$route.query.id&&!s.$route.query.preId?(n(),r("button",{key:0,class:"btn btn-sm btn-outline-secondary me-2",type:"button",onClick:dl},e[53]||(e[53]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),h("Clear ")]))):b("",!0),$.value<5?(n(),r("button",{key:1,class:"btn btn-sm btn-dark",disabled:Ge.value,onClick:kt},e[54]||(e[54]=[h(" Next "),t("i",{class:"bi bi-arrow-right ms-1"},null,-1)]),8,So)):b("",!0)])]),t("div",qo,[D(t("div",null,[t("div",Ao,[t("div",Vo,[t("div",Eo,[S(F).query.preId?(n(),r("span",Lo,e[56]||(e[56]=[t("i",{class:"bi bi-check2-circle me-1"},null,-1),h("Predefined ")]))):b("",!0),X(et,{disabled:(I.value.formId&&I.value.formId.length>0||S(F).query.form_name)&&De.value!=="1",labeltext:"Form Name",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formName",validationStar:"true",placeholder:"Enter form name (e.g., Leave Request)",onChange:e[6]||(e[6]=l=>Gt(l,"form_name")),modelValue:Ut.value,"onUpdate:modelValue":e[7]||(e[7]=l=>Ut.value=l)},null,8,["disabled","modelValue"]),Y.value?(n(),r("span",Ro,[e[57]||(e[57]=t("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),h(g(Y.value),1)])):b("",!0)])]),t("div",To,[X(et,{disabled:(I.value.formId&&I.value.formId.length>0||S(F).query.form_name)&&De.value!=="1",labeltext:"Form Short Code",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formShortCode",validationStar:"true",placeholder:"Enter short code (e.g., LR, PR)",onChange:e[8]||(e[8]=l=>Gt(l,"form_short_name")),modelValue:m.value.form_short_name,"onUpdate:modelValue":e[9]||(e[9]=l=>m.value.form_short_name=l)},null,8,["disabled","modelValue"]),J.value?(n(),r("span",Uo,[e[58]||(e[58]=t("i",{class:"bi bi-exclamation-circle me-1"},null,-1)),h(g(J.value),1)])):b("",!0)]),t("div",Mo,[X(et,{disabled:I.value.formId&&I.value.formId.length>0&&De.value!=="1",labeltext:"Form Naming Series",class:"formHeight",type:"text",tag:"input",name:"Value",id:"formNameSeries",placeholder:"e.g., YY-YY, YYYY, or ABC",modelValue:m.value.series,"onUpdate:modelValue":e[10]||(e[10]=l=>m.value.series=l)},null,8,["disabled","modelValue"]),e[59]||(e[59]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h(" Format examples: "),t("code",null,"YY-YY"),h(" → 24-25-0001, "),t("code",null,"YYYY"),h(" → 2025-0001, "),t("code",null,"ABC"),h(" → ABC-0001 ")],-1))])])],512),[[ge,ae.value===0]]),D(t("div",null,[t("div",Oo,[t("div",zo,[t("label",Bo,[e[60]||(e[60]=h(" Owner Department ")),m.value.owner_of_the_form?b("",!0):(n(),r("span",Po,"*"))]),X(S(Se),{disabled:I.value.formId&&I.value.formId.length>0&&De.value!=="1",onOpen:Wt,options:Ve.value,onChange:Dt,modelValue:m.value.owner_of_the_form,"onUpdate:modelValue":e[11]||(e[11]=l=>m.value.owner_of_the_form=l),placeholder:"Select owning department",multiple:!1,class:"font-12 multiselect",searchable:!0,openDirection:"bottom"},null,8,["disabled","options","modelValue"]),e[61]||(e[61]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h("Department that owns and manages this form ")],-1))]),t("div",No,[t("label",jo,[e[62]||(e[62]=h(" Form Category ")),m.value.form_category?b("",!0):(n(),r("span",Wo,"*"))]),X(S(Se),{disabled:I.value.formId&&I.value.formId.length>0&&De.value!=="1",options:ie.value,modelValue:m.value.form_category,"onUpdate:modelValue":e[12]||(e[12]=l=>m.value.form_category=l),placeholder:"Select a category",multiple:!1,searchable:!0,class:"font-12 multiselect"},null,8,["disabled","options","modelValue"]),e[63]||(e[63]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h("Categorize this form for better organization ")],-1))]),t("div",Ho,[t("label",Yo,[e[64]||(e[64]=h(" Accessible to Departments ")),m.value.accessible_departments.length?b("",!0):(n(),r("span",Jo,"*"))]),X(S(Se),{modelValue:m.value.accessible_departments,"onUpdate:modelValue":e[14]||(e[14]=l=>m.value.accessible_departments=l),options:Ks.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Select departments that can access this form",class:"font-12",onSelect:Is,onRemove:el,openDirection:"bottom"},{option:ss(({option:l})=>[t("div",Go,[t("input",{type:"checkbox",checked:Xs(l),class:"custom-checkbox",onChange:o=>xs(l,o),onClick:e[13]||(e[13]=ue(()=>{},["stop"]))},null,40,Zo),t("span",null,g(l),1)])]),selection:ss(({values:l,isOpen:o})=>[l.length?D((n(),r("span",{key:0,class:"multiselect__single font-11"},g(Qs.value),513)),[[ge,!o]]):b("",!0)]),_:1},8,["modelValue","options"]),e[65]||(e[65]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h("Users from these departments can raise requests using this form ")],-1))])])],512),[[ge,ae.value===1]]),D(t("div",null,[t("div",Ko,[t("div",Qo,[e[67]||(e[67]=t("label",{class:"form-label font-13 fw-medium"},"Form Type",-1)),X(S(Se),{options:Tt,modelValue:bt.value,"onUpdate:modelValue":e[15]||(e[15]=l=>bt.value=l),placeholder:"Select form visibility",multiple:!1,searchable:!0,label:"label","track-by":"value",reduce:l=>l.value,class:"font-12 multiselect",openDirection:"bottom"},null,8,["modelValue","reduce"]),t("small",Xo,[e[66]||(e[66]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),bt.value===1?(n(),r("span",xo,"Public forms are accessible via QR code without login")):(n(),r("span",Io,"Private forms require authentication to access"))])]),t("div",ea,[e[68]||(e[68]=t("label",{class:"form-label font-13 fw-medium"},[h(" Enable Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(S(Se),{options:["Yes","No"],modelValue:m.value.has_workflow,"onUpdate:modelValue":e[16]||(e[16]=l=>m.value.has_workflow=l),placeholder:"Enable approval workflow?",multiple:!1,class:"font-12 multiselect",searchable:!0},null,8,["modelValue"]),e[69]||(e[69]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h("Enable if this form requires multi-level approvals ")],-1))]),m.value.has_workflow==="Yes"?(n(),r("div",ta,[e[70]||(e[70]=t("label",{class:"form-label font-13 fw-medium"},[h(" Use Existing Workflow "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(S(Se),{onOpen:Kt,options:je.value,modelValue:fe.value,"onUpdate:modelValue":e[17]||(e[17]=l=>fe.value=l),placeholder:"Select a workflow roadmap",multiple:!1,class:"font-12 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:Qt,openDirection:"bottom"},null,8,["options","modelValue"]),e[71]||(e[71]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h(" Auto-populates requestor and approver configurations from existing workflow ")],-1))])):b("",!0)])],512),[[ge,ae.value===2]]),D(t("div",null,[t("div",sa,[m.value.as_web_view===1?(n(),r("div",la,e[72]||(e[72]=[t("h6",{class:"fw-bold font-14 mb-3"},[t("i",{class:"bi bi-qr-code me-2"}),h("Public Form Settings")],-1)]))):b("",!0),t("div",oa,[e[73]||(e[73]=t("label",{class:"form-label font-13 fw-medium"},[h(" Submit Response Message "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(et,{class:"formHeight",type:"text",tag:"input",name:"Value",id:"formSubmitResponse",placeholder:"e.g., Thank you! Your request has been submitted.",modelValue:m.value.public_form_response,"onUpdate:modelValue":e[18]||(e[18]=l=>m.value.public_form_response=l)},null,8,["modelValue"]),e[74]||(e[74]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h("Message shown to users after successful form submission ")],-1))]),t("div",aa,[e[75]||(e[75]=t("label",{class:"form-label font-13 fw-medium"},[h(" Notification Email(s) "),t("span",{class:"fw-normal font-11 text-secondary"},"(optional)")],-1)),X(et,{class:"formHeight",type:"text",tag:"input",name:"Value",id:"formSubmitEmail",placeholder:"email1@example.com, email2@example.com",modelValue:m.value.mail_id,"onUpdate:modelValue":e[19]||(e[19]=l=>m.value.mail_id=l)},null,8,["modelValue"]),e[76]||(e[76]=t("small",{class:"text-muted font-11 ms-1"},[t("i",{class:"bi bi-info-circle me-1"}),h("Email addresses to notify on form submission (comma-separated) ")],-1))]),S(F).query.preId?(n(),r("div",na,e[77]||(e[77]=[t("h6",{class:"fw-bold font-14 mb-3 mt-4"},[t("i",{class:"bi bi-link-45deg me-2"}),h("Form Linking")],-1)]))):b("",!0),t("div",ia,[t("div",ra,[D(t("input",{class:"form-check-input",disabled:m.value.is_predefined_doctype==1,type:"checkbox",id:"is_linked","onUpdate:modelValue":e[20]||(e[20]=l=>m.value.is_linked=l),"true-value":1,"false-value":0},null,8,da),[[qe,m.value.is_linked]]),e[78]||(e[78]=t("label",{class:"form-check-label font-13",for:"is_linked"}," Link this form to another form ",-1))]),e[79]||(e[79]=t("small",{class:"text-muted font-11 ms-4"},[t("i",{class:"bi bi-info-circle me-1"}),h("Create a relationship between this form and an existing form ")],-1))]),m.value.is_linked?(n(),r("div",ua,[e[80]||(e[80]=t("label",{class:"form-label font-13 fw-medium"},"Linked Form",-1)),t("div",ca,[D(t("input",{type:"text",class:"form-control font-13",id:"standardFormInput",disabled:m.value.is_predefined_doctype==1,"onUpdate:modelValue":e[21]||(e[21]=l=>m.value.is_linked_form=l),placeholder:"Type to search and select a form...",onInput:vs,onFocus:e[22]||(e[22]=l=>ot.value=!0),onBlur:_s},null,40,pa),[[O,m.value.is_linked_form]]),ot.value&&lt.value.length?(n(),r("ul",ma,[(n(!0),r(E,null,L(lt.value,(l,o)=>(n(),r("li",{class:"list-group-item list-group-item-action font-12",key:o,onMousedown:ue(a=>bs(l.name),["prevent"]),style:{cursor:"pointer"}},g(l.name),41,fa))),128))])):b("",!0)])])):b("",!0)])],512),[[ge,ae.value===3]])])])):b("",!0),$.value===2?(n(),r("div",va,[t("div",ba,[t("div",_a,[t("button",{onClick:e[23]||(e[23]=l=>Ct()),class:"btn btn-sm btn-light"},e[81]||(e[81]=[t("i",{class:"bi bi-chevron-left"},null,-1),h(" Back ")]))]),t("div",ha,[(n(!0),r(E,null,L(S(v),(l,o)=>(n(),r("button",{key:o,class:U(["zoho-tab",{active:Ne.value===o}]),onClick:a=>Ne.value=o},[e[82]||(e[82]=t("i",{class:"bi bi-file-earmark-text me-1"},null,-1)),h(" "+g(o===0?"Requestor Block":`Approver Block ${o}`)+" ",1),S(v).length>1?(n(),r("i",{key:0,class:"bi bi-x-lg ms-2",onClick:ue(a=>Jt(o),["stop"])},null,8,ya)):b("",!0)],10,ga))),128))]),t("div",wa,[t("button",{class:"btn btn-sm btn-primary me-2",onClick:Ht},e[83]||(e[83]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),h("Add Block ")])),$l.value?(n(),r("button",{key:0,class:"btn btn-sm btn-light me-2",onClick:ql},e[84]||(e[84]=[t("i",{class:"bi bi-eye me-1"},null,-1),h("Preview ")]))):b("",!0),S(v).length?(n(),r("button",{key:1,class:"btn btn-sm btn-dark",onClick:e[24]||(e[24]=l=>Zt("save"))},g(S(T)!=="new"?"Update Form":"Create Form"),1)):b("",!0)])]),t("div",ka,[t("aside",{class:U(["zoho-field-library",{collapsed:!Le.value}])},[t("div",{class:"library-header",onClick:e[25]||(e[25]=l=>Le.value=!Le.value)},[t("div",Ca,[t("h6",Da,[e[85]||(e[85]=t("i",{class:"bi bi-grid-3x3-gap me-2"},null,-1)),h(" "+g(Le.value?"Field Types":"Fields"),1)]),t("button",Fa,[t("i",{class:U(Le.value?"bi bi-chevron-left":"bi bi-chevron-right")},null,2)])])]),Le.value?(n(),r("div",$a,[X(so,{fields:ct,onFieldAdd:Rl,onFieldDragstart:Tl,onFieldDragend:Ul})])):b("",!0)],2),t("div",Sa,[t("div",{class:"canvas-inner",ref_key:"mainBlockRef",ref:pt},[(n(!0),r(E,null,L(S(v),(l,o)=>D((n(),r("div",{class:"block-level",key:o},[t("div",qa,[t("div",Aa,[t("div",Va,[t("h6",Ea,g(o===0?"Requestor Block":`Approver
                                  Block ${o}
                                  `),1),t("div",La,[o!==0&&B(o).view_only_reportee||B(o).all_approvals_required||B(o).requester_as_a_approver?(n(),r("div",Ra,[t("span",Ta,g(B(o).view_only_reportee===1?"Reporting Manager only":"")+" "+g(B(o).all_approvals_required===1?"All of the selected approvers":"")+" "+g(B(o).requester_as_a_approver===1?"Approval by Requestor":""),1),t("span",null,[e[86]||(e[86]=t("span",{class:"ms-1"}," on rejection escalating to ",-1)),t("span",Ua,g(B(o).on_rejection?`Level ${B(o).on_rejection}`:"Requestor"),1)]),t("span",Ma,g(B(o).all_approvals_required===1?"":"(Skipping multi approval)"),1)])):b("",!0)])]),t("div",Oa,[S(T)&&S(z).length?(n(),r("div",za,[B(o)?(n(),r("label",Ba,[t("span",Pa,g(B(o).roles.length>0?o===0?"Requestor Roles: ":"Approver Roles: ":""),1),t("span",Na,g(B(o).roles.slice(0,2).join(", ")),1),B(o).roles.length>2?(n(),r("span",{key:0,"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:a=>wt(o),class:"more-count badge bg-primary ms-2",style:{cursor:"pointer"}}," +"+g(B(o).roles.length-2)+" more ",9,ja)):b("",!0)])):b("",!0)])):b("",!0),ms(o)&&S(T)!=null&&S(T)!=null&&S(T)!="new"&&B(o).roles.length===0?(n(),r("button",{key:1,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:a=>wt(o)},[e[87]||(e[87]=t("img",{src:Ql,alt:"Add",class:"me-1"},null,-1)),h(" "+g(o===0?"Add Requestors":"Add Approvers"),1)],8,Wa)):b("",!0),S(T)!=null&&S(T)!=null&&S(T)!="new"&&B(o).roles.length>0?(n(),r("button",{key:2,class:"btn btn-light designationBtn d-flex align-items-center",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",onClick:a=>wt(o)},e[88]||(e[88]=[t("i",{class:"bi bi-pencil font-14"},null,-1)]),8,Ha)):b("",!0),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteBlock",onClick:a=>Jt(o)},e[89]||(e[89]=[t("i",{class:"bi bi-trash me-1"},null,-1),h(" Delete Block ")]),8,Ya)])])]),t("div",Ja,[(n(!0),r(E,null,L(l.sections,(a,i)=>(n(),r("div",{key:"section-"+i,class:"dynamicSection mt-0 section"},[t("section",Ga,[t("div",Za,[D(t("input",{"onUpdate:modelValue":u=>a.label=u,type:"text",class:U(["border-less-input","font-14",{"italic-style":!a.label},{"fw-medium":a.label}]),onChange:u=>pe(o,i),onInput:u=>pe(o,i),placeholder:"Untitled section"},null,42,Ka),[[O,a.label]]),a.errorMsg?(n(),r("small",Qa,g(a.errorMsg),1)):b("",!0)]),t("div",Xa,[t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:u=>bl(o,i)},e[90]||(e[90]=[t("i",{class:"bi bi-trash me-1"},null,-1),h(" Delete Section ")]),8,xa)])]),t("div",Ia,[(n(!0),r(E,null,L(a.rows,(u,c)=>(n(),r("section",{class:"row dynamicRow row-container",key:"row-"+c},[t("div",en,[t("label",tn,g(Sl(c)),1),t("div",null,[u.columns.length<3?(n(),r("button",{key:0,class:"btn btn-light bg-transparent border-0 p-1 font-12",onClick:f=>_l(o,i,c)},e[91]||(e[91]=[t("i",{class:"bi bi-plus font-14"},null,-1),h(" Add Column ")]),8,sn)):b("",!0)])]),t("div",ln,[t("div",on,[(n(!0),r(E,null,L(u.columns,(f,d)=>(n(),r("div",{key:"column-"+d,onMouseenter:p=>Fs(o,i,c,d),onMouseleave:$s,class:"col p-0 dynamicColumn position-relative column-container"},[t("div",nn,[t("div",rn,[D(t("input",{"onUpdate:modelValue":p=>f.label=p,type:"text",class:U(["border-less-input","ps-1","font-14","inputHeight",{"italic-style":!f.label},{"fw-medium":f.label}]),onChange:p=>pe(o,i,c,d),onInput:p=>pe(o,i,c,d),placeholder:"Column Name"},null,42,dn),[[O,f.label]]),f.errorMsg?(n(),r("small",un,g(f.errorMsg),1)):b("",!0)]),D(t("div",cn,[t("button",{class:"btn btn-light bg-transparent me-1 btn-sm",onClick:p=>hl(o,i,c,d)},e[92]||(e[92]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,pn)],512),[[ge,Ss(o,i,c,d)]])]),f.fields.length===0?(n(),r("div",{key:0,class:"empty-drop-zone",onDragover:e[26]||(e[26]=ue(()=>{},["prevent"])),onDrop:p=>ke(p,o,i,c,d,s.fieldIndex)},null,40,mn)):b("",!0),(n(!0),r(E,null,L(f.fields,(p,w)=>{var q;return n(),r("div",{key:"field-"+w,onMouseenter:y=>ks(o,i,c,d,w),onMouseleave:Cs,class:"dynamicField m-1 draggable-item",draggable:"true",onDragstart:y=>Ot(y,o,i,c,d,w),onDragover:e[30]||(e[30]=ue(()=>{},["prevent"])),onDrop:y=>ke(y,o,i,c,d,w)},[t("div",{class:"drop-zone",onDragover:e[27]||(e[27]=ue(()=>{},["prevent"])),onDrop:y=>ke(y,o,i,c,d,w)},null,40,vn),p.fieldtype!=="Table"?(n(),r("div",{key:0,class:"px-1 dynamic_fied field-border",draggable:"true",onDragstart:y=>Ot(y,o,i,c,d,w),onDragover:e[28]||(e[28]=ue(()=>{},["prevent"])),onDrop:y=>ke(y,o,i,c,d,w)},[t("div",_n,[t("div",hn,[D(t("input",{"onUpdate:modelValue":y=>p.label=y,placeholder:"Name the field",class:U(["border-less-input","font-14","p-0","inputHeight",{"italic-style":!p.label},{"fw-medium":p.label}]),onChange:y=>pe(o,i,c,d,w),onInput:y=>pe(o,i,c,d,w)},null,42,gn),[[O,p.label]]),p.errorMsg?(n(),r("small",yn,g(p.errorMsg),1)):b("",!0)]),D(t("div",wn,[t("button",{class:"btn btn-light btn-sm bg-transparent py-0",onClick:y=>wl(o,i,c,d,w)},e[93]||(e[93]=[t("i",{class:"ri-file-copy-line font-13 copyIcon"},null,-1)]),8,kn),t("button",{class:"btn btn-light btn-sm bg-transparent trash-btn py-0",onClick:y=>{yl(o,i,c,d,w),pe(o,i,c,d)}},e[94]||(e[94]=[t("i",{class:"bi bi-x-lg font-13"},null,-1)]),8,Cn)],512),[[ge,Ds(o,i,c,d,w)]])]),D(t("select",{"onUpdate:modelValue":y=>p.fieldtype=y,class:"form-select mb-2 mt-1 font-13 searchSelect",onChange:y=>kl(o,i,c,d,w)},[e[95]||(e[95]=t("option",{value:""},"Select Type",-1)),(n(),r(E,null,L(ct,y=>t("option",{key:y,value:y.type},g(y.label),9,Fn)),64))],40,Dn),[[Be,p.fieldtype]]),["Select","Table MultiSelect","Small Text"].includes(p.fieldtype)?(n(),r("div",$n,[e[96]||(e[96]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":y=>p.options=y,class:"form-control shadow-none mb-1 font-12"},null,8,Sn),[[O,p.options]]),!p.options||p.options.trim()===""?(n(),r("small",qn," Options are required for this field type. ")):b("",!0)])):b("",!0),p.fieldtype==="Link"?(n(),r("div",An,[t("label",{class:"font-11 fw-light",for:"link-search-"+be(o,i,c,d,w)}," Search Doctype: ",8,Vn),D(t("input",{id:"link-search-"+be(o,i,c,d,w),type:"text","onUpdate:modelValue":y=>S(v)[o].sections[i].rows[c].columns[d].fields[w].options=y,onInput:y=>gs(S(v)[o].sections[i].rows[c].columns[d].fields[w].options,o,i,c,d,w),onFocus:y=>hs(be(o,i,c,d,w)),class:"form-control font-12 mb-1",placeholder:"Type to search..."},null,40,En),[[O,S(v)[o].sections[i].rows[c].columns[d].fields[w].options]]),(q=He[be(o,i,c,d,w)])!=null&&q.length&&_t[be(o,i,c,d,w)]?(n(),r("ul",Ln,[(n(!0),r(E,null,L(He[be(o,i,c,d,w)],(y,k)=>(n(),r("li",{key:k,onClick:C=>ys(o,i,c,d,w,y.name),class:"list-group-item list-group-item-action"},g(y.name),9,Rn))),128))])):b("",!0)])):b("",!0),t("div",Tn,[t("div",Un,[t("div",Mn,[D(t("input",{class:"font-12","onUpdate:modelValue":y=>p.reqd=y,"true-value":1,id:"mandatory-"+o+"-"+i+"-"+c+"-"+d+"-"+w,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,8,On),[[qe,p.reqd]])]),t("div",null,[t("label",{class:"font-12 m-0 fw-light",for:"mandatory-"+o+"-"+i+"-"+c+"-"+d+"-"+w},"Mandatory",8,zn)])]),t("div",null,[t("button",{class:"btn btn-sm font-12",onClick:y=>p.showDescription=!p.showDescription},g(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Bn)])]),p.showDescription?D((n(),r("textarea",{key:2,"onUpdate:modelValue":y=>p.description=y,class:"form-control font-12 mt-2",placeholder:"Enter field description"},null,8,Pn)),[[O,p.description]]):b("",!0),p.error?(n(),r("small",Nn,g(p.error),1)):b("",!0)],40,bn)):b("",!0),t("div",{class:"drop-zone",onDragover:e[29]||(e[29]=ue(()=>{},["prevent"])),onDrop:y=>ke(y,o,i,c,d,w)},null,40,jn),t("div",Wn,[t("div",null,[t("div",null,[t("div",Hn,[p.fieldtype==="Table"?(n(),r("div",Yn,[(n(!0),r(E,null,L(se.value,(y,k)=>(n(),r("div",{key:k,class:"childTable"},[k===p.fieldname||k===p.options?(n(),r("h5",Jn,g(k.replace(/_/g," ")),1)):b("",!0),W[k]&&k===Pt.value?(n(),r("div",Gn,[t("div",Zn,[p.showDescription?D((n(),r("input",{key:0,"onUpdate:modelValue":C=>p.description=C,class:"form-control font-12",placeholder:"Enter field description"},null,8,Kn)),[[O,p.description]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:C=>p.showDescription=!p.showDescription},g(p.showDescription?"Hide Description":p.description?"Edit Description":"Add Description"),9,Qn)])])):b("",!0),k===p.options||k===p.fieldname?(n(),r("table",Xn,[e[100]||(e[100]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",{onDragover:ue(Vs,["prevent"]),onDrop:C=>Es(C,y)},[(n(!0),r(E,null,L(y,(C,Z)=>{var Ze,Ke,Qe,Xe,xe,Ie,Q;return n(),r("tr",{key:Z,draggable:W[k],onDragstart:H=>qs(Z),onDragend:As,class:U({dragging:Fe.value===Z})},[t("td",null,g(Z+1),1),W[k]?(n(),r("td",ei,[D(t("input",{"onUpdate:modelValue":H=>C.label=H,onInput:H=>ut(C,k,Z),placeholder:"Field Label",class:U(["form-control",{"border-1 border-danger":(Ke=(Ze=A[k])==null?void 0:Ze[Z])==null?void 0:Ke.length}])},null,42,ti),[[O,C.label]]),(Xe=(Qe=A[k])==null?void 0:Qe[Z])!=null&&Xe.length?(n(),r("div",si,[(n(!0),r(E,null,L(A[k][Z],(H,Ml)=>(n(),r("div",{key:Ml},g(H),1))),128))])):b("",!0)])):(n(),r("td",li,g(C.label),1)),W[k]?(n(),r("td",oi,[t("div",ai,[D(t("select",{"onUpdate:modelValue":H=>C.fieldtype=H,onChange:H=>ut(C,k,Z),class:U(["form-select form-select-sm",{"border-1 border-danger":(Ie=(xe=A[k])==null?void 0:xe[Z])==null?void 0:Ie.length}])},[e[97]||(e[97]=t("option",{value:""},"Select Type",-1)),(n(),r(E,null,L(gt,H=>t("option",{key:H.type,value:H.type},g(H.label),9,ii)),64))],42,ni),[[Be,C.fieldtype]]),t("div",ri,[t("div",di,[t("div",ui,[D(t("input",{class:"font-12 form-control-sm","onUpdate:modelValue":H=>C.description=H,placeholder:"description",type:"text"},null,8,ci),[[O,C.description]])])]),t("button",{class:"btn btn-light btn-sm",onClick:H=>Js(k,Z)},e[98]||(e[98]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,pi)])]),["Select"].includes(C.fieldtype)?(n(),r("div",mi,[e[99]||(e[99]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":H=>C.options=H,onInput:H=>ut(C,k,Z),class:"form-control shadow-none mb-1 font-12"},null,40,fi),[[O,C.options]]),!C.options||C.options.trim()===""?(n(),r("small",vi," Options are required for this field type. ")):b("",!0)])):b("",!0),(Q=G[k])!=null&&Q.includes(Z)?(n(),r("span",bi,"Type required**")):b("",!0)])):(n(),r("td",_i,g(C.fieldtype),1))],42,In)}),128))],40,xn)])):b("",!0),p.fieldtype==="Table"&&(p.label===k||p.fieldname===k)?(n(),r("div",hi,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:C=>Gs(k,p.description)},g(W[k]?"Save":"Edit"),9,gi),W[k]?(n(),r("button",{key:0,class:"btn btn-light btn-sm",onClick:C=>Ys(k)}," Add More Field ",8,yi)):b("",!0)])):b("",!0)]))),128))])):b("",!0)])])])])],40,fn)}),128)),t("div",{class:"drop-zone-bottom",onDragover:e[31]||(e[31]=ue(()=>{},["prevent"])),onDrop:p=>ke(p,o,i,c,d,f.fields.length),style:{"background-color":"#f0f0f0",border:"1px dashed #ccc",margin:"4px"}},null,40,wi),t("div",{class:"drop-zone",onDragover:e[32]||(e[32]=ue(()=>{},["prevent"])),onDrop:p=>ke(p,o,i,c,d,s.fields.length),style:{height:"10px","background-color":"transparent"}},null,40,ki),t("div",Ci,[t("button",{class:"btn btn-light btn-sm d-flex align-items-center addField m-2",onClick:p=>gl(o,i,c,d)},e[101]||(e[101]=[t("i",{class:"bi bi-plus fs-5"},null,-1),t("span",null,"Add Field",-1)]),8,Di)])],40,an))),128))])])]))),128)),t("div",null,[(n(!0),r(E,null,L(a.afterCreated,(u,c)=>(n(),r("div",{key:c,class:"childTable dynamicColumn m-0 p-2"},[t("h5",Fi,g(u.tableName),1),W[u.tableName]?(n(),r("div",$i,[t("div",Si,[u.showDescription?D((n(),r("input",{key:0,"onUpdate:modelValue":f=>u.description=f,class:"form-control font-12",placeholder:"Enter field description"},null,8,qi)),[[O,u.description]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:f=>u.showDescription=!u.showDescription},g(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,Ai)])])):b("",!0),t("table",Vi,[e[107]||(e[107]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Label"),t("th",null,"Field Type")])],-1)),t("tbody",null,[(n(!0),r(E,null,L(u.columns,(f,d)=>{var p,w,q,y;return n(),r("tr",{key:d},[t("td",null,g(d+1),1),W[u.tableName]?(n(),r("td",Ei,[D(t("input",{"onUpdate:modelValue":k=>f.label=k,placeholder:"Field Label",class:U(["form-control",{"border-1 border-danger":(p=G[u.tableName])==null?void 0:p.includes(d)}]),onBlur:k=>{var C;f.label=(C=f.label)==null?void 0:C.trim(),Ye(f,u.tableName,d,u.columns)}},null,42,Li),[[O,f.label]]),(w=A[u.tableName])!=null&&w[d]?(n(),r("div",Ri,[(n(!0),r(E,null,L(A[u.tableName][d],(k,C)=>(n(),r("span",{key:C},[h(g(k)+" ",1),e[102]||(e[102]=t("br",null,null,-1))]))),128))])):b("",!0)])):(n(),r("td",Ti,g(f.label),1)),W[u.tableName]?(n(),r("td",Ui,[t("div",Mi,[D(t("select",{"onUpdate:modelValue":k=>f.fieldtype=k,class:U(["form-select form-select-sm",{"border-1 border-danger":(q=G[u.tableName])==null?void 0:q.includes(d)}]),onChange:k=>Ye(f,u.tableName,d,u.columns)},[e[103]||(e[103]=t("option",{value:""},"Select Type",-1)),(n(),r(E,null,L(gt,k=>t("option",{key:k.type,value:k.type},g(k.label),9,zi)),64))],42,Oi),[[Be,f.fieldtype]]),t("button",{class:"btn btn-light btn-sm",onClick:k=>Ws(o,i,u.tableName,d)},e[104]||(e[104]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,Bi)]),f.fieldtype==="Select"?(n(),r("div",Pi,[e[105]||(e[105]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":k=>f.options=k,class:"form-control shadow-none mb-1 font-12",onInput:k=>Ye(f,u.tableName,d,u.columns)},null,40,Ni),[[O,f.options]])])):b("",!0),(y=A[u.tableName])!=null&&y[d]?(n(),r("div",ji,[(n(!0),r(E,null,L(A[u.tableName][d],(k,C)=>(n(),r("span",{key:C},[h(g(k),1),e[106]||(e[106]=t("br",null,null,-1))]))),128))])):b("",!0)])):(n(),r("td",Wi,g(f.fieldtype),1))])}),128))])]),t("div",Hi,[t("button",{class:"btn btn-light btn-sm mx-2",onClick:f=>Hs(o,i,u.tableName)},g(W[u.tableName]?"Save":"Edit"),9,Yi),W[u.tableName]?(n(),r("button",{key:0,class:"btn btn-light btn-sm",onClick:f=>js(o,i,u.tableName)}," Add More Field ",8,Ji)):b("",!0)])]))),128))])]),t("div",null,[t("div",null,[o==0?(n(),r("button",{key:0,class:"btn btn-light addRow mb-3 mt-4",onClick:u=>Rs(o,i)}," Add New Table ",8,Gi)):b("",!0),(n(!0),r(E,null,L(a.childTables,(u,c)=>{var f;return n(),r("div",{key:`table-${o}-${i}-${c}`,class:"child-table"},[u.newTable?(n(),r("div",Zi,[t("div",Ki,[t("div",null,[t("span",{class:U(u.tableName?"d-none":"text-danger")},"*",2),D(t("input",{"onUpdate:modelValue":d=>u.tableName=d,placeholder:"Table Name",onBlur:d=>zt(u),class:U(["border-less-input font-14 p-0 inputHeight",{"italic-style":!u.tableName,"fw-medium":u.tableName}])},null,42,Qi),[[O,u.tableName]]),(f=A[`${o}-${i}-${c}`])!=null&&f.tableName?(n(),r("div",Xi,g(A[`${o}-${i}-${c}`].tableName),1)):b("",!0),Oe.value?(n(),r("div",xi,g(Oe.value),1)):b("",!0),t("div",Ii,[t("div",er,[u.showDescription?D((n(),r("input",{key:0,"onUpdate:modelValue":d=>u.as_a_block=d,class:"form-control font-12",placeholder:"Enter field description"},null,8,tr)),[[O,u.as_a_block]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:d=>u.showDescription=!u.showDescription},g(u.showDescription?"Hide Description":u.description?"Edit Description":"Add Description"),9,sr)])])]),t("button",{class:"btn btn-light bg-transparent border-0 font-13 deleteSection",onClick:d=>Us(o,i,c)},e[108]||(e[108]=[t("i",{class:"bi bi-trash"},null,-1),h(" Remove Table ")]),8,lr)]),(n(!0),r(E,null,L(u.columns,(d,p)=>{var w,q,y,k,C,Z,Ze,Ke,Qe,Xe,xe,Ie;return n(),r("div",{key:p,class:"dynamicField"},[t("div",or,[t("div",ar,[t("div",null,[t("span",{class:U(d.label?"d-none":"text-danger")},"*",2),D(t("input",{"onUpdate:modelValue":Q=>d.label=Q,placeholder:"Name the field",onBlur:()=>{zt(d),Os(d,o,i,c,p,u.columns)},class:U(["border-less-input font-14 p-0 inputHeight",{"italic-style":!d.label,"fw-medium":d.label,"is-invalid":(y=(q=(w=A[`${o}-${i}-${c}`])==null?void 0:w.columns)==null?void 0:q[p])==null?void 0:y.label}])},null,42,nr),[[O,d.label]]),(Z=(C=(k=A[`${o}-${i}-${c}`])==null?void 0:k.columns)==null?void 0:C[p])!=null&&Z.label?(n(),r("div",ir,g(A[`${o}-${i}-${c}`].columns[p].label),1)):b("",!0)]),t("div",rr,[t("div",dr,[d.showDescription?D((n(),r("input",{key:0,"onUpdate:modelValue":Q=>d.description=Q,class:"form-control font-12",placeholder:"Enter field description"},null,8,ur)),[[O,d.description]]):b("",!0),t("button",{class:"btn btn-sm text-nowrap font-12",onClick:Q=>d.showDescription=!d.showDescription},g(d.showDescription?"Hide Description":d.description?"Edit Description":"Add Description"),9,cr)]),t("button",{class:"btn btn-sm trash-btn py-0",onClick:Q=>Ms(o,i,c,p)},e[109]||(e[109]=[t("i",{class:"bi bi-x-lg"},null,-1)]),8,pr)])]),D(t("select",{"onUpdate:modelValue":Q=>d.fieldtype=Q,class:U(["form-select font-13 mb-1",{"is-invalid":(Qe=(Ke=(Ze=A[`${o}-${i}-${c}`])==null?void 0:Ze.columns)==null?void 0:Ke[p])==null?void 0:Qe.fieldtype}])},[e[110]||(e[110]=t("option",{value:""},"Select Type",-1)),(n(),r(E,null,L(gt,Q=>t("option",{key:Q.type,value:Q.type},g(Q.label),9,fr)),64))],10,mr),[[Be,d.fieldtype]]),["Select"].includes(d.fieldtype)?(n(),r("div",vr,[e[111]||(e[111]=t("label",{class:"font-12 fw-light",for:"options"},"Enter Options:",-1)),D(t("textarea",{id:"options",placeholder:"Enter your Options","onUpdate:modelValue":Q=>d.options=Q,class:"form-control shadow-none mb-1 font-12"},null,8,br),[[O,d.options]]),!d.options||d.options.trim()===""?(n(),r("small",_r," Options are required for this field type. ")):b("",!0)])):b("",!0),(Ie=(xe=(Xe=A[`${o}-${i}-${c}`])==null?void 0:Xe.columns)==null?void 0:xe[p])!=null&&Ie.fieldtype?(n(),r("div",hr,g(A[`${o}-${i}-${c}`].columns[p].fieldtype),1)):b("",!0)])])}),128)),t("button",{class:"btn btn-light btn-sm addField mx-1",onClick:d=>Ts(o,i,c)},e[112]||(e[112]=[t("i",{class:"bi bi-plus"},null,-1),h(" Add Field ")]),8,gr),t("button",{class:"btn btn-dark btn-sm font-12 mx-1",onClick:d=>Ns(o,i,c)}," Create Table ",8,yr),e[113]||(e[113]=t("hr",null,null,-1))])):b("",!0)])}),128))])]),t("div",wr,[t("button",{class:"btn btn-light border font-12",onClick:u=>vl(o,i)},e[114]||(e[114]=[t("i",{class:"bi bi-plus-circle me-1 fs-6"},null,-1),h(" Add Section ")]),8,kr)])]))),128)),o===0?(n(),r("div",Cr)):b("",!0)])])),[[ge,o===Ne.value]])),128))],512)]),Vt.value?(n(),r("aside",Dr,[t("div",Fr,[e[116]||(e[116]=t("h6",{class:"mb-0"},"Field Properties",-1)),t("button",{class:"btn btn-sm btn-link p-0",onClick:e[33]||(e[33]=l=>Vt.value=null)},e[115]||(e[115]=[t("i",{class:"bi bi-x-lg"},null,-1)]))]),e[117]||(e[117]=t("div",{class:"properties-content"},[t("p",{class:"text-muted small"},"Select a field to edit its properties")],-1))])):b("",!0)])])):b("",!0),$.value===3?(n(),r("div",$r,[t("div",Sr,[t("button",{onClick:e[34]||(e[34]=l=>Ct()),class:"btn btn-sm btn-light"},e[118]||(e[118]=[t("i",{class:"bi bi-chevron-left"},null,-1),h(" Back ")])),e[120]||(e[120]=t("h1",{class:"font-14 fw-bold m-0"},"Workflow Setup",-1)),t("button",{class:"btn btn-sm btn-dark",onClick:kt},e[119]||(e[119]=[h(" Next "),t("i",{class:"bi bi-chevron-right"},null,-1)]))]),t("div",qr,[t("div",Ar,[e[126]||(e[126]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),h("Workflow Configuration")])],-1)),t("div",Vr,[t("div",Er,[t("div",Lr,[e[123]||(e[123]=t("label",{class:"form-label fw-bold"},"Workflow Type",-1)),t("div",Rr,[D(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"existingWorkflow",value:"existing","onUpdate:modelValue":e[35]||(e[35]=l=>ve.value=l)},null,512),[[ls,ve.value]]),e[121]||(e[121]=t("label",{class:"btn btn-outline-primary",for:"existingWorkflow"},[t("i",{class:"bi bi-folder me-1"}),h("Use Existing ")],-1)),D(t("input",{type:"radio",class:"btn-check",name:"workflowType",id:"newWorkflow",value:"new","onUpdate:modelValue":e[36]||(e[36]=l=>ve.value=l),checked:""},null,512),[[ls,ve.value]]),e[122]||(e[122]=t("label",{class:"btn btn-outline-primary",for:"newWorkflow"},[t("i",{class:"bi bi-plus-circle me-1"}),h("Create New ")],-1))])]),ve.value==="existing"?(n(),r("div",Tr,[e[124]||(e[124]=t("label",{class:"form-label fw-bold"},"Select Workflow",-1)),X(S(Se),{onOpen:Kt,options:je.value,modelValue:fe.value,"onUpdate:modelValue":e[37]||(e[37]=l=>fe.value=l),placeholder:"Select WF Road Map",multiple:!1,class:"font-11 multiselect",searchable:!0,label:"display_name","track-by":"roadmap_title",onSelect:Qt,openDirection:"bottom"},null,8,["options","modelValue"]),e[125]||(e[125]=t("small",{class:"text-muted font-12 mt-1 d-block"},[t("i",{class:"bi bi-info-circle me-1"}),h("Auto-populates requestors and approvers ")],-1))])):b("",!0)])])]),ve.value==="new"?(n(),r("div",Ur,[e[132]||(e[132]=t("div",{class:"card-header bg-light"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-person-plus me-2"}),h("Requestor Configuration")])],-1)),t("div",Mr,[e[131]||(e[131]=t("p",{class:"text-muted font-12 mb-3"},[t("i",{class:"bi bi-info-circle me-1"}),h(" Define who can submit requests for this form based on WF Requestors ")],-1)),t("button",{class:"btn btn-primary btn-sm mb-3",onClick:Vl},e[127]||(e[127]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),h("Add Requestor Role ")])),at.value.length>0?(n(),r("div",Or,[t("table",zr,[e[130]||(e[130]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"40%"},"Role"),t("th",{width:"30%"},"Auto Approval"),t("th",{width:"20%"},"Permissions"),t("th",{width:"10%"},"Action")])],-1)),t("tbody",null,[(n(!0),r(E,null,L(at.value,(l,o)=>(n(),r("tr",{key:o},[t("td",null,[D(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":a=>l.role=a,placeholder:"Enter role name"},null,8,Br),[[O,l.role]])]),t("td",null,[t("div",Pr,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a=>l.autoApproval=a},null,8,Nr),[[qe,l.autoApproval]]),t("label",jr,g(l.autoApproval?"Yes":"No"),1)])]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:a=>Ll()},e[128]||(e[128]=[t("i",{class:"bi bi-gear"},null,-1),h(" Configure ")]),8,Wr)]),t("td",null,[t("button",{class:"btn btn-sm btn-danger",onClick:a=>El(o)},e[129]||(e[129]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Hr)])]))),128))])])])):b("",!0)])])):b("",!0),ve.value==="existing"&&fe.value&&Re.value.length>0?(n(),r("div",Yr,[e[138]||(e[138]=t("div",{class:"card-header bg-success text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-check-circle me-2"}),h("Loaded Requestors")])],-1)),t("div",Jr,[t("div",Gr,[e[133]||(e[133]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),t("strong",null,g(Re.value.length),1),e[134]||(e[134]=h(" requestor role(s) loaded from ")),t("strong",null,g(fe.value.display_name),1)]),t("div",Zr,[t("table",Kr,[e[136]||(e[136]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Role"),t("th",null,"Auto Approval"),t("th",null,"Columns Allowed")])],-1)),t("tbody",null,[(n(!0),r(E,null,L(Re.value,(l,o)=>(n(),r("tr",{key:o},[t("td",null,[t("strong",null,g(l.requestor),1)]),t("td",null,[l.auto_approval?(n(),r("span",Qr,e[135]||(e[135]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),h("Yes ")]))):(n(),r("span",Xr,"No"))]),t("td",null,[t("small",xr,g(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[137]||(e[137]=t("div",{class:"alert alert-info mt-3"},[t("i",{class:"bi bi-info-circle me-1"}),h(" Go to "),t("strong",null,"Step 2"),h(" and click "),t("strong",null,'"Add Requestors"'),h(" to select specific designations for these roles ")],-1))])])):b("",!0),ve.value==="existing"&&fe.value&&we.value.length>0?(n(),r("div",Ir,[e[147]||(e[147]=t("div",{class:"card-header bg-primary text-white"},[t("h6",{class:"mb-0 fw-bold"},[t("i",{class:"bi bi-diagram-3 me-2"}),h("Loaded Approval Workflow")])],-1)),t("div",ed,[t("div",td,[e[139]||(e[139]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),t("strong",null,g(we.value.length),1),e[140]||(e[140]=h(" approval level(s) loaded from ")),t("strong",null,g(fe.value.display_name),1)]),t("div",sd,[t("table",ld,[e[145]||(e[145]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"10%"},"Level"),t("th",{width:"25%"},"Role"),t("th",{width:"15%"},"Mandatory"),t("th",{width:"20%"},"Approval Type"),t("th",{width:"30%"},"Columns Allowed")])],-1)),t("tbody",null,[(n(!0),r(E,null,L(we.value,(l,o)=>(n(),r("tr",{key:o},[t("td",null,[t("span",od,"Level "+g(l.level),1)]),t("td",null,[t("strong",null,g(l.role),1)]),t("td",null,[l.mandatory?(n(),r("span",ad,e[141]||(e[141]=[t("i",{class:"bi bi-exclamation-circle me-1"},null,-1),h("Required ")]))):(n(),r("span",nd,"Optional"))]),t("td",null,[l.view_only_reportee?(n(),r("span",id,e[142]||(e[142]=[t("i",{class:"bi bi-person me-1"},null,-1),h("Reporting Manager ")]))):l.all_approvals_required?(n(),r("span",rd,e[143]||(e[143]=[t("i",{class:"bi bi-people me-1"},null,-1),h("All Users ")]))):l.requester_as_a_approver?(n(),r("span",dd,e[144]||(e[144]=[t("i",{class:"bi bi-person-check me-1"},null,-1),h("Requestor ")]))):(n(),r("span",ud," Any One "))]),t("td",null,[t("small",cd,g(l.columns_allowed||"All fields"),1)])]))),128))])])]),e[146]||(e[146]=t("div",{class:"alert alert-info mt-3"},[t("i",{class:"bi bi-info-circle me-1"}),h(" Go to "),t("strong",null,"Step 2"),h(" and click "),t("strong",null,'"Add Approvers"'),h(" for each level to select specific designations ")],-1))])])):b("",!0),e[148]||(e[148]=Yl('<div class="card mt-4" data-v-5210446b><div class="card-header bg-light" data-v-5210446b><h6 class="mb-0 fw-bold" data-v-5210446b><i class="bi bi-shield-check me-2" data-v-5210446b></i>System Generated Fields</h6></div><div class="card-body" data-v-5210446b><div class="alert alert-secondary mb-3" data-v-5210446b><i class="bi bi-info-circle me-2" data-v-5210446b></i> These fields are automatically included for all requestors. </div><div class="row g-3" data-v-5210446b><div class="col-md-6" data-v-5210446b><div class="field-preview-card" data-v-5210446b><label class="form-label fw-bold" data-v-5210446b>Requestor Name</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-5210446b></div></div><div class="col-md-6" data-v-5210446b><div class="field-preview-card" data-v-5210446b><label class="form-label fw-bold" data-v-5210446b>Requestor Email</label><input type="email" class="form-control" value="Auto-populated from user profile" disabled data-v-5210446b></div></div><div class="col-md-6" data-v-5210446b><div class="field-preview-card" data-v-5210446b><label class="form-label fw-bold" data-v-5210446b>Request Date</label><input type="text" class="form-control" value="Auto-populated on submission" disabled data-v-5210446b></div></div><div class="col-md-6" data-v-5210446b><div class="field-preview-card" data-v-5210446b><label class="form-label fw-bold" data-v-5210446b>Department</label><input type="text" class="form-control" value="Auto-populated from user profile" disabled data-v-5210446b></div></div></div></div></div>',1))])])):b("",!0),$.value===4?(n(),r("div",pd,[e[149]||(e[149]=t("div",{class:"stepperbackground d-flex align-items-center justify-content-end gap-2"},[t("div",null,[t("button",{class:"btn btn btn-light previewBtn font-13","data-bs-toggle":"modal","data-bs-target":"#customFormatModal"},"Print Format ")]),t("div")],-1)),X(os,{blockArr:mt.value},null,8,["blockArr"])])):b("",!0)])])])])])])]),t("div",md,[t("div",fd,[t("div",vd,[e[153]||(e[153]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"customFormatModalLabel"},"Print Format"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",bd,[e[151]||(e[151]=t("label",{for:""},"Form Name",-1)),D(t("input",{"onUpdate:modelValue":e[38]||(e[38]=l=>it.value=l),multiple:!1,placeholder:S(F).query.id,class:"font-11 form-control",id:"Form_name_print",searchable:!0},null,8,_d),[[O,it.value]]),t("div",hd,[t("div",gd,[D(t("input",{class:"font-12","onUpdate:modelValue":e[39]||(e[39]=l=>Ue.value=l),"true-value":1,"false-value":0,placeholder:"Field Name",type:"checkbox"},null,512),[[qe,Ue.value]])]),e[150]||(e[150]=t("div",null,[t("label",{for:"mandatory",class:"font-12 fw-bold m-0 fw-light"},"Print Landscape Mode")],-1))])]),t("div",{class:"modal-footer"},[e[152]||(e[152]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1)),t("button",{type:"button",class:"btn btn-dark",onClick:pl},"Add Print Format")])])])]),t("div",yd,[t("div",wd,[t("div",kd,[e[154]||(e[154]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"formViewModalLabel"},"Form Preview"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Cd,[X(os,{blockArr:mt.value},null,8,["blockArr"])]),e[155]||(e[155]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),t("div",Dd,[t("div",Fd,[t("span",$d,g(j.value==0?"Add Requestors":`Approval Settings - Level ${j.value}`),1),e[156]||(e[156]=t("button",{type:"button",class:"btn-close bg-light text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1))]),t("div",Sd,[t("div",qd,[j.value!==0?(n(),r("div",Ad,[e[158]||(e[158]=t("label",{class:"fw-bold font-12 mb-2"},"Approver Type",-1)),D(t("select",{"onUpdate:modelValue":e[40]||(e[40]=l=>ce.value=l),class:"form-select shadow-none font-12"},e[157]||(e[157]=[t("option",{value:""},"Any one of the selected approvers",-1),t("option",{value:"ViewOnlyReportee"},"Reporting Manager only",-1),t("option",{value:"all_approvals_required"},"All of the selected approvers",-1),t("option",{value:"requester_as_a_approver"},"Approval by Requestor",-1)]),512),[[Be,ce.value]])])):b("",!0),t("div",Vd,[t("div",Ed,[t("span",Ld," Select "+g(j.value===0?"Requestors":"Approvers"),1),t("span",Rd,g(R.value.length)+" Selected ",1)]),re.value.length?(n(),r("div",Td,[t("div",Ud,[t("div",Md,[t("input",{type:"checkbox",id:"selectAll",checked:tl.value,onChange:sl,class:"form-check-input me-2 designationCheckBox"},null,40,Od),t("label",zd," Select all designation ("+g(Je.value.length)+") ",1)]),j.value!==0?(n(),r("div",Bd,[D(t("input",{type:"checkbox",id:"showHods","onUpdate:modelValue":e[41]||(e[41]=l=>Me.value=l),class:"form-check-input me-2 designationCheckBox"},null,512),[[qe,Me.value]]),e[159]||(e[159]=t("label",{for:"showHods",class:"form-check-label mt-2 fw-bold"}," Show HODs Only ",-1))])):b("",!0),t("div",null,[R.value.length?(n(),r("button",{key:0,type:"button",class:"btn btn-sm font-12 text-danger",onClick:ll},e[160]||(e[160]=[t("i",{class:"bi bi-x"},null,-1),h(" Clear all ")]))):b("",!0)])]),re.value.length?(n(),Jl(S(Gl),{key:0,multiple:!0,modelValue:R.value,"onUpdate:modelValue":e[42]||(e[42]=l=>R.value=l),options:Je.value,"close-on-select":!1,"clear-search-on-select":!0,placeholder:"Search & Select Designations"},null,8,["modelValue","options"])):b("",!0)],512)):(n(),r("div",Pd,e[161]||(e[161]=[t("div",{class:"d-flex justify-content-center"},[t("span",null,"No Designations Found")],-1)])))]),j.value!==0?(n(),r("div",Nd,[e[162]||(e[162]=t("div",null,[t("label",{for:"",class:"fw-bold font-12"},"On Rejection")],-1)),D(t("select",{"onUpdate:modelValue":e[43]||(e[43]=l=>Ee.value=l),class:"form-select shadow-none font-12 mt-1 me-2"},[(n(!0),r(E,null,L(ws.value,l=>(n(),r("option",{key:l,value:l},g(l===0?"Requestor":"Approver Level "+l),9,jd))),128))],512),[[Be,Ee.value,void 0,{number:!0}]])])):b("",!0),j.value!==0?(n(),r("div",Wd,[t("div",Hd,[t("div",Yd,[D(t("input",{"onUpdate:modelValue":e[44]||(e[44]=l=>tt.value=l),type:"checkbox","true-value":1,"false-value":0,id:"Approver",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[qe,tt.value]]),e[163]||(e[163]=t("label",{for:"Approver",class:"m-0"},"Approval Mandatory",-1))]),vt.value===!0?(n(),r("div",Jd,[D(t("input",{"onUpdate:modelValue":e[45]||(e[45]=l=>st.value=l),type:"checkbox","true-value":1,"false-value":0,id:"approver_can_edit",class:"me-2 m-0 form-check-input designationCheckBox"},null,512),[[qe,st.value]]),e[164]||(e[164]=t("label",{for:"approver_can_edit",class:"m-0"}," Allow this approver to edit the form ",-1))])):b("",!0)])])):b("",!0)]),t("div",Gd,[t("div",Zd,[X(Zl,{class:"btn btn-dark addingDesignations","data-bs-dismiss":"offcanvas",onClick:ol,name:j.value===0?"Add Requestor":"Add Approvers"},null,8,["name"])])])])])]))}},xd=rs(Kd,[["__scopeId","data-v-5210446b"]]);export{xd as default};
