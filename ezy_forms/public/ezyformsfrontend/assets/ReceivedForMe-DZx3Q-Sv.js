var we=Object.defineProperty;var X=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var Y=(f,d,i)=>d in f?we(f,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[d]=i,Z=(f,d)=>{for(var i in d||(d={}))Ce.call(d,i)&&Y(f,i,d[i]);if(X)for(var i of X(d))$e.call(d,i)&&Y(f,i,d[i]);return f};var K=(f,d,i)=>new Promise((T,C)=>{var r=h=>{try{S(i.next(h))}catch(A){C(A)}},$=h=>{try{S(i.throw(h))}catch(A){C(A)}},S=h=>h.done?T(h.value):Promise.resolve(h.value).then(r,$);S((i=i.apply(f,d)).next())});import{_ as Se,O as Ae,u as Ee,e as B,d as n,f as Fe,w as Oe,o as m,c as p,b as s,t as w,a as ee,G as Pe,P as Ne,A as Ie,B as Le,C as te,i as I,q as k,v as je,z as De,J as ae,E as Me,R as Te,k as g,l as y,n as J,j as M}from"./index-BHd6CXej.js";const xe={class:"d-flex justify-content-between align-items-center py-2"},Be={class:"m-0 font-11 pt-1"},Je={class:"mt-2"},Ve={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},We={class:"modal-dialog modal-dialog-centered modal-lg"},ze={class:"modal-content"},Ue={class:"modal-header"},Ge={class:"modal-title font-13",id:"viewRequestLabel"},He={class:"p-2"},Qe={class:"activity-log-container"},Xe={class:"activity-log-content"},Ye={class:"font-12 mb-1"},Ze={class:"strong-content"},Ke={class:"strong-content"},et={class:"strong-content"},tt={key:0},at={key:1,class:"strong-content"},st={key:0,class:"form-floating p-1"},ot={key:0,class:"font-11 text-danger ps-1"},nt={class:"modal-footer"},lt={key:0,class:"d-flex justify-content-between align-items-center mt-3 gap-2"},rt=["disabled"],it={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ut={key:1},ct=["disabled"],dt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},vt={key:1},mt={__name:"ReceivedForMe",setup(f){const d=Ae(),i=Ee(),T=B(()=>Me.value),C=n({business_unit:""}),r=n({limitPageLength:20,limit_start:0,filters:[]}),$=n(0),S=n([]),h=n([]),A=n([]),E=n([]),se=n(""),L=n([]),V=n([]);n(!1);const W=n([{th:"Request ID",td_key:"name"},{th:"Requested By",td_key:"requested_by"},{th:"Requested on",td_key:"requested_on"},{th:"Requested Department",td_key:"role"},{th:"Approval Status",td_key:"status"},{th:"Pending With",td_key:"assigned_to_users"},{th:"Linked ID",td_key:"linked_form_id"}]),oe=n([{name:"View Request",icon:"fa-solid fa-eye"}]),F=n([]),l=n({}),z=n(null),j=n([]),b=n(""),x=n([]),ne=n([]),O=n(!1),P=n(!1);Fe(()=>{pe();const t=localStorage.getItem("employeeData");x.value=JSON.parse(t)});const U=n([]);function le(){g.post(y.view_only_reportee).then(t=>{U.value=t.message,q(r.value.filters)}).catch(t=>{console.log(t)})}function re(t,e){var o,a,u;if(e.name==="View Request")if(t){l.value=Z({},t),se.value=l.value.current_level,z.value=Te((a=JSON.parse((o=l.value)==null?void 0:o.json_columns))==null?void 0:a.fields),ne.value=JSON.parse((u=l.value)==null?void 0:u.json_columns).child_table_fields;const c=[["wf_generated_request_id","like",`%${l.value.name}%`]],v={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(c),order_by:`\`tab${l.value.doctype_name}\`.\`creation\` desc`};g.get(`${y.resource}${l.value.doctype_name}`,{params:v}).then(_=>{_.data&&(j.value=_.data[0],ye(j.value,z.value),g.get(`${y.resource}${l.value.doctype_name}/${_.data[0].name}`).then(N=>{const Q=Object.keys(N.data).filter(D=>Array.isArray(N.data[D]));Q.length&&(V.value={},Q.forEach(D=>{V.value[D]=N.data[D]||[]}))}).catch(N=>{console.error("Error fetching data for :",N)}))}).catch(_=>{console.error("Error fetching categories data:",_)}),g.get(`${y.resource}${J.WFActivityLog}/${l.value.name}`).then(_=>{_.data&&(L.value=_.data.reason||[])}).catch(_=>{console.error("Error fetching activity data:",_)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ")}function ie(t,e,o){o==="view"&&d.push({name:"ApproveRequest",query:{routepath:i.path,name:t.name,doctype_name:t.doctype_name,type:"mytasks",designation:x.value}}),o==="td_key"&&t.linked_form_id&&d.push({name:"ApproveRequest",query:{routepath:i.path,name:t.linked_form_id,business_unit:t.property,type:"linkedForm",readOnly:"true"}})}const G=B(()=>L.value.some(t=>t.action==="Request Cancelled")),ue=t=>t?new Date(t).toLocaleDateString("en-GB"):"N/A",ce=t=>t?{"Request Cancelled":"cancelled","Request Raised":"raised"}[t]||t.toLowerCase():"performed an action on",R=n(!0),de=()=>{b.value.trim()!==""&&(R.value=!0)};function ve(t,e){if(b.value.trim()===""){R.value=!1;return}R.value=!0,O.value=!0;let o={};E.value.length&&E.value.map(a=>{o[a.fieldname]=a.value}),g.put(`${y.resource}${l.value.doctype_name}/${j.value.name}`,o).then(a=>{a!=null&&a.data&&fe(t,e)}).catch(a=>{console.error("Error submitting form:",a)})}const me=n(null),pe=()=>K(this,null,function*(){try{const e=yield(yield fetch("https://api.ipify.org?format=json")).json();me.value=e.ip}catch(t){console.error("Error fetching IP:",t)}});function fe(t,e){let o={property:l.value.property,doctype:l.value.doctype_name,request_ids:[l.value.name],reason:b.value,action:e,files:null,cluster_name:null,url_for_approval_id:"",current_level:l.value.current_level};g.post(y.requestApproval,{request_details:[o]}).then(a=>{var u;((u=a==null?void 0:a.message)==null?void 0:u.success)===!0?(M.success(`Request ${e}ed`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),b.value="",q()):M.error(`Failed to ${e} request`,{autoClose:1e3,transition:"zoom"})}).catch(a=>{console.error("Error processing request:",a)}).finally(()=>{O.value=!1})}function _e(t,e){if(b.value.trim()===""){R.value=!1;return}R.value=!0,P.value=!0;let o={};E.value.length&&E.value.map(a=>{o[a.fieldname]=a.value}),g.put(`${y.resource}${l.value.doctype_name}/${j.value.name}`,o).then(a=>{a!=null&&a.data&&(bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),ge(t,e))})}function ge(t,e){let o={property:l.value.property,doctype:l.value.doctype_name,request_id:l.value.name,reason:b.value,action:e,files:[],url_for_cancelling_id:"",current_level:l.value.current_level};g.post(y.wf_cancelling_request,o).then(a=>{a!=null&&a.message&&(b.value="",M.success(`${e}`,{autoClose:1e3,transition:"zoom"}),bootstrap.Modal.getInstance(document.getElementById("viewRequest")).hide(),q())}).catch(a=>{console.error("Error processing cancellation:",a),M.error("An error occurred while processing your request.",{autoClose:1e3,transition:"zoom"})}).finally(()=>{P.value=!1})}function ye(t,e){e.forEach(o=>{o.sections.forEach(a=>{a.rows.forEach(u=>{u.columns.forEach(c=>{c.fields.forEach(v=>{t!=null&&t.hasOwnProperty(v==null?void 0:v.fieldname)&&(v.value=t[v==null?void 0:v.fieldname])})})})})})}function he(){R.value=!0}const be=t=>{r.value.limitPageLength=t,r.value.limit_start=0,r.value.filters.length?q(r.value.filters):q()},qe=([t,e])=>{r.value.limitPageLength=t,r.value.limit_start=e,r.value.filters.length?q(r.value.filters):q()};n([]);const H=n(null);function ke(t){clearTimeout(H.value),H.value=setTimeout(()=>{r.value.filters=[],W.value.forEach(e=>{const o=e.td_key;t[o]&&r.value.filters.push([o,"like",`%${t[o]}%`])}),r.value.filters.length?(r.value.limit_start=0,q(r.value.filters)):q()},500)}function q(t){const e=JSON.parse(localStorage.getItem("employeeData"));x.value=e.designation;const o=[["assigned_to_users","like",`%${e==null?void 0:e.designation}%`],["property","like",`%${C.value.business_unit}%`],["status","!=","Request Cancelled"],["name","in",U.value],["status","!=","Completed"]];t&&o.push(...t);const a={fields:JSON.stringify(["*"]),limit_page_length:r.value.limitPageLength,limit_start:r.value.limit_start,filters:JSON.stringify(o),order_by:"`tabWF Workflow Requests`.`creation` desc"},u={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(o)};g.get(`${y.resource}${J.WFWorkflowRequests}`,{params:u}).then(c=>{$.value=c.data[0].total_count}).catch(c=>{console.error("Error fetching total count:",c)}),g.get(`${y.resource}${J.WFWorkflowRequests}`,{params:a}).then(c=>{r.value.limit_start===0?(F.value=c.data,S.value=[...new Set(c.data.map(v=>v.name))],h.value=[...new Set(c.data.map(v=>v.doctype_name))],A.value=[...new Set(c.data.map(v=>v.status))]):F.value=F.value.concat(c.data)}).catch(c=>{console.error("Error fetching records:",c)})}const Re=B(()=>({name:{type:"input"},requested_by:{type:"input"},role:{type:"input"},status:{type:"select",options:["Request Raised","In Progress"]}}));return Oe(T,t=>{C.value.business_unit=t,t.length&&le()},{immediate:!0}),(t,e)=>{var o;return m(),p("div",null,[s("div",xe,[s("div",null,[e[3]||(e[3]=s("h1",{class:"m-0 font-13"},"Requests Assigned to me",-1)),s("p",Be,w($.value)+" request",1)])]),s("div",Je,[ee(Pe,{tHeaders:W.value,tData:F.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onUpdateFilters:ke,"field-mapping":Re.value,onCellClick:ie,isFiltersoption:"true",actions:oe.value,onActionClicked:re},null,8,["tHeaders","tData","field-mapping","actions"]),ee(Ne,{currentRecords:F.value.length,totalRecords:$.value,onUpdateValue:be,onLimitStart:qe},null,8,["currentRecords","totalRecords"])]),s("div",Ve,[s("div",We,[s("div",ze,[s("div",Ue,[s("h5",Ge," Request Id: "+w((o=l.value.name)==null?void 0:o.replace(/_/g," ")),1),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal",onClick:he,"aria-label":"Close"})]),e[12]||(e[12]=s("div",{class:"modal-body approvermodalbody"},null,-1)),s("div",He,[s("div",Qe,[(m(!0),p(Ie,null,Le(L.value,(a,u)=>(m(),p("div",{key:u,class:te(["activity-log-item",{"last-item":u===L.value.length-1}])},[e[7]||(e[7]=s("div",{class:"activity-log-dot"},null,-1)),e[8]||(e[8]=I("def add_roles_to_wf_requestors ")),s("div",Xe,[s("p",Ye,[e[4]||(e[4]=I(" On ")),s("strong",Ze,w(ue(a.creation)),1),e[5]||(e[5]=I(", ")),s("strong",Ke,w(a.user_name),1),I(" ("+w(a.role)+") has ",1),s("strong",et,w(ce(a.action)),1),e[6]||(e[6]=I(" the request")),u!==0&&a.reason?(m(),p("span",tt,"with the comments:")):k("",!0),u!==0&&a.reason?(m(),p("strong",at,w(a.reason||"N/A"),1)):k("",!0)])])],2))),128))]),G.value?k("",!0):(m(),p("div",st,[je(s("textarea",{class:te(["form-control font-12",{"is-invalid":!R.value}]),placeholder:"Leave a comment here",id:"floatingTextarea",onInput:de,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a)},null,34),[[De,b.value]]),e[9]||(e[9]=s("label",{class:"font-11",for:"floatingTextarea"},"Comments..",-1)),R.value?k("",!0):(m(),p("span",ot,"Please enter comments**"))]))]),s("div",nt,[G.value?k("",!0):(m(),p("div",lt,[s("div",null,[s("button",{type:"submit",class:"btn btn-outline-danger font-12 py-0 rejectbtn",disabled:P.value,onClick:e[1]||(e[1]=ae(a=>_e(t.formData,"Request Cancelled"),["prevent"]))},[P.value?(m(),p("span",it)):k("",!0),P.value?k("",!0):(m(),p("span",ut,e[10]||(e[10]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),s("span",{class:"font-12"},"Reject",-1)])))],8,rt)]),s("div",null,[s("button",{type:"submit",class:"btn btn-success approvebtn",disabled:O.value,onClick:e[2]||(e[2]=ae(a=>ve(E.value,"Approve"),["prevent"]))},[O.value?(m(),p("span",dt)):k("",!0),O.value?k("",!0):(m(),p("span",vt,e[11]||(e[11]=[s("i",{class:"bi bi-check-lg font-15 me-2"},null,-1),s("span",{class:"font-12"},"Approve",-1)])))],8,ct)])]))])])])])])}}},gt=Se(mt,[["__scopeId","data-v-9a851869"]]);export{gt as default};
