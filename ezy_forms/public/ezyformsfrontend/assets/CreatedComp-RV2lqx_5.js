import{_ as J,r as i,u as M,x,E as U,e as B,f as D,w as G,M as Y,y as d,z as f,K as g,o as K,c as Q,d as s,t as W,b as v,S as X,G as Z,P as ee,m as P,Y as te,D as se,H as oe,J as ne}from"./index-DlVunteb.js";const ae={class:"d-flex formsticky align-items-center justify-content-between py-2"},ie={class:"m-0 font-11 pt-1"},re={class:"d-flex align-items-center gap-2"},le={class:"d-flex align-items-center"},me={class:"mt-2"},ce={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},ue={class:"modal-dialog modal-xl"},de={class:"modal-content"},fe={class:"d-block modal-header bg-dark text-white py-2"},pe={class:"d-flex align-items-center justify-content-between"},_e={class:""},he={class:"modal-body"},be=["innerHTML"],ge={__name:"CreatedComp",setup(ve){const y=i(0),C=i(""),k=i({}),m=i([]),_=M(),c=x(()=>U.value);B([]),D(()=>{});const l=i({limit_start:0,limitPageLength:20,form_name:"",form_short_name:"",accessible_departments:"[]",business_unit:"",form_category:"",owner_of_the_form:"",search:""}),$=i("");G(c,e=>{l.value.business_unit=e,e.length&&($.value=e,m.value=[],p())},{immediate:!0});const w=i([{th:"Form name",td_key:"form_name"},{th:"Short Name",td_key:"form_short_name"},{th:"Form category",td_key:"form_category"},{th:"Owner of form",td_key:"owner_of_the_form"},{th:"Accessible departments",td_key:"accessible_departments"},{th:"Status",td_key:"form_status"},{th:"Enable/Disable",td_key:"enable"}]),h=Y(),R=i(null),L=i([{name:"View form",icon:"fa-solid fa-eye"},{name:"Edit Form",icon:"fa-solid fa-edit"},{name:"Raise Request",icon:"fa-solid fa-check-circle"}]),N=i([]);function T(e,t){if(t.name==="View form")e!=null&&e.form_json?h.push({name:"FormPreviewComp",query:{routepath:_.path,form_short_name:e.form_short_name,business_unit:c.value}}):(console.warn("There are no form fields"),b(e));else if(t.name==="Edit Form")b(e);else if(t.name==="Download Print format"){k.value=e;const a={form_short_name:e.form_short_name,business_unit:c.value};d.post(f.preview_dynamic_form,a).then(o=>{C.value=o.message}).catch(o=>{console.error("Error fetching data:",o)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}if(t.name==="Raise Request"){const a=JSON.parse(e.form_json),n=localStorage.getItem("employeeData");if(n){const o=JSON.parse(n).designation,r=a.workflow[0].roles;let u=!1;for(let F=0;F<r.length;F++)if(r[F]===o){u=!0;break}u?h.push({name:"RaiseRequest",query:{routepath:_.path,selectedForm:e.form_short_name,business_unit:e.business_unit}}):se("You are not assigned to raise a request.")}}else t.name==="Edit accessibility to dept."?b(e):t.name==="In-active this form"?S(e,"0"):t.name==="Activate this form"&&S(e,"1")}function q(e,t,a){const n=e.enable=="1"||e.enable===1,o=n?"Disable":"Enable";confirm(`Are you sure you want to ${o} ${e.name} Form?`)&&(e.enable=n?0:1,d.put(`${f.resource}${g.EzyFormDefinitions}/${e.name}`,e).then(r=>{oe(`Form ${o}d successfully`),window.location.reload()}).catch(r=>{console.error("Error updating toggle:",r)}))}function z(){const e={form_short_name:k.value.form_short_name,name:null,business_unit:c.value};d.post(f.download_pdf_form,e).then(t=>{let a=ne+t.message;a=a.replace("/api","");const n=document.createElement("a");n.href=a,n.download=t.message.split("/").pop(),n.click()}).catch(t=>{console.error("Error fetching data:",t)})}function S(e,t){if(e){const a=e.name,n={active:t};d.put(`${f.resource}${g.EzyFormDefinitions}/${a}`,n).then(o=>{p()}).catch(o=>{console.error("Error updating form status:",o)})}}const E=i(null);function A(e){clearTimeout(E.value),E.value=setTimeout(()=>{const t=[];w.value.forEach(a=>{const n=a.td_key;e[n]&&t.push([n,"like",`%${e[n]}%`])}),p(t.length?t:void 0)},500)}function b(e=null){e==null?h.push({name:"FormStepper",query:{routepath:_.path,business_unit:c.value}}):h.push({name:"FormStepper",params:{paramid:e.name},query:{routepath:_.path,business_unit:c.value,id:e.name}})}const O=e=>{l.value.limitPageLength=e,l.value.limit_start=0,p()},V=([e,t])=>{l.value.limitPageLength=e,l.value.limit_start=t,p()},H=i([]);i([]);const I=i([]);function p(e){const t=[["business_unit","=",`${l.value.business_unit}`],["form_status","=","Created"]];e&&t.push(...e);const a={fields:JSON.stringify(["*"]),filters:JSON.stringify(t),limit_page_length:l.value.limitPageLength,limit_start:l.value.limit_start,order_by:"`tabEzy Form Definitions`.`enable` DESC, `tabEzy Form Definitions`.`creation` DESC"},n={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(t)};d.get(`${f.resource}${g.EzyFormDefinitions}`,{params:n}).then(o=>{y.value=o.data[0].total_count}).catch(o=>{console.error("Error fetching ezyForms data:",o)}),d.get(`${f.resource}${g.EzyFormDefinitions}`,{params:a}).then(o=>{const r=o.data;l.value.limit_start===0?(m.value=r,H.value=[...new Set(r.map(u=>u.form_category))],I.value=[...new Set(r.map(u=>u.owner_of_the_form))]):m.value=m.value.concat(r)}).catch(o=>{console.error("Error fetching ezyForms data:",o)})}const j=x(()=>({form_name:{type:"input"},form_short_name:{type:"input"},form_category:{type:"input"},owner_of_the_form:{type:"input"}}));return(e,t)=>(K(),Q("div",null,[s("div",ae,[s("div",null,[t[2]||(t[2]=s("h1",{class:"m-0 font-13"},"All Forms ",-1)),s("p",ie,W(y.value)+" forms available",1)]),s("div",re,[s("div",le,[v(X,{class:"buttoncomp",onClick:t[0]||(t[0]=a=>b()),name:"Create form"})])])]),s("div",me,[v(Z,{tHeaders:w.value,tData:m.value,isAction:"true",actionType:"dropdown",enableDisable:"true",onActionClicked:T,onToggleClick:q,isFiltersoption:"true","field-mapping":j.value,actions:L.value,onUpdateFilters:A,isCheckbox:"true"},null,8,["tHeaders","tData","field-mapping","actions"]),v(ee,{currentRecords:m.value.length,totalRecords:y.value,onUpdateValue:O,onLimitStart:V},null,8,["currentRecords","totalRecords"])]),s("div",ce,[s("div",ue,[s("div",de,[s("div",fe,[s("div",pe,[t[5]||(t[5]=s("div",null,[s("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),s("div",_e,[s("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:z},t[3]||(t[3]=[P("Download Pdf"),s("span",{class:"ms-2"},[s("i",{class:"bi bi-download"})],-1)])),s("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:t[1]||(t[1]=(...a)=>e.closemodal&&e.closemodal(...a)),"data-bs-dismiss":"modal"},t[4]||(t[4]=[P("Close "),s("i",{class:"bi bi-x"},null,-1)]))])])]),s("div",he,[s("div",{innerHTML:C.value},null,8,be)]),t[6]||(t[6]=s("div",{class:"modal-footer"},null,-1))])])]),v(te,{blockArr:R.value,formDescriptions:k.value,childHeaders:N.value},null,8,["blockArr","formDescriptions","childHeaders"])]))}},ke=J(ge,[["__scopeId","data-v-15ee4793"]]);export{ke as default};
