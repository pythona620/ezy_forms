var de=Object.defineProperty;var V=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var W=(h,u,f)=>u in h?de(h,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[u]=f,U=(h,u)=>{for(var f in u||(u={}))ue.call(u,f)&&W(h,f,u[f]);if(V)for(var f of V(u))ce.call(u,f)&&W(h,f,u[f]);return h};import{_ as me,e as $,s as fe,d as a,u as ve,w as pe,f as _e,o as R,c as q,b as t,t as k,a as x,G as ge,P as ye,j as _,D as he,H as be,I as we,B as ke,h as Re,E as qe,L as Ee,l as g,m as y,p as L,n as Se}from"./index-BX552J3x.js";const Pe={class:"d-flex justify-content-between align-items-center py-2"},Ce={class:"m-0 font-11 pt-1"},Ne={class:"mt-2"},Fe={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},$e={class:"modal-dialog modal-dialog-centered modal-lg"},xe={class:"modal-content"},Le={class:"modal-header py-2 d-block"},Oe={class:"d-flex justify-content-between align-items-center"},Me={class:"m-0 font-13",id:"viewRequest"},Ae={class:"activity-log-container"},Be={class:"activity-log-content"},Ie={class:"font-12 mb-1"},Te={class:"strong-content"},je={class:"strong-content"},De={key:0},Je={key:1},Ve={class:"strong-content"},We={class:"strong-content"},Ue={class:"modal-footer"},He={key:0},Ge={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},ze={class:"modal-dialog modal-xl"},Qe={class:"modal-content"},Xe={class:"modal-body pdf-body"},Ye=["innerHTML"],Ze={__name:"RaisedByMe",setup(h){const u=$(()=>qe.value),f=fe(),O=a({business_unit:""}),r=a({limitPageLength:20,limit_start:0,filters:[]}),N=a(0),o=a({}),M=a(null),E=a([]),H=a([]),G=a([]),z=a([]);a([]);const S=a([]),Q=a(""),A=a(""),P=a([]),B=a("");a([]);const X=a([]),Y=a(""),F=a([]),I=ve();a(!1);const T=a([{th:"Request ID",td_key:"name"},{th:"Form Name",td_key:"doctype_name"},{th:"Role",td_key:"role"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"},{th:"Approved Date",td_key:"modified"}]),Z=a([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(s){f.push({name:"ApproveRequest",query:{routepath:I.path,name:s.name,doctype_name:s.doctype_name,business_unit:s.property,status:s.status,type:"myforms",readOnly:"true"}})}function ee(){const s=document.getElementById("viewRequest");if(s){const e=bootstrap.Modal.getInstance(s);e&&e.hide()}f.push({name:"RaiseRequest",query:{routepath:I.path,business_unit:o.value.property,selectedForm:o.value.doctype_name,selectedFormId:o.value.name,selectedFormStatus:o.value.status}})}$(()=>P.value.some(s=>s.action==="Request Cancelled"));function te(s,e){var n,d,c;if(e.name==="View Request")if(s){o.value=U({},s),B.value=s.status,Q.value=(n=o.value)==null?void 0:n.total_levels,X.value=JSON.parse((d=o.value)==null?void 0:d.json_columns).child_table_fields,M.value=Ee(JSON.parse((c=o.value)==null?void 0:c.json_columns).fields);const b=[["wf_generated_request_id","like",`%${o.value.name}%`]],m={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(b),order_by:`\`tab${o.value.doctype_name}\`.\`creation\` desc`};g.get(`${y.resource}${o.value.doctype_name}`,{params:m}).then(i=>{i.data&&(E.value=i.data,oe(E.value[0],M.value),g.get(`${y.resource}${o.value.doctype_name}`).then(l=>{console.log("Data for :",l.data[0])}).catch(l=>{console.error("Error fetching data for :",l)}),g.get(`${y.resource}${o.value.doctype_name}/${i.data[0].name}`).then(l=>{const v=Object.keys(l.data).filter(p=>Array.isArray(l.data[p]));v.length&&(F.value={},v.forEach(p=>{F.value[p]=l.data[p]||[]}))}).catch(l=>{console.error("Error fetching data for :",l)}))}).catch(i=>{console.error("Error fetching categories data:",i)}),g.get(`${y.resource}${L.WFActivityLog}/${o.value.name}`).then(i=>{i.data&&(P.value=i.data.reason||[])}).catch(i=>{console.error("Error fetching activity data:",i)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(e.name==="PDF Format"){o.value=s;const b=[["wf_generated_request_id","like",`%${o.value.name}%`]],m={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(b),order_by:`\`tab${o.value.doctype_name}\`.\`creation\` desc`};g.get(`${y.resource}${o.value.doctype_name}`,{params:m}).then(i=>{if(i.data){E.value=i.data;const l={form_short_name:s.doctype_name,name:E.value[0].name,business_unit:u.value};g.post(y.preview_dynamic_form,l).then(v=>{A.value=v.message}).catch(v=>{console.error("Error fetching data:",v)})}}).catch(i=>{console.error("Error fetching categories data:",i)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function j(){F.value=[],Y.value=""}const se=s=>s?new Date(s).toLocaleDateString("en-GB"):"N/A",ae=s=>s?{"Request Cancelled":"cancelled","Request Raised":"raised"}[s]||s.toLowerCase():"performed an action on";function D(){var e;const s={form_short_name:o.value.doctype_name,name:(e=E.value[0])==null?void 0:e.name,business_unit:u.value};g.post(y.download_pdf_form,s).then(n=>{let d=Se+n.message;d=d.replace("/api","");const c=document.createElement("a");c.href=d,c.download=n.message.split("/").pop(),c.click()}).catch(n=>{console.error("Error fetching data:",n)})}function oe(s,e){e.forEach(n=>{n.sections.forEach(d=>{d.rows.forEach(c=>{c.columns.forEach(b=>{b.fields.forEach(m=>{s!=null&&s.hasOwnProperty(m==null?void 0:m.fieldname)&&(m.value=s[m==null?void 0:m.fieldname])})})})})})}const ne=s=>{r.value.limitPageLength=s,r.value.limit_start=0,r.value.filters.length?w(r.value.filters):w()},le=([s,e])=>{r.value.limitPageLength=s,r.value.limit_start=e,r.value.filters.length?w(r.value.filters):w()},J=a(null);function ie(s){console.log(s),clearTimeout(J.value),J.value=setTimeout(()=>{r.value.filters=[],T.value.forEach(e=>{const n=e.td_key;s[n]&&r.value.filters.push([n,"like",`%${s[n]}%`])}),r.value.filters.length?(r.value.limit_start=0,w(r.value.filters)):w()},500)}function w(s){var b,m,C,i;const n=[["requested_by","like",JSON.parse(localStorage.getItem("employeeData")).emp_mail_id],["property","like",`%${O.value.business_unit}%`]];s&&n.push(...s);const d={fields:JSON.stringify(["*"]),limit_page_length:(b=r.value)==null?void 0:b.limitPageLength,limit_start:(m=r.value)==null?void 0:m.limit_start,filters:JSON.stringify(n),order_by:"`tabWF Workflow Requests`.`creation` desc"},c={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(n)};g.get(`${(C=y)==null?void 0:C.resource}${(i=L)==null?void 0:i.WFWorkflowRequests}`,{params:c}).then(l=>{N.value=l.data[0].total_count}).catch(l=>{console.error("Error fetching total count:",l)}),g.get(`${y.resource}${L.WFWorkflowRequests}`,{params:d}).then(l=>{const v=l.data;r.value.limit_start===0?(S.value=v,H.value=[...new Set(v.map(p=>p.name))],G.value=[...new Set(v.map(p=>p.doctype_name))],z.value=[...new Set(v.map(p=>p.status))]):S.value=S.value.concat(v)}).catch(l=>{console.error("Error fetching records:",l)})}const re=$(()=>({status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},name:{type:"input"},doctype_name:{type:"input"},role:{type:"input"}}));return pe(u,s=>{O.value.business_unit=s,s.length&&w()},{immediate:!0}),_e(()=>{}),(s,e)=>{var n;return R(),q("div",null,[t("div",Pe,[t("div",null,[e[0]||(e[0]=t("h1",{class:"m-0 font-13"},"Requests Submitted",-1)),t("p",Ce,k(N.value)+" request",1)])]),t("div",Ne,[x(ge,{tHeaders:T.value,tData:S.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onCellClick:K,actions:Z.value,onActionClicked:te,isFiltersoption:"true","field-mapping":re.value,onUpdateFilters:ie},null,8,["tHeaders","tData","actions","field-mapping"]),x(ye,{currentRecords:S.value.length,totalRecords:N.value,onUpdateValue:ne,onLimitStart:le},null,8,["currentRecords","totalRecords"])]),t("div",Fe,[t("div",$e,[t("div",xe,[t("div",Le,[t("div",Oe,[t("div",null,[t("h5",Me,"Request Id: "+k((n=o.value.name)==null?void 0:n.replace(/_/g," ")),1)]),t("div",{class:""},[t("button",{button:"button",class:"btn btn-white text-dark font-13",onClick:D},e[1]||(e[1]=[_(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)])),t("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:j,"data-bs-dismiss":"modal"},e[2]||(e[2]=[_(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),e[9]||(e[9]=t("div",{class:"modal-body approvermodalbody"},null,-1)),t("div",Ae,[(R(!0),q(he,null,be(P.value,(d,c)=>(R(),q("div",{key:c,class:we(["activity-log-item",{"last-item":c===P.value.length-1}])},[e[7]||(e[7]=t("div",{class:"activity-log-dot"},null,-1)),t("div",Be,[t("p",Ie,[e[3]||(e[3]=_(" On ")),t("strong",Te,k(se(d.creation)),1),e[4]||(e[4]=_(", ")),t("strong",je,[c==0?(R(),q("span",De,"you")):(R(),q("span",Je,k(d.user_name),1))]),_(" ("+k(d.role)+") ",1),t("strong",Ve,k(ae(d.action)),1),e[5]||(e[5]=_(" the request with the comments: ")),t("strong",We,k(d.reason||"N/A"),1),e[6]||(e[6]=_(". "))])])],2))),128))]),t("div",Ue,[e[8]||(e[8]=t("div",{class:"d-flex justify-content-between align-items-center gap-2"},null,-1)),B.value=="Request Raised"?(R(),q("div",He,[x(ke,{type:"button",class:"border-1 edit-btn text-nowrap font-10",onClick:ee,name:"Edit Form"})])):Re("",!0)])])])]),t("div",Ge,[t("div",ze,[t("div",Qe,[t("div",{class:"modal-header py-2 d-block bg-dark text-white"},[t("div",{class:"d-flex justify-content-between align-items-center"},[e[12]||(e[12]=t("div",null,[t("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),t("div",{class:""},[t("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:D},e[10]||(e[10]=[_(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)])),t("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:j,"data-bs-dismiss":"modal"},e[11]||(e[11]=[_(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),t("div",Xe,[t("div",{innerHTML:A.value},null,8,Ye)]),e[13]||(e[13]=t("div",{class:"modal-footer"},null,-1))])])])])}}},tt=me(Ze,[["__scopeId","data-v-a0417205"]]);export{tt as default};
