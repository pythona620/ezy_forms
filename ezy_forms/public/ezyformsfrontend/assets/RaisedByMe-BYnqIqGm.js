var de=Object.defineProperty;var V=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var W=(g,d,m)=>d in g?de(g,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):g[d]=m,U=(g,d)=>{for(var m in d||(d={}))ce.call(d,m)&&W(g,m,d[m]);if(V)for(var m of V(d))ue.call(d,m)&&W(g,m,d[m]);return g};import{q as me,e as N,I as pe,d as a,u as fe,w as ve,f as _e,o as k,c as q,b as t,t as w,a as x,_ as ye,P as ge,j as v,z as he,A as be,y as we,B as ke,h as qe,E as Re,J as Ee,l as _,m as y,p as O,n as Se}from"./index-DXneRfP_.js";const Pe={class:"d-flex justify-content-between align-items-center py-2"},Ce={class:"m-0 font-11 pt-1"},Fe={class:"mt-2"},$e={class:"modal fade",id:"viewRequest","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"viewRequestLabel","aria-hidden":"true"},Ne={class:"modal-dialog modal-dialog-centered modal-lg"},xe={class:"modal-content"},Oe={class:"modal-header py-2 d-block"},Le={class:"d-flex justify-content-between align-items-center"},Me={class:"m-0 font-13",id:"viewRequest"},Ae={class:"activity-log-container"},Be={class:"activity-log-content"},Ie={class:"font-12 mb-1"},Je={class:"strong-content"},je={class:"strong-content"},De={key:0},Te={key:1},Ve={class:"strong-content"},We={class:"strong-content"},Ue={class:"modal-footer"},He={key:0},ze={class:"modal fade",id:"pdfView",tabindex:"-1","aria-labelledby":"pdfViewLabel","aria-hidden":"true"},Ge={class:"modal-dialog modal-xl"},Qe={class:"modal-content"},Xe={class:"modal-body pdf-body"},Ye=["innerHTML"],Ze={__name:"RaisedByMe",setup(g){const d=N(()=>Re.value),m=pe(),L=a({business_unit:""}),b=a({limitPageLength:20,limit_start:0}),F=a(0),o=a({}),M=a(null),R=a([]),H=a([]),z=a([]),G=a([]);a([]);const E=a([]),Q=a(""),A=a(""),P=a([]),B=a("");a([]);const X=a([]),Y=a(""),$=a([]),I=fe();a(!1);const J=a([{th:"Request ID",td_key:"name"},{th:"Form name",td_key:"doctype_name"},{th:"My Forms",td_key:"role"},{th:"Requested on",td_key:"requested_on"},{th:"Approval Status",td_key:"status"},{th:"Workflow Status",td_key:"assigned_to_users"},{th:"Approved Date",td_key:"modified"}]),Z=a([{name:"View Request",icon:"fa-solid fa-eye"},{name:"PDF Format",icon:"bi bi-filetype-pdf"}]);function K(s){m.push({name:"ApproveRequest",query:{routepath:I.path,name:s.name,doctype_name:s.doctype_name,business_unit:s.property,status:s.status,type:"myforms",readOnly:"true"}})}function ee(){const s=document.getElementById("viewRequest");if(s){const e=bootstrap.Modal.getInstance(s);e&&e.hide()}m.push({name:"RaiseRequest",query:{routepath:I.path,business_unit:o.value.property,selectedForm:o.value.doctype_name,selectedFormId:o.value.name,selectedFormStatus:o.value.status}})}N(()=>P.value.some(s=>s.action==="Request Cancelled"));function te(s,e){var i,n,c;if(e.name==="View Request")if(s){o.value=U({},s),B.value=s.status,Q.value=(i=o.value)==null?void 0:i.total_levels,X.value=JSON.parse((n=o.value)==null?void 0:n.json_columns).child_table_fields,M.value=Ee(JSON.parse((c=o.value)==null?void 0:c.json_columns).fields);const h=[["wf_generated_request_id","like",`%${o.value.name}%`]],u={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(h),order_by:`\`tab${o.value.doctype_name}\`.\`creation\` desc`};_.get(`${y.resource}${o.value.doctype_name}`,{params:u}).then(r=>{r.data&&(R.value=r.data,oe(R.value[0],M.value),_.get(`${y.resource}${o.value.doctype_name}`).then(l=>{console.log("Data for :",l.data[0])}).catch(l=>{console.error("Error fetching data for :",l)}),_.get(`${y.resource}${o.value.doctype_name}/${r.data[0].name}`).then(l=>{const p=Object.keys(l.data).filter(f=>Array.isArray(l.data[f]));p.length&&($.value={},p.forEach(f=>{$.value[f]=l.data[f]||[]}))}).catch(l=>{console.error("Error fetching data for :",l)}))}).catch(r=>{console.error("Error fetching categories data:",r)}),_.get(`${y.resource}${O.WFActivityLog}/${o.value.name}`).then(r=>{r.data&&(P.value=r.data.reason||[])}).catch(r=>{console.error("Error fetching activity data:",r)}),new bootstrap.Modal(document.getElementById("viewRequest"),{}).show()}else console.warn(" There is no form fields ");else if(e.name==="PDF Format"){o.value=s;const h=[["wf_generated_request_id","like",`%${o.value.name}%`]],u={fields:JSON.stringify(["*"]),limit_page_length:"None",limit_start:0,filters:JSON.stringify(h),order_by:`\`tab${o.value.doctype_name}\`.\`creation\` desc`};_.get(`${y.resource}${o.value.doctype_name}`,{params:u}).then(r=>{if(r.data){R.value=r.data;const l={form_short_name:s.doctype_name,name:R.value[0].name,business_unit:d.value};_.post(y.preview_dynamic_form,l).then(p=>{A.value=p.message}).catch(p=>{console.error("Error fetching data:",p)})}}).catch(r=>{console.error("Error fetching categories data:",r)}),new bootstrap.Modal(document.getElementById("pdfView"),{}).show()}}function j(){$.value=[],Y.value=""}const se=s=>s?new Date(s).toLocaleDateString("en-GB"):"N/A",ae=s=>s?{"Request Cancelled":"cancelled","Request Raised":"raised"}[s]||s.toLowerCase():"performed an action on";function D(){var e;const s={form_short_name:o.value.doctype_name,name:(e=R.value[0])==null?void 0:e.name,business_unit:d.value};_.post(y.download_pdf_form,s).then(i=>{let n=Se+i.message;n=n.replace("/api","");const c=document.createElement("a");c.href=n,c.download=i.message.split("/").pop(),c.click()}).catch(i=>{console.error("Error fetching data:",i)})}function oe(s,e){e.forEach(i=>{i.sections.forEach(n=>{n.rows.forEach(c=>{c.columns.forEach(h=>{h.fields.forEach(u=>{s!=null&&s.hasOwnProperty(u==null?void 0:u.fieldname)&&(u.value=s[u==null?void 0:u.fieldname])})})})})})}const ne=s=>{b.value.limitPageLength=s,b.value.limit_start=0,S()},le=([s,e])=>{b.value.limitPageLength=s,b.value.limit_start=e,S()},T=a(null);function ie(s){clearTimeout(T.value),T.value=setTimeout(()=>{const e=[];J.value.forEach(i=>{const n=i.td_key;s[n]&&e.push(n,"like",`%${s[n]}%`)}),e.length?S(e):S()},500)}function S(s){var h,u,C,r;const i=[["requested_by","like",JSON.parse(localStorage.getItem("employeeData")).emp_mail_id],["property","like",`%${L.value.business_unit}%`]];s&&i.push(s);const n={fields:JSON.stringify(["*"]),limit_page_length:(h=b.value)==null?void 0:h.limitPageLength,limit_start:(u=b.value)==null?void 0:u.limit_start,filters:JSON.stringify(i),order_by:"`tabWF Workflow Requests`.`creation` desc"},c={fields:JSON.stringify(["count(name) AS total_count"]),limitPageLength:"None",filters:JSON.stringify(i)};_.get(`${(C=y)==null?void 0:C.resource}${(r=O)==null?void 0:r.WFWorkflowRequests}`,{params:c}).then(l=>{F.value=l.data[0].total_count}).catch(l=>{console.error("Error fetching total count:",l)}),_.get(`${y.resource}${O.WFWorkflowRequests}`,{params:n}).then(l=>{const p=l.data;b.value.limit_start===0?(E.value=p,H.value=[...new Set(p.map(f=>f.name))],z.value=[...new Set(p.map(f=>f.doctype_name))],G.value=[...new Set(p.map(f=>f.status))]):E.value=E.value.concat(p)}).catch(l=>{console.error("Error fetching records:",l)})}const re=N(()=>({status:{type:"select",options:["Request Raised","In Progress","Completed","Request Cancelled"]},name:{type:"input"},doctype_name:{type:"input"},role:{type:"input"}}));return ve(d,s=>{L.value.business_unit=s,s.length&&S()},{immediate:!0}),_e(()=>{}),(s,e)=>{var i;return k(),q("div",null,[t("div",Pe,[t("div",null,[e[0]||(e[0]=t("h1",{class:"m-0 font-13"},"Requests Submitted",-1)),t("p",Ce,w(F.value)+" request",1)])]),t("div",Fe,[x(ye,{tHeaders:J.value,tData:E.value,isAction:"true",viewType:"viewPdf",isCheckbox:"true",onCellClick:K,actions:Z.value,onActionClicked:te,isFiltersoption:"true","field-mapping":re.value,onUpdateFilters:ie},null,8,["tHeaders","tData","actions","field-mapping"]),x(ge,{currentRecords:E.value.length,totalRecords:F.value,onUpdateValue:ne,onLimitStart:le},null,8,["currentRecords","totalRecords"])]),t("div",$e,[t("div",Ne,[t("div",xe,[t("div",Oe,[t("div",Le,[t("div",null,[t("h5",Me,"Request Id: "+w((i=o.value.name)==null?void 0:i.replace(/_/g," ")),1)]),t("div",{class:""},[t("button",{button:"button",class:"btn btn-white text-dark font-13",onClick:D},e[1]||(e[1]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)])),t("button",{type:"button",class:"btn btn-white text-dark font-13",onClick:j,"data-bs-dismiss":"modal"},e[2]||(e[2]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),e[9]||(e[9]=t("div",{class:"modal-body approvermodalbody"},null,-1)),t("div",Ae,[(k(!0),q(he,null,be(P.value,(n,c)=>(k(),q("div",{key:c,class:we(["activity-log-item",{"last-item":c===P.value.length-1}])},[e[7]||(e[7]=t("div",{class:"activity-log-dot"},null,-1)),t("div",Be,[t("p",Ie,[e[3]||(e[3]=v(" On ")),t("strong",Je,w(se(n.creation)),1),e[4]||(e[4]=v(", ")),t("strong",je,[c==0?(k(),q("span",De,"you")):(k(),q("span",Te,w(n.user_name),1))]),v(" ("+w(n.role)+") ",1),t("strong",Ve,w(ae(n.action)),1),e[5]||(e[5]=v(" the request with the comments: ")),t("strong",We,w(n.reason||"N/A"),1),e[6]||(e[6]=v(". "))])])],2))),128))]),t("div",Ue,[e[8]||(e[8]=t("div",{class:"d-flex justify-content-between align-items-center gap-2"},null,-1)),B.value=="Request Raised"?(k(),q("div",He,[x(ke,{type:"button",class:"border-1 edit-btn text-nowrap font-10",onClick:ee,name:"Edit Form"})])):qe("",!0)])])])]),t("div",ze,[t("div",Ge,[t("div",Qe,[t("div",{class:"modal-header py-2 d-block bg-dark text-white"},[t("div",{class:"d-flex justify-content-between align-items-center"},[e[12]||(e[12]=t("div",null,[t("h5",{class:"m-0 text-white font-13",id:"exampleModalLabel"}," PDF format ")],-1)),t("div",{class:""},[t("button",{button:"button",class:"btn btn-dark text-white font-13",onClick:D},e[10]||(e[10]=[v(" Download Pdf"),t("span",{class:"ms-2"},[t("i",{class:"bi bi-download"})],-1)])),t("button",{type:"button",class:"btn btn-dark text-white font-13",onClick:j,"data-bs-dismiss":"modal"},e[11]||(e[11]=[v(" Close "),t("i",{class:"bi bi-x"},null,-1)]))])])]),t("div",Xe,[t("div",{innerHTML:A.value},null,8,Ye)]),e[13]||(e[13]=t("div",{class:"modal-footer"},null,-1))])])])])}}},tt=me(Ze,[["__scopeId","data-v-ecb034c4"]]);export{tt as default};
